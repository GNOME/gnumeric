2002-06-24  Jody Goldberg <jody@gnome.org>

	* src/func-builtin.c : finish cleaning out the 'selection' function
	and silence the warnings.

2002-06-23  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui-priv.h (SCG_FOREACH_PANE) : respect the
	  GnumericPane::is_active flag to begin support for h/v only freezing.
	* src/sheet-control-gui.c (scg_redraw_headers) : ditto.
	(scg_make_cell_visible) : ditto.

	* src/sheet-view.c (sv_attach_control) : position the cursors for the
	  newly attached control.

	* src/func-builtin.c (func_builtin_init) : delete the 'selection'
	  function.  It is no longer possible with a sheetview.

	* src/workbook-control-gui.c (cb_select_auto_expr) : remove
	  'selection(0)' argument and just pass function name.  The conversion
	  to SheetView forces a different methodology.
	* src/workbook-view.c (workbook_view_new) : ditto.
	(wb_view_auto_expr_recalc) : Make the call manually.

2002-06-22  Jody Goldberg <jody@gnome.org>

	* src/expr.h : support constructed ranges.
	* src/parser.y (parser_sheet_by_name) : ditto.
	* src/expr-name.c (name_refer_circular) : ditto.

	* src/expr.c (do_gnm_expr_unref) : support range_ctor and reorder to
	  produce a better jump table.
	(gnm_expr_equal) : ditto.
	(do_expr_as_string) : ditto.
	(gnm_expr_rewrite) : ditto.
	(ets_hash) : ditto.
	(ets_equal) : ditto.
	(expr_tree_sharer_share) : ditto.
	(expr_eval_real) : ditto and use gnm_expr_extract_ref.
	(gnm_expr_extract_ref) : new.

2002-06-21  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (workbook_view_new) : add views of all existing
	  sheets.

	* src/workbook-control-component.c (wbcc_sheet_focus) : move to new
	signature.

	* src/application.c (gnumeric_application_finalize) : do not free the
	  clipboard here.  It is too late.

2002-06-21  Jody Goldberg <jody@gnome.org>

	* src/parse-util.c (parse_cell_name) : take a cellpos *

	* src/func-builtin.c (gnumeric_selection) : dummy out for now until a
	  different approach is available.

	* src/commands.c : convert to sheetview.
	  s/parent/cmd/ to make things more readable
	(cmd_selection_clear) : rename from cmd_clear_selection so that we can
	  start to group the operations that currently operate on selections.
	(cmd_selection_format) : rename from cmd_format.
	(cmd_selection_colrow_hide) : rename from cmd_colrow_hide_selection.
	(cmd_selection_outline_change) : rename from cmd_colrow_outline_change.
	(cmd_selection_group) : rename from cmd_group.
	(cmd_selection_autoformat) : rename from cmd_autoformat.
	(cmd_colrow_hide_correct_selection) : take a control.

	* src/colrow.c (cb_colrow_visibility) : selections are now part of
	  sheetview.
	(colrow_get_visiblity_toggle) : ditto.

	* src/cmd-edit.c (cmd_select_cur_row) : convert to sheetview.
	(cmd_select_cur_col) : ditto.
	(cmd_select_cur_array) : ditto.
	(cmd_select_cur_depends) : ditto.
	(cmd_select_cur_inputs) : ditto.
	(cmd_paste_to_selection) : ditto.

	* src/bonobo-io.c (deserialize_wb_from_xml_stream) : pass the wbv into
	  the context directly.
	(gnumeric_bonobo_write_workbook) : ditto.
	(gnumeric_bonobo_read_workbook) : ditto.

	* src/consolidate.c (redraw_respan_and_select) : set selection only
	  for the calling view.
	(row_consolidate) : pass in the view.
	(col_consolidate) : ditto.
	(colrow_consolidate) : ditto.
	(consolidate_apply) : Take a control so that we can extract the view.

	* src/commands.c (cmd_consolidate_redo) : Pass the control.

2002-06-20  Jody Goldberg <jody@gnome.org>

	* src/sheet-view.c (sheet_view_init) : init the selection.

	* src/workbook-view.c (workbook_view_new) : init current_sheet_view.
	(wb_view_format_feedback) : operate on the sheetview.
	(wb_view_selection_desc) : ditto.
	(wb_view_edit_line_set) : ditto.

2002-06-20  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_sheet_add) : Use sheet_get_view.
	(wb_view_sheet_focus) : ditto.
	* src/xml-io.c (xml_write_selection_info) : ditto.
	(xml_read_selection_info): ditto.
	(xml_workbook_write) : now that the view is in the context don't
	  bother passing it.
	(xml_write_wbv_attributes) : ditto.
	(xml_read_wbv_attributes) : ditto.

2002-06-21  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/application.h (gnumeric_application_get_app) : new
	* src/application.c (gnumeric_application_get_app) : new
	(application_clipboard_clear) : emit "clipboard_modified" rather than
	  calling wb_control_menu_state_update on each control
	(application_clipboard_cut_copy) : ditto
	* src/libgnumeric.c (gnm_common_init) : remove debug spew, no need
	  to keep an app pointer
	(gnm_shutdown) : use gnumeric_application_get_app rather than a static 
	  app pointer
	* src/workbook-control-priv.h : new clipboard_changed_signal field in 
	  WorkbookControl
	* src/workbook-control.c (cb_wbc_clipboard_modified) : new
	(wbc_finalize) : disconnect signal handler
	(workbook_control_init) : new

2002-06-21  Morten Welinder  <terra@diku.dk>

	* configure.in: When checking for 2.96, use $CC.

2002-06-20  Jon K Hellan  <hellan@acm.org>

	* configure.in (have_pygtk): Add test for Pygtk.

	* acconfig.h: Add WITH_PYGTK

2002-06-19  Jody Goldberg <jody@gnome.org>

	* src/application.c (application_clipboard_cut_copy) : Use sv_weak_ref.
	(application_clipboard_clear) : Use sv_weak_unref.

	* src/workbook-view.c (wb_view_sheet_add) : create the view before
	  potentially looking for it.

	* src/workbook-edit.c (wbcg_edit_finish) : Accept text with only a
	  leading expr char as strings, we know they can not be expressions.

	* src/parse-util.c (gnumeric_char_start_expr_p) : be more lenient
	  about accepting leading '+' as the start of an expression.

	* src/application.c (application_set_selected_sheet) : merge into.
	(application_clipboard_cut_copy) : here.

2002-06-19  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/application.h : gobjectify
	* src/application.c : gobjectify; replace app. with app-> throughout
	(application_init) : deleted
	(gnumeric_application_init) : new
	(gnumeric_application_class_init) : new
	(application_display_dpi_set) : deleted
	(application_use_auto_complete) : use gconf
	(application_live_scrolling) : ditto
	(application_auto_expr_recalc_lag) : ditto
	(gnumeric_application_setup_icons) : new
	(gnumeric_application_finalize) : finalize
	* src/libgnumeric.c (gnm_common_init) : use new application object
	(gnm_shutdown) : ditto
	* src/commands.c (cmd_cell_range_is_locked_effective) : use range type
	(cmd_dao_is_locked_effective) : new
	(cmd_sort_redo) : check for locks

2002-06-19  Morten Welinder  <terra@diku.dk>

	* src/mathfunc.c: Update to R 1.5.1.
	(pexp, pweibull): Use R's version.  All callers
	changed to match new prototype.

2002-06-19  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_destroy) : no need to unant, that is a view
	  responsibility.

	* src/sheet-view.c (sv_weakref_notify) : new.
	(sv_weak_ref) : new.
	(sv_weak_unref) : new.
	(sv_unant) : move here from sheet.
	(sv_ant) : move here from sheet.
	(sv_selection_copy): from selection.c
	(sv_selection_cut) : from selection.c

	* src/sheet-control.c (sc_view) : new.

	* src/sheet-control-gui.c (scg_ant) : the animated cursors are now
	  stored in the view not the sheet.
	(context_menu_handler) : sync with the workbook control criteria for
	  enabling paste special.

	* src/selection.c (sheet_selection_copy) : start the process of
	  migrating to SheetView and move this there.
	(sheet_selection_cut) : ditto.

	* src/item-cursor.c (item_cursor_do_action) : pass a SheetView.

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : pass a
	  SheetView.

	* src/corba-sheet.c : untested patch to handle views.

	* src/commands.c (cmd_ins_del_colrow_undo) : use the sheetview.
	(cmd_ins_del_colrow_redo) : ditto.
	(cmd_ins_del_colrow_finalize) : remove weakref on the view.
	(cmd_ins_del_colrow) : add a weak ref to the view.

	* src/application.c (application_init) : we store a view now, not just
	  a sheet.
	(application_clipboard_clear) : update all workbooks, not just this
	  one, and store the view.
	(application_clipboard_unant) : use the view.
	(application_set_selected_sheet) : the selection is now view based.
	(application_clipboard_cut_copy) : take a view and remove the crufy
	  enable_paste_special flag.  That is handled locally.
	(application_clipboard_is_empty) : handle SheetView.
	(application_clipboard_is_cut) : ditto.
	(application_clipboard_sheet_get) : ditto.
	(application_clipboard_sheet_view_get) : ditto.

	* src/workbook-control-gui.c (wbcg_menu_state_update) : Use the
	  current sheet not some magic sheet.

	* src/sheet.c (sheet_new) : delete enable_paste_special.

	* src/workbook-control-gui.c (wbcg_menu_state_update) : paste special
	  is for local copies, use the application data rather than a sheet
	  local flag.

2002-06-19  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_attach_view) : renamed from sheet_attach_control.
	(sheet_detach_view) : renamed from sheet_detach_control.

	* src/sheet-view.c : new.

	* src/sheet-control.c (sc_sheet_set) : delete bogus.
	(sc_view) : new.

	* src/sheet-control-gui.c (sheet_control_gui_new) : A control now takes a
	  view in place of a model.

	* src/selection.c (sheet_selection_redraw) : adjustment to 
	  SHEET_FOREACH_CONTROL.

	* src/gnumeric.h : Add SheetView
	* src/Makefile.am : Add sheet-view.[ch]

2002-06-18  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_insert_current_date) : check for
	  failure to start editing.
	(cb_insert_current_time) : ditto.

2002-06-18  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-graph.c (gnm_graph_vector_seq_scalar) : forward port a
	  patch for keelyn.

	* src/file.c (gnum_file_saver_save_to_stream_real) : forward port a
	  warning suppression.

	* src/clipboard.c (clipboard_paste_region) : restore the expr_relocate
	  code in preparation for supporting the XL style heuristic.

	* src/GNOME_Gnumeric.xml : forward port some fixes.
	* src/sheet-object-widget.c (cb_scrollbar_value_changed) : ditto.
	(sheet_widget_scrollbar_set_sheet) : ditto.

2002-06-17  Jody Goldberg <jody@gnome.org>

	* src/dependent.c (cb_name_invalidate) : renamed from
	  cb_name_invalidate_sheet.  Just set the expression to NULL.
	  no need to be polite.  It just confuses things during workbook
	  destruction when the name references another sheet which has already
	  been destroyed.

2002-06-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_cell_range_is_locked_effective) : use 
	  gnumeric_error_invalid rather than gnumeric_notice,
	  change arguments to cmd_cell_range_is_locked_effective 
	  throughout.
	(cmd_selection_is_locked_effective) : change arguments
	(cmd_clear_redo) : check for locked cells
	(cmd_format_redo) : check for locked cells

2002-06-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_selection_is_locked_effective) : new
	(cmd_area_set_text_redo) : check for locked cells
	(cmd_ins_del_colrow_redo) : check for locked cells and split arrays

2002-06-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/application.c : add pixmaps
	* src/commands.c (cmd_reorganize_sheets_undo) : change call to 
	  cmd_reorganize_sheets
	(cmd_reorganize_sheets_redo) : ditto
	(cmd_reorganize_sheets_finalize) : handle lock lists
	(cmd_reorganize_sheets) : handle lock lists
	* src/commands.h (cmd_reorganize_sheets) : change arguments
	* src/workbook-control-gui.c : change calls to cmd_reorganize_sheets
	* src/workbook.c (workbook_sheet_reorganize) : handle changed locks
	* src/workbook.h (workbook_sheet_reorganize) : add arguments
	* src/pixmaps/Makefile.am : add padlock_no.xpm and padlock.xpm
	* src/pixmaps/padlock_no.xpm : new
	* src/pixmaps/padlock.xpm : new

2002-06-14  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_sheet_detach) : add comment that we should
	  not do the check if it is during destruction.
	(workbook_finalize) : Its too late to destroy the 3d depends here.
	* src/dependent.c (workbook_deps_destroy) : do it here.

	* src/parser.y (parser_sheet_by_name) : new utility function to
	  support applix style absolute sheet references.
	(sheetref) : parser_sheet_by_name.

2002-06-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_cell_range_is_locked_effective) : new
	(cmd_analysis_tool_redo) : check whether output region is locked.

2002-06-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (workbook_close_if_user_permits) :
	show "All" buttons only if multiple workbooks are open.
	
2002-06-13  Jody Goldberg <jody@gnome.org>

 	http://bugzilla.gnome.org/show_bug.cgi?id=85181
	* src/workbook-edit.c (wbcg_edit_start) : protect against recursion
	  before testing for protection, we may already have a dialog up.

2002-06-12  Rodrigo Moya <rodrigo@gnome-db.org>

	* src/file.c:
	* src/plugin-service.c: s/IS_GSF/GSF_IS

2002-06-11  Jon K Hellan  <hellan@acm.org>

	* src/file.c: Include unistd.h to declare unlink, close and read.

	* src/main-application.c: Inlude bonobo-main.h to declare
	bonobo_activate.

2002-06-10  Jon K Hellan  <hellan@acm.org>

	* src/file.c: Fix up includes to make the bonobo version build.

	* src/plugin-service.c: Ditto.

	* src/gui-file.c (ask_for_file_saver, gui_file_save_to_stream):
	Disable for now to make the bonobo version build.

	* src/workbook-control-gui.c (cb_file_send): Ditto.

2002-06-07  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_open) : convert to libgsf.

	* src/stf.c (stf_open_and_read) : convert to libgsf.
	(stf_preparse) : ditto.
	(stf_read_workbook) : ditto.
	(stf_read_workbook_auto_csvtab) : ditto.
	(stf_read_default_probe) : ditto.

	* src/stf-parse.c (stf_parse_is_valid_data) : actually disable the
	  wide char support if it is not available.

	* src/gutils.c (gnm_extension_pointer) : copied from libgnome to
	  decrease our dependence on it.

	* src/gui-util.c (gnumeric_editable_enters) : modernize a bit.

	* src/gnumeric-simple-canvas.c (gnm_simple_canvas_grab) : suppress
	  warning.

	* src/file.c (gnum_file_opener_probe_real) : Use libgsf.
	(gnum_file_opener_open_real) : ditto.
	(gnum_file_opener_probe) : ditto.
	(gnum_file_opener_open) : ditto.
	(gnum_file_saver_save_to_stream_real) : disable, we can move this out
	  of here when GsfOutput comes online.

	* src/collect.c (string_range_function) : suppress warning.

	* src/cell.c (cell_set_array_formula) : Adjust to the signature change
	  for gnm_expr_new_array.
	* src/sheet-autofill.c (autofill_cell) : ditto.

2002-06-07  Jody Goldberg <jody@gnome.org>

	* configure.in : require libgsf.

	* src/xml-io.c (xml_check_version) : move the sanity checking here.
	(gnumeric_xml_read_workbook) : rather than here.  Support GsfInput.
	(xml_probe) : and here.
	(gnumeric_xml_write_workbook_to_stream) : delete.

2002-05-31  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-simple-canvas.c (gnm_simple_canvas_grab) : actually
	  return the result.

2002-06-01  Jody Goldberg <jody@gnome.org>

 	http://bugzilla.gnome.org/show_bug.cgi?id=83794
	* src/stf.c (stf_read_workbook_auto_csvtab) : simple autodetection of
	  tab delimited vs csv

	http://bugzilla.gnome.org/show_bug.cgi?id=82847
	* src/value.c (parse_criteria_range) : Check for null in both cases.
	  Clean up a touch while we are in here.

2002-05-29  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am (EXTRA_DIST) : include main-component.c

2002-05-29  Jody Goldberg <jody@gnome.org>

	* configure.in : post release version bump

2002-05-29  Jody Goldberg <jody@gnome.org>

	* Release 1.1.4

2002-05-29  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : tweak to make automake happy

2002-05-27  Jody Goldberg <jody@gnome.org>

	* configure.in : up the gnome-print req.

2002-05-29  Jody Goldberg <jody@gnome.org>

	* src/parse-util.h : Add PERR_SINGLE_RANGE.

2002-05-29  Jon Kåre Hellan  <hellan@acm.org>

	* configure.in (try_python): Fix typo

2002-05-22  Jody Goldberg <jody@gnome.org>

	* src/clipboard.c (clipboard_paste_region) : remove
	  PASTE_EXPR_RELOCATE.  It was added so that sorting cells with
	  relative references would change, but it was not well considered and
	  causes breakage.

2002-05-21  Morten Welinder  <terra@diku.dk>

	* src/func-builtin.c (func_builtin_init, shutdown_cat): Use plain
	function_get_category.

	* src/func.c (function_get_category): Don't use NULL as translated
	name -- translate!
	(function_add_placeholder): Use plain function_get_category.

2002-05-21  Morten Welinder  <terra@diku.dk>

	* src/func.c (function_def_get_arg_name): Fix char/string type
	mismatch.  Bad Andreas!
	(functions_shutdown): Remove stubs for unknown functions.
	(function_add_placeholder): Keep track of unknown functions.

	* configure.in: Refuse to compile with gcc 2.96.

2002-05-20  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-dialogs.schemas : add 2 printer schemas
	* src/gnumeric-gconf-priv.h : add printer keys
	* src/gnumeric-gconf.c : add printer get/set methods
	* src/gnumeric-gconf.h : ditto
	* src/print.c (print_job_info_set_one_time_defaults) : add 2 settings
	(print_job_info_save_one_time_defaults) : ditto

2002-05-19  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_print_setup_redo) : dirty all sheets if
	  parent.sheet == NULL

2002-05-16  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-component.c (wbcc_set_sensitive): New
	(wbcc_menu_state_sensitivity): Remove
	(workbook_control_component_ctor_class): Register
	wbcc_set_sensitive and remove wbcc_menu_state_sensitivity.

2002-05-16  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_open) : Use wb_control_set_sensitive.

	* src/workbook-control-priv.h :
	  remove menu.set_sensitivity
	  add set_sensitive
	* src/workbook-control.[ch] : ditto.

	* src/workbook-control-gui.c (cb_thaw_ui_toolbar) : call
	  wbcg_menu_state_sensitivity directly.
	(wbcg_edit_set_sensitive) : ditto.
	(wbcg_set_sensitive) : new.
	(workbook_control_gui_ctor_class) : register wbcg_set_sensitive and
	  remove wbcg_menu_state_sensitivity.

2002-05-15  Andreas J. Guelzow <aguelzow@taliesin.ca>
	* src/print-info.c (print_info_set_margin_right) : remove some
	  debugging code

2002-05-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* configure.in : bump lignomeprintui req to 0.115.0
	* src/print-info.c (print_info_new) : margins are now in print_config
	(print_info_save) : ditto
	(print_info_dup) : ditto
	(print_info_get_margins) : new
	(print_info_set_margin_header) : new
	(print_info_set_margin_footer) : new
	(print_info_set_margin_left) : new
	(print_info_set_margin_right) : new
	(print_info_set_margins) : new
	* src/print-info.h (print_info_get_margins) : new
	(print_info_set_margin_header) : new
	(print_info_set_margin_footer) : new
	(print_info_set_margin_left) : new
	(print_info_set_margin_right) : new
	(print_info_set_margins) : new
	* src/print.c (print_hf_element) : margins are now in print_config
	(print_headers) : ditto
	(print_footers) : ditto
	(print_page) : ditto
	(print_job_info_get) : ditto
	* src/xml-io.c (xml_node_set_print_margins) : new
	(xml_node_get_print_margin) : new
	(xml_write_print_info) : margins are now in print_config
	(xml_print_info_fix_margins) : ditto
	(xml_read_print_margins) : ditto

2002-05-15  Morten Welinder  <terra@diku.dk>

	* src/main-application.c (warn_about_ancient_gnumerics): Don't
	complain unless the file name has a slash in it.

2002-05-14  Jon K Hellan  <hellan@acm.org>

	* src/main-component.c (control_activated_cb): Don't call
	bonobo_ui_component_rm. We got a warning from bonobo when the
	containing shell was deleted.

2002-05-14  Jon K Hellan  <hellan@acm.org>

	* src/GNOME_Gnumeric_Component.xml: Add File/Print setup,
	File/Print, File/Print preview.

	* src/workbook-control-component.c (cb_file_print_setup)
	(cb_file_print, cb_file_print_preview): New functions. Invoke
	File/Print setup, File/Print, File/Print preview.
	(verbs): Add File/Print setup, File/Print, File/Print preview.

	* src/main-component.c (gnumeric_component_factory): Initialize
	plugins. Yet another bpb.

2002-05-14  Morten Welinder  <terra@diku.dk>

	* configure.in (GNUMERIC_LOCALE_DIR): Deduce.
	* src/libgnumeric.c (init_init): Use GNUMERIC_LOCALE_DIR.

2002-05-14  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (read_from_stream): Brown paper bag.

2002-05-14  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (init_for_inflate): Use size of buffer, not size
	of pointer to buffer.

2002-05-13  Jon K Hellan  <hellan@acm.org>

	* src/cmd-edit.[ch] (cmd_paste): Remove 'time' parameter.

	* src/cmd-edit.c (cmd_paste): Call wb_control_paste_from_selection
	without 'time' parameter.
	(cmd_paste_to_selection): Call cmd_paste without 'time' parameter.

	* src/item-cursor.c (item_cursor_do_action): Remove 'time'
	parameter. Call cmd_paste without 'time' argument.
	(context_menu_hander, item_cursor_do_drop): Call
	item_cursor_do_action without 'time' argument.

	* src/gui-clipboard.[ch]: Switched to GtkClipboard API.
	(x_request_clipboard): Remove 'time' parameter.
	(x_clipboard_bind_workbook): Remove.
	(x_claim_clipboard): New function. Claims ownership of primary and
	clipboard.

	* src/gui-clipboard.c
	(x_clipboard_to_cell_region): Renamed from
	x_selection_to_cell_region.
	(x_clipboard_received): Renamed from
	x_selection_received. 'widget' parameter replaced with
	'clipboard', and 'time' parameter dropped. Call
	gtk_clipboard_request_contents instead of gtk_selection_convert.
	(x_clipboard_get_cb): Renamed from x_selection_handler. 'widget'
	parameter replaced with 'clipboard', and 'time' parameter dropped.
	Don't trust 'info' parameter. Gtk bug?
	(x_clipboard_clear_cb): New function. Replaces x_selection_clear,
	but even simpler.
	(x_request_clipboard): Call gtk_clipboard_request_contents instead
	of gtk_selection_convert.

	* src/workbook-control.[ch], src/workbook-control-priv.h: Remove
	'time' parameter from paste_from_selection method.

	* src/workbook-control-component.c (wbcc_claim_selection): Remove.
	(workbook_control_component_ctor_class): Inherit claim_selection
	from superclass.

	* src/workbook-control-gui.c (wbcg_paste_from_selection): Remove
	'time' parameter and call x_request_clipboard without 'time'
	parameter.
	(wbcg_claim_selection): Replace old implementation with call to
	new function x_claim_clipboard.
	(workbook_control_gui_init): Remove call to
	x_clipboard_bind_workbook.

2002-05-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/plugin.c (gnumeric_extra_plugin_dirs) : don't memorize the
	  answer
	(plugin_db_rescan) : new
	* src/plugin.h (plugin_db_rescan) : new

2002-05-12  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (workbook_close_if_user_permits) : add
	  arguments and add discard-all and save-all buttons when exiting.
	(cb_file_quit) : handle discard-all and save-all

2002-05-11  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-component.c (wbcc_set_transient_for):
	Enable bonobo_control_set_transient_for. It's fixed in libbonoboui
	now.

2002-05-11  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.c (gnm_gconf_rm_notification_autocorrect) :
	  renamed to gnm_gconf_rm_notification
	(nm_gconf_add_notification_plugin_directories) : new
	* src/gnumeric-gconf.h : ditto
	* src/gui-util.c (fsel_dir_handle_ok) : new
	(gnumeric_dialog_dir_selection) : new
	* src/gui-util.h (gnumeric_dialog_dir_selection) : new

2002-05-10  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (cb_file_preferences): Add wbcg
	argument to dialog_preferences.
	(cb_format_preferences): Ditto.

2002-05-10  Morten Welinder  <terra@diku.dk>

	* src/value.c (value_new_string_nocopy): New function.
	(value_new_string): Simplify.

2002-05-10  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (workbook_setup_sheets): Really
	revert kluge.

2002-05-10  Jon K Hellan  <hellan@acm.org>

	* src/gnumeric-canvas.c: oops. Committed this file by mistake, and
	have to revert.

2002-05-10  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (workbook_setup_sheets): Remove
	resize kluge. It broke things on Solaris.

2002-05-09  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add 3 printer schemax
	* src/gnumeric-gconf-priv.h : add printer keys
	* src/gnumeric-gconf.c : add printer get/set methods
	* src/gnumeric-gconf.h : ditto
	* src/print.c (print_job_info_set_one_time_defaults) : new
	(print_job_info_save_one_time_defaults) : new
	(print_job_info_get) : call print_job_info_set_one_time_defaults
	(sheet_print) : call print_job_info_save_one_time_defaults

2002-05-08  Jon K Hellan  <hellan@acm.org>

	* src/gui-util.c (gnumeric_dialog_run): Silence warnings.

2002-05-08  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c, src/workbook-control-gui-priv.h
	(wbcg_scroll_wheel_support_cb): Rename from
	cb_scroll_wheel_support and export protected.

	* src/workbook-control-component.c: Add more missing includes:
	commands.h, selection.h, sheet-control-gui.h, workbook-edit.h.
	(wbcc_validation_msg): Return a dummy 0 to satisfy prototype.
	(workbook_control_component_init): Remve unused drag_types
	variable. Add signal handler for mouse wheel scrolling.

2002-05-08  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-component.c: Include "dialogs.h" to get
	prototype for dialog_search.

	* src/bonobo-io.c (cleanup_stream): Return status.

2002-05-08  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control.[ch], src/workbook-control-priv.h
	(wb_control_edit_set_sensitive): New virtual, replacing
	workbook_edit_set_sensitive in workbook-edit. Made parameter names
	descriptive because it's now used far away from where it is
	defined.

	* src/workbook-control-component.c (wbcc_edit_set_sensitive): Null
	implementation of new virtual.
	(workbook_control_component_init): Construct, but don't show, the
	edit area, to avoid warnings when range selecting.
	(workbook_control_component_ctor_class): Register
	edit_set_sensitive implementation.

	* src/workbook-control-gui.[ch] (wbcg_toolbar_timer_clear): Moved
	from workbook-edit, renamed and exported.

	* src/workbook-control-gui.h (cb_thaw_ui_toolbar): Moved from
	workbook-edit.
	(wbcg_edit_set_sensitive): Implementation of new virtual
	wb_control_edit_set_sensitive, moved from workbook-edit and
	renamed from workbook_edit_set_sensitive.
	(workbook_control_gui_ctor_class): Register edit_set_sensitive
	implementation.

	* src/workbook-edit.c (toolbar_timer_clear, cb_thaw_ui_toolbar,
	workbook_edit_set_sensitive): Move to workbook-control-gui.
	(wbcg_edit_finish, (wbcg_edit_start, wbcg_edit_attach_guru,
	wbcg_edit_detach_guru):
	s/workbook_edit_set_sensitive/wb_control_edit_set_sensitive/

2002-05-08  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-edit.c : include gnumeric-gconf.h
	* src/workbook-edit.h : declare wbcg_edit_attach_guru_with_unfocused_rs

2002-05-08  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add unfocused-rs schema
	* src/gnumeric-gconf-priv.h : add unfocused-rs key and fix
	  print-setup-all-sheets key
	* src/gnumeric-gconf.c : add unfocused-rs get/set methods
	* src/gnumeric-gconf.h : ditto
	* src/workbook-edit.c (wbcg_edit_attach_guru_main) : new
	(wbcg_edit_attach_guru) : split off wbcg_edit_attach_guru_main
	(wbcg_edit_attach_guru_with_unfocused_rs) : new

2002-05-06  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (deserialize_wb_from_xml_stream)
	(gnumeric_bonobo_read_from_stream): Display message on error.

	* src/workbook-control-component.c
	(workbook_control_component_ctor_class): Inherit io context
	methods from wbcg.
	(wbcc_error_system, wbcc_error_read, wbcc_error_read)
	(wbcc_error_read, wbcc_error_save, wbcc_error_invalid)
	(wbcc_error_error_info): Remove.

	* src/gui-util.c (gnumeric_dialog_run): Use wbcg_set_transient
	instead of gtk_window_set_transient_for.

2002-05-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (print_job_info_get) : duplicate print_info
	(print_job_info_destroy) : destroy print_info
	(sheet_print) : use range info from print dialog

2002-05-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add print-setup-all-sheets schema
	* src/gnumeric-gconf-priv.h : add print-setup-all-sheets key
	* src/gnumeric-gconf.c : add print-setup-all-sheets get/set methods
	* src/gnumeric-gconf.h : ditto
	* src/commands.c (cmd_print_set_up) : allow sheet == NULL (ie. all sheets)
	(cmd_print_set_up_redo) : handle sheet == NULL
	(cmd_print_set_up_undo) : handle sheet == NULL

2002-05-05  Jon K Hellan  <hellan@acm.org>

	* GNOME_Gnumeric.server.in.in: Add Bonobo Zoomable interface.

	* src/main-component.c (control_activated_cb): Don't set
	wbcc->bcontrol here.
	(zoom_level_from_index, zoomable_set_zoom_level_cb,
	zoomable_zoom_in_cb, zoomable_zoom_out_cb,
	zoomable_zoom_to_fit_cb, zoomable_zoom_to_default_cb): New
	functions to support zoomable interface.
	(add_interfaces): Add zoomable interface.
	(gnumeric_component_factory): Call wbcc_set_bcontrol.

	* src/workbook-control-component.[ch]
	wbcc_get_zoom_factor): New function. Return zoom factor of current
	sheet.
	(wbcc_set_zoom_factor): New function. Set zoom factor for current
	sheet.
	(wbcc_sheet_focus): Report zoom level.
	(wbcc_set_bcontrol): New function. Setter for private 'bcontrol'
	attribute.
	(wbcc_set_zoomable): New function. Setter for private 'zoomable'
	attribute.
	(workbook_control_component_activate): Remove 'control' from
	signature. Use wbcc->bcontrol instead.

	* src/workbook-control-component.c (wbcc_zoom_feedback): Implement
	method.

	* src/workbook-control-component-priv.h (struct
	_WorkbookControlComponent): Add 'zoomable' attribute.

2002-05-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add zoom-factor schema
	* src/gnumeric-gconf-priv.h : add zoom-factor key
	* src/gnumeric-gconf.c : add zoom-factor get/set methods
	* src/gnumeric-gconf.h : ditto
	* configure.in : update libgnomeprint/libgnomeprintui req.
	* src/sheet.c (sheet_new) : use zoom factor from preferences

2002-05-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c : add cmd_print_set_up and friends
	* src/commands.h : add cmd_print_set_up
	* src/print-info.c (save_margin) : constify second argument
	(save_range) : ditto
	(print_info_margin_copy) : constify first argument and fix
	  silly typo
	(print_info_dup) : fix leak

2002-05-05  Jon K Hellan  <hellan@acm.org>

	* src/Makefile.am: Fix typo in GNOME_Gnumeric_Component.xml

2002-05-05  Pablo Saratxaga  <pablo@mandrakesoft.com>

	* configure.in: Added Vietnamese (vi) to ALL_LINGUAS

2002-05-05  Jon K Hellan  <hellan@acm.org>

	* src/GNOME_Gnumeric_Component.xml: Add UI for the viewer component.

	* src/Makefile.am: Add UI file for the viewer component.

	* src/gui-util.c (gnumeric_keyed_dialog): Use
	wbcg_set_transient instead of gnumeric_set_transient.

	* src/main-component.c (control_activated_cb): New signal handler
	to handle component activation/deactivation.
	(gnumeric_component_factory): Register activation/deactivation
	signal handler

	* src/workbook-control-component.[ch]
	(workbook_control_component_activate): New function. Merge in our
	UI.

	* src/workbook-control-component-priv.h
	(struct	_WorkbookControlComponent): Add bcontrol member for the
	BonoboControl.

	* src/workbook-control-component.c (wbcc_set_transient_for): New
	function. Set a dialog transient for the bonobo shell which
	contains us.
	(bcontrol_get_wbcg): New function. Get the WorkbookControl from
	the BonoboControl. This is implemented by means of object data on
	the BonoboControl.
	(cb_file_summary): New function. Pop up the Properties dialog.
	(cb_edit_copy): New function. Copy the selection.
	(cb_edit_search): New function. Pop up the search dialog.
	(cb_help_about): New function. Pop up the "About Gnumeric" dialog.
	(verbs): Add them.
	(workbook_control_component_init): Zero the bcontrol field.
	(workbook_control_component_ctor_class): Override the wbcg
	set_transient method.

	* src/workbook-control-gui.[ch] (wbcg_set_transient): New virtual
	method to set a dialog transient for the toplevel.

	* src/workbook-control-gui-priv.h (WorkbookControlGUIClass): Add
	set_transient virtual method.

	* src/workbook-control-gui.c (WBCG_CLASS, WBCG_VIRTUAL_FULL,
	WBGC_VIRTUAL): Define macros, analogous to macros in
	workbook-control.c.
	(wbcg_set_transient_for): New function. set_transient
	implementation for wbcg.
	(workbook_setup_sheets): Resize notebook from an idle handler to
	work around a display problem in the component. Explain why we had
	to do this.
	(workbook_control_gui_ctor_class): Add set_transient virtual method.

2002-05-04  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_colrow_get_default) : new.
	* src/commands.c (cmd_ins_del_colrow_redo) : Use it.

2002-05-04  Jukka-Pekka Iivonen  <jiivonen@cs144028.pp.htv.fi>

	* configure.in : Removed src/functions/Makefile.

2002-05-03  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/func-builtin.c : mark argument names for translation and adjust
	  them for use by the formula guru.
	* src/func.c (function_def_get_arg_name) : translate argument name

2002-05-03  Morten Welinder  <terra@diku.dk>

	* src/workbook-control-gui.c (cb_select_auto_expr): Filter out
	expressions that don't parse.  (Probably because some plugin
	wasn't loaded.)

2002-05-03  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add max-initial-clauses schema
	* src/gnumeric-gconf-priv.h : add max-initial-clauses key
	* src/gnumeric-gconf.c : add max-initial-clauses get/set methods
	* src/gnumeric-gconf.h : ditto

2002-05-03  Morten Welinder  <terra@diku.dk>

	* src/rangefunc.c (range_count): New function.
	* src/func-util.h: Remove.

2002-05-02  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print-info.c (print_info_free) : add print-config
	(print_info_new) : ditto
	(print_info_save) : ditto
	(print_info_dup) : ditto
	* src/print-info.h : add print-config to PrintInformation
	* src/print.c (print_job_info_get) : use
	  gnome_print_master_get_page_size_from_config
	(sheet_print) : use print_config included in PrintInformation
	* src/xml-io.c (xml_write_print_info) : use print_config included
	  in PrintInformation
	(xml_read_print_info) : ditto

2002-05-02  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : shift has noting
	  to do with this any more.

2002-05-02  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=79925
	* src/sheet-control-gui.c (scg_colrow_select) : flag failures to
	  initiate a selection
	* src/item-bar.c (item_bar_event) : only grab if the selection is
	  successful.

2002-05-02  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (sheet_print) : pass updated print-config to print-dialog

2002-05-01  Christophe Merlet  <christophe@merlet.net>

	* schemas/gnumeri-dialogs.schemas : Replaced // with /.
	* src/Makefile.am : Added main-application.c to $EXTRA_DIST.

2002-04-30  Jody Goldberg <jody@gnome.org>

	* src/dependent.c (cb_range_contained_collect) : begin support for
	  GnmRenderedRegion by adding support for non relocatable dependents.
	(cb_single_contained_collect) : ditto.

2002-04-29  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (gnumeric_pane_header_init) : set a
	  non-contraining scrollregion here in case something scrolls before we
	  are realized and a real region is assigned.

	* src/sheet-object.c (sheet_object_clone_sheet) : range == NULL is legal

	* src/sheet.c (sheet_clone_colrow_info_item) : Use colrow_copy.
	  While we're here use sheet_colrow_fetch too.
	(sheet_dup) : rename from sheet_duplicate to be consistent.

2002-04-29  Jody Goldberg <jody@gnome.org>

	* configure.in : post release version bump

2002-04-29  Jody Goldberg <jody@gnome.org>

	* Release 1.1.3

2002-04-28  Jody Goldberg <jody@gnome.org>

	* src/item-cursor.c : no need to do the gdk_flushes here.
	  the grab/ungrab wrappers handle it.

2002-04-29  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (deserialize_wb_from_xml_stream): New
	function. Factored out of gnumeric_bonobo_read_from_stream.
	Deserializes a Workbook from an XML stream.
	(read_from_stream): New function. Factored out of
	gnumeric_bonobo_read_from_stream. Handles bonobo stream oriented
	aspect of stream deserialization task.
	(gnumeric_bonobo_read_from_stream): Refactor so that only Workbook
	/ WorkbookView / WorkbookControl aspects of deserialization are
	handled here. The stream and XML concerns are factored out into
	separate functions. Also, fix reload bugs by making code more
	similar to wb_view_open. Still not perfect, but better.

2002-04-28  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c : no longer needs item-debug support.

	* src/sheet-object.c (sheet_object_view_key) : ARRGGGHHHH.
	  cut-n-paste error.

	* src/gnumeric-simple-canvas.c (gnm_simple_canvas_ungrab) : be anal
	  and gdk_flush.
	(gnm_simple_canvas_grab) : ditto.  We periodically do some processing
	  after an ungrab which might delay flushing the event queue.  Which
	  could result in the grab remaining for the duration of the event.

2002-04-28  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (gnumeric_bonobo_read_from_stream): Initialize
	wb, drop dirty test. This fixes component display bug.

2002-04-28  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (gnumeric_bonobo_read_from_stream): Drop
	workbook_is_pristine test. In the viewer, we know we shouldn't
	save, but the test gives suprising results.

2002-04-27  Jody Goldberg <jody@gnome.org>

	* src/item-acetate.c (item_acetate_point) : remember that the far
	  point is not included.

	* src/bonobo-io.c (gnumeric_bonobo_read_from_stream) : similar to
	  wb_view_open we need to recalc as necessary and do a sheet_update.

	* src/workbook-control-gui.c (cb_insert_image) : no need to recalc or
	  update.

2002-04-27  Jon K Hellan  <hellan@acm.org>

	* configure.in: Check for bonobo libraries when --with-bonobo is
	selected.

2002-04-27  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_finalize) : destroy the views
	  before we destroy the control.

	* src/sheet-object.c (cb_sheet_object_view_finalized) : renamed from
	  sheet_object_view_destroyed and simplified to use weakrefs.  At this
	  point all we can do is remove the view from the list.
	(sheet_object_new_view) : using weakrefs we are more constrained.
	  object data is already done so there is no need to add refs to the
	  control.

2002-04-26  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_add) : Use
	  sc_object_create_view.

	* src/sheet-control-gui-priv.h (SCG_FOREACH_PANE) : new.
	* src/sheet-control-gui.c (scg_redraw_all) : use SCG_FOREACH_PANE.
	(scg_redraw_region) : ditto.
	(scg_resize) : ditto.
	(scg_set_zoom_factor) : ditto.
	(cb_table_destroy) : ditto.
	(sheet_control_gui_new) : ditto.
	(scg_unant) : ditto.
	(scg_ant) : ditto.
	(scg_adjust_preferences) : ditto.
	(scg_cursor_visible) : ditto.
	(scg_compute_visible_region) : ditto.
	(scg_edit_start) : ditto.
	(scg_edit_stop) : ditto.
	(scg_rangesel_changed) : ditto.
	(scg_rangesel_start) : ditto.
	(scg_rangesel_stop) : ditto.
	(scg_set_display_cursor) : ditto.
	(scg_colrow_resize_stop) : ditto.
	(scg_colrow_resize_start) : ditto.
	(scg_colrow_resize_move) : ditto.
	(scg_special_cursor_start) : ditto.
	(scg_special_cursor_stop) : ditto.
	(scg_special_cursor_bound_set) : ditto.
	(scg_object_stop_editing) : clear the control points in the panes.
	(scg_mode_edit_object) : ditto.
	(scg_object_update_bbox) : ditto.

	* src/gnumeric-pane.c (gnm_pane_init) : init anted_cursors and the
	  control points.  Optionally create views of all the objects if we
	  already have a sheet.
	(gnm_pane_object_stop_editing) : transfered from scg.
	(gnm_pane_object_move) : ditto.
	(cb_slide_handler) : ditto.
	(display_object_menu) : ditto.
	(cb_control_point_event) : ditto.
	(new_control_point) : ditto.
	(set_item_x_y) : ditto.
	(set_acetate_coords) : ditto.
	(gnm_pane_object_set_bounds) : ditto.
	(cb_sheet_object_canvas_event) : ditto.
	(cb_sheet_object_view_destroy) : ditto.
	(cb_sheet_object_widget_canvas_event) : ditto.
	(gnm_pane_object_register) : ditto.
	(gnm_pane_widget_register) : ditto.

	* src/sheet-control-gui.c (scg_object_destroy_view) : new.
	(scg_object_create_view) : new.
	(scg_class_init) : register the new functions.

	* src/sheet-object*.c
	(*update_bounds) : update signature.
	(*new_view) : update signature.

2002-04-26  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (compute_sheet_pages) : don't overwrite number of
	  pages from previous sheets.

2002-04-26  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (get_bytes_from_compressed_stream): Fix typo

2002-04-26  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.c (struct StreamIOCtxt): Context data structure
	for reading a PersistStream.
	(get_raw_bytes_from_stream): New function. Read raw bytes from the
	stream.
	(get_bytes_from_compressed_stream): New function. Uncompress bytes
	from the stream and copy wanted number of bytes into buffer.
	(get_bytes_from_stream): New function. Read bytes from the stream,
	having uncompressed them if necessary.
	(cleanup_stream): New function. Clean up zlib when closing stream.
	(check_gzip_header): New function. Check if stream is gzipped.
	(init_for_inflate): New function. Initialize data structures for
	uncompressing.
	(hack_xmlSAXParseFile): Drop the non HAVE_LIBXML_2 branch. Rename
	context variables: We now have both an xml context and a stream
	context.
	(gnumeric_bonobo_read_from_stream): Set up handling of compressed
	streams. Propagate CORBA exceptions where allowed by the
	PersistStream interface.

2002-04-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add sort schemas
	* src/gnumeric-gconf-priv.h : add sort related keys
	* src/gnumeric-gconf.[ch] : add sort-related get/set methods
	* src/sort.[ch] : use preferences, add preserve formats flags
	* src/workbook-control-gui.c (sort_by_rows) : use preferences

2002-04-25  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (set_acetate_coords) : work around some
	  strange code in the canvas-shape that was blowing out the borders.

2002-04-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-canvas.[ch] : add sheet_object_group
	* src/commands.c : add selector to cmd_object_raise
	* src/commands.h : ditto
	* src/sheet-object-container.c : use sheet_object_group
	* src/sheet-object-graphic.c : ditto
	* src/sheet-object-image.c : ditto
	* src/sheet-object-item.c : ditto
	* src/sheet-object.c (cb_sheet_object_raise_to_top) : new
	(cb_sheet_object_lower_to_bottom) : new
	(sheet_object_populate_menu) : add raise to top/lower to bottom
	  menu items

2002-04-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/item-grid.c (ig_obj_create_finish) : don't unref the sheet
	  object, the ref has already been absorbed elsewhere.
	  http://bugzilla.gnome.org/show_bug.cgi?id=79809

2002-04-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.[ch] (cmd_object_raise) : new command
	* src/sheet-object.h (sheet_object_raise) : new
	* src/sheet-object.c (sheet_object_raise) : new
	(cb_sheet_object_raise) : new
	(cb_sheet_object_lower) : new
	(sheet_object_populate_menu) : add raise/lower menu items

2002-04-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (setup_rotation) : deleted
	(print_page) : remove call to setup_rotation
	(sheet_print) : no need to hide landscape printing

2002-04-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (sheet_print) : work around some gnome-print bug and hide
	  landscape printing temporarily.

2002-04-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/application.c (application_clipboard_clear) : also clear CLIPBOARD
	* src/gui-clipboard.c (x_selection_clear) : clear selection only if PRIMARY
	  is asserted elsewhere
	(x_clipboard_bind_workbook) : set CLIPBOARD targets
	* src/workbook-control-gui.c (wbcg_claim_selection) : claim PRIMARY and
	  CLIPBOARD

2002-04-23  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_analysis_tool_undo) : reset column widths and
	  row heights
	(cmd_analysis_tool_redo) : save column widths and row heights
	(cmd_analysis_tool) : initialize column widths and row heights save lists
	(cmd_analysis_tool_finalize) : delete column widths and row heights save lists

2002-04-21  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* idl/Makefile.am: introduce EVOLUTION_IDL_DIR to support building
	with Evolution-Composer.idl in a non-standard location.

2001-11-04  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: added gdk_pixbuf to the libs considered for
	GNUMERIC_CFLAGS and GNUMERIC_LIBS.

2001-10-27  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in : Support --with-python=prog consistently: never call
	`python', always call $python_prog.

2001-10-21  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* idl/Makefile.am : Introduced EVOLUTION_IDL_DIR to make it possible
	  to use Evolution-Composer.idl from a non-standard location.

2001-11-04  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: added gdk_pixbuf to the libs considered for
	GNUMERIC_CFLAGS and GNUMERIC_LIBS.

2002-04-22  Morten Welinder  <terra@diku.dk>

	* src/value.c (criteria_test_equal, criteria_test_unequal,
	criteria_test_less, criteria_test_less_or_equal,
	criteria_test_greater, criteria_test_greater_or_equal,
	parse_criteria, parse_criteria_range, free_criterias,
	find_rows_that_match, parse_database_criteria,
	find_column_of_field): Move from fn-database.

2002-04-22  Morten Welinder  <terra@diku.dk>

	* src/expr-name.c (expr_name_shutdown): New function.

	* src/libgnumeric.c (gnm_common_init, gnm_shutdown): Fix
	prototype.
	(gnm_shutdown): Shut down expr_name.

2002-04-19  Morten Welinder  <terra@diku.dk>

	* src/expr.c (gnm_expr_new_error): Remove.

	* src/func-builtin.c (gnumeric_selection, gnumeric_version): Moved
	from fn-sheet.

2002-04-19  Jon K Hellan  <hellan@acm.org>

	* src/bonobo-io.[ch] (gnumeric_bonobo_read_from_stream): New
	function. Reads a workbook from a Bonobo PersistStream.

	* src/bonobo-io.c (hack_xmlSAXParseFile): Re-enable

	* src/main-component.c: No longer a dummy. Remove DUMMY compile
	flag.
	(load_workbook_from_stream): Remove.
	(dummy_add_interfaces): Rename to add_interfaces. Pass control to
	bonobo_persist_stream_new.
	(gnumeric_component_factory): Make a real gnumeric component.

	* src/sheet-control-gui.c (scg_take_focus): Test if wbcg_toplevel
	!= NULL.

	* src/workbook-control.[ch] (wb_control_menu_state_sheet_count):
	New virtual.

	* src/workbook-control-priv.h: Virtualize menu_state.sheet_count.

	* src/workbook-control-component.c (wbcc_get_password,
	wbcc_progress_set, wbcc_progress_message_set, wbcc_init_state,
	wbcc_title_set, wbcc_format_feedback, wbcc_zoom_feedback,
	wbcc_edit_line_set, wbcc_edit_selection_descr_set,
	wbcc_auto_expr_value, wbcc_undo_redo_clear,
	wbcc_undo_redo_truncate, wbcc_undo_redo_pop, wbcc_undo_redo_push,
	wbcc_undo_redo_labels, wbcc_menu_state_update,
	wbcc_menu_state_sheet_prefs, wbcc_menu_state_sheet_count,
	wbcc_menu_state_sensitivity, wbcc_validation_msg): New no-op
	methods.
	(wbcc_error_system, wbcc_error_plugin, wbcc_error_read,
	wbcc_error_save, wbcc_error_invalid, wbcc_error_error_info,
	wbcc_control_new, wbcc_sheet_focus, wbcc_claim_selection): New
	methods.
	(workbook_control_component_init): New function.
	(workbook_control_component_ctor_class): Flesh out.
	(workbook_control_component_new): New function.

	* src/workbook-control-gui.[ch] (wbcg_sheet_to_page_index): Rename
	from sheet_to_page_index and make public.

	* src/workbook-control-gui.c (wbcg_cur_scg, wbcg_sheet_remove,
	wbcg_sheet_rename, wbcg_sheet_focus, wbcg_sheet_move, cb_edit_cut,
	cb_sheet_remove): Use new name of from sheet_to_page_index and
	make public.
	(wbcg_sheet_add): Use virtualized menu_sheet_count.
	(workbook_control_gui_ctor_class): Virtualize menu_sheet_count.

2002-04-18  Morten Welinder  <terra@diku.dk>

	* src/expr-name.c (expr_name_add): Plug leaks.

	* src/gnumeric-graph.c: Resurrect enough so that the excel plugin
	will load.  This doens't mean things will work!

	* src/func-builtin.c (func_builtin_init): New file.  Some stuff
	from src/functions/fn-math.c imported.

	* src/libgnumeric.c (gnm_shutdown): Shutdown functions also.

	* src/func.c (functions_init): Init builtins.
	(functions_shutdown): New function.

2002-04-18  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_error_info_dialog_show) : hide cursor

2002-04-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-file.c : replace gnome-config with get/set methods from
	  src/gnumeric-gconf.h
	* schemas/gnumeric-general.schemas : new schemas
	* src/gnumeric-gconf-priv.h : new keys
	* src/gnumeric-gconf.[ch] : new get/set methods

2002-04-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.[ch] (gnumeric_dialog_show) : deleted
	* src/gui-file.c (ask_for_file_saver) : change GnomeDialog to GtkDialog
	  NOTE: untested change!
	* src/sheet-object-container.c (sheet_object_container_new_file) :
	  change GnomeDialog to GtkDialog.  NOTE: untested change!

2002-04-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_error_info_dialog_show_full) : renamed to
	  gnumeric_error_info_dialog_show and rewritten
	(gnumeric_error_info_dialog_show) : deleted
	(ctree_insert_error_info) : deleted
	(insert_error_info) : new

2002-04-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_error_info_dialog_show_full) : converted from
	  GnomeDialog to GtkDialog

2002-04-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add xml-compression schema
	* src/gnumeric-gconf-priv.h : new xml-compression-level key
	* src/gnumeric-gconf.[ch] : new xml-compression-level get/set functions
	* src/xml-io.c : use get/set methods from src/gnumeric-gconf.h rather
	  than gnome-config directly

2002-04-16  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_open) : merge with wb_view_open_custom
	  and remove the useless view argument.

	* src/libgnumeric.c : move the application specific code from here.
	* src/main-application.c : to here.

	* configure.in : Addd gobject & gmodule

2002-04-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add window size schemas
	* src/gnumeric-gconf-priv.h : add window size keys
	* src/gnumeric-gconf.[ch] : add window size set/get methods
	* src/workbook-control-gui.c : use gconf for all preferences

2002-04-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-dialogs.schemas : add more schemas
	* src/commands.c : use get/set methods from src/gnumeric-gconf.h
	* src/file-autoft.[ch] : switch from gnome-config to gconf
	* src/gnumeric-gconf-priv.h : more keys
	* src/gnumeric-gconf.[ch] : more get/set methods
	* src/gutils.[ch] (gnumeric_config_get_string_list) : deleted

2002-04-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-dialogs.schemas : new plugin schemas
	* src/Makefile.am : add src/gnumeric-gconf.c and src/gnumeric-gconf-priv.h
	* src/application.c : use get/set methods from src/gnumeric-gconf.h
	* src/commands.c : change include
	* src/error-info.c : switch to GSLists from GLists
	* src/error-info.h : switch to GSLists from GLists
	* src/gnumeric-gconf.h : new get/set methods
	* src/gnumeric-gconf.c : new
	* src/gnumeric-gconf-priv.h : formerly src/gnumeric-gconf.h
	* src/gui-util.c : switch to GSLists from GLists
	* src/gutils.h : some new g_slist functions
	* src/gutils.c : some new g_slist functions
	* src/libgnumeric.c : use get/set methods from src/gnumeric-gconf.h
	* src/plugin-loader-module.c : switch to GSLists from GLists
	* src/plugin-loader.c : switch to GSLists from GLists
	* src/plugin-loader.h : switch to GSLists from GLists
	* src/plugin-service.c : switch to GSLists from GLists
	* src/plugin.c : switch to GSLists from GLists and use gconf
	* src/plugin.h : switch to GSLists from GLists
	* src/workbook-control-gui.c : use get/set methods from src/gnumeric-gconf.h

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/.cvsignore: Ingore gnumeric-component

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/main-component.c (gnumeric_component_factory): And another one.

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/main-component.c (gnumeric_component_factory): Silence
	warning.

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/main.[ch]: Remove from CVS.

	* src/libgnumeric.c: Really don't include main.h

2002-04-15  Jody Goldberg <jody@gnome.org>

	* src/libgnumeric.c : delete some stale code that is no longer needed
	  in gtk2.

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/libgnumeric.h: Rename header guards after file rename.

	* src/main.[ch]: Add notes that the files are obsolete

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/libgnumeric.c: Copied from src/main.c. Don't include main.h

	* src/libgnumeric.h: Copied from src/main.h

	* src/corba-args.c: s/main.h/libgnumeric.h/

	* src/main-application.c: s/main.h/libgnumeric.h/

	* src/main-component.c: s/main.h/libgnumeric.h/

	* src/normal-args.c: s/main.h/libgnumeric.h/

	* src/print.c: s/main.h/libgnumeric.h/

	* src/workbook.c: s/main.h/libgnumeric.h/

	* src/workbook-control-gui.c: s/main.h/libgnumeric.h/

2002-04-15  Jon K Hellan  <hellan@acm.org>

	* src/main.[ch]: Restructure.

	* src/gui-gnumeric.h: Declare WorkbookControlComponent and
	WorkbookControlStandalone.

	* GNOME_Gnumeric.server.in.in: Add gnumeric-component /
	OAFIID:GNOME_Gnumeric_Factory

	* src/Makefile.am: Add gnumeric-component to build, and new files.

	* src/workbook-control-gui.h (WORKBOOK_CONTROL_GUI_CLASS): Fix typo.

	* src/workbook-control-standalone.h: New file. wbcg class for
	standalone app - public header file. Dummy for now.

	* src/workbook-control-standalone.c: New file. wbcg class for
	standalone app - source file. Dummy for now.

	* src/workbook-control-standalone-priv.h: New file. wbcg class for
	standalone app - private header file. Dummy for now.

	* src/workbook-control-component.h: New file. Bonobo component
	class - public header file. Dummy for now.

	* src/workbook-control-component.c: New file. Bonobo component
	class - source file. Dummy for now.

	* src/workbook-control-component-priv.h: New file. Bonobo
	component class - private header file. Dummy for now.

	* src/main-component.c: New file. Main entry point for Bonobo
	component.

	* src/main-application.c: New file: Main entry point for
	standalone application.

2002-04-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-dialogs.schemas : add more preferences
	* src/application.c : move autocorrect_init into src/main.c
	* src/gnumeric-gconf.h : added defines and comments
	* src/main.c : add autocorrect_init and autocorrect_shutdown

2002-04-15  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (sheet_cell_add_to_hash): Plug leak.

2002-04-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add various new preferences
	* schemas/gnumeric-dialogs.schemas : fix capitalization
	* src/application.c : switch gnome_config to gconf
	* src/gnumeric-gconf.h : new preferences

2002-04-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/rangefunc-strings.c : fix warning
	* src/history.c : fis argument type in non-bonobo build

2002-04-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add max number of undo items pref
	* src/commands.c (truncate_undo_info) : also truncate if max number
	  of items is exceeded.
	* src/gnumeric-gconf.h : add max number of undo items pref

2002-04-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/GNOME_Gnumeric.xml : Change menu text for Sheet Reorder/Manage
	* src/workbook-control-gui.c : Change tooltip for Sheet Manage

2002-04-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add history and n of sheets
	  preferences
	* src/Makefile.am : add src/rangefunc-strings.[ch]
	* src/application.c : change file history handling to gconf,
	  change app.history_list to GSList from GList
	* src/application.h : change app.history_list to GSList from GList
	* src/collect.c : add string functions
	* src/collect.h :add string functions
	* src/gnumeric-gconf.h : add history and n of sheets preferences
	* src/history.c : change history_list to GSList from GList
	* src/history.h : change history_list to GSList from GList
	* src/main.c : add user-specified number of sheets to first workbook
	* src/workbook-control-gui.c : add user-specified number of sheets
	  to new workbooks
	* src/workbook.c : change history_list to GSList from GList
	* src/rangefunc-strings.h : new
	* src/rangefunc-strings.c : new

2002-04-14  Jon K Hellan  <hellan@acm.org>

	* src/main.h (has_gnumeric_been_compiled_with_guile_support):
	This function disappeared long ago. Remove.

2002-04-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/collect.c (callback_function_collect) : keep missing data info
	(collect_floats) : afdd missing data info handling
	(collect_floats_value_with_info) : new
	(cb_insert_diff_elements) : new
	(cb_int_descending) : new
	(union_of_int_sets) : new
	(cb_remove_missing_el) : new
	(strip_missing) : new
	(float_range_function2) : use flags
	* src/collect.h (CollectFlags) : 2 new flags
	* src/commands.c (max_descriptor_width) : fix sense of test.

2002-04-13  Jody Goldberg <jody@gnome.org>

	* src/commands.c (max_descriptor_width) : add some protection.

2002-04-13  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_cellregion_write) : Patch massive leak introduced
	  in the transition to libxml2.  Thanks Andreas.

2002-04-13  Morten Welinder  <terra@diku.dk>

	* */*: Make fn-financial a plugin.

	* src/commands.c (cmd_range_list_to_string_utility): Try not to
	allocate gigabytes of memory for no reason.

2002-04-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_range_to_str_utility) : new
	* src/commands.h (cmd_range_to_str_utility) : new

2002-04-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/value.c (value_get_as_string) : handle VALUE_ARRAY more reasonably
	(value_peek_string) : initialize all fields of cache

2002-04-13  Jon K Hellan  <hellan@acm.org>

	* src/gui-file.c: s/ENABLE_BONOBO/WITH_BONOBO/

	* src/gui-util.c: Ditto.

	* src/history.c: Ditto.

	* src/main.c: Ditto.

	* src/sheet.c: Ditto.

	* src/sheet-object.c: Ditto.

	* src/workbook-control-gui.c: Ditto.

	* src/workbook-format-toolbar.c: Ditto.

	* src/workbook-object-toolbar.c:

	* src/workbook.c: Ditto.

	* src/workbook-private.c: Ditto.

	* src/xml-io.c: Ditto.

2002-04-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add 2 undo preference settings
	* src/commands.c : add sheet name to descriptors depending on
	  preference setting
	* src/commands.h : add cmd_range_list_to_string_utility and
	  cmd_cell_pos_name_utility
	* src/gnumeric-gconf.h : new file, gather gconf paths in a single
	  includable place

2002-04-12  Jody Goldberg <jody@gnome.org>

	* src/workbook-private.c :  move the really broken bonobo stuff here.

	* src/sheet-control-gui.c (scg_object_update_bbox) : Use fabs to
	  handle inversion.
	(scg_mode_edit_object) : Be a touch more anal.

	* src/style.c (get_substitute_font) : add more font mappings.

	* src/item-grid.c (ig_obj_create_finish) : no need to moneky with the
	  internals of scg.  Setting the mode clears the new object.  Setting
	  the sheet adds a ref, so there are no worries that it will go away.

	* src/gnumeric-canvas.c : rip out the drag and drop support.
	* src/workbook-control-gui.c : move it here.
	(cb_insert_image) : silence a warning.
	(cb_edit_cut) : at least make the object deletetion undoable.
	(workbook_close_if_user_permits) : reorder to conform to HIG.

2002-04-08  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_object_stop_editing) : unref the
	  current object.
	(scg_mode_edit_object) : ref the current object.

	* src/item-grid.c (ig_obj_create_finish) : Use
	  scg_mode_edit_object.
	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object) : Use
	  sc_mode_edit to handle objects that are still being created.

2002-04-06  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_object_update_bbox) : abs the dif when
	  checking for middle ctrl points.

2002-04-01  Jody Goldberg <jody@gnome.org>

	* src/gui-util.c (gnumeric_toolbar_new) : minor clean up.
	  one init is sufficient.

2002-04-12  Jon K Hellan  <hellan@acm.org>

	* src/GNOME_Gnumeric.xml (FilePrintSetup): Add back "print" stock icon.
	(FilePreferences): Add as menu item.
	(InsertGraph, InsertComponent, InsertShapedComponent): Comment out
	both from menu and toolbar.
	(InsertImage, InsertFormula): Add to "Insert" menu.
	(List, Combo): Re-enable in object toolbar.

2002-04-12  Morten Welinder  <terra@diku.dk>

	* src/auto-format.c (auto_format_init): Install a key destroyer.
	(auto_format_shutdown): Simplify.
	(auto_format_function_result_by_name): New function.
	(auto_format_function_result): Use
	auto_format_function_result_by_name.
	(auto_format_function_result_remove): New function.

2002-04-12  Jon K Hellan  <hellan@acm.org>

	* src/workbook-format-toolbar.c: Replace Gnome stock pixmap names
	with gtk synonym.

	* src/item-cursor.c (item_cursor_popup_menu): Replace Gnome stock
	copy pixmap name with gtk synonym.

2002-04-12  Jon K Hellan  <hellan@acm.org>

	* src/GNOME_Gnumeric.xml: Update to current pixmap names. Add
	'preferences' command.

2002-04-12  Jon K Hellan  <hellan@acm.org>

	* plugins/Makefile.am (SUBDIRS_FILE_FORMATS): Plan Perfect plugin
	  got installed, but not built. Don't do either.

2002-04-12  Jon K Hellan  <hellan@acm.org>

	* configure.in (bonobo_msg): (re)introduce ENABLE_BONOBO variable
	and bonobo_suffix.

	* src/Makefile.am (uidir): Update to gnome-2 conventions.

	* idl/GNOME_Gnumeric.idl
	(GNOME::Gnumeric::Application.new_workbook): Fix syntax error.

	* src/bonobo-io.c: #ifdef out the lot for now.

	* src/gnumeric-graph.c: ditto.

	* src/sheet-object-bonobo.c: ditto.

	* src/sheet-object-container.c: ditto.

	* src/sheet-object-item.c: ditto.

	* src/main.c (main): #ifdef out gnumeric_bonobo_io_init for now.
	(main): #ifdef out EmbeddableGridFactory_init.

	* src/print.c: Remove bonobo-print-client.h include.

	* src/sheet-object.c (sheet_object_register): #ifdef out bonobo
	object registration.

	* src/workbook.c (workbook_is_pristine, workbook_init,
	workbook_new): #ifdef bonobo case to be the same as non bonobo for
	now.
	(workbook_persist_file_load, workbook_persist_file_save,
	workbook_bonobo_setup): #ifdef out for now.

	* src/workbook-control-gui.c (cb_launch_graph_guru,
	insert_bonobo_object, cb_insert_component,
	cb_insert_shaped_component): #ifdef out for now.
	(verbs): #ifdef out GraphGuru, InsertComponent and
	InsertShapedComponent for now.

	* src/workbook-private.[ch]: #ifdef bonobo case to be the same as non
	bonobo for now.

2002-04-11  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/dependent.c (dependent_set_expr) : fix leak
	(invalidate_refs) : fix leak
	(cb_name_invalidate_sheet) : fix leak
	* src/expr-name.c (expr_name_create) : fix leak

2002-04-11  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-object-graphic.c (cb_dialog_graphic_config_apply_clicked) :
	  removed
	(cb_dialog_graphic_config_ok_clicked) : don't call
	  cb_dialog_graphic_config_apply_clicked
	(cb_adjustment_value_changed) : also change real sheet object
	(cb_color_changed) : ditto
	(cb_dialog_filled_config_apply_clicked) : removed
	(cb_dialog_filled_adjustment_value_changed) : new
	(cb_dialog_filled_color_changed) : new
	(cb_dialog_filled_config_ok_clicked) : don't call
	  cb_dialog_filled_config_apply_clicked
	(sheet_object_filled_user_config) : hook-up cb_dialog_filled_*_changed
	* src/sheet-object-widget.c (cb_scrollbar_config_ok_clicked) : save
	  all data
	(cb_checkbox_config_destroy) : delete old_label
	(cb_checkbox_config_cancel_clicked) : reset all data
	(sheet_widget_checkbox_user_config) : save old label

2002-04-11  Morten Welinder  <terra@diku.dk>

	* */*: Make new plugins fn-eng from src/functions/fn-eng.c

	* src/parser.y (gnumeric_parse_error): Plug leak.

	* src/item-edit.c (item_edit_destroy): Fix memory corruption on
	double destroys.

2002-04-10  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-object-graphic.c (sheet_object_filled_user_config) : don't
	  use GnomeDialog. Use Glade.
	(cb_dialog_filled_config_destroy) : replaces cb_dialog_filled_close
	(cb_dialog_filled_config_apply_clicked) : replaces cb_dialog_filled_clicked
	(cb_dialog_filled_config_ok_clicked) : new
	(cb_dialog_filled_config_cancel_clicked) : new

2002-04-10  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-object-graphic.c (sheet_object_graphic_user_config) : add line
	  preview

2002-04-10  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-object-graphic.c (sheet_object_graphic_user_config) : don't
	  use GnomeDialog. Use Glade.
	(cb_dialog_graphic_config_destroy) : replaces cb_dialog_graphic_close
	(cb_dialog_graphic_config_apply_clicked) : replaces cb_dialog_graphic_clicked
	(cb_dialog_graphic_config_ok_clicked) : new
	(cb_dialog_graphic_config_cancel_clicked) : new
	(cb_adjustment_value_changed) : use changed DialogGraphicData

2002-04-10  Morten Welinder  <terra@diku.dk>

	* src/clipboard.c (paste_cell_with_operation): Plug leak.
	(paste_link): Ditto.

2002-04-10  Morten Welinder  <terra@diku.dk>

	* src/parse-util.c (cellref_a1_get): Fix toupper usage.  Make this
 	work for non-English.  Check for overflow in row number.

2002-04-10  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* sheet-object-widget.c (cb_checkbox_config_ok_clicked) : plug
 	expr leak
	(cb_scrollbar_config_ok_clicked) : plug expr leak

2002-04-10  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* sheet-object-widget.c (cb_checkbox_config_cancel_clicked) : new
	(cb_checkbox_config_ok_clicked) replaces cb_scrollbar_config_clicked
	(sheet_widget_checkbox_user_config) : don't use GnomeDialog

2002-04-09  Morten Welinder  <terra@diku.dk>

	* src/rendered-value.c (rendered_value_new,
 	rendered_value_destroy, rendered_value_init,
 	rendered_value_shutdown): Yet another pool allocator.

2002-04-09  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* gnumeric-canvas.c (gnm_canvas_key_mode_object) : Sheet objects
	  are GObjects
	* src/item-grid.c (ig_obj_create_finish) : unref the object since
	  scg_mode_edit_object might not pick up the reference
	* src/sheet-control-gui.c (scg_object_stop_editing) : unref the
	  sheet object
	(scg_mode_edit_object) : ref the object if we store a reference
	* src/workbook-control-gui.c (cb_edit_cut) :  Sheet objects
	  are GObjects

2002-04-09  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* sheet-object-widget.c (cb_scrollbar_config_cancel_clicked) : new
	(cb_scrollbar_config_ok_clicked) replaces cb_scrollbar_config_clicked
	(sheet_widget_scrollbar_user_config) : don't use GnomeDialog

2002-04-09  Morten Welinder  <terra@diku.dk>

	* configure.in (bind_textdomain_codeset): Add -lintl when needed.

	* src/workbook-control-gui.c: s/E_qual/_Equal/.

2002-04-08  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (hide_show_detail_real) : new
	(group_ungroup_colrow_real) : new
	(hide_show_detail) : use dialog_col_row
	(group_ungroup_colrow) : use dialog_col_row

2002-04-08  Morten Welinder  <terra@diku.dk>

	* src/expr.c (cb_expression_pool_leak): New function.
	(expr_shutdown): Show leaking expressions.

	* src/validation.c (validation_eval): Plug leaks.

2002-04-08  Jon K Hellan  <hellan@acm.org>

	* configure.in: Test for <wctype.h>

	* src/stf-parse.c: Include <wctype.h> only if present.

2002-04-08  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/colrow.c (colrow_set_sizes) : set to default if size is 0
	* src/commands.c (cmd_resize_colrow) : size == 0 means default size
	* src/summary.c : avoid warnings
	* src/workbook-cmd-format.c (sheet_dialog_set_column_width) : just
	  call dialog_col_width
	(workbook_cmd_format_column_std_width) : ditto
	(sheet_dialog_set_row_height) : just call dialog_row_height
	(workbook_cmd_format_row_std_height) : ditto

2002-04-07  Jon K Hellan  <hellan@acm.org>

	* configure.in: Test for isfinite as a macro.
	* acconfig.h: Ditto.

2002-04-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/item-edit.c : link to the expr-entry changed signal rather than its
	  gtkentry changed signal.

2002-04-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/item-edit.c (point_is_inside_range) : rather than parsing
	  using parse_surrounding_ranges, ask the expression entry
	  widget for the already parsed info.
	* src/parse-util.c (parse_surrounding_ranges) : fix formatting and
	  add some debug switches

2002-04-05  Morten Welinder  <terra@diku.dk>

	* src/gutils.c (gnm_mem_chunk_foreach_leak): New function.

	* src/str.c (string_get, string_get_nocopy, string_unref):
	Optionally use string pool.
	(string_shutdown): New function.
	* src/main.c (main): Call string_shutdown.

2002-04-05  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_insert_image) : add insert image.

	* src/sheet-object.c (sheet_object_default_size) : add a default_size
	  handler that can generate default sizes per instance rather than
	  class.

	* src/sheet-object-image.c (sheet_object_image_default_size) :
	  implement.
	(sheet_object_image_class_init) : register the deafult size handler.
	* src/application.c  : add insert image.
	* src/pixmaps/Makefile.am : add insert image.

2002-04-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-pane.c (gnm_pane_reposition_cursors) : also
	  reposition item-edit cursor
	  http://bugzilla.gnome.org/show_bug.cgi?id=77321

2002-04-04  Morten Welinder  <terra@diku.dk>

	* src/main.c (main): Initialize and shutdown expr class.

	* src/expr.c (gnm_expr_new_constant, gnm_expr_new_funcall)
	(gnm_expr_new_unary, gnm_expr_new_binary, gnm_expr_new_name)
	(gnm_expr_new_cellref, gnm_expr_new_array, gnm_expr_new_set)
	(do_gnm_expr_unref): Conditionally use expression pool.
	(expr_init, expr_shutdown): Setup new expression pool.

2002-04-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/item-edit.h (point_is_inside_range) : don't call
	  gnumeric_char_start_expr_p since it changes the cursor position
	(entry_cursor_event) : new
	(item_edit_set_arg) : use notify::cursor-position rather than
	  button-press-event

2002-04-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/parse-util.c (parse_surrounding_ranges) : new, code extracted
	  from src/widgets/gnumeric-expr-entry.c
	* src/parse-util.h (parse_surrounding_ranges) : new
	* src/item-edit.c (scan_at) : deleted
	(point_is_inside_range) : use arse_surrounding_ranges
	* src/position.c (value_to_rangeref) : new
	(rangeref_normalize) : new
	* src/position.h (value_to_rangeref, rangeref_normalize) : new
	* src/ranges.c (setup_range_from_value) : use setup_range_from_range_ref
	(setup_range_from_range_ref) : new
	* src/ranges.h (setup_range_from_range_ref) : new
	* src/value-sheet.c (value_cellrange_normalize) : use rangeref_normalize

2002-04-03  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/ranges.h (setup_range_from_value) : new
	(value_to_global_range) : new
	* src/ranges.c : ditto
	* src/consolidate.c : use setup_range_from_value
	* src/corba-sheet.c : ditto
	* src/item-edit.c : ditto
	* src/value.c : ditto

2002-04-03  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : Fix long description formatting.

2002-04-02  Jon K Hellan  <hellan@acm.org>

	* src/func.c (function_def_get_arg_name): Don't crash if arguments
	aren't named.

2002-04-01  Morten Welinder  <terra@diku.dk>

	* src/value.c (USE_VALUE_POOLS): Make pools conditional.

	* src/parser.y (line, opt_exp): Plug gigantic leak.  Now why does
	the expression widget call the parser thousands of times?

	* src/expr.c (expr_eval_real): Simplify.

2002-04-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/item-cursor.c (item_cursor_target_region_ok) : fix message dialog

2002-04-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/mstyle.c (mstyle_new_default) : protect against faulty
	  schema installation
	* src/style.c (font_init) : protect against faulty
	  schema installation and also configure bold and italic default fonts.

2002-04-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : add default font schemas
	* src/application.[ch] : add central preferences dialog
	* src/main.c : dispose of preference dialog on exit
	* src/mstyle.c : use gconf data to initialize default style
	* src/style.[ch] : use gconf data to initialize default style
	* src/workbook-control-gui.c : add preference menu items

2002-04-01  Morten Welinder  <terra@diku.dk>

	* src/expr.c (expr_eval_real): Fix overflow for EXP case.  (Twice.)

	* src/mathfunc.c (gnumeric_fake_trunc): Fix for negative valus.

2002-03-31  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c : use workbook signals
	* src/commands.h : include tools/tools.h rather than dialogs/tools.h
	* src/summary.c (summary_info_add) : return boolean
	* src/summary.h (summary_info_add) : return boolean
	* src/workbook.c : new workbook signals
	(workbook_add_summary_info) : new, emit signal
	(workbook_set_filename) : emit signal
	* src/workbook.h : new workbook signals

2002-03-31  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_analysis_tools_undo) : clear region
	  before pasting (to avoid leaving cell comments behind)

2002-03-31  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c : cmd_analysis_tools allow the engines
	  to carry info from TOOL_ENGINE_LAST_VALIDITY_CHECK to
	  TOOL_ENGINE_PERFORM_CALC
	* src/commands.h : include dialogs/tools.h rather than
	  tools/analysis-tools.h

2002-03-31  Jody Goldberg <jody@gnome.org>

	* src/gui-util.c (gnumeric_toolbar_new) : respect ui preferences.

2002-03-30  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_analysis_tool_redo) : TOOL_ENGINE_PERFORM_CALC
	  should never return TRUE since we already cleared the target.

2002-03-29  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas : new schema file
	* schemas/Makefile.am : added gnumeric-general.schemas
	* src/application.h (application_release_gconf_client) : new
	(application_get_gconf_client) : new
	* src/application.c (application_release_gconf_client) : new
	(application_get_gconf_client) : new
	(app_init) : initialize new app.gconf_client
	* src/commands.c (truncate_undo_info) : read size_left from gconf
	* src/main.c : destroy app.gconf_client on exit

2002-03-29  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* src/sheet.c (sheet_delete_rows, sheet_delete_cols) : Fixed the
	adjustments for Solver's parameters.

	* src/sheet.c (sheet_insert_rows, sheet_insert_cols) : Fixed the
	adjustments for Solver's parameters.

2002-03-29  Morten Welinder  <terra@diku.dk>

	* src/value.c (value_new_cellrange_unsafe, value_new_cellrange,
	value_new_cellrange_r, value_new_array_non_init, value_release):
	Use chunk allocator for ranges and arrays.
	(value_init): Initialise range and array pools.
	(value_shutdown): Free range and array pools.

2002-03-29  Morten Welinder  <terra@diku.dk>

	* src/gutils.c (gnm_mem_chunk_new, gnm_mem_chunk_destroy,
	gnm_mem_chunk_alloc, gnm_mem_chunk_free): Keep per-block
	freelists.
	(gnm_mem_chunk_free): g_free chunks that are completely empty.

	* src/value.c (value_get_as_float): Improve precision.
	(value_get_as_int): Take sign into account when (fake-)truncating
	floating point numbers.
	(value_new_error, value_new_error_str, value_new_string,
	value_new_string_str, value_release): Use chunk allocator for
	strings and errors.
	(value_init): Initialise error and string pools.
	(value_shutdown): Free error and string pools.

2002-03-29  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* samples/solver/regression-test-suite.gnumeric: Solver's
	regression test suite added.

2002-03-28  Jody Goldberg <jody@gnome.org>

	* src/sheet-object.c (sheet_object_set_sheet) : ref the object when we
	  add it to the sheet.
	(sheet_object_clear_sheet) : unref here.
	(sheet_object_set_sheet) : move the content of new_view here.

	* src/print-cell.c (print_cell) : seems like the sign of the descenty
	  is reversed.
	* src/print.c (print_footers) : ditto.

	* src/sheet.c (sheet_move_range) : long list onto short list not
	  vice versa.
	(sheet_delete_cols) : ditto.
	(sheet_delete_rows) : ditto.
	* src/dependent.c (micro_hash_resize) : ditto.

	* src/style.c (style_font_new_simple) : init the print_font.
	(style_font_unref) : unref the print_font.

	* src/print-cell.c (print_cell) : use the print_font.

	* src/print.c (print_job_info_destroy) : GnomeFont is a GObject.

2002-03-27  Jody Goldberg <jody@gnome.org>

	* gnumeric.desktop.in (Exec) : Add %F

2002-03-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_analysis_tool_redo) : add dao_autofit_columns

2002-03-28  Morten Welinder  <terra@diku.dk>

	* */*.c: Fix g_warning calls to not have terminating n.

2002-03-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (sheet_print) : gpm is not a GtkObject

2002-03-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c : port to gnome2

2002-03-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_destroy_dialog) : replaced by call to
	  gtk_widget_destroyed

2002-03-27  Jody Goldberg <jody@gnome.org>

	* configure.in : Include the necessary gconf setup to install schemas.

2002-03-27  Jody Goldberg <jody@gnome.org>

	* src/io-context.c (gnm_io_get_password) : new.
	* src/command-context.c (cmd_context_get_password) : new.
	* src/workbook-control-gui.c (wbcg_get_password) : new.

2002-03-26  Jody Goldberg <jody@gnome.org>

	* src/parser.y (yylex) : make utf8 clean.
	(find_char) : ditto.
	(find_matching_close) : ditto.

2002-03-26  Jody Goldberg <jody@gnome.org>

	* configure.in : add schemas dir.

	* src/gnumeric-canvas.c (gnumeric_canvas_new) : disable auto-center.

2002-03-27  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* src/xml-io.c: Added saving and loading of Solver's options.

2002-03-25  Jody Goldberg <jody@gnome.org>

	* Release 1.1.2

2002-03-26  Morten Welinder  <terra@diku.dk>

	* src/rendered-value.c (rendered_value_new): Just peek directly
	into the approx_width structure -- everyone else does that.  Take
	worst case of "e", signs, and decimal points into account.

	* src/style.h (StyleFont): Change floats to doubles.  Add more
	approx_width fields.

	* src/style.c (style_font_get_width_pts): Remove.

2002-03-26  Morten Welinder  <terra@diku.dk>

	* src/style.c (style_font_new_simple): Translate pixels to points
	properly.

	* src/style.c (style_font_new_simple): Fix misplaced #endif.

	* src/format.c (format_value): Fix general display of floats.
	Oops.

	* src/value.c (value_release): Use the fact that VALUE_TERMINATE
	is an error value.

2002-03-26  Morten Welinder  <terra@diku.dk>

	* src/value.c (value_new_bool, value_new_int, value_release): Use
	int/bool pool.
	(value_init): Initialise int/bool pool.
	(value_shutdown): Free int/bool pool.

	* src/gutils.c (gnm_mem_chunk_new): Use smaller alignment when
	known to be possible.

2002-03-26  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c : added insert-function menu item

2002-03-26  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/ : new directory for schema files
	* schemas/gnumeric-dialogs.schemas : file for gconf configuration
	  variables used by the gnumeric dialogs

2002-03-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* gui-util.[ch] (focus_on_entry) : new
	* src/workbook-control-gui.c (cb_file_summary) : delete unused
	  variable

2002-03-25  Morten Welinder  <terra@diku.dk>

	* src/format.c (format_value): Strip signs when conditional
	formats are in use.

2002-03-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.[hc] : implement cmd_change_summary
	* src/summary.[hc] : constify arguments
	(summary_item_free) : make public, handle NULL argument
	(summary_item_copy) : new
	(summary_item_by_name) : new
	(summary_item_as_text_by_name) : new
	* src/workbook-control-gui.c (cb_file_summary) : delete unused
	  variable, add argument to dialog_summary_update
	* src/workbook.c (workbook_set_filename) : update summary dialog

2002-03-25  Morten Welinder  <terra@diku.dk>

	* src/format.c (StyleFormatEntry): Make the value field a
	gnum_float at intended.

	* src/main.c (main): Call g_set_prgname.
	(main): Call value_init and value_shutdown appropriately.

	* src/value.c (value_terminate_err): New value.
	(value_terminate): Replace this function by the value
	VALUE_TERMINATE.  All callers changed.
	(value_hash): Be smarter about arrays.
	(value_new_float): Use chunk allocator.
	(value_release): Release floats properly.
	(value_init, value_shutdown): New functions.

	* src/gutils.c (gnm_mem_chunk_destroy): Add new argument for leak
	tracking.

2002-03-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* workbook-control-gui.c : change arguments in call of
	  dialog_summary_update

2002-03-24  Morten Welinder  <terra@diku.dk>

	* src/gutils.c (gnm_mem_chunk_new, gnm_mem_chunk_destroy,
 	gnm_mem_chunk_alloc, gnm_mem_chunk_alloc0, gnm_mem_chunk_free):
 	New functions implementing a sane and fast chunk allocated.
  	(Maybe use Evolution's later.)

	* src/dependent.h (struct _GnmDepContainer): add members
 	range_pool and single_pool for allocation.

	* src/dependent.c (link_single_dep): Allocate from pool.
	(unlink_single_dep): Free using pool.
	(link_range_dep): Allocate from pool.
	(unlink_range_dep): Free using pool.
	(do_deps_destroy): Destroy pools.
	(gnm_dep_container_new): Allocate pools.
	(cb_dep_hash_invalidate): Don't free at all -- we're about to dump
 	both pools anyway.

	* src/cell.c (cell_new): New function.  (About time.)
	(cell_copy): Use cell_new.
	(cell_destroy): Free from pool if we allocated that way.
	(cell_init, cell_shutdown): New functions.

	* src/xml-io.c (cell_copy_new): Use cell_new.
	* src/sheet.c (sheet_cell_new): Use cell_new.
	* src/main.c (main): Initialise and shutdown cells.

2002-03-22  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_cell_insert) : delete.
	(cb_sheet_cell_copy) : use sheet_cell_new instead of
	  cell_copy + sheet_cell_insert.

	* src/gnumeric.h (CellList) : delete.

2002-03-22  Almer S. Tigelaar  <almer@gnome.org>

	* src/format-template.h: Extend FormatTemplate struct with
	edge related flags.

	* src/format-template.c (formate_template_new): Initialize
	new edge related members.
	(format_template_clone): Clone new edge related members and
	constify.
	(format_template_transform_edges): Transforms the templates
	by removing edges if so desired.
	(format_template_calculate): Use format_template_transform_edges.

2002-03-21  Jody Goldberg <jody@gnome.org>

	* Massive rename
	ExprTree -> GnmExpr
	eval.[ch] -> dependent.[ch]
	DependentContainer -> GnmDepContainer

	* src/print-info.c (load_formats) : suppress some warnings.

	* src/func.c (function_def_call_with_values) : use g_alloca.

2002-03-21  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* AUTHORS: Added the authors of the LP Solve algorithm.

2002-03-20  Jody Goldberg <jody@gnome.org>

	* src/sheet-style.c (cell_tile_apply_pos) : a simple optimization.
	  Don't split a tile to apply the existing style.

	* src/cellspan.c (cell_calc_span) : Fix span calc when spanning
	  through hidden columns with content there was a typo, and a logic
	  error.  No need to change the margin for an invisible column.

2002-03-19  Jody Goldberg <jody@gnome.org>

	* src/eval.c (cell_eval_content) : move here from cell.c and
	  privatize.
	(dependent_changed) : remove useless argument.

2002-03-19  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/func.[ch] (function_def_get_arg_type_string) : new
	(function_def_get_arg_name) : new
	* src/gui-util.[ch] (gnumeric_dialog_raise_if_exists) :
	  change return type from gboolean to gpointer
	* src/workbook-control-gui.c : add argument to call to
	  dialog_formula_guru

2002-03-19  Morten Welinder  <terra@diku.dk>

	* src/position.c (cellref_equal): Change the order of comparisons
	a bit.  This works around a purify problem.  (I.e., a problem with
	purify, not with the gnumeric code.)

	* src/style.c (style_font_new_simple): Work harder at getting widest character.

	* src/format.c (format_number): Fix format breakage.  (Extra "E".)

	* src/parser.y (parse_string_as_value): Clean up.

2002-03-19  Juan Pablo Mendoza <jpablo@gnome.org>

	* src/Makefile.am: Changue subdirs order to build pixmaps before
	  dialogs. This fix the cvs build.

2002-03-18  Morten Welinder  <terra@diku.dk>

	* src/rangefunc.c (float_hash): Fix for long double case (which
	has six padding bytes on gcc/ix86).  Also be smarter.

	* src/value.c (value_hash): Scale by a power of two for speed.

2002-03-18  Morten Welinder  <terra@diku.dk>

	* src/workbook-control-gui.c (cb_workbook_debug_info): Add code to
	share cells in workbook.

	* src/main.c: Add --debug_share=1 option.

	* src/expr.c (expr_list_eq): New function.
	(expr_tree_sharer_new, expr_tree_sharer_destroy)
	(expr_tree_sharer_share): New functions.

	* src/position.c (cellref_hash): New function.

	* src/value.c (value_hash): New function.

2002-03-18  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_analysis_tool) : set me->parent.size

2002-03-18  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c : typo. (Thanks frob)

2002-03-18  Jody Goldberg <jody@gnome.org>

	* configure.in : bump canvas req to pull in the canvas fixes
	changes.

	* src/xml-io.c (xml_sheet_read) : look for sheet names in the right
	  place.

2002-03-17  Jody Goldberg <jody@gnome.org>

	* src/style.c (style_font_get_height) : add some additional
	  protection.
	(style_font_new_simple) : be really really anal.

2002-03-17  Jon K Hellan  <hellan@acm.org>

	* src/workbook-format-toolbar.c (cb_fore_color_changed): Handle
	autocolors.
	(cb_border_changed): Ditto.
	(workbook_create_format_toolbar): Ditto.

2002-03-16  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_foreach_cell_in_range) : support 3d
	  references.
	(workbook_finalize) : free the 3d dep list if necessary.
	(workbook_init) : initialize the list.
	(cb_dep_unlink) : new.
	(pre_sheet_index_change) : new.
	(cb_dep_link) : new.
	(post_sheet_index_change) : new.
	(workbook_sheet_index_update) : privatize.
	(workbook_sheet_attach) : add pre/post handling for 3d references.
	(workbook_sheet_detach) : ditto.

	* src/eval.c (link_cellrange_dep) : add support for 3d deps.
	(unlink_cellrange_dep) : add support for 3d deps.
	(workbook_link_3d_dep) : new.
	(workbook_unlink_3d_dep) : new.
	(dependent_link) : called here.
	(dependent_unlink) : and here.

	* configure.in : bump libcanvas req to getthe no auto-center patch.

2002-03-16  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_{insert,delete}_{cols,rows}) : don't recalc the
	  entire sheet.  We'll queue what we need when relocating.

	* src/cell.c (cell_set_expr_unsafe) : don't relink.

	* src/eval.c (micro_hash_resize) : minor optimization.
	(dependents_unrelocate_free) : moved here and renamed from
	(workbook_unrelocate_free) : moved here and renamed from
	  workbook_expr_unrelocate_free.
	(workbook_unrelocate) : moved here and renamed from
	  workbook_expr_unrelocate.
	(cb_range_contained_collect) : new.
	(cb_single_contained_collect) : new.
	(dependents_relocate) : moved here and renamed from
	  workbook_expr_relocate.  Then changed to operate on the actual
	  depenents of the region rather than everything, clarified the
	  handling of linking/unlinking.
	(dependents_unrelocate) : relink deps and queue them for recalc.

	* src/cell.c (cell_relocate) : clean out a bit now that we are not
	  using it without reloc info.

	* src/expr.c (cellref_relocate) : don't use the ultra safe reference
	  checks here, we WANT to know if things are out of bounds.
	(cellref_shift) : ditto.

2002-03-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-control-gui-priv.h : added label field
	* src/workbook-control-gui.c (cb_sheet_name) : call
	  editable_label_start_editing rather than dialog_sheet_name
	(sheet_action_rename_sheet) : ditto
	(wbcg_sheet_add) : store editable label ref for future ref

2002-03-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c : support tab color changes in cmd_reorganize_sheets
	* src/commands.h (cmd_reorganize_sheets) : add arguments
	* src/sheet.c (sheet_set_tab_color) : add third argument
	(sheet_new) : initialize tab_text_color
	(sheet_destroy) : free tab_text_color
	* src/sheet.h : add tab_text_color to _Sheet
	(sheet_set_tab_color) : add third argument
	* src/workbook-control-gui.c (wbcg_sheet_add) : also set tab_text_color
	(wbcg_sheet_rename) : add arguments to call of cmd_reorganize_sheets
	(cb_insert_sheet) : ditto
	* src/workbook.c (workbook_sheet_reorganize) : support changing of tab
	  colors
	* src/workbook.h (workbook_sheet_reorganize) : add arguments
	* src/xml-io.c : read and write TabTextColor

2002-03-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_merge_data_redo) : use cell_assign_value rather
	  than copy/paste to preserve merged target fields.
	* src/commands.c (cmd_merge_data_redo) : don't create unnecessary cells
	* src/sheet-object.[ch] (sheet_object_clone_sheet) : delete
	* src/sheet-object.[ch] (sheet_object_clone_sheet_in_range) : rename
	  sheet_object_clone_sheet
	* src/sheet.c : change sheet_object_clone_sheet calls

2002-03-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c : use cell_assign_value rather than copy/paste to
	  preserve merged target fields.

2002-03-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-object-widget.[ch] (sheet_widget_checkbox_switch_link_sheet) :
	  delete again (unnecessary after Jody's fix of the root problem)
	* src/colrow.c (colrow_set_states) : preserve the
	  ColRowStateList, it possibly should also be applied to other sheets
	(colrow_restore_state_group) : ditto.
	* src/sheet.c : delete the ColRowStateList after colrow_set_states
	* src/commands.c : delete the ColRowStateList after colrow_set_states
	(cmd_merge_data_redo) : preserve column and row widths, etc.

2002-03-13  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_press) : disable object
	  movement while guru is up.

	* src/sheet-object-widget.c (sheet_widget_scrollbar_get_ref) : Add a
	  force_sheet parameter.
	(sheet_widget_checkbox_get_ref) : ditto.
	(sheet_widget_scrollbar_clone) : do not force a fully qualified ref here.
	  It would incorrectly cause the new object to link to the old sheet.
	(sheet_widget_checkbox_clone) : ditto.

	* src/parser.y : support the applix #AND# #OR# #NOT# operators.

2002-03-13  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_merge_data_redo) : handle sheet objects
	  and change ref in checkboxes
	* src/sheet-object-widget.c (sheet_widget_checkbox_switch_link_sheet) :
	  new
	* src/sheet-object-widget.h (sheet_widget_checkbox_switch_link_sheet) :
	  new
	* src/sheet-object.c (sheet_object_clone_sheet_in_range) : new
	* src/sheet-object.h (sheet_object_clone_sheet_in_range) : new
	* src/workbook-control-gui.c (cb_tools_merge) : remove unused var

2002-03-12  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_sheet_label_edit_finished) : renamed
	  from cb_sheet_label_changed and handle NULL text as cancel.
	(cb_sheet_label_edit_stopped) : deleted.

	* configure.in : Generate GNOME_Gnumeric.server.in
	* Generate GNOME_Gnumeric.server : start to think about this.

	* src/expr-name.c (expr_name_unlink_deps) : handle delayed hash
	  creation.
	(expr_name_new) : dont init the hash table.
	(expr_name_add_dep) : until here.

	* src/sheet.c (sheet_destroy_contents) : free the primary array too.

	* src/xml-io.c (cell_copy_new) : set comment to NULL.
	* src/gui-clipboard.c (x_selection_to_cell_region) : ditto.
	* src/stf-parse.c (stf_parse_region) : ditto.

2002-03-12  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* workbook-control-gui.c : add Merge to the Edit/Fill menu
	(cb_tools_merge) : new
	* commands.h (cmd_merge_data) : new
	* commands.c : implement the cmd_merge_data command
	(cmd_set_comment_finalize) : simplify

2002-03-12  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (sheet_destroy_contents): Plug leak.
	* src/workbook.c (workbook_finalize): Free the sheets member.
	* src/sheet-control-gui.c (scg_finalize): Plug leak.

2002-03-11  Jody Goldberg <jody@gnome.org>

	* src/expr-name.c (expr_name_new) : make public.

2002-03-11  Jon K Hellan  <hellan@acm.org>

	* src/format.c: silence	warning.

2002-03-11  Morten Welinder  <terra@diku.dk>

	* configure.in (ynl, erfl, erfcl): Check that these actually work.
	(glibc defines these, they just don't work.)

2002-03-11  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (delete_pristine_sheets) : rename to
	  cmd_reorganize_sheets_delete_sheets and use command_undo_sheet_delete
	  rather than workbook_sheet_delete.
	(cmd_analysis_tool_finalize) : shorten code.

2002-03-11  Jody Goldberg <jody@gnome.org>

	* src/gui-util.c (color_combo_get_style_color) : changes to color combo.
	* src/sheet-object-graphic.c (cb_fill_color_changed) : ditto.
	* src/workbook-format-toolbar.c (cb_fore_color_changed) : ditto.
	(cb_back_color_changed) : ditto.
	(workbook_create_format_toolbar) : ditto.

2002-03-10  Jody Goldberg <jody@gnome.org>

	* configure.in : bump gal req to pull in the colour combo changes.

2002-03-10  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2002-03-10  Jody Goldberg <jody@gnome.org>

	* Release 1.1.1

2002-03-10  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (command_undo_sheet_delete) new utility function (for
	  CMD_ANALYSIS_TOOL_TYPE and CMD_SHEET_REORGANIZE_TYPE)
	(CMD_ANALYSIS_TOOL) : undo/redo command for data analysis tools.
	* src/commands.h (cmd_analysis_tool) : new

2002-03-10  Jody Goldberg <jody@gnome.org>

	* src/tools/solver/reports.c : warning suppression
	* src/tools/solver/solver.c (lp_solver_init) : ditto.

	* configure.in : bump gal version req.

2002-03-09  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnm-marshalers.list : add NONE:STRING

2002-03-10  Jon K Hellan  <hellan@acm.org>

	* src/func.c (copy_hash_table_to_ptr_array): Check if function is
	FUNCTION_NAMEONLY here.
	(function_dump_defs): So that we can use the earlier version of this.

2002-03-09  Jon K Hellan  <hellan@acm.org>

	Dump function definitions from plugins, this time the easy way
	which even works.

	* src/func.c (copy_hash_table_to_ptr_array): Copy also when fd->help
	is NULL.
	(function_dump_defs): Load function definition before dumping name
	only function.

	* src/main.c (main): Drop force load argument to plugins_init.

	* src/plugin.[ch] (activate_plugin, plugin_db_activate_plugin_list,
	plugin_db_activate_saved_active_plugins, plugins_init): Revert to
	pre 2002-03-08 version. We apologize for the inconvenience.
	However, error reporting by means of gnumeric_error_error_info
	remains.

	* src/plugin-service.[ch]
	(plugin_service_function_group_initialize): Revert to pre
	2002-03-08 version.
	(plugin_service_activate): Ditto. Except that we don't reinstate
	#ifdef PLUGIN_ALWAYS_LOAD. That branch is hopelessly bitrotted.

	* src/plugin.h: Drop #undef PLUGIN_ALWAYS_LOAD.

2002-03-09  Jody Goldberg <jody@gnome.org>

	* src/func.c (func_def_load) : rename from function_def_get_full_info_if_needed
	  and remove the condition.

	* src/eval.c (link_expr_dep) : Call func_def_load if necessary to
	  check for a link function.

2002-03-09  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* samples/solver/blend.mps: Added another Netlib demo.  The
	results seem to be correct now, so we are finally getting close..

2002-03-09  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_editline_focus_in) : if editing fails
	restore focus to the sheet.

	* src/workbook-edit.c (wbcg_edit_start) : fix typo and swapping of the
	  warnings.

2002-03-09  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* workbook-control-gui.c : change menu items "Re-order sheets"
	  to "Manage Sheets" and enable these items even for single sheet
	  workbooks.
	* commands.h : add deleted_sheets argument to cmd_reorganize_sheets
	* commands.c : ditto

2002-03-08  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric.xml : switch Format->Workbook with
	  Format->AutoFormat
	* src/workbook-control-gui.c (workbook_menu_format) : ditto.

	* src/workbook-view.c (wb_view_is_protected) : new.

	* src/workbook-edit.c (wbcg_edit_start) : load style directly
	  don't use cell_get_style.  This enables support for protection of
	  blank cells.  Use wb_view_is_protected, and command_context_invalid.

2002-03-08  C. Scott Ananian <cananian@lesser-magoo.lcs.mit.edu>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet): don't put us in
	  edit mode if wbcg_edit_start indicates the cell is locked.
	* src/workbook-control-gui.c (cb_autosum, cb_autofunction): handle
	  case where wbcg_edit_start returns FALSE indicating that cell is
	  locked.
	* src/workbook-edit.c (wbcg_edit_start): this function now returns a
	   boolean which indicates whether the 'edit_start' attempt succeeded.
	   Check cell properties to return FALSE if the cell is locked.
	* src/workbook-edit.h (wbcg_edit_start): modify the prototype as per above.
	* src/workbook-view.c (wb_view_set_attribute, workbook_view_init):
	  Remove ARG_VIEW_* enumeration, which isn't used after Gnome2 port.
	  Add WorkbookView::is_protected attribute, and initialize it to
	  FALSE.  The update to wb_view_set_attribute is enough to get
	  xml_sax import working properly (yay, modular code!).
	* src/workbook-view.h: add 'is_protected' field to WorkbookView struct.
	  This is TRUE iff the workbook is locked.
	* src/xml-io.c (xml_write_wbv_attributes):
	  Write the new 'protected' workbook view attribute.  Two lines are
	  enough to get read/write from xml_io working.  Score one for
	  xml_sax: zero should have been sufficient.
	* src/dialogs/cell-format.glade: The 'worksheet protected' checkbox
	  shouldn't be greyed-out anymore.
	* src/dialogs/dialog-cell-format.c (cb_protection_sheet_protected_toggle,
	fmt_dialog_init_protection_page, cb_fmt_dialog_dialog_buttons):
	  connect up the 'worksheet protected' button in the
	  Format->Cells->Protection dialog.  Update worksheet object when
	  toggled and mark that the dialog's changed.
	* src/dialogs/dialog-workbook-attr.c src/dialogs/workbook-attr.glade:
	  Add Format->Worksheet->Protection dialog.

2002-03-08  Jon K Hellan  <hellan@acm.org>

	* src/command-context-stderr.c (ccs_class_init): Make gmorten happy.

	* src/command-context.h (COMMAND_CONTEXT): Fix typo.

	* src/command-context-stderr.c
	(command_context_stderr_get_status): Fix typo.

	* src/command-context-stderr.[ch]: Add.

	* src/Makefile.am: Add command-context-stderr.[ch]

	* src/main.c (main): Force load plugins before dumping function
	definitions.

	* src/plugin.[ch] (activate_plugin, plugin_db_activate_plugin_list,
	plugin_db_activate_saved_active_plugins, plugins_init): Add
	force_load parameter.
	(plugins_init): Use virtual function gnumeric_error_error_info to
	report error.

	* src/plugin-service.[ch]
	(plugin_service_function_group_initialize): Add force_load
	parameter. Get function info if force loaded.
	(plugin_service_activate): Propagate force_load parameter.

	* src/gnumeric.h: Declare CommandContextStderr.

	* src/func.[ch] (function_def_get_full_info_if_needed): Make
	public so that it's available when force-loading plugins.

	* src/error-info.c (error_info_print_with_offset): Print to stderr
	instead of stdout.

2002-03-08  Morten Welinder  <terra@diku.dk>

	* src/validation.c (validation_eval): Minor cleanup.
	* src/value.c (value_peek_string): Be smarter about errors.

2002-03-08  Jakub Steiner <jimmac@ximian.com>

	* src/pixmaps/Makefile.am:
	* src/pixmaps/format_money_24.png:
	* src/pixmaps/format_percent_24.png:
	* src/pixmaps/object_list_24.png:
	* src/pixmaps/object_combo_24.png: fix the filenames

2002-03-08  Jakub Steiner <jimmac@ximian.com>

	* icons/down-right.png, icons/right-down.png: pretty gnome2 icons
	* src/pixmaps/percent.png:
	* src/pixmaps/money.png:
	* src/pixmaps/list.png:
	* src/pixmaps/combo.png, src/pixmaps/Makefile.am: replace xpm
	  with a PNG (removed combo.xpm)

2002-03-08  Jody Goldberg <jody@gnome.org>

	* configure.in : add sample_datasource

	* src/validation.c (validation_eval) : cleanup handling of 'int'
	and fix handling of between.

2002-03-08  Jody Goldberg <jody@gnome.org>

	* src/eval.h : Add DEPENDENT_ALWAYS_UNLINK.
	  and the as yet unused DEPENDENT_HAS_3D.

	* src/io-context.c (gnm_io_warning) : new stub.
	(gnm_io_warning_unknown_font) : ditto.
	(gnm_io_warning_unknown_function) : ditto.
	(gnm_io_warning_unsupported_feature) : ditto.

	* src/func.c (function_def_get_full_info_if_needed) :  add
	  link/unlink.

	* src/plugin-service.c
	(plugin_service_function_group_get_full_info_callback) : add
	  link/unlink.  This is a terrible interface.  Why not just make the
	  thing into the FunctionDescriptor.
	* src/plugin-loader-module.c
	(gnumeric_plugin_loader_module_func_get_full_function_info) : ditto.

2002-03-08  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_write_print_info) : handle missing paper so that
	  we can save again.

	* templates/autoformat/autoformat.3D.button.xml : fix.

	* plugins/Makefile.am (SUBDIRS) : add sample_datasource.

2002-03-07  Jody Goldberg <jody@gnome.org>

	* src/plugin-loader-module.h (ModulePluginFunctionInfo) : add
	  'link' and 'unlink'.

2002-03-07  Jody Goldberg <jody@gnome.org>

	* src/position.c (eval_pos_init*) : handle the optional dependent.

	* src/eval.c (link_expr_dep) : support the adjustment to EvalPos.
	(unlink_expr_dep) : support the adjustment to EvalPos.

	* *.c : directly include gnome-i18n.h, value.h and expr.h
	  where necessary now that they are no longer included.
	* src/func.h : here.

	* src/position.h (EvalPos) : Pass in an optional Dependent.

	* src/expr.h (FunctionEvalInfo) : remove the func_def.  Send in the
	  ExprFunc wrapper instead.  That contains the func-def if desired.

	* src/func.c (function_set_link_handlers) : differentiate signatures
	  for link & unlink.

2002-03-07  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* src/analysis-tools.[ch]: Moved into src/tools.
	src/auto-correct.[ch]: Ditto.
	src/goal-seek.[ch]: Ditto.

	* src/solver.h (SolverResults): Added a few more fields to improve
	reporting.

2002-03-07  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* workbook.c (workbook_sheet_reorganize) : implement adding of
	  multiple sheets

2002-03-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet.c (sheet_new) : initialize sheet->index_in_wb
	* src/sheet.h : new field sheet::index_in_wb
	* src/workbook-control-gui.c (wbcg_sheet_add) : replace
	  workbook_sheet_index_get with sheet->index_in_wb
	* src/workbook-view.c (wb_view_sheet_focus) : ditto
	* src/workbook.c (workbook_sheet_index_get) : deleted
	(workbook_sheet_index_update) : new
	(workbook_sheet_attach) : replace workbook_sheet_index_get
	  with sheet->index_in_wb, call workbook_sheet_index_update
	(workbook_sheet_detach) : ditto
	(workbook_sheet_move) : ditto
	(workbook_sheet_reorganize) : ditto

2002-03-06  Jukka-Pekka Iivonen  <jiivonen@hutcs.cs.hut.fi>

	* src/tools: New directory created for tools.

	* src/tools/solver: Moved src/solver-lp.c into here and split it
	into two files: src/tools/solver/solver.c and
	src/tools/solver/reports.c.  A _major_ rewrite.

	* src/tools/solver/lp_solve: Integrated key parts of an LGPLed
	linear programming toolkit called LP Solve 3.2.  (The whole
	package can be found from ftp://ftp.ics.ele.tue.nl/pub/lp_solve).
	Major clean up for making it to look like GNOME code.  LP Solve is
	written by Michel Berkelaar and others.  Thanks for the great
	work!

	* configure.in: Added src/tools/Makefile, src/tools/solver/Makefile,
	and src/tools/solver/lp_solve/Makefile.

	* src/Makefile.am: Added tools subdirectory.

	* src/mathfunc.[ch]: Removed all solver related functions.

	* src/solver.h, src/sheet.c: solver_lp_new renamed as
	solver_param_new.  solver_lp_destroy renamed as
	solver_param_destroy.

	* src/xml-io.c: Solver related changes.

	* samples/solver/production-plan.gnumeric: A Solver sample file.

2002-03-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_error_info_dialog_show) : remove
	  forced placement by mouse
	(gnumeric_set_transient) : remove unused code, set dialog
	  placement to GTK_WIN_POS_CENTER_ON_PARENT

2002-03-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/eval.c (link_expr_dep) : fix typo

2002-03-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (delete_pristine_sheets) : new
	(cmd_reorganize_sheets_undo) : delete new sheets, change calling
	  sequence of workbook_sheet_reorganize
	(cmd_reorganize_sheets_redo) : change calling
	  sequence of workbook_sheet_reorganize
	(cmd_reorganize_sheets_finalize) : clear new_sheets
	(cmd_reorganize_sheets) : handle adding of sheets, streamline
	  selection of cmd descriptor
	* src/workbook-control-gui.c (cb_insert_sheet) : use
	  cmd_reorganize_sheets
	* src/workbook.c (workbook_sheet_reorganize) : handle adding of sheets
	* src/workbook.h (workbook_sheet_reorganize) : add argument

2002-03-05  Jody Goldberg <jody@gnome.org>

	* src/eval.c (link_single_dep) : flag inter-{sheet,book} references.
	(link_cellrange_dep) : ditto.
	(link_expr_dep) : collect the flags.
	(dependent_link) : and assign them here.
	(dependent_unlink_sheet) : delete and merge into.
	(do_deps_destroy) : here.  And use the new inter-{sheet,book} flags to
	  avoid removing internal links.

	* src/sheet.c (sheet_destroy_contents) : depends are now handled
	  outside this routine add a precondition.

	* src/main.c : delete style_debugging.

	* src/clipboard.c (clipboard_copy_range) : suppress warning.

2002-03-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (workbook_close_if_user_permits) :
	  use gtk_message_dialog_new/gnumeric_dialog_run

2002-03-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-control-gui.c (scg_comment_display) : put
	  a frame around the pop-up

2002-03-05  Morten Welinder  <terra@diku.dk>

	* src/expr.c (expr_eval_real): Improve precision of %.

2002-03-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-control-gui.c (scg_comment_display) : use
	  textview widget

2002-03-05  Morten Welinder  <terra@diku.dk>

	* src/workbook-edit.c (auto_complete_matches): Plug leak.

	* src/gutils.c (erfgnum, erfcgnum, yngnum): Ground work for later.

	* src/mathfunc.c (gpow10): Fix precision for large negative
	exponents.
	(gpow2): Fix for negative exponents.

2002-03-05  Jody Goldberg <jody@gnome.org>

	* src/eval.c : split add/drop into distinct functions and use
	  link/unlink consistently.

2002-03-05  Morten Welinder  <terra@diku.dk>

	* src/validation.c (validation_eval): Make int-check saner.
	Fix translated string.

	* src/analysis-tools.c (fourier_fft_inv, fourier_fft): Improve
	precision.

	* src/mathfunc.h (M_LN2gnum, M_LN10gnum, M_PIgnum, M_PI_2gnum,
	M_LN2gnum, M_LN10gnum, M_SQRT2gnum): Provide high-precision
	constants.

2002-03-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/clipboard.c (clipboard_paste_region) : preserve comments
	  when pasting content
	* src/clipboard.h : exclude comments from PASTE_DEFAULT
	* src/sheet-control-gui.c : Add `Add/modify comments' item to
	  cell context menu
	* src/sheet.h : CLEAR_COMMENTS and CLEAR_MERGES should be distinct.
	* src/workbook-control-gui.c : correct spelling

2002-03-05  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_cell_remove_from_hash) : only unlink if it is
	  linked.
	(sheet_cell_destroy) : simplify slightly.
	(cb_remove_allcells) : just destroy them, no need to remove from hash.
	(sheet_destroy_contents) : ditto.

	* src/eval.c (UNLINK_DEP) : delete.
	(dependent_unlink) : simplify.
	(dependent_unlink_sheet) : clean up and don't bother to unlink from
	  deps list.

	* src/cell.c : s/CELL_BEING_ITERATED/DEPENDENT_BEING_ITERATED/

2002-03-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/clipboard.c (clipboard_copy_range, clipboard_prepend_cell
	  clipboard_prepend_comment) : check existing cells and all
	  comments.
	* sheet-object-cell-comment.c (cell_comment_event) : handle
	  double click by opening dialog (slightly modified patch by
	  Wayne Schuster)

2002-03-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/clipboard.h : PASTE_ALL_TYPES should include comments

2002-03-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/clipboard.c (paste_cell) : paste comment
	(clipboard_prepend_cell) : store comment info
	(clipboard_copy_range) : check all cells
	* src/clipboard.h : add comment field to CellCopy
	* src/commands.c (cmd_clear_undo) : handle comments
	(cmd_clear_selection) : ditto

2002-03-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* commands.h (cmd_set_comment) : new
	* commands.c (cmd_set_comment_apply, set_comment_undo,
	  cmd_set_comment_redo, cmd_set_comment_finalize, cmd_set_comment) :
	  new

2002-03-04  Morten Welinder  <terra@diku.dk>

	* src/mathfunc.c (dexp): Add give_log arg and use R's version.
	All callers changed.

	* src/analysis-tools.c (destroy_data_set_list): Plug leak.

2002-03-04  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_cell_insert) : make it clear that this routine
	  does not link the expression or register the dependencies.
	(sheet_cell_remove_from_hash) : document state changes and use
	  dependend_unlink.
	(cb_remove_allcells) : cell_destroy will unlink.
	(cb_collect_cell) : be clear that the results are unlinked.
	(colrow_move) : some docs.
	(sheet_move_range) : simplify now that the collected cells are
	  unlinked rather than just having their depends dropped.

	* src/eval.c (cell_add_dependencies) : delete.
	(cell_drop_dependencies) : delete.

	* src/style.c (style_font_new_simple) : If we can't find a font check
	  a map to see if we know of something similar.
	(get_substitute_font) : moved here from the XL importer.

2002-03-03  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_rename_sheet,...) : now a wrapper around
	  cmd_reorganize_sheets.
	(cmd_reorganize_sheets_apply) : moved into workbook.c as
	  workbook_sheet_reorganize
	(cmd_reorganize_sheets,...) : implement sheet renaming
	* src/commands.h : add an argument to cmd_rename_sheet
	* src/workbook-control-gui.c (cb_sheet_label_changed) :
	  change invocation of cmd_rename_sheet
	* src/workbook.c (workbook_sheet_rename) replaced by
	  workbook_sheet_reorganize
	* src/workbook.h: ditto

2002-03-02  Jody Goldberg <jody@gnome.org>

	* src/eval.c (handle_tree_deps) : Use hooks for per dependent
	  link/unlink for each function.

2002-03-02  Jody Goldberg <jody@gnome.org>

	* src/global-gnome-font.c : Use string chunk.

	* src/sheet-object-cell-comment.c :  This is a GObject now.
	(comment_get_points) : fix x offset.

2002-03-01  Morten Welinder  <terra@diku.dk>

	* src/workbook-control-gui.c: Add dots to "Sort" entry.

	* src/complex.h (complex_scale_real): New function.

	* src/analysis-tools.c (fourier_fft, fourier_fft_inv): Clean using
	existing complex math routines.

2002-03-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/commands.c (cmd_reorganize_sheets_finalize) : fix typo

2002-03-01  Morten Welinder  <terra@diku.dk>

	* src/commands.c (cmd_reorganize_free_names): Remove.
	(cmd_reorganize_sheets_finalize): Simplify.

	* src/analysis-tools.c (regression_tool): Fix P values.

	* src/regression.c (general_linear_regression): Fix ->var in the
	trivial n==xdim case.

2002-02-29  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* commands.h (cmd_reorganize_sheets) : new
	* commands.c : implement cmd_reorganize_sheets

2002-02-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (wbcg_validation_msg) : delete
	  dialog and fix sense of test

2002-02-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.[hc] (entry_to_float_with_format_default) : new

2002-02-28  Morten Welinder  <terra@diku.dk>

	* src/regression.c (linear_solve): Move rescaling from here...
	(LUPDecomp): ...to here so we save a copy.
	(general_linear_regression): Allocate the permutation matrix with
	the proper size.  (The old size was too big, so no-one really got
	hurt.)

	* src/rangefunc.c (range_minabs, range_maxabs): New functions.

	* src/regression.c (rescale): Don't include "b" in determining the
	scale.  Use range_maxabs.

2002-02-28  Morten Welinder  <terra@diku.dk>

	* src/regression.c (general_linear_regression): If the inverse has
	negative elements in the diagonal, assume near singularity.
	(linear_solve): Rescale matrix and target.  Rip out the error
	correction attempt.
	(rescale): New function.
	(LUPDecomp, backsolve): Remove col/row confusion.

2002-02-28  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (workbook_control_gui_init) : fix
	  reordering of ins col/row in non-bonobo case.

2002-02-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (delete_sheet_if_possible) :
	  use gnumeric_dialog_question_yes_no

2002-02-28  Jody Goldberg <jody@gnome.org>

	* src/expr-name.c (expr_name_set_expr) : always relink.

	* src/eval.c (handle_tree_deps) : ignore inactive names.

2002-02-27  Jody Goldberg <jody@gnome.org>

	* src/global-gnome-font.c (global_gnome_font_init) : fix leak.

	* src/style.c (style_font_new_simple) : fix leak.

2002-02-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.h (entry_to_float_with_format) : new
	* src/gui-util.c (entry_to_float_with_format) : add format to
	  entry_to_float
	(entry_to_float) : wrapper around entry_to_float_with_format

2002-02-27  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c: Use new lower-tail flag for R's q*
 	routines.
	(new_data_set): Plug leak.

2002-02-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/value.c (value_get_as_string) : case VALUE_CELLRANGE can be
	  for absolute and A1-rel references. Use global_range_name.

2002-02-27  Morten Welinder  <terra@diku.dk>

	* src/analysis-tools.c (ztest_tool): Fix problem from R upgrade.
	(regression_tool): Simplify.

	* src/regression.c (linear_solve): Attempt error correction in the
 	near-singular case.
	(linear_regression, exponential_regression): Change return type to
 	an enum.  All callers changed.
	(LUPDecomp): Attempt to detect near-singularity.

2002-02-26  Morten Welinder  <terra@diku.dk>

	* src/regression.c (linear_regression, exponential_regression):
	Add safety check.

	* plugins/*/*.xml.in: just use the .la file for module_file.

	* plugins/*/Makefile.am: don't hack the .xml file any more.

	* src/mathfunc.c: Make various helper functions static.

	* src/format-template.h: prototype the template member functions.

2002-02-26  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_read_cell) : xmlNodeGetContent always returns a
	  value now.  That simplifies comments and complicates content.
	(xml_cellregion_read) : ditto.

2002-02-25  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_progress_message_set) : port to
	  gnome2.

	* src/print-cell.c (print_show_iso8859_1) : delete.

	* src/gui-file.c (gui_file_open) : someportability tweaks.

	* icons/Makefile.am : move the icons here.

	* src/history.c (history_menu_item_create) : constness.
	* src/formats.c (currency_date_format_init) : constness.
	* src/solver.h : some constness.
	* src/workbook-control-gui.c (cb_select_auto_expr) : constness.
	(workbook_control_gui_init) : some fixes for the bonobo build.

2002-02-25  Morten Welinder  <terra@diku.dk>

	* src/format-template.h: prototype the template member functions.

	* src/mathfunc.c: Switch to R-1.4.0 sources.  Deal with signature
	changes everywhere.

2002-02-25  Morten Welinder  <terra@diku.dk>

	* configure.in: Test if we must prototype strtold.  Test for
	log1pl.

2002-02-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/sheet-object-widget.c (cb_scrollbar_set_focus) : remove code
	  now held in wbcg_edit_attach_guru
	(cb_checkbox_set_focus) : ditto
	(sheet_widget_scrollbar_user_config) : rearrange signal callbacks
	(sheet_widget_checkbox_user_config) : ditto

2002-02-25  Morten Welinder  <terra@diku.dk>

	* src/xml-io.c (xml_cellregion_write) : specify the encoding, and
	  enable formatting.
	(gnumeric_xml_write_workbook) : ditto.

2002-02-25  Morten Welinder  <terra@diku.dk>

	* src/mathfunc.c (random_01): Reduce the number of system calls
	and get more precision for the general gnum_float case.

	* src/mathfunc.c (random_*): use gnum_float, not double.  (Since
	many underlying functions are still double-based, not all these
	will have precision beyond double.)

	* src/solver-lp.c: Constify.  Plug a few leaks.

	* src/sheet.h (struct _Sheet): Make solver_parameters a pointer.
	Deal with this everywhere.

2002-02-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/analysis-tools.h : delete tool_set_focus
	* src/workbook-edit.c (guru_set_focus) : new, formerly tool_set_focus
	  in src/dialogs/dialog-analysis-tools.c
	(wbcg_edit_attach_guru) : attach guru_set_focus to set_focus widget

2002-02-25  Morten Welinder  <terra@diku.dk>

	* configure.in (atan2l, sinhl, coshl, tanhl, asinhl, acoshl,
	atanhl, erfl, erfcl, ynl, isnanl, finitel, hypotl): Add checks for these.
	* src/numbers.h: supply right version of above.  Use everywhere.

2002-02-25  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-image.h: Declare typedef ObjectImage.

	* src/sheet-object-image.c (struct _SheetObjectImage): Add
	cropping parameters.
	(sheet_object_image_new): Initialize cropping parameters.
	(sheet_object_image_set_crop): New function. Set cropping
	parameters.
	(soi_get_cropped_pixbuf): New function. Get the cropped image from
	pixbuf.
	(soi_get_pixbuf): Do cropping by calling soi_get_cropped_pixbuf.
	(sheet_object_image_init): Initialize cropping parameters.

2002-02-24  Almer S. Tigelaar  <almer@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=72416
	http://bugzilla.gnome.org/show_bug.cgi?id=71783
	* src/stf-export.c (stf_export_cell):
	Honor the 'never' quote setting and fix a subtle
	bug that caused the quoting character always be	"

2002-02-22  Morten Welinder  <terra@diku.dk>

	* src/numbers.h (floorgnum, ceilgnum, powgnum, expgnum, loggnum,
	log10gnum, singnum, cosgnum, tangnum, asingnum, acosgnum,
	atangnum): Supply these.  Use everywhere.

	* configure.in: Check for the above.

2002-02-22  Morten Welinder  <terra@diku.dk>

	* configure.in: Check for ldexpl and frexpl.

	* src/mathfunc.c (gpow2): New function.
	(gnumeric_add_epsilon, gnumeric_sub_epsilon, gnumeric_fake_floor,
	gnumeric_fake_ceil, gnumeric_fake_round, gnumeric_fake_trunc):
	Make these gnum_float typed.

	* src/numbers.h (frexpgnum, ldexpgnum): New stuff.

2002-02-21  Morten Welinder  <terra@diku.dk>

	* src/numbers.h: Define prototypes for strtognum, modfgnum, and
	gnumabs here when needed.

	* src/workbook-control-gui.c (wbcg_validation_msg): Constify.

	* src/cell.c (cell_is_zero): Use gnum_float.

	* src/regression.c (LUPDecomp): Use gnumabs.
	* src/solver-lp.c (solver_answer_report): Ditto.
	* src/value.c (value_diff): Ditto.
	* src/goal-seek.c: Ditto.
	* src/rangefunc.c (range_avedev): Ditto.

	* src/validation.c (validation_eval): Use gnum_float, modfgnum,
	and gnumabs.

	* src/numbers.h (GNUM_MANT_DIG, GNUM_MAX_EXP, gnumabs): New stuff.

2002-02-21  Morten Welinder <terra@diku.dk>

	* src/solver-lp.c (callback): Fix formats.

	* src/plugin-loader-module.h (ModulePluginFunctionInfo): Constify.
	* src/plugin-loader-module.c (gnumeric_plugin_loader_module_func_get_full_function_info): Constify.
	* src/func.c (function_def_get_full_info_if_needed): Constify.

2002-02-20  Jody Goldberg <jody@gnome.org>

	* src/workbook.h : some house cleaning.

	* src/workbook.c (workbook_is_pristine) : remove stuf for
	  external_dependents.  No use having fogotten stubs hanging around.

	* src/workbook-control-gui.c (cb_insert_component) : look for
	  ControlFactories.
	(cb_insert_shaped_component) : look for CanvasComponentFactories.

	* src/commands.h : remove include for gtkobject.

	* idl/GNOME_Gnumeric_Graph.idl : We a ControlFactory now, not an
	  Embeddable.

2002-02-20  Morten Welinder  <terra@diku.dk>

	* src/mathfunc.c (display): Fix format.
	* src/analysis-tools.c (confidence_level): Ditto.
	(regression_tool): Ditto.
	* src/format.c (fmt_general_int): Ditto.

	* configure.in (set_mode_warnings): Add -Wformat also.

2002-02-20  Morten Welinder  <terra@diku.dk>

	* src/func.c (fn_def_new, function_add_args, function_add_nodes):
 	Constify.

2002-02-20  Morten Welinder  <terra@diku.dk>

	* src/parser.y (yyerror): Constify.

	* src/xml-io.c (xml_node_set_print_unit): Constify.
	(xml_read_print_repeat_range): Constify.

	* src/summary.c (summary_item_name): Constify.

	* src/print-info.c (predefined_formats, render_ops): Constify.

2002-02-20  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/expr-name.c (builtins): Constify.

	* src/complex.c (complex_to_string): Constify.

	* src/commands.c (cmd_set_text): Constify.
	(cmd_area_set_text): Constify.

	* src/mstyle.c (mstyle_to_string): Missing g_strdup added for
 	sanity check, just in case.
	* src/summary.c (summary_item_as_text): Ditto.
	* src/value.c (value_get_as_string): Ditto.

	* configure.in (CFLAGS): Add -Wwrite-strings, if possible.

	* src/gui-util.c (gnumeric_dialog_raise_if_exists): Constify.

2002-02-20  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/analysis-tools.c (regression_tool) : use only values
	  from extra_stat (renamed to regression_stat)
	* src/regression.c (general_linear_regression) : calculate more
	  regression_stat
	(regression_stat_new) : new
	(regression_stat_destroy) : new
	* src/regression.h : add fields to regression_stat_t and add
	  declarations of regression_stat_new and regression_stat_destroy

2002-02-20  Morten Welinder  <terra@diku.dk>

	* src/format.c (format_value): Missing g_strdup added for sanity
 	check, just in case.

	* src/datetime.c (coup_cd): Cleanup using
 	g_date_get_days_in_month.

2002-02-19  Morten Welinder  <terra@diku.dk>

	* src/numbers.h (modfgnum, strtgnum, GNUM_FORMAT_[eEfg],
 	GNUM_DIG): New stuff.

  	* .../*.[cy]: All relevant strtod changed to strtognum; modf to
 	modfgnum; DBL_DIG to GNUM_DIG; formats changed to use
 	GNUM_FORMAT_...

	* src/gutils.c (strtognum): If needed, define a version here.

	* src/complex.c (complex_to_string): Use right format for
 	imaginary part.

	* configure.in: Add support for --with-long-double.

	* acconfig.h: Add WITH_LONG_DOUBLE.

2002-02-19  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=69362
	* src/auto-correct.c (autocorrect_tool) : only upper case things if
	  they are at the start of a word.

2002-02-19  Morten Welinder  <terra@diku.dk>

	* src/format.c: Use gnum_float instead of double.

	* src/mathfunc.c (random_01): Use /dev/urandom when available.

	* src/sheet-autofill.c (autofill_cell): Use gnum_float instead of
	double.
	* src/expr.c (expr_eval_real): Ditto.
	* src/datetime.c (datetime_timet_to_serial_raw): Ditto.

	* src/format.c (format_compile): Fix isdigit usage.

	* src/value.c (value_diff): Return a gnum_float, not a double.

2002-02-19  Jody Goldberg <jody@gnome.org>

	* src/global-gnome-font.c (global_gnome_font_init) : get font list
	  from pango.
	(global_gnome_font_shutdown) : and free it here.

2002-02-18  Jody Goldberg <jody@gnome.org>

	* configure.in  : post release bump.

2002-02-18  Jody Goldberg <jody@gnome.org>

	* Release 1.1.0

2002-02-18  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_scroll_wheel_support) : fix
	  scrollwheel support.
	(workbook_control_gui_init) : use the new 'scroll-event' handler.

2002-02-17  Jody Goldberg <jody@gnome.org>

	* plugins/excel/ms-escher.c (ms_escher_read_OPT) : add support for
	  blip cropping.

2002-02-16  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-image.c (soi_get_pixbuf) : move things here.
	(sheet_object_image_new_view) : and use it here.
	(sheet_object_image_print) : and here.

2002-02-15  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-image.{ch} : new.

	* src/sheet-object.c (sheet_object_new_view) : use a weak_ref.

	* src/sheet-control-gui.c (scg_object_register) : more safety
	  and use a weak_ref.

	* src/sheet-object-graphic.c : More GObject-ification.

2002-02-15  Morten Welinder  <terra@diku.dk>

	* src/regression.c (LUPDecomp): Use fabs, not abs.
	* src/validation.c (validation_eval): Ditto.

2002-02-15  Morten Welinder  <terra@diku.dk>

	* src/regression.c (general_linear_regression): Cleanup using
	range functions.

2002-02-15  Jody Goldberg <jody@gnome.org>

	* src/widgets/gnumeric-combo-text.c (gnm_combo_text_destroy) : more
	  g_signal-ification.  g_signal_handlers_disconnect_by_func just hides
	  the problem.  The real issue is that we are disconnecting twice.

	* src/workbook.c (workbook_set_saveinfo) : use a weak_ref.

2002-02-15  Jody Goldberg <jody@gnome.org>

	* src/item-cursor.c (item_cursor_tip_setlabel) : enable now that the
	  canvas bug is fixed.

	* src/sheet-control-gui.c (cb_hscrollbar_adjust_bounds) : new.
	(cb_vscrollbar_adjust_bounds) : new.

	* src/gui-util.c (gtk_button_stock_alignment_set) : new.
	(gnumeric_init_help_button) : new.

	* src/gnumeric-canvas.h : Move declaration of
	  GnumericCanvasSlideHandler here.

	* src/gnumeric-canvas.c (gnm_canvas_guru_key) : forward to the entry,
	  not the GnumericExprEntry wrapper.
	(gnm_canvas_key_mode_sheet) : ditto.

	* src/formats.c (cell_format_classify) : handle general.

	* src/file-priv.h : Inherit from GObject.

	* src/complete-sheet.c (complete_sheet_finalize) : call class_peek
	  here to avoid potential reference problems.

	* src/commands.c (cmd_set_text) : doh!  fix multi-line text.
	(cmd_autoformat) : const.

	* src/cell.c (cell_relocate) : const.
	* src/clipboard.c (paste_cell_with_operation) : const.
	(paste_cell) : ditto.

	* src/application.c (application_init) : add jimmac's expr-entry icon.

	* src/Makefile.am : distribute the marshaller.list

	s/GtkType/GType/
	s/GtkSignalFunc/GCallback/
	s/gtk_signal_connect/g_signal_connect/  + reformating.
	s/GTK_CHECK_CAST/G_TYPE_CHECK_INSTANCE_CAST/
	s/GTK_CHECK_TYPE/G_TYPE_CHECK_CLASS_CAST/
	s/GTK_CHECK_CLASS_CAST/G_TYPE_CHECK_INSTANCE_TYPE/
	s/GTK_CHECK_CLASS_TYPE/G_TYPE_CHECK_CLASS_TYPE/

2002-02-11  Jody Goldberg <jody@gnome.org>

	* src/stf.c (stf_init) : Make the names of the text import/export
	  clearer.

2002-02-12  Morten Welinder  <terra@diku.dk>

	* src/io-context.c (value_io_progress_update): Correct assertion.

	* src/io-context.c (file_io_progress_update,
	memory_io_progress_update, value_io_progress_update,
	count_io_progress_update, workbook_io_progress_update): Use test,
	not assignment.

	* src/stf-parse.c (trim_spaces_inplace): Fix isspace usage.
	(stf_parse_is_valid_data): Ditto.
	* src/sheet.c (sheet_name_quote): Ditto.

2002-02-11  Jon K Hellan  <hellan@acm.org>

	Support per-sheet grid color. Needed for correct XL import.

	* src/style-color.[ch] (color_equal): Rename to style_color_equal
	and export.

	* src/style-border.[ch] (style_border_none_set_color): New
	function. Update the grid color (color of style border none) to
	the given color.

	* src/sheet-style.[ch] (sheet_style_update_grid_color): New
	function. Update the grid color to fit the given sheet.

	* src/item-grid.c (item_grid_draw): Call
	sheet_style_update_grid_color before rendering.

	* src/print-cell.c (print_cell_range): Ditto

	* src/preview-grid.c (preview_grid_draw): Call
	style_border_none_update_color before rendering.

2002-02-11  Jody Goldberg <jody@gnome.org>

	* src/item-bar.c (item_bar_realize) : Use the standard cursor.

2002-02-08  Jody Goldberg <jody@gnome.org>

	* src/workbook-edit.c (wbcg_get_entry) : Use
	  gnumeric_expr_entry_get_entry.
	(wbcg_edit_attach_guru) : wbcg_get_entry.
	(wbcg_edit_detach_guru) : ditto.

	* src/workbook-control-gui.c : include datetime.h
	(workbook_setup_edit_area) : pack the ecpr-entry, not the contained
	entry.
	(wbcg_validation_msg) : warning suppression.

	* src/validation.c (validation_eval) : suppress warning.

	* src/sheet-autofill.c (str_contains) : delete.

	* src/number-match.c (format_match) : remove unused variable.

	* src/item-edit.c (item_edit_set_arg) : wbcg_get_entry signature change.

	* src/format-template.c (format_template_member_set_row_info) : delete.
	(format_template_member_set_col_info) : ditto.

	* src/commands.c (cmd_autoformat) : revert previous attempt at
	  constness.  It seems the templates are also used as acumulators
	  during application.  I don't think it is a great design choice,
	  but we'll live with it.

	* src/application.c (application_init) : add Jacub's expr entry.

2002-02-10  Chema Celorio  <chema@celorio.com>

	* configure.in: remove GNOME_COMMON_INIT
	[http://developer.gnome.org/dotplan/porting/ar01s05.html]

2002-02-08  Jon K Hellan  <hellan@acm.org>

	* src/mstyle.c (link_border_colors): Return from the right place.

	* src/style-color.c (style_color_new_uninterned): Create with
	refcount 1.
	(style_color_new): Only increment refcount if using cached color.

	* src/sheet.c (sheet_duplicate): Clone auto pattern color

	* src/sheet-style.c (sheet_style_init): Move auto_pattern_color
	initialization forward. sheet_style_get_auto_pattern_color is
	called from sheet_style_find below.
	(sheet_style_set_auto_pattern_color): Tag it as an auto
	color. Unref the input color.

	* src/sheet-style.[ch]: (sheet_style_get_auto_pattern_color): constify.

	* src/mstyle.c (link_pattern_color): New function.  Replace auto
	pattern color in style with sheet's auto pattern color.
	(link_border_colors): New function. Replace auto border colors in
	style with sheet's auto pattern color.
	(mstyle_link_sheet): Use target sheet's auto pattern color by
	calling link_xxxx_color functions.
	(mstyle_set_border): Fix typo.

2002-02-07  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/analysis-tools.c (anova_single_factor_tool) : be more
	  careful with precision.

2002-02-07  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/rangefunc.c (range_sum) : improve precision through 2 pass
	  algorithm
	(range_sumsq) : ditto

2002-02-06  Jody Goldberg <jody@gnome.org>

	* src/auto-format.c (auto_style_format_suggest) : it is now the
	  primitive.

2002-02-06  Michael Meeks  <michael@ximian.com>

	* src/workbook.c (workbook_bonobo_setup): don't
	setup the item container.

	* src/gnumeric-graph.c: porting action.
	(bonobo_activation_exception_id): kill.

	* src/corba-args.c (gnumeric_arg_parse): upd.

	* src/bonobo-io.c: porting action.

	* src/sheet-object-bonobo.c: porting action.

2002-02-06  Jody Goldberg <jody@gnome.org>

	* src/sheet-autofill.c (autofill_create_fill_items) : changes to the
	classification interface.  It will continue to evolve.

	* src/formats.c (cell_format_classify) : change the signature.  In the
	  future this should really be split.  This routine is
	  1) stupid
	  2) wrong
	  It is really only useful in the context of the format dialog.
	  however, our desire to call it elsewhere indicates what the new
	  format engine should make easiliy accessible.

	* src/expr.c (expr_eval_real) : quick and easy support for autoformat
	  style formating for percent operator.  Just a quick test to see how
	  hard it would be, and it wasn't.

	* src/auto-format.c : Convert to StyleFormat.  Nothing actually uses
	  this anymore but I have not merged its logic into the eval structure
	  yet.

	* src/format-template.c (format_template_check_valid) : warning
	  suppression.

	* src/format.c (style_format_general) : new.
	(style_format_default_date) : new.
	(style_format_default_time) : new.
	(style_format_default_percentage) : new.
	(style_format_default_money) : new.

	* src/cell.c (cell_get_format) : finish the conversion.

2002-02-05  Jon K Hellan  <hellan@acm.org>

	* src/style-color.c (style_color_new_uninterned): New
	function. Factored out of style_color_new. Creates color
	unconditionally, without using the hash table.
	(style_color_new): Factor out style_color_new_uninterned.
	(style_color_new_i8): New function. Create a style color from 8
	bit rgb values by cloning to 16 bits.
	(style_color_auto_font): New function. Returns an uninterned black
	to represent Excel auto font color.
	(style_color_auto_back): New function. Returns an uninterned white
	to represent Excel auto background color.
	(style_color_auto_pattern): New function. Returns an uninterned black
	to represent Excel auto pattern color.
	(color_equal): Include is_auto flag in comparison.
	(color_hash): Include is_auto flag in hash function.

	* src/style-color.h (style_color_new_i8, style_color_auto_font,
	style_color_auto_back, style_color_auto_pattern): Declare

	* src/sheet-style.c (struct _SheetStyleData): Add
	auto_pattern_color.
	(sheet_style_init): Initialize auto_pattern_color.
	(sheet_style_shutdown): Unref auto_pattern_color.
	(sheet_style_set_auto_pattern_color): New function. Set the auto
	pattern color for this sheet.
	(sheet_style_get_auto_pattern_color): New function. Get the auto
	pattern color for this sheet.

	* src/sheet-style.h (sheet_style_set_auto_pattern_color,
	sheet_style_get_auto_pattern_color): Declare.

2002-02-03  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_insert_current_date) : don't actually
	  store the value, just start editing with it.
	(cb_insert_current_time) : ditto.

2002-02-03  Jody Goldberg <jody@gnome.org>

	* src/value.c (value_new_*) : init Value*::fmt
	(value_duplicate) : ref the fmt too.
	(value_set_fmt) : new.

	* src/cell.c (cell_cleanout) : no more format.
	(cell_copy) : ditto.
	(cell_set_text) : ditto.
	(cell_set_expr_internal) : ditto.
	(cell_set_expr_unsafe) : ditto.
	(cell_get_format) : ditto.

	Change all callers.
	* src/sheet.c (sheet_cell_set_value) : remove format assingment.
	* src/cell.c (cell_set_expr_and_value) : remove format assignment.
	(cell_assign_value) : ditto.
	(cell_set_value) : ditto.
	(cell_set_expr) : ditto.
	* src/parser.y (expr_parse_str) : remove arg to return the suggested
	  format.  That will be handled at run time.
	* src/number-match.c (format_match) : remove arg to return the parse
	  formula.  Store it in the value instead.

2002-02-02  Jody Goldberg <jody@gnome.org>

	* src/main.c (main) : disable the removal of Shift as an accelerator
	  fixes the double movement in treeviews strangeness.

	* src/workbook-control-gui.c : reorganize the insert menu.
	* src/GNOME_Gnumeric.xml : ditto.

2002-02-01  Jody Goldberg <jody@gnome.org>

	* src/xml-io-autoft.c : port to libxml2 and begin merging into
	* src/format-template.c : here.

2002-01-31  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_dialog_question_yes_no) : port to gnome2

2002-02-01  Jody Goldberg <jody@gnome.org>

	* configure.in : cleanup the includes a bit and make the libole2
	  requirement specific to the XL plugin.  Tidy up the gda, and gb
	  tests to be consistent and more informative.

	* src/main.c : remove ole debug flag.

	* src/gnumeric-graph.c (gnm_graph_new) : return a GObject
	  makes it easier to handle NULL.

2002-01-31  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/analysis-tools.h : add `warning' to GENERIC_TOOL_STATE
	  and some clean-up

2002-01-31  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_focus_cur_scg) : warning
	  suppression.
	(sheet_control_gui_new) : enable partial scrollbar support.

	* src/workbook-control.c (wb_control_parse_and_jump) : make defined
	  names absolute.

2002-01-30  Jody Goldberg <jody@gnome.org>

	* src/dialogs/dialog-autoformat.c (templates_load) : changes to
	  category_group_get_templates_list.

	* src/xml-io-autoft.c (gnumeric_xml_write_format_template) : take a
	  context not a control to clarify things.
	(gnumeric_xml_read_format_template) : ditto.

	* src/workbook.c (workbook_persist_file_save) : changes to
	  wb_view_save_as.

	* src/io-context.c (io_context_destroy) : impl is a command context now.
	(gnumeric_io_context_new) : weaken requirements so that all we need is
	  a command context.  Not strictly necessary, but makes it less likely
	  that people will get confused.

	* src/workbook-view.c (wb_view_save_as) : Take a command context not a
	  workbook control to avoid confusing what we are saving.
	(wb_view_save) : ditto.
	(wb_view_selection_desc) : Implement using an explicit control.
	(wb_view_open_custom) : add a missing precondition.
	* src/gui-file.c (do_save_as) : changes to wb_view_save_as.
	(gui_file_save_to_stream) :  changes to gnumeric_io_context_new.

	* src/file-autoft.c (category_get_templates_list) : take a command
	context, not a workbookcontrol.
	(category_group_get_templates_list) : ditto.
	* src/format-template.c (format_template_new) : ditto.
	(format_template_new_from_file) : ditto.

2002-01-31  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/analysis-tools.h : include type definitions and function
	  prototypes previously in src/dialogs/dialog-analysis-tools.c
	* src/analysis-tools.c (autofit_columns) : make non-static
	* src/func-util.h (parse_database_criteria) : new

2002-01-30  Jody Goldberg <jody@gnome.org>

	* src/application.c : merge in the new object icons from jimmac.
	* src/pixmaps/Makefile.am : ditto.
	* src/workbook-control-gui.c : ditto.
	* src/GNOME_Gnumeric.xml : ditto.
	s/^/Object/
	s/Rect/Rectangle/
	s/Oval/Ellipse/
	s/Checkbutton/Checkbox/

	* src/gui-util.c (gnumeric_error_info_dialog_show) : center error
	  dialog on the mouse.

2002-01-29  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_notebook_switch_page) : fix changing
	  sheets.

2002-01-29  Jody Goldberg <jody@gnome.org>

	* src/workbook-format-toolbar.c (workbook_create_format_toolbar) :
	  hard code relief.
	* src/workbook-control-gui.c (workbook_create_standard_toolbar) :
	  ditto.

2002-01-29  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-control-gui.c (sheet_action_rename_sheet) : move most
	  code into dialog_sheet_name and friends
	(cb_sheet_change_name) : ditto, also rename to cb_sheet_name

2002-01-28 Joshua R. Odom <jrodom@stic.net>

	* src/application.c : clean up the file names to match the code.
	* src/pixmaps/Makefile.am : ditto.

2002-01-28  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_sheet_move) : flag if the move did
	  anything.

	* src/workbook-object-toolbar.c :  adjust to the new creation format.

	* src/workbook-edit.c (wbcg_edit_has_guru) : return the actual guru.

	* src/workbook-control-gui.c : Explicitly use the STOCK items rather
	  than just the stock icon names.  This enables the accelerators too.

	* src/sheet-object-widget.c : cleanup.
	  Use _init functions, no need to create a silly _new wrapper that calls
	  construct.  Remove unused Sheet arguments.

	* src/gnumeric-canvas.c (gnm_canvas_guru_key) : new.
	(gnm_canvas_key_mode_sheet) : be more careful about what how to handle
	  keys when there is a guru up.

	* src/sheet-object-widget.c (sheet_widget_checkbox_user_config) :
	  create the table.

2002-01-27  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : cleanup the generated files.

2002-01-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/consolidate.c (consolidate_set_destination) : accept
	  value instead of range
	(consolidate_add_source) : ditto
	* src/consolidate.h (consolidate_set_destination) : change
	  parameters
	(consolidate_add_source) : ditto

2002-01-27  Seth Nickell  <snickell@stanford.edu>

	* Makefile.am:

	Install .desktop file into prefix/share/applications,
	the new location for .desktop files in GNOME 2.

	* gnumeric.desktop.in:

	Add appropriate categories fields.

	Add a functional description to match the GNOME 2
	HIG.

2002-01-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui_util.c (gnumeric_destroy_dialog) : new callback
	(gnumeric_notice_nonmodal) : save dialog ptr in reference
	* src/gui_util.h (gnumeric_notice_nonmodal) : change
	  parameters and return value

2002-01-27  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c :
	  remove Menu_ prefix from pixmap names.

2002-01-26  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_notice_nonmodal) : non-modal version of
	  gnumeric_notice
	(gnumeric_dialog_run) : remove warning
	* src/gui-util.h (gnumeric_notice_nonmodal) : new

2002-01-26  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (entry_to_float) :
	  moved here from dialogs/dialog-analysis-tools.c
	(entry_to_int) : ditto
	(float_to_entry) : ditto
	(int_to_entry) : ditto

	* src/gui-util.h (entry_to_float) new function (used to be static)
	(entry_to_int) : ditto
	(float_to_entry) : ditto
	(int_to_entry) : ditto

2002-01-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* item-grid.c (item_grid_event) : don't scroll at end of formula
	  range selection (http://bugzilla.gnome.org/show_bug.cgi?id=63485)

2002-01-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gnumeric_dialog_run) : use GTK functions
	(gnumeric_notice) : create GTK_Message_Dialog
	* src/gui-util.h (gnumeric_notice) : change type of second argument
	* src/gui-file.c : fix all calls to gnumeric_notice
	* src/print.c : ditto
	* src/style.c : ditto
	* src/workbook-cmd-format.c : ditto
	* src/workbook-control-gui.c : ditto

2002-01-25  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_context_menu) : fix the icon names.

	* src/gui-util.c (gnumeric_popup_menu) : sink the menus.

	* src/main.c (main) : lock the encoding to be utf-8.

	* src/eval.c : enable the micro hash by default.

	* src/expr.c (cellref_relocate) : simplify and remove the force
	  arguments.  Flag invalidations from inside vs to inside. From takes
	  precendence.
	(cellref_shift) : new.
	(cellrange_relocate) : simplfy and try a different tack on how to
	  handle corners with different sets of relocation needs.

	* src/commands.c (cmd_paste_cut_undo) : pass NULL for the
	  reloc_storage to disable invalidation.

	* src/sheet.c (sheet_move_range) : document.
	  Make the reloc_storage optional.  If it is not specified do NOT
	  invalidate references to the dst region that are being
	  invalidated.  Since this routine is only used for cut redo/undo
	  and undo really should not be invalidating we use that as a flag.

2002-01-25  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : register the marshaller as BUILT sources.

2002-01-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/cell.h (cell_get_render_color) : new
	* src/rendered-value.c (cell_get_render_color) : new

2002-01-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/ranges.h (global_range_name) : new
	* src/ranges.c (global_range_name) : new

2002-01-24  Jody Goldberg <jody@gnome.org>

	* configure.in : explicitly disable guile, psiconv, and bonobo for now.
	Add a warning.

	* src/Makefile.am : Apparently the sources list is order dependent.
	  Put the built sources at the top.

2002-01-24  Rodrigo Moya <rodrigo@gnome-db.org>

	* configure.in: fixed libgda detection for GNOME 2.

2002-01-23  Jody Goldberg <jody@gnome.org>

	* src/gui-util.c (gnumeric_textview_get_text) : new utility.
	(gnumeric_textview_set_text) : ditto.

	* src/history.c : tidy up a mite.

	* src/gui-util.c : Some initial conversions to gnome2.  Needs work.

	* src/gui-file.c (can_try_save_to) : Use the new glib2 file utilities.

	* src/gnumeric.h : remove the gnome-1.4 compatibility shims.

	* src/gnumeric-pane.c (gnumeric_pane_realized) : renamed to be
	  consistent.

	* src/gnumeric-graph.c (bonobo_activation_exception_id) : renamed from
	  oaf_exception_id.
	(gnm_graph_setup) : begin conversion to bonobo-activation.

	* src/gnumeric-canvas.c : disable the IM support for now.

	* src/formats.c (currency_symbols) : pound, yen, euro -> utf8.

	* src/format.c : no need for portability.h
	* src/func.c : ditto.

	* src/file.c (gnum_file_saver_setup) : disable mime for now.

	* src/command-context.c : Inherit directly from GObject.
	* src/commands.c : ditto.
	* src/complete-sheet.c : ditto.
	* src/complete.c : ditto.

	* src/application.c : convert to new stock icon management.

	* src/Makefile.am : remove portability.h.
	  Add pixmaps subdir.
	  Build marshallers.

	* Makefile.am : Convert to intltool.
	* acconfig.h : Convert to gnome2 gettext format.
	* .cvsignore : Convert to intltool, and remove the Conf file.
	* src/.cvsignore : Update.
	* autogen.sh : Convert to gnome2.
	* configure.in : Rough conversion to gnome2.  We'll need to re-enable
	  the plugins.

	* idl/GNOME_Gnumeric.idl : Delete an unused interface.
	* idl/Makefile.am (dist) : update.

	* plugins/Makefile.am :  Use WITH_GUILE rather than just GUILE to be
	  consistent.
	* plugins/*/Makefile.am : Convert to intltool.

2002-01-22  Jody Goldberg <jody@gnome.org>

	* src/sheet-autofill.c (autofill_create_fill_items) : Use
	  list_prepend, and reverse in palce of append.

2001-01-22  Kevin Breit <mrproper@ximian.com>

	* Makefile.am: Added omf-install/
	* omf-install: Added directory for OMF stuff
	* omf-install/Makefile.am: Copied that in

2002-01-22  Rodrigo Moya <rodrigo@gnome-db.org>

	* README:
	* configure.in: increased minimum libgda versions
