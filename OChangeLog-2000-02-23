1999-11-12  Miguel de Icaza  <miguel@gnu.org>

	* src/format.c (format_number): Use alloca here.

1999-11-12  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-cell-format.c (fillin_negative_samples) :
	  Add configurable currency symbols.
	(cb_format_currency_select) : New function.
	(fmt_dialog_init_format_page) : Init the list of currencies.

	* src/formats.c (CurrencySymbol) : Add 'None' and Pound
	  ans set default to '$'.

	From Jon K Hellan  <hellan@acm.org>
	* src/dialogs/cell-format.glade: 
	  Use descriptive names for notebook pages.
	  Change accelerators, should remove conflicts within pages.
	  Remove explicit width for format_general_label.
	  Use GtkLabel instead of GtkAccelLabel.
	  Change spelling from "seperator" to "separator".
	  Make decimals spinbutton focus target for "decimal places" label.
	  format_negative_scroll: Set vscrollbar_policy to GTK_POLICY_AUTOMATIC.
	  format_list_scroll: Set hscrollbar_policy to GTK_POLICY_NEVER.
	
	* src/dialogs/dialog-cell-format.c:  
	  Change spelling from "seperator" to "separator".
	(fmt_dialog_init_format_page):
	(fmt_dialog_enable_widgets): Also hide and show F_NEGATIVE_SCROLL.
	(cb_format_list_size_allocate): 
	  Make the selected line visible when we know our geometry.
	(fmt_dialog_init_format_page): Set negative clist title passive.
	(fmt_dialog_init_format_page): 
	  Call cb_format_changed to update display if "general" is displayed.
	(set_initial_focus): Set initial focus
	(fmt_dialog_impl): Set dialog title, set initial focus


1999-11-12  Michael Meeks  <mmeeks@gnu.org>

	* src/workbook.c (workbook_attach_sheet): Add comment explaining life.

1999-11-12  Michael Meeks  <mmeeks@gnu.org>

	* src/workbook.c (workbook_attach_sheet): Attach the 
	editable_label pointer to the sheet tab.
	(workbook_rename_sheet): Fix _really_ broken label setting code #3134.

	* src/widgets/widget-editable-label.c (el_stop_editing): make
	toplevel destruction more explicit.

1999-11-11  Michael Meeks  <mmeeks@gnu.org>

	* src/ranges.c (range_fragment_list_clip): Fix heinous range bug,
	I need instant dental care.

1999-11-12  Tuomas Kuosmanen  <tigert@gimp.org>

	* src/pixmaps/money.xpm: New icon for "money" datatype.

1999-11-11  Michael Meeks  <mmeeks@gnu.org>

	* src/selection.c (sheet_selection_paste): remove spurious
	unant.

1999-11-11  Michael Meeks  <mmeeks@gnu.org>
	
	* src/mstyle.c (mstyle_new_default): Revert removal of
	default_mstyle patch.

	* src/selection.c (selection_move_range_cb): kill.
	(sheet_selection_move): fixup. (sheet_selection_paste): unant cursor
	on copy.

	* src/mstyle.c (mstyle_merge): Change semantics again, was stomping
	on other ref-counted copies. (mstyle_elements_copy): implement.
	(mstyle_copy): Implement.

1999-11-10  Michael Meeks  <mmeeks@gnu.org>

	* src/ranges.c (range_fragment_list_clip): implement clipping.

	* src/sheet-style.c (sheet_mstyle_compute_from_list): split from
	(sheet_style_compute): and call.

	* src/ranges.c (range_expand): implement.

1999-11-11  Jody Goldberg <jgoldberg@home.com>

	* src/mstyle.c (mstyle_new_default) : Disable caching of default
	  style to prevent problems when overridden later.

	* src/dialogs/dialog-cell-format.c (draw_format_preview) :
	  Generate accounting format strings.

	* doc/C/images/{number-format-dialog.jpg,
			number-format-justification-dialog-2.jpg,
			number-format-color-dialog-2.jpg) : Update.
	* doc/C/number-format.sgml : Update.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_load) :
	  The client_site is created in the initializer.

1999-11-10  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_move) : Delete.
	(sheet_selection_paste) : Use sheet_selection_set instead,
	  and check for singletons and same shapeness when pasting a cut.

	* src/item-cursor.c (item_cursor_tip_setlabel) : New function, not
	  used yet.
	(item_cursor_selection_event) : Keep track of the starting point.
	(item_cursor_drag_event) : Use info to not jump to the edge.
	(item_cursor_autofill_event) : Ditto.
	(item_cursor_set_bounds_visibly) : Minor patch to use the new offset
	  information.

	* src/gnumeric-util.c (gnumeric_position_tooltip) : Be sensitive to 0.

	* src/gnumeric-sheet.c (gnumeric_sheet_new) : Select A1 at startup,
	  not A1:B2.
	(move_cursor_horizontal) : Remove warning.

	* src/dialogs/dialog-cell-format.c (draw_format_preview) : Init
	  variable.

	* src/cell-draw.c (cell_draw) : Correct problem with spanning columns.

	* src/pattern.c (gnumeric_background_set_gc) : Always set the GC
	  in case a spanning column needs it.

	* src/item-grid.c (item_grid_draw) : Improve support for spanning
	  columns going to the right.  We are still broken in that spanning
	  columns to the left will skip borders.

	* src/dialogs/cell-format.glade : Improve layout for big fonts.

1999-11-07  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c (workbook_new): coding style requires a space
	before an opening parenthesis.

1999-11-09  Michael Meeks  <mmeeks@gnu.org>

	* doc/features.txt: Added, please expand.

1999-11-09  Michael Meeks  <mmeeks@gnu.org>

	* src/dialogs/dialog-cell-format.c (cb_fmt_dialog_dialog_apply): fix
	possible fatal ref handing problem. (fmt_dialog_impl): Fix state.result
	leak.

	* src/ranges.c (range_copy): simplify.

	* src/sheet-style.c (do_blank_border): create
	(sheet_selection_apply_border_cb): Add clearing 'outer' styles.
	(sheet_unique_cb): Kill freeing of range fragments; wierd.

1999-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/formats.c (cell_format_is_number) : Add initial currency,
	  percent, and scientific notation support.

	* src/format.c (format_number) : Add support for currency codes.
	(format_value) : Ditto.

	* src/item-bar.c (bar_draw_cell) : Slight color adjustment to make
	  it easier to see which rows/cols are selected.

	* src/render-ascii.c (cell_region_render_ascii) : Fix typo that was
	  breaking pasting too the X selection.

	* src/dialogs/dialog-cell-format.c (fmt_dialog_init_format_page,
	  fmt_dialog_impl, fmt_dialog_init_font_page, fmt_dialog_init_align_page,
	  setup_color_pickers) :  Use mstyle_is_element_conflict.
	(dialog_cell_format) : Use sheet_selection_get_unique_style.
	(do_check_border) : Fix the boundary cases until we getthe extended
	  uniq support.
	(draw_format_preview) : Add format generation routines for
	  number, currency, percent, and scientific.

1999-11-09  Michael Meeks  <mmeeks@gnu.org>

	* src/xml-io.c (xml_read_style_border): update to STYLE_BORDER_NONE.

	* src/sheet-style.c (do_apply_border): update.
	(sheet_selection_apply_border_cb): update + add diagonals here.
	(sheet_selection_set_border): simplify + update.

	* src/dialogs/dialog-cell-format.c (cb_fmt_dialog_dialog_apply):
	update to new sheet_selection_set_border API.

	* src/border.h: s/BORDER_/STYLE_BORDER_/

1999-11-09  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-cell-format.c (init_border_button) : Use
	  check_border.
	(check_border, cb_check_border,
	 do_check_border, sheet_cell_get_border) : New functions.

1999-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (selection_foreach_range) : Have the call back
	  return a flag.

	* src/dialogs/dialog-cell-format.c (draw_border_preview) :
	  Support for presetting the border types.

	* src/widgets/gnumeric-dashed-canvas-line.c
	(gnumeric_dashed_canvas_line_set_dash_index) : Remove unused rgba
	  argument.

	* src/selection.c (selection_first_range) : Add permit_complex flag.

	* src/item-grid.c (item_grid_draw_border) : Correct diagonal vs
	  reverse diagonal.

	* src/border.c (style_border_none) : New function.
	(style_border_fetch) : Use new function to handle BORDER_NONE.
	(style_border_unref) : Be extra careful about border_none.
	(style_border_draw) : Handle BORDER_NONE.

	* src/formats.c : Reorg slightly.

	* src/mstyle.c (mstyle_new_default) : Init to border_none.

	* src/sheet-style.c (sheet_selection_apply_border_cb) :
	  Rework to apply inside regions, and clear regions when appropriate.

	* src/xml-io.c : Expand set of border style names.

	* src/dialogs/dialog-cell-format.c : Move closer to selecting
	  formats correctly.
	  Set & clear borders now.

1999-11-08  Michael Meeks  <mmeeks@gnu.org>

	* src/dialogs/dialog-summary.c (summary_get): fix minor naming
	bug.

	* src/mstyle.c (mstyle_element_dump): fixup for NULL borders.

1999-11-08  Frank Chiulli <fchiulli@home.com>
	
	* src/summary.c : Added new strings to summary_item_name to reflect all
	  the fields/items in SummaryInformation and DocumentSummaryInformation.

	* src/summary.c (summary_item_new_boolean) : New function.
	
	* src/summary.c (summary_item_new_short) : New function.
	
	* src/summary.c (summary_item_as_text) : Now processes the new summary 
	  types (SUMMARY_BOOLEAN, SUMMARY_SHORT, SUMMARY_TIME).

	* src/summary.c (summary_item_free) : Now processes the new summary 
	  types (SUMMARY_BOOLEAN, SUMMARY_SHORT, SUMMARY_TIME).
	  
	* src/summary.h : Added new enums to SummaryItemType (SUMMARY_BOOLEAN,
	  SUMMARY_SHORT, SUMMARY_TIME).  Added new enums to SummaryItemBuiltin
	  to summary all the summary items.  Added two new fields (short_i and
	  boolean) the v union within the _SummaryItem struct.  Added prototypes
	  for the new public functions.
	  
	* src/dialogs/dialog-summary.c (summary_get): Field names are construct-
	  ed from the name in summary_item_name[] with "glade_" prefixed.

	* src/dialogs/dialog-summary.c (summary_put): Field names are construct-
	  ed from the name in summary_item_name[] with "glade_" prefixed.

	* src/dialogs/dialog-summary.c (dialog_summary_update) : Added new 
	  summary field - Company.
	  
	* src/dialogs/summary.glade : Added new summary field - Company.
	  
	* src/dialogs/summary.glade.h : Added new summary field - Company.
       
1999-11-08  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_selection_apply_border_cb): Update
	to only set 'inner' regions.

1999-11-08  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_write_style_border) : Handle NULL borders.

	* src/border.c (style_border_ref, style_border_unref) : NULL is
	  permissible.

	* src/format.c (format_get_thousand, format_get_decimal) : Init
	  locale if necessary.

	* src/formats.c (cell_format_is_number) : New function.

	* src/mstyle.c (mstyle_new_default) : Init borders to NULL to indicate
	  no borders.  This allows borders to be cleared.

	* src/dialogs/dialog-cell-format.c : Use locale.
	  Begin use of cell_format_classify.

1999-11-07  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (cb_set_row_height, sheet_selection_height_update) :
	  Put these back until we support shrinking in calc_dimensions.

	* src/dialogs/dialog-cell-format.c (cb_fmt_dialog_dialog_apply):
	  replace call to height_update.

	* src/workbook-format-toolbar.c (change_font_size_in_selection_cmd): 
	Replace call.

1999-11-07  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (selection_apply) : Bug 3382.  Be more careful
	  when regions are completely contained.

	* src/format.c (format_get_thousand, format_get_decimal) : New
	  functions.

1999-11-07  Michael Meeks  <mmeeks@gnu.org>

	* plugins/Makefile.am (SUBDIRS): add oleo.

	* configure.in: ditto.

1999-11-07  Michael Meeks  <mmeeks@gnu.org>

	* src/ranges.c (range_translate): implemented.

	* src/selection.c (sheet_selection_paste): Add sheet_selection_move.
	(sheet_selection_move): implement.

	* src/sheet.c (sheet_new): clear dirty flag (attaching the default
	  style was setting it).

1999-11-07  Michael Meeks  <mmeeks@gnu.org>

	* s/border_/style_border/

	* src/selection.c (sheet_selection_height_update): Kill; ill-concieved.
	(cb_set_row_height): ditto.

	* src/dialogs/dialog-cell-format.c (cb_fmt_dialog_dialog_apply): hack
	out height_update.

	* src/workbook-format-toolbar.c (change_font_size_in_selection_cmd): 
	remove call.

1999-11-07  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-cell-format.c (cb_fmt_dialog_dialog_apply) :
	  Get a fresh style after applying changes.

	* src/Makefile.am : Remove non-existant sheet-style.h.

1999-11-06  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_selection_set_border): Set the diagonals,
	clean the closure.

	* src/dialogs/dialog-cell-format.c (fmt_dialog_impl) : Dont close the
	  dialog until ok or cancel is pressed.

1999-11-06  Jody Goldberg <jgoldberg@home.com>

	* src/selection.c (sheet_selection_height_update) : Call the
	  autoresize code for non user sized rows.  Do not just hard code the
	  new height.

	* src/dialogs/dialog-cell-format.c (cb_font_changed) : Apply changes
	  to the font.
	(cb_fmt_dialog_dialog_apply) : Call sheet_selection_height_update if
	  the font changed.

1999-11-06  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-view.c (sheet_view_set_zoom_factor) : Smaill patch from
	  Federico Mena Quintero to improve item-bar resize while zoomed.

	* src/dialogs/dialog-cell-format.c (border_get_mstyle) : Support
	  color.

	* src/dialogs/cell-format.glade : Minor alignment improvments with
	  large fonts.

1999-11-05  Jody Goldberg <jgoldberg@home.com>

	* src/print-cell.c (print_cell_background) : Follow the correct
	  conventions on whether to draw a background.

	* src/sheet.c (sheet_clear_region) : Clear the style also.
	(sheet_fill_selection_with) : Run a recalc after autofill to ensure
	  that all formulas get rendered.

	* src/mstyle.c (mstyle_new_default) : Set the pattern to transparent.

	* src/workbook.c (workbook_menu_edit_clear) : Fix typo.

	* src/pattern.c (gnumeric_background_set_gc) : Move the pattern &
	  background GC setup logic from item_grid_paint_empty_cell here.

	* src/item-grid.c (item_grid_paint_empty_cell) :
	  Use gnumeric_background_set_gc.

	* src/cell-draw.c (cell_draw) : Ditto.

	* src/border.c (border_set_gc_dash) : Adjust cap format.

	* src/item-grid.c (item_grid_paint_empty_cell) : Split background and
	  pattern GC setup in a new function.

	* src/pattern.c (gnumeric_background_set_gc) : New function.

	* src/cell-draw.c (cell_draw) : Use gnumeric_background_set_gc.

1999-11-05  Michael Meeks  <mmeeks@gnu.org>

	* src/border.c (border_fetch): re-do orientation.

	* src/xml-io.c (xml_read_style_border): update orientation +
	IO the full set of borders. (xml_write_style_border): ditto.

	* src/dialogs/dialog-cell-format.c (border_get_mstyle): Create.
	(cb_fmt_dialog_dialog_apply): Add border bits.

	* src/sheet-style.c (do_apply_border, sheet_selection_apply_border_cb),
	(sheet_selection_set_border): Implement.

1999-11-05  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet.h: add sheet_selection_set_border.

	* src/style.c (style_new, style_new_mstyle, style_new_empty),
	(style_destroy, style_duplicate, style_merge_to): Hack.

	* src/mstyle.h: kill style_new_mstyle.

	* src/style.h: Kill redundant old code.

1999-11-04  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_paint_empty_cell) : As per instructions
	  from quartic we must call gnome_canvas_set_stipple_origin or things
	  get strange with stipples and the cursor.

	* src/expr.c (expr_tree_array_formula_corner) : If the corner is not
	  set attempt to set it.  Add more sanity checking to ensure that the
	  corner cell is really a corner cell.
	(eval_expr_real, do_expr_decode_tree) : Adjust to interface change in
	  expr_tree_array_formula_corner.

	* src/eval.c (add_tree_deps) : do not depend on the array corner being
	  set while calculating dependancies.  This eases the burden on insert
	  row/col which is forced to insert the lower/right cells BEFORE the
	  upper left and hence before the corner is set.

1999-11-04  Michael Meeks  <mmeeks@gnu.org>

	* src/corba-workbook.c (Workbook_save_to): Update so it compiles!
	(Workbook_sheet_current): Use standard 'wb' var. name.

	* src/sheet.c (sheet_move_range): add style slide.

	* src/sheet-style.c (sheet_unique_cb): Use range_fragment_list instead.
	(sheet_style_relocate): Implement.

	* src/ranges.c (range_fragment_list): Fix cretinous logic bug.
	(range_fragment): Split out (range_fragment_list): use it.
	(range_split_ranges): Update to use copy_fn + globalise.
	(range_fragment): fix leak.

1999-11-03  Miguel de Icaza  <miguel@gnu.org>

	* src/expr.c (eval_range): Removed parsed node from here too. 
	(eval_range): Removed computation logic from here.
	(eval_expr_real): ditto.

	* src/func.c (iterate_cellrange_callback): Ditto.

	* src/cell.c (cell_eval, cell_eval_content): Redone the evaluation
	logic to put all the actual details in a single spot.

1999-11-03  Miguel de Icaza  <miguel@gnu.org>

	* src/expr.c (eval_expr_real): Removed cell->parsed_node &&
	(cell->flags & CELL_QUEUED_FOR_RECALC)) from condition.
	
	* src/func.c (iterate_cellrange_callback): ditto.

1999-11-02  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c: change the binding.  Not clear to me yet if we
	need to fix gnome-libs.

1999-11-04  Jody Goldberg <jgoldberg@home.com>

	* src/workbook-format-toolbar.c (back_color_changed) : Set the pattern
	  to solid if we assign a colour to an area that did not have a
	  background before.

	* src/dialogs/dialog-cell-format.c (fmt_dialog_enable_widgets) :
	  Improve support for custom formats, and ensure that we
	  temporarily start off in 'Custom' until the rest of the format
	  recognition is ready.

1999-11-03  Jody Goldberg <jgoldberg@home.com>

	* src/dialog/dialog-cell-format.c : Rewrite.

	* src/item-grid.c (item_grid_paint_empty_cell) : First attempt to
	  draw patterns correctly.  We'll move much of this into a new routine
	  to be shared by non-empty cells if it works.

	* src/gnumeric-sheet.c (gnumeric_sheet_realize) : move the patterns
	  into their own file.

	* src/pattern.[ch] : New file.

	* src/mstyle.c (mstyle_new_default) : Do not set the pattern colour
	  by default.

1999-10-06  Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/file.c
	(workbook_import): Initial focus and selection in import dialog
	(workbook_save_as): Specify the app as the parent.

	* src/file.c
	(workbook_read): Moved error message code to new
	file_error_message procedure
	(file_error_message): The procedure
	(workbook_save, workbook_save_as): Notice failure to
	save. Clean marking of sheet moved from xml-io.c to here.

	* src/xml-io.c (xml_sheet_write, gnumeric_xml_read_sheet,
	gnumeric_xml_write_sheet): 
	Dirty/clean marking of sheet moved out.

	* src/corba-workbook.c (Workbook_save_to): 
	Mark saved sheet clean. FIXME: Failure to save still ignored.

1999-11-03  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet.c (sheet_insert_col, sheet_insert_row): fiddle styles.

	* src/sheet-style.c (sheet_style_region_link): implement.
	(sheet_style_stamp_compare): implement.
	(style_region_new): create. (sheet_style_attach): use it.
	(style_region_copy): implement.
	(style_region_destroy): create (sheet_style_region_unlink): use.
	(sheet_style_insert_colrow): implement.

	* src/ranges.c (range_contained): Make semantics more logical.

1999-11-03  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_style_delete_colrow): Fixup.

	* src/sheet.c (sheet_delete_row, sheet_delete_col): Add style stage.

1999-11-02  Michael Meeks  <mmeeks@gnu.org>

	* src/workbook.c (workbook_set_filename): update precondition macros.

	* src/sheet-style.c (sheet_style_region_unlink): Create.
	(sheet_style_optimize): use it. (sheet_style_delete_colrow): Implement.

	* src/ranges.c (range_contained): Implement.

1999-11-02  Federico Mena Quintero  <federico@redhat.com>

	* src/print-preview.c (PreviewMode): Renamed the move modes to
	MODE_MOVE and MOVE_MODE_DRAGGING.
	(preview_canvas_button_press): Split the event handling code
	between several functions.  Rationale:  we will want drag-zoom and
	we need different modes for this, and the code in a single
	function would get unwieldy.  In addition, grab the pointer and
	use GDK_POINTER_MOTION_HINT_MASK for better behavior.
	(PrintPreview): Added fields for drag anchor and drag offset.
	(drag_to): New function to drag/scroll.
	(create_preview_canvas): Connect to the different event handlers.
	(do_zoom): We do not need to re-render the page; just set the zoom
	factor.  Also, use exponential zooming for better behavior.

	* src/cursors.h: Moved the cursor #defines to an enum.  This way
	we can check for a max value in cursor_get().  Moved the cursor
	array to the .c file and made it private.

	* src/cursors.c (cursors_init): Added sanity check so that all
	cursors are defined.
	(cursor_get): New function to get a cursor based on its type.
	(cursors): Added hand cursors.

	* src/pixmaps/cursor_hand_{open,closed}.xpm: Added hand cursors.

1999-11-01  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_realize) : Set the default background
	  to white, so that the redraws are not quite so obvious.

	* ./src/sheet.c (cellref_name) : Change to take a ParsePosition
	  rather than just a row, col so that we can handle inter-book
	  references.

	* src/expr.c (do_expr_decode_tree) : Pass a ParsePosition.
	(cellref_relocate) : Fix typo.

	* src/corba-sheet.c (fill_corba_value) : Pass a ParsePosition.

	* src/parser.y : Dummy up a parser for intersheet references.  NOT
	  complete as yet.

	* src/sheet-view.[ch] : Add select_all data member to SheetView.

	* src/sheet.c (sheet_move_range) : Correct handling of intersheet
	  and interbook references.

	* src/workbook.c (workbook_new_with_sheets) : Assign a default unique
	  name so that all workbooks will have a name.
	(workbook_set_filename) : Change return to allow for eventual test for
	  uniqueness.

1999-11-01  Miguel de Icaza  <miguel@gnu.org>

	* src/item-bar.c (item_bar_draw): Optimize.
	(is_pointer_on_division): Bug fix for boundary condition. 
	(get_col_from_pos): ditto.

1999-10-30  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (preview_canvas_event): Reversed the delta
	computation, to make the scrolling follow what federico
	suggested. 

	* src/workbook-format-toolbar.c: Change the money format to
	include decimals.

1999-10-29  Miguel de Icaza  <miguel@gnu.org>

	* src/xml-io.c (xml_init): Rename.

1999-10-25  Miguel de Icaza  <miguel@gnu.org>

	* src/complex.h (GNUMERIC_COMPLEX_PROTO): Fix from Tom Mooney to
	get the compile settings done correctly.

1999-11-01  Michael Meeks  <mmeeks@gnu.org>

	* src/workbook-format-toolbar.c (modify_cell_format): fix
	style ref leak.

1999-11-01  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_merge): Radicaly alter semantics and
	function + document. (mstyle_empty): add.

	* src/sheet-style.c (sheet_style_optimize): Only remove lower
	stamp items if all there elements are safely masked.

1999-11-01  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (list_check_sorted): create + add checks.
	(sheet_style_optimize): Use stamps correctly.
	(sheet_styles_dump): dump stamp.

	* src/mstyle.c (mstyle_merge, mstyle_dump): Kill stamp.
	(mstyle_stamp_compare, dump_style_flist): kill.

	* src/sheet-style.c (sheet_style_attach): set stamp + inc.

	* src/sheet.h: Move StyleRegion to sheet-style.c + add stamp.

1999-10-31  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_style_compute, sheet_unique_cb): Kill
	check_sorted; the style stamp stuff needs serious work. The stamp
	should be on the StyleRegion _not_ the MStyle.

1999-10-31  Michael Meeks  <mmeeks@gnu.org>

	* NEWS (Daniel): credit.

	* acconfig.h: add undef ENABLE_GB

	* configure.in: Add preliminary 'gb' autoconf support. Add comments.

1999-10-31  Jody Goldberg <jgoldberg@home.com>

	* src/border.c (border_set_gc_dash, border_get_width) : New functions.

	* src/widgets/gnumeric-dashed-canvas-line.[ch] : New canvas item
	  that has advanced dash formats.

1999-10-30  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-object.c (sheet_object_drop_file): Fixup bad mapping
	case.

1999-10-30  Michael Meeks  <mmeeks@gnu.org>

	* src/eval.c (region_get_dependencies): Update.
	(search_range_deps): fix logic bug in range intersection.

	* src/mstyle.c (mstyle_merge): Make sta the default master style,
	fix several logic bugs in stamp order preservation + stamp from the
	master style.
	(mstyle_list_check_sorted): kill debug churning, just answer.
	(mstyle_stamp_compare): Implement.

	* src/sheet-style.c (sheet_style_optimize): Add warning + use
	new stamp merging fn. + simplify by NULLing slain StyleRegion list
	elements. (sheet_style_compute): quieten debug.

1999-10-30  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c (gnumeric_sheet_new) : Found the drawing
	  problem wherin it was not possible to jump to the bottom of a
	  64k row sheet.  The scroll region of 1M was too small.  Upped it
	  to 1,200,000.
	(gnumeric_sheet_compute_visible_ranges) : A fencepost-ish problem.
	  There is no need to increment the col/row count once we've found
	  the end.  Doing so risks falling prey to the boundary cases.

	* src/sheet-view.c (new_canvas_bar) : Ditto.

1999-10-29  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet.c (sheet_set_zoom_factor): don't bother re-rendering update.

	* src/sheet-style.c (sheet_cells_update): Add re-render argument.
	(re_dimension_cells_cb): update. (sheet_selection_apply_style_cb): if
	format changed re-render cell's text + add redraw.

1999-10-28  Jody Goldberg <jgoldberg@home.com>

	* src/widgets/widget-font-selector.c (reload_preview) :
	  Copy the style rather than creating a new one.  So that
	  we can change the colour elsewhere if desired.
	(font_selector_set) : Fix typos.
	(list_realize) : We can not moveto
	  a list element until after the widget is realized.  Add a handler
	  to take care of it.

	* src/dialogs/font-sel.glade : Make the scrollbars optional.
	  Fix the height of the preview area to avoid irritating flicker
	  as the dialog resizes.

1999-10-28  Michael Meeks  <mmeeks@gnu.org>

	* src/item-grid.c (item_grid_set_gc_stipple): Add.
	(item_grid_draw_cell, item_grid_paint_empty_cell): use it, but
	it blows up wierdly :-(

	* AUTHORS: Updated.

1999-10-27  Michael Meeks  <mmeeks@gnu.org>

	* src/ranges.c (range_contains): kill.

	* src/sheet.h (range_contains): Add (performance critical).

	* src/dialogs/dialog-cell-format.c (create_background_radio): Add pattern
	reading. (create_coloring_page): update pattern bits.
	(apply_coloring_format): Use the pattern index.

1999-10-26  Michael Meeks  <mmeeks@gnu.org>

	* src/dialogs/dialog-cell-format.c (create_background_radio): Make
	pattern selector global.
	
1999-10-27  Morten Welinder  <terra@diku.dk>

	* src/xml-io.c (xml_probe): Improve message when probing fails.

	* src/main.c (gnumeric_main): Don't let workbook_count go to zero
 	just because loading the first command-line specified sheet fails.
	(Bug 3119.)

1999-10-26  Morten Welinder  <terra@diku.dk>

	* src/format.c (format_compile): Plug leak.

	* src/workbook.c (workbook_new): Typo.

1999-10-26  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_style_changed) : Fix.

	* src/dialog/utils-dialog.[ch] : Add gnumeric_load_image.
	* src/dialog/dialog-printer-setup.c : Stolen from here.

1999-10-26  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_set_pattern): cripple for now.

	* src/xml-io.c (xml_sheet_write): Write the style regions in the
	correct order !. (xml_read_style): set italic for italic.

	* src/sheet-style.c (sheet_get_style_list): Return a copy.

	* src/xml-io.c (xml_read_cell_styles),
	(xml_dispose_read_cell_styles): replace.
	(xml_sheet_read): Add read_cell_styles*.

1999-10-26  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-stat.c: Fixed the const arguments of GROWTH and
 	TREND.

	* src/regression.[ch], src/functions/fn-stat.c: Started adding the
 	extra statistical output for LINEST and LOGEST.
	
	* src/functions/fn-database.c: Started the implementation of
 	GETPIVOTDATA.

1999-10-25  Jody Goldberg <jgoldberg@home.com>

	* src/main.c (gnumeric_main) : Remove current_workbook notion.

	* src/dialogs/dialog-simple-input.c (dialog_get_number) : Return
	  FALSE on cancel too.

	* src/workbook-cmd-format.[ch] : Add std row/column size scale factors.
	(workbook_cmd_format_row_height) : Use them.

	* src/item-bar.c (colrow_tip_setlabel) : Use the scale factors.

	* src/application.[ch] : New files to hold data common to all
	  workbooks.

	* src/item-grid.c (create_popup_menu) : Use gboolean and split
	  paste and paste special. Add pixmaps.
	(item_grid_popup_menu) : Use application_clipboard_is_empty.
	(item_grid_invert_gc) : Add extended_right flag to disable right
	  border for extended cells.

	* src/item-cursor.c (item_cursor_start_animation) : Decrease the
	  timeout.

	* src/main.c : Use application_init.
	* src/selection.c : Use application_clipboard_copy,
	  application_clipboard_cut.
	(find_a_clipboard, find_workbook_with_clipboard) : Delete.
	(sheet_selection_paste) : Use sheet_move_range for cut.

	* src/sheet.[ch] : Export sheet_move_range.
	(sheet_move_range) : Plug leak when a cell is moved out of bounds.

	* src/clipboard.c (x_selection_handler) : Use
	  application_clipboard_contents_get and respect the difference
	  between cut & copy.

	* src/workbook.[ch] :  Move clipboard stuff into application.h.
	(paste_cmd, paste_special_cmd) : Catch attempt to paste nothing.

	* src/Makefile.am : Add application.[ch].

1999-10-25  Michael Meeks  <mmeeks@gnu.org>

	* TODO: Prune scads of completed work out, + add some guff about
	sorting out cell spans; another fun fun project :-)

	* src/cell.c (cell_style_changed): implement.

	* src/sheet.c (sheet_new): use get_full_range clean.
	(sheet_set_zoom_factor): Add sheet_cells_update to re-calc bits.

	* src/sheet-style.c (sheet_cells_update, re_dimension_cells_cb): Create.
	(sheet_selection_apply_style_cb): Add sheet_cells_update.
	(sheet_get_full_range): implement for convenience.

	* doc/Styles.txt: Add "ref-counting for dummies" and "Getting a Style"
	sections.

1999-10-25  Morten Welinder  <terra@diku.dk>

	* src/complex.h: Fix typo.  thanks to Tim Mooney.

1999-10-25  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-database.c: Fixed the criteria argument
 	handling.  Each column defines conditions in boolean AND relation
 	and each row in criteria matches in boolean OR relation with the
 	given database.  Fixed the non-numeric return values of DGET.
  	Documentation improvements.
	
	* src/func.h (func_criteria_t): Added column field.

1999-10-24  Miguel de Icaza  <miguel@gnu.org>

	* src/cellspan.c (cell_register_span): Create the span if required.

	* src/sheet.c (sheet_destroy_contents): Remove debugging messages.
	(sheet_row_new): Row spans are now created on demand. 

	* src/xml-io.c (xml_get_print_hf): Plug memory leak.
	(xml_get_print_hf): More leak fixes.

	* src/mstyle.c (mstyle_verify): Fixed.

	* src/sheet.c (sheet_destroy_contents): Change the routine that
	destroys the cells. 
	(destroy_sheet_cell_cb): Proper cell destruction code.
	(cb_free_cell): Make this routine free the cell *CORRECTLY*.
	Please, do not break the code like this in the future.

	* src/workbook.c (sheet_action_delete_sheet): Do not destroy the
	sheet here.
	(workbook_detach_sheet): Destroy the sheet here, before queuing a
	recalc. 
	(workbook_do_destroy): Do not kill the sheet here.

1999-10-24  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (MStyleElement): Make font.size float + shrink enums.
	Add standard header.

1999-10-24  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_style_attach): kill redundant style_ref.

	* src/xml-io.c (xml_write_style): Use default_back instead of _fore for
	the background.

	* src/item-edit.c (item_edit_draw): generate a StyleFont when needed.
	(item_edit_init): init mstyle. (item_edit_destroy): unref mstyle.

	* src/item-edit.h: Use an MStyle instead of a Style.

1999-10-24  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_new_default): Re-enable the standard background
	color for now so things don't crash everywhere.

	* src/item-grid.c (item_grid_draw_cell): Fixes for unset colors.

	* src/Makefile.am (CLEANFILES): remove spurious binaries on clean.

	* src/dialogs/dialog-cell-format.c (create_coloring_page): Sort out
	case of no colors.

1999-10-24  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_unique_cb): Again, CVS merge bug fixed.

	* src/mstyle.c (mstyle_elements_equal): Fix stupid bug ( again ).
	(mstyle_elements_compare): fix big bug; stupid CVS.

	* src/sheet.c (sheet_update_controls): fix leak.

	* src/sheet-style.c (sheet_destroy_styles): fix leak.

	* src/cell.c (cell_get_style): Kill.

	* src/functions/fn-information.c (gnumeric_cell): Update format
	section.

	* src/sheet.c (cb_set_cell_value): Kill FORMAT_SET reference
	and use new style API.

	* src/cell.h: Kill CELL_FORMAT_SET flag.

1999-10-23  Michael Meeks  <mmeeks@gnu.org>

	* src/print-cell.c (print_cell_text): kill Style.
	(print_cell): ditto.
	(print_cell_grid): Add checks on return type of
	sheet_*_get_info.

	* src/mstyle.h: big constification.

	* src/mstyle.c (mstyle_verify): fix compile errors.

	* src/cell-draw.c (sheet_view_font): Kill.
	(cell_draw): edge out Style.
	(sheet_get_style_font): create.

	* src/cell.c (cell_get_mstyle): implement.

	* src/style.h: Change structs back to typedef defines + move
	"mstlye.h" include to foot + add MStyleBorder.

	* src/item-grid.c (item_grid_draw_border): Take an MStyle.
	(item_grid_paint_empty_cell): pass an mstyle + kill a Style.
	(item_grid_draw_cell): edge Style out.

1999-10-24  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-style.c (sheet_style_attach) : reference the style object.

	* src/mstyle.c (mstyle_elements_equal) : Correct the loop.

	* src/mstyle.c (mstyle_new_default) : Do not set colours by default.
	  There is an important difference between selecting a colour and
	  using the default colour.  The default does not override the
	  borders.

1999-10-23  Michael Meeks  <mmeeks@gnu.org>

	* doc/Styles.txt: update.

1999-10-23  Michael Meeks  <mmeeks@gnu.org>

	* src/corba-sheet.c (Sheet_cell_get_pattern, Sheet_cell_set_pattern): 
	implement.

	* src/sheet-style.c (sheet_unique_cb): Re-clip against selection
	after fragment and use all ranges.

	* src/dialogs/dialog-cell-format.c (format_number_select_row): Add
	check to kill debug; odd.

1999-10-22  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_elements_compare): fix.

	* src/ranges.c (range_fragment): Silly logic error + only 1 range
	case.

	* src/dialogs/dialog-cell-format.c (create_coloring_page): fixup.

	* src/sheet-style.c (sheet_selection_get_unique_style): add debug.

1999-10-22  Miguel de Icaza  <miguel@gnu.org>

	* src/Makefile.am (Gnumeric-impl.o): Do not use BUILT_SOURCES as
	suggested by Tom.
	($(GNUMERIC_CORBA_GENERATED)): Removed ugly hack 

	* src/selection.c (cb_set_row_height): Include the fix from the
	pre-style change

	* src/workbook.c (workbook_can_close): Do not let the can-close
	dialog box to be run twice (one from the C-w dialog, another from
	the Window Manager request).

	* src/widgets/widget-font-selector.c (fs_destroy): display_font is
	not a GtkObject, but a pointer to a GnomeDisplayFont which is just
	a structure "owned" by GnomePrint.

	* src/dialogs/dialog-cell-format.c (cb_set_row_height): Only
	autofit when growing, not shrinking.

	* src/cell-draw.c (cell_draw): Remove margin from here.

	* src/widgets/widget-font-selector.c (size_selected): Set the size
	here.
	(font_selector_set): Set the size here too.

	* src/dialogs/dialog-cell-format.c (apply_font_format): Use the
	font dimension from the font selector, not from the GnomeFont.

1999-10-21  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet.c (sheet_accept_pending_input): Focus current sheet
	also to kill any F2 editing.

	* configure.in (bonobo): Require Bonobo 0.5

	* src/gnumeric-sheet.c (gnumeric_sheet_selection_cursor_base): New
	routine to control the "base" spinning location.

	* src/item-grid.c (item_grid_button_1): Start cell selection if
	user clicks and a selection is going on.  Reset the spin base here.

	* src/sheet.c (sheet_cancel_pending_input): Queue a recalc here,
	as we have modified the cell values.

1999-10-20  Martin Norbäck  <norpan@bigfoot.com>

	* gnumeric.desktop.in: Added Swedish translation

1999-10-22  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_destroy): update.

1999-10-21  Michael Meeks  <mmeeks@gnu.org>

	* src/border.c (border_draw): Constify.

	* src/sheet-autofill.c (autofill_cell): Fix.

	* src/corba-sheet.c (Sheet_cell_get_alignment, Sheet_cell_set_alignment),
	(Sheet_cell_set_background, Sheet_cell_set_foreground): implement.

	* src/sheet-style.c (sheet_style_attach_single): implement.

	* src/workbook-format-toolbar.c (workbook_feedback_set): Add
	cache back in to save scanning huge font lists.

	* src/sheet-style.c (sheet_unique_cb): fix leak.

1999-10-20  Michael Meeks  <mmeeks@gnu.org>

	* src/render-ascii.c (cell_region_render_ascii): Update; perhaps
	cell_get_text will need to be passed an MStyle...

	* src/clipboard.c (paste_cell_flags, clipboard_prepend_cell),
	(clipboard_release): handle styles to some extent.
	(sheet_paste_selection): Add an optimize pass.

	* src/cell.h (CellCopy): Add style.

	* src/sheet.c (sheet_new): setup color correctly.
	(range_is_homogeneous): Kill ( done in sheet-style.c nowadays ).

	* src/workbook-format-toolbar.c (modify_cell_format): Use an MStyle.
	(change_selection_font): set italic as well as bold.
	(change_font_size_in_selection_cmd): Update sheet after style set.

	* src/sheet.h (range_equal): Add macro.

	* src/ranges.c (range_equal): kill; too slow.

	* src/mstyle.c (mstyle_elements_equal): simplify lots.

	* src/cell.c (cell_get_span): Optimise by hoisting simple checks over
	slow style ones. (cell_is_number): make inline

	* src/workbook-format-toolbar.c (workbook_feedback_set): remove redundant
	checks on each style element to see if set + add preconditions.

	* src/mstyle.c (mstyle_get_font): implement.

	* src/cell.c (cell_get_span): pass init. align in to save redundant
	style_compute. (cell_get_horizontal_align): optimise.
	(calc_text_dimensions): take an MStyle. (cell_calc_dimensions): use mstyle.

	* src/print-cell.c (print_cell_text): new horizontal_align bits.

	* src/cell-draw.c (cell_draw): ditto.

	* src/sheet-style.c (sheet_style_compute): Update cache API.
	(sheet_style_cache_lookup, sheet_style_cache_add): ditto.

	* src/mstyle.c (mstyle_get_color): unconstify.

	* Update floating mstyle vars. to 'mstyle'

1999-10-20  Michael Meeks  <mmeeks@gnu.org>

	* src/corba-sheet.c (Sheet_cell_get_format): remove check.

	* src/cell.c (cell_get_horizontal_align): add check.
	(cell_get_span): remove checks on alignment set.

	* src/functions/fn-information.c (gnumeric_cell): kill leak;

	* src/workbook-format-toolbar.c (modify_cell_format): kill leak.

	* src/print-cell.c (print_cell_text): fix leaks.
	(print_cell): ditto.

	* src/cell.c (cell_get_formatted_val): return error case.

	* src/sheet.c (sheet_new): Attach default format.

	* src/style.c (style_mstyle_new): update.

	* src/print-cell.c (print_empty_cell): update.

	* src/xml-io.c (xml_write_style, xml_write_style_region): update.
	(xml_write_style_border, xml_read_style, xml_read_style_border): fix.

1999-10-19  Michael Meeks  <mmeeks@gnu.org>

	* src/item-grid.c (item_grid_paint_empty_cell): update.

	* src/item-edit.c (item_edit_update): fix.

	* src/cell.c (cell_get_formatted_val, cell_set_format_simple),
	(cell_get_horizontal_align, cell_get_style, cell_get_span): fixups.

	* src/workbook-format-toolbar.c (set_selection_halign, change_selection_font),
	(change_font_in_selection_cmd, change_font_size_in_selection_cmd),
	(fore_color_changed, back_color_changed, workbook_feedback_set): fixups.

	* src/corba-sheet.c (Sheet_cell_get_format, Sheet_range_set_format): update.

	* src/sheet.c (sheet_update_controls): update.

	* src/dialogs/dialog-cell-format.c (create_number_format_page), 
	(apply_number_formats, create_align_page, apply_align_format),
	(create_font_page, apply_font_format, set_color_picker_from_style),
	(create_coloring_page, apply_coloring_format, cell_properties_apply):
	hack to new 'helper' functions.

	* src/sheet-style.c (sheet_style_cache_lookup), 
	(sheet_style_cache_add, sheet_style_compute): Update.
	(sheet_selection_get_uniq_style, sheet_uniq_cb): Break badly.

	* src/mstyle.c: Totaly re-hash API for Miguel, biggish re-write.
	(mstyle_is_element_set, mstyle_unset_element, mstyle_set_color),
	(mstyle_get_color, mstyle_set_border, mstyle_set_pattern),
	(mstyle_get_pattern, mstyle_set_font_name, mstyle_get_font_name),
	(mstyle_set_font_bold, mstyle_get_font_bold, mstyle_set_font_italic),
	(mstyle_get_font_italic, mstyle_set_font_size, mstyle_get_font_size),
	(mstyle_set_format, mstyle_get_format, mstyle_set_align_h),
	(mstyle_get_align_h, mstyle_set_align_v, mstyle_get_align_v),
	(mstyle_set_orientation, mstyle_get_orientation),
	(mstyle_set_fit_in_cell, mstyle_get_fit_in_cell): Implemented ( boring ).
	(mstyle_compare): implement

1999-10-19  Michael Meeks  <mmeeks@gnu.org>

	* src/cell.c (cell_get_horizontal_align): fiddle. (cell_get_span): Fixup.

	* src/xml-io.c (xml_sheet_write): Actually attach the saved
	style tree. (xml_write_style): Fix silly bug in color writing.

1999-10-19  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_destroy): Fix leak.

	* src/item-grid.c (item_grid_draw_cell): ditto.

1999-10-16  Michael Meeks  <mmeeks@gnu.org>

	* src/dialogs/dialog-cell-format.c (apply_coloring_format): Fixup.

	* src/selection.c (sheet_selection_height_update): create.

	* src/dialogs/dialog-cell-format.c (cell_properties_apply):
	update. (apply_number_formats, apply_align_format),
	(apply_font_format): Don't set the selection's properties yet,
	setup the selections height.

	* src/sheet-style.c (sheet_selection_get_uniq_style):
	update docs.

1999-10-16  Michael Meeks  <mmeeks@gnu.org>

	* src/style.c (style_mstyle_new): Add format ( oops ).

	* src/cell.c (cell_get_formatted_val): Create.
	(cell_get_text, cell_render_value): use it.
	(cell_get_horizontal_align): Update.

	* src/ranges.c (range_merge): comment out sluggish pre-condition.

	* src/workbook-format-toolbar.c (do_sheet_selection_apply_style): Fixup.

	* src/ranges.c (range_split_ranges): Kill 1/2 the range_contains calls,
	fix bug + optimize. (range_overlap): kill comment + inline.

	* src/workbook.c (deps_output): renamed to (misc_output) + update.
	(workbook_setup_edit_area): show if style_debugging.

	* src/main.c: Add 'style_debugging' integer.

	* src/cell.c (cell_set_font_from_style, cell_set_halign, cell_set_border),
	(cell_set_alignment, cell_set_foreground, cell_set_background),
	(cell_set_color_from_style, cell_set_pattern, cell_set_format_from_style):
	kill the stubs for the old style API.
	(cell_set_format_simple): fix silly bug.

1999-10-15  Michael Meeks  <mmeeks@gnu.org>

	* src/ranges.c (range_equal): compare rows then cols + inline.

	* src/sheet-style.c (sheet_styles_dump): implement.

	* src/workbook.c (deps_output): dump styles.

	* src/mstyle.c (mstyle_elements_init): create.
	(mstyle_elements_equal): Add quick type sum check.

	* src/sheet-style.c (sheet_selection_get_uniq_style): use it.

1999-10-14  Michael Meeks  <mmeeks@gnu.org>

	* src/workbook-format-toolbar.c (workbook_feedback_set): kill old
	conflict resoltion.

	* src/sheet-style.c (sheet_style_cache_add): fixup cache flush on huge
	caches.

	* src/print-cell.c (print_empty_cell): 

	* src/mstyle.c (render_merge): kill. (mstyle_list_check_sorted): rename.

	* src/sheet-style.c (sheet_style_compute, sheet_uniq_cb): Add checks for
	sortedness  kill redundant return.

	* src/item-grid.c (item_grid_paint_empty_cell): 

	* src/cell.c (cell_get_style): zoom.

	* src/item-edit.c (item_edit_update): ditto.

	* src/style.c (style_mstyle_new): Update to take a zoom argument.

	* src/sheet.c (zoom_cell_style): kill: redundant (sheet_set_zoom_factor):
	use new render side zoom, allows different zoom per view.

	* src/mstyle.c (mstyle_do_merge): optimise by dropping out if we
	have all attributes set + kill redundant copy.
	(render_merge_blank): Kill.

	* src/ranges.c (range_contains): re-order for speed & inline.

	* src/sheet.c (sheet_update_controls): update.

1999-10-13  Michael Meeks  <mmeeks@gnu.org>

	* src/cell.c (cell_get_style): pass elements around.

	* src/item-edit.c (item_edit_update): ditto.

	* src/corba-sheet.c (Sheet_cell_get_format): ditto..

	* src/item-grid.c (item_grid_paint_empty_cell): ditto.

	* src/print-cell.c (print_empty_cell): ditto.

	* src/sheet-style.c (sheet_style_compute_blank): axe.
	(sheet_style_compute): update to new API.

	* src/xml-io.c (xml_sheet_write): use sheet_get_style_list.

	* src/sheet-style.c (sheet_style_compute): Unroll render_merge in here
	to allow caching.

	* src/sheet.c (sheet_set_zoom_factor): calm font scaling down.

	* src/sheet-style.c: Re-write each style list lookup adding dereference.
	(sheet_create_styles): create, (sheet_destroy_styles): update.
	(sheet_style_cache_lookup, sheet_style_cache_add),
	(sheet_style_cache_flush): stub for now + add various flushes.
	(scache_remove): create.

	* src/sheet.h: Hide style_data in sheet-style.c + add cell lookup
	hash on advice of profiler.

	* src/sheet.c (sheet_new): use sheet_create_styles.

	* src/ranges.c (range_fragment): fix: was very broken.

	* src/dialogs/dialog-cell-format.c (apply_font_format): use String.

	* src/xml-io.c (xml_write_style, xml_read_style): use String

	* src/workbook-format-toolbar.c (change_font_in_selection_cmd),
	(workbook_feedback_set): ditto.

	* src/style.c (style_mstyle_new): ditto.

	* doc/Styles.txt: Update bit about strings.

	* src/mstyle.c (mstyle_element_equal, mstyle_element_dump),
	(mstyle_element_copy, mstyle_element_destroy): Use String not
	char * for font name.

	* src/mstyle.h: Change font.name to a ref counted String.

	* src/style.h (style_unref): Add.

	* src/cell.c (cell_render_value, cell_get_horizontal_align),
	(cell_get_text, cell_calc_dimensions): use style_unref.

	* src/item-edit.c (item_edit_update): use style_unref not destroy.

	* src/item-grid.c (item_grid_paint_empty_cell): ditto.

	* src/print-cell.c (print_empty_cell): ditto.

	* src/cell-draw.c (sheet_view_font, cell_draw): ditto.

	* src/corba-sheet.c (Sheet_cell_get_format): unref style.

	* src/mstyle.c (mstyle_do_merge): Remove redundant uniq thing.
	(render_merge, render_merge_blank): ditto.
	(mstyle_destroy): nail huge leak, destroy style elements.
	(mstyle_elements_compare, mstyle_elements_destroy): implement.

	* src/ranges.c (range_fragment): Don't operate on the original list.

	* src/sheet-style.c (sheet_uniq_cb): Implement fully.

1999-10-12  Michael Meeks  <mmeeks@gnu.org>

	* src/ranges.c (range_fragment): Only remove region if it is valid.

	* src/sheet.c (sheet_new): NULL style_list.

	* src/mstyle.c (mstyle_destroy): Add safe catch for NULL pointers.

	* src/sheet-style.c (sheet_destroy_styles): moved & made global,
	unref mstyles not destroy + precondition on ref_count.

	* src/sheet.c (sheet_destroy_styles): Moved.

1999-10-11  Michael Meeks  <mmeeks@gnu.org>

	* src/style.c (style_mstyle_new): Re-initialize background color
	so it doesn't crash !!!

	* src/item-grid.c (item_grid_draw_cell): add check on back_color.

	* src/sheet-style.c (sheet_uniq_cb): update.

	* src/ranges.c (range_fragment_free): implement.
	(range_clip, range_fragment): Implement - grief.

	* src/cell.c (cell_get_span): print the unknown type.
	(cell_get_horizontal_align): fixup.

	* src/sheet-style.c (sheet_selection_get_uniq_style): quiten.
	(sheet_uniq_cb): Add, (sheet_selection_get_uniq_style): check all
	selection ranges; fix leak.

1999-10-11  Michael Meeks  <mmeeks@gnu.org>

	* src/Gnumeric.idl: Add a variable name for datanotify so it compiles!
	kill redundant (void) on count.

1999-10-11  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_equal): add quick initial pointer equality test.
	(mstyle_element_equal): add precondition + debug.
	(mstyle_elements_equal): add debug.

	* src/sheet-style.c (sheet_style_optimize): Actualy remove culled
	regions from the sheet style list as well as the temporary one.

1999-10-10  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_style_optimize): fix big leak.
	(sheet_style_optimize): fix _stupid_ bug killing the optimizer.
	re-hash order things are done in + add failed merge case.
	(sheet_selection_apply_style_cb): add optimize.
	(sheet_style_optimize): fix mamouth drop-through bug.

	* src/mstyle.c (mstyle_elements_equal): update.

	* src/sheet-style.c (sheet_style_attach): make debug look nice.

1999-10-10  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_element_dump): dump the default name instead.
	(check_sorted): quieten.

	* src/sheet-style.c (sheet_style_attach): remove n*n equality
	check + move into sheet_style_optimize.
	(sheet_style_optimize): Add equal range merging.
	(sheet_style_compute_blank): kill debug.
	Add new debugging macro throught.

	* src/ranges.c (range_adjacent): add pre-conditions.
	(range_merge): implement.

	* src/mstyle.c (mstyle_element_equal): Implement.
	(mstyle_elements_equal, mstyle_equal): ditto.
	(mstyle_new_elems, dump_style_list): add casts.

1999-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/style.c (style_mstyle_new) : Init background color to NULL for
	  now.

	* src/dialogs/dialog-cell-format.c (set_color_picker_from_style) :
	  Don't warn about unset colours.

	* src/item-grid.c (item_grid_draw_cell) : Draw borders.

	* src/border.[ch] : Since stipples won't work, we don't need
	  is_vertical.
	(border_draw) : new function.

	* src/mstyle.c (mstyle_element_dump) : Add borders.

	* src/sheet-style.c : Kill some warnings and make it compile.

	* src/style.c (style_new) : Support borders.
	(style_mstyle_new) : Ditto.

1999-10-09  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_style_optimize): hack.

	* src/ranges.c (range_adjacent): implement.

	* src/sheet.c (sheet_cell_add): Kill complexity: sorted.

	* src/cell.c (cell_get_span): Fixup.

	* src/xml-io.c (xml_write_style_region): use mstyle_get_elements.
	(xml_write_style_border, xml_write_style): constify.

	* src/mstyle.c (mstyle_new): update + init array.
	(mstyle_new_array, mstyle_add_array): kill.
	(mstyle_merge): implement. (mstyle_add): add preconditions + implement.
	(mstyle_set): update. (mstyle_to_string): update.
	(mstyle_new_elems, mstyle_get_elements): implement.

	* src/sheet.h (MStyle): kill GArray + move all into mstyle:PrivateStyle.

1999-10-09  Jody Goldberg <jgoldberg@home.com>

	* src/border.[ch] : Add a reasonable approximation of the XL border styles.

	* src/mstyle.[ch] : Add more border line styles.
	  Add placeholders for diagonal and reverse diagonal borders.
	  Add placeholder for 'pattern' colour vs background colour.
	  Moved COLOR_FORE into the section not visibile in a blank cell.

	* src/xml-io.c : Switch to new border scheme.

1999-10-09  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (mstyle_element_copy): implement.
	(mstyle_element_destroy): ditto.

	* src/sheet-style.c (sheet_style_attach): Complicate :-)

	* src/mstyle.h (MSTYLE_ANY_COLOR, MSTYLE_ANY_BORDER): add to help.

1999-10-08  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_selection_apply_style_cb): add.
	(sheet_selection_apply_style): fix.

	* src/selection.c (selection_foreach_range): Implement.

1999-10-08  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet.c (sheet_delete_col): hack up.

	* src/item-grid.c (item_grid_paint_empty_cell): cull stuff.

	* src/corba-sheet.c (Sheet_cell_get_format, Sheet_cell_get_font): fix.

	* configure.in: Fixup bonobo check.

1999-10-07  Michael Meeks  <mmeeks@gnu.org>

	* src/mstyle.c (check_sorted): update check & add comment.

	* src/ranges.c (range_overlap): implement.
	(range_fragment): stubbed.

	* src/sheet-style.c (sheet_selection_get_uniq_style): Use range_overlap.

	* src/style.h (DEFAULT_SIZE, DEFAULT_SIZE): move here from style.c

	* src/workbook-format-toolbar.c (workbook_feedback_set): Set
	non bold / italic as the default + kill warning + add default size.

	* src/xml-io.c (xml_read_style_border, xml_write_style_border):
	in-line border structure.

	* src/style.c (style_hash, style_compare): kill
	(style_new, style_mstyle_new, style_destroy, style_duplicate): 
	remove old border (style_merge_to): cull.
	(border_hash, style_init, style_shutdown): kill border bits.
	(border_equal): ditto.

	* src/sheet-autofill.c (autofill_cell): comment out style bits.

	* src/item-grid.c (item_grid_draw_cell): Kill debug border rendering.

	* src/print-cell.c (print_border, print_cell_border): #ifdef out.
	(print_cell): comment out border call.

	* src/mstyle.h: Make borders in-line structures.

	* src/style.c (style_border_new_plain, style_border_new),
	(style_border_ref, style_border_unref): kill.

	* src/style.h: Kill StyleBorderOrient + StyleBorder in favor
	of MStyleBorder.

	* src/corba-sheet.c (cb_range_set_format): kill.
	(Sheet_range_set_format): fixup.

	* src/mstyle.c (mstyle_unref, mstyle_ref): Implemented.

	* src/sheet.h: Add ref-count to MStyle.

	* src/ranges.c (range_list_foreach_full): typo.
	(range_style_apply_cb, range_set_style): Add.

	* src/corba-sheet.c (Sheet_cell_set_font): cut.
	(Sheet_cell_set_comment): re-enable.
	(Sheet_cell_get_font): implement.
	(Sheet_cell_get_font, Sheet_cell_set_background),
	(Sheet_cell_get_background, Sheet_cell_get_pattern),
	(Sheet_cell_set_pattern, Sheet_cell_set_alignment),
	(Sheet_cell_get_alignment): deprecated.
	(Sheet_range_set_format): Implemented.

	* src/cell.h: Comment out the old cell_set_* API except for
	cell_set_format*.

	* src/cell.c (cell_get_horizontal_align): Fixup.
	(cell_set_formula): hack format setting.
	(cell_set_format_simple): fixup.

1999-10-07  Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

        * dialog-cell-format.c 
        (create_number_format_page, create_font_page): 
        Make <Enter> in entry fields invoke default button

        * dialog-cell-format.c 
        (format_find): Select line in categorylist.     
        (format_number_select_row): Initial list selection happens before
        property box is created, so check before notifying it.

        * dialog-cell-format.c 
        (dialog_cell_format): Initial focus.
        (dialog_cell_format, struct cell_format_pages): 
        New signature for create_page.
        (create_number_format_page, create_align_page, create_font_page,
        create_coloring_page): New out parameter focus_widget: The widget
        to receive initial focus if page is current when notebook pops up.

1999-10-07  Jon K Hellan <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/dialog-analysis-tools.c (hbox_pack_label_and_entry):
	moved.

	* src/dialogs/dialog-solver.c (add_strings_to_glist): moved.
	
	* src/dialogs/utils-dialog.[ch]: Added.

	* src/dialogs/Makefile.am: ditto.

1999-10-07  Michael Meeks  <mmeeks@gnu.org>

	* src/xml-io.c (xml_write_styles): create; untested.
	(font_component): kill.

1999-10-06  Michael Meeks  <mmeeks@gnu.org>

	* src/xml-io.c (parse_xml_context_t): Remove hash table of styles +
	style count: redundant now. (xml_write_style): majorly hacked.
	(xml_write_style_border): ditto. (xml_read_style_region): ditto.
	(xml_read_style): huge mangle. (xml_read_style_border): ditto.
	(xml_write_cell): kill style write per cell, (xml_read_cell): ditto, lots.
	(xml_cell_styles_init): remove; sluggish style hash (add_style): ditto.
	(xml_sheet_write): kill  (xml_cell_styles_shutdown): die.
	(xml_sheet_write): kill call.
	(xml_read_cell_styles): kill (xml_sheet_read): + call.
	(xml_dispose_read_cell_styles): kill (xml_sheet_read): + call.
	(destroy_style): die. (style_font_new_from_x11): remove: unused.
	(xml_sheet_write): add xml_write_styles call.

	* src/mstyle.c: Add array of style names.

1999-10-05  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet.c (sheet_update_controls): Use new workbook_feedback_set.

	* src/workbook-format-toolbar.c (workbook_feedback_set): Pass the style
	element array instead + hack to use this.

1999-10-04  Michael Meeks  <mmeeks@gnu.org>

	* src/sheet-style.c (sheet_selection_apply_style): renamed.

	* src/dialogs/dialog-cell-format.c (set_color_picker_from_style): created.
	(create_coloring_page): simplify & update.
	(apply_coloring_format): 

1999-10-04  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/dialogs/dialog-cell-format.c (dialog_cell_format): Update style
	stuff. (cells_get_format): remove (create_number_format_page): update.
	(create_align_page): update. (apply_align_format): update.
	(apply_number_formats): ditto. (apply_font_format): re-implemented &
	commented out large chunks of stuff.
	(create_font_page): update: needs work. (create_coloring_page): update.

1999-09-29  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/mstyle.c (mstyle_do_merge): Updated API & stuff.
	(render_merge, render_merge_blank): change slightly.

	* src/workbook-format-toolbar.c: use sheet_apply_style_to_selection.

	* src/sheet-style.c: Create,
	(sheet_style_attach_old): Remove.
	(sheet_apply_style_to_selection): Add.

	* src/ranges.c (range_set_style): Remove.

	* src/corba-sheet.c (Sheet_range_set_format): comment out.

	* src/workbook.c (workbook_init): initialise clipboard.

1999-09-28  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/workbook-format-toolbar.c (set_selection_halign): fixup.

	* src/style.h: New expandable border setup.

	* src/mstyle.h: Expand to full set of types.

1999-09-28  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/workbook-format-toolbar.c (change_selection_font): re-implement.

	* src/mstyle.c (dump_style_list): Add. (check_sorted): use it.

	* src/xml-io.c (xml_write_names): remove unused 'm'
	(xml_write_cell, xml_read_style_region): hacked.
	(xml_read_cell, add_style): ditto.

	* src/ranges.c (range_set_style): use attach_old.

	* src/sheet.c (sheet_style_attach): Use a Range.
	(sheet_style_attach_old): Deprecated copy.

	* src/workbook-format-toolbar.c (change_selection_font, set_new_font),
	(set_font_size, modify_cell_format, set_cell_fore_color),
	(set_cell_back_color): use cell_get_style.
	(apply_style_to_selection): update to MStyle.
	(apply_style_to_range): Update.
	Seriously hack style apply code.

	* src/sheet-autofill.c (autofill_cell): cell_get_style.

	* src/print-cell.c (print_cell): cell_get_style.

	* src/corba-sheet.c: style API dummied out.

	* src/functions/fn-information.c (gnumeric_cell): cell_get_style.

	* src/sheet.c (zoom_cell_style): kill for now. (sheet_cell_add): 
	hack more.

	* src/cell.h: kill public style element.

	* src/cell.c (cell_destroy): ditto.

	* src/dialogs/dialog-cell-format.c (cells_get_format),
	(create_align_page, create_coloring_page): use cell_get_style.

	* src/item-grid.c (item_grid_paint_empty_cell): Kill default style
	check.

	* src/sheet.c (sheet_cell_add): comment out style bits.
	(sheet_destroy_styles): mstyle_destroy.
	(sheet_set_zoom_factor): add warning.

	* src/print-cell.c (print_empty_cell): fix style_compute.
	(print_cell_text): use cell_get_style.

	* src/workbook.h: Remove old inline 'style' in Workbook.

	* src/xml-io.c (xml_workbook_write, xml_workbook_read): ditto.

	* src/sheet.h: move range dependant Style bits here + include glib.h
	
	* src/style.h: Split typedefs from enum's & structs 

1999-09-27  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/style.c (mstyle_style_new): add. (style_new): deprecate.

	* src/mstyle.[ch]: Created.

	* src/item-edit.c (item_edit_update): fix style_compute.

	* src/item-grid.c (item_grid_paint_empty_cell): ditto.

	* src/clipboard.c (paste_cell_flags): Hack.

	* src/cell-draw.c (sheet_view_font, cell_draw): use cell_get_style

	* src/sheet.c (sheet_style_compute): remove non_default_style_flags
	argument.

	* src/cell.c (cell_render_value, cell_get_text): Use cell_get_style
	(cell_set_formula, cell_calc_dimensions): ditto.
	(cell_get_style): implement.

1999-10-07  Miguel de Icaza  <miguel@gnu.org>

	* src/gnumeric-sheet.c (gnumeric_sheet_compute_visible_ranges):
	Fix typo here.

1999-10-07  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_find_row,
	item_grid_find_col) : Return a value in the overflow case.

	From : Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/dialog-zoom.glade: Place sheet list inside frame. 
	  Use frame label, not list column label.
	  Add padding.
	  Use 0 height drawing area to set minimum width of spin button.

1999-10-06  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook-format-toolbar.c (change_selection_font): Remove
	ants when we change the font.
	(set_selection_halign): And when we change the alignment.

	Many more left to be removed.  Left as an excercise to Jody :-)

	* src/sheet.c (sheet_start_editing_at_cursor): remove ants when we
	start entering new text.

	* src/sheet-view.c (sheet_view_selection_unant): Destroys the
	anted cursors from the sheet view.
	(sheet_view_selection_ant): Adds cursors to the sheetview.
	(sheet_view_construct): New group that is used to hold the
	selection-ant items.

	* src/gnumeric-sheet.c (gnumeric_sheet_key_mode_sheet): Kill ants
	on escape.
	(gnumeric_sheet_key_mode_object): ditto.

	* src/selection.c (sheet_selection_unant): New function, kills the
	selection ants.
	(sheet_selection_ant): New function, adds an anted selection to
	all the selected regions.

	* src/clipboard.c (do_clipboard_paste_cell_region): Do not paste
	beyond sheet boundaries.

	* src/item-grid.c (item_grid_find_row): Do not go beyond sheet boundaries.
	(item_grid_find_col): ditto.

	* configure.in: Generate gnumeric.desktop

	* gnumeric.desktop.in: New file, used to choose the correct
	gnumeric/gnumeric-bonobo executable name.

	* src/sheet-object-item.c: Updated to fit with the new Bonobo
	changes. 

1999-10-06  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-zoom.c (dialog_zoom_impl) : Have the custom zoom
	  spinbox call 'Ok' when enter is pressed.

	* src/sheet.c (sheet_destroy_contents) : Fix typo causing memory
	  corruption.

	* src/sheet.h : Decrease SHEET_MAX_ROWS to 16k until we can tune
	  memory usage.

	From : Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/dialog-printer.c (gnumeric_printer_dialog_run): 
	  Workbook: New parameter
	  Set initial focus.
	  Make <Enter> in entry fields invoke default button.
	  Specify the app as the parent.

	* src/dialogs/dialog-printer.h (gnumeric_printer_dialog_run): 
	  Change signature

	* src/print.c (sheet_print): 
	  gnumeric_printer_dialog_run has new signature

	* src/dialogs/dialog-sovler.c (add_strings_to_glist): Remove
	(add_radio_buttons): Remove unnecessary "_()"
	(dialog_solver_options, dialog_solver): Add missing "_()"

	* src/dialogs/utils-dialog.c: New file
	(ut_dia_entry_new_with_max_length, ut_dia_entry_new): 
	  Create entry fields where <Enter> activates the default button
	(hbox_pack_label_and_entry): Move from dialog-analysis-tools.c
	(add_strings_to_glist): Move from dialog-solver.c

	* src/dialogs/utils-dialog.h: New file
	(hbox_pack_label_and_entry, add_strings_to_glist): Move from tools.h

	* src/dialogs/dialog-cell-comment.c (dialog_cell_comment): 
	  Make OK button the default.

	* src/dialogs/dialog-cell-sort.c (order_box_new):  
	  Make <Enter> in entry field invoke default button.

	* src/dialogs/dialog-define-names.c (dialog_define_names): 
	  Make <Enter> in entry field invoke default button.
	  Specify the app as the parent.

	* src/dialogs/names.glade: ok button needs "can_default".

	* src/dialogs/dialog-summary.c (dialog_summary_update): 
	  Make <Enter> in entry fields invoke default button.

	* src/dialogs/summary.glade: Make OK button the default.
	  Change widget names used by program to avoid inadvertent
	  translation. 

	* src/dialogs/dialog-analysis-tools.c 
	(new_dialog): Make OK button the default
	(dialog_data_analysis): Initial focus and selection, Make OK button
	  the default.
	(add_check_buttons, add_output_frame, dialog_sampling_tool): Make
	  <Enter> in entry field invoke default button
	(hbox_pack_label_and_entry): Move to utils-dialog.c
	(dialog_random_tool): Replace pack_label_and_entry with
	  hbox_pack_label_and_entry  
	(pack_label_and_entry): Remove

	* src/dialogs/dialog-goal-seek.c (dialog_found_solution, 
	dialog_goal_seek): Make OK button the default
	(dialog_goal_seek): Make <Enter> in entry field invoke default button.

	* src/dialogs/dialog-paste-special.c (dialog_paste_special): 
	  Initial focus

1999-10-05  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_destroy_contents) : Mark freed segments with
	  NULL.

	* src/selection.c (selection_contains_colrow) : New function.
	* src/item-bar.c (item_bar_event) : Use it.

	From : Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/{insert,delete}-cells.glade : New files.
	* src/dialogs/dialog-{insert,delete}-cells.c : Switch from using
	  Cauldron to using libglade.

	* src/plugin-manager.c (plugin_manager_new): 
	  Go away on <Esc>, set initial focus.

	* src/dialogs/sheet-rename.glade: Made OK button default.

	* dialog-simple-input.c (dialog_get_number): gnome_dialog_run instead
	  of run_and_close - otherwise entry widget is destroyed before it is
	  read.  Make <Enter> in entry field activate default button.
	(dialog_get_sheet_name) : Ditto.

	* src/workbook.c (workbook_rename_sheet): Update notebook label

	* src/workbook-cmd-format.c 
	(workbook_cmd_format_column_width,
	 workbook_cmd_format_row_height): Off by one error.

1999-10-04  Jody Goldberg <jgoldberg@home.com>
	From: Nick Lamb <njl98r@ecs.soton.ac.uk>

	* src/cursors.c (cursors_init, create_bitmap_and_mask_from_xpm) :
	  A small patch to invert the logic when handling black vs white in
	  cursors.  This works around a problem with some Xservers.
	  Bug 808.

1999-09-30  Miguel de Icaza  <miguel@gnu.org>

	* src/Gnumeric-value.idl: New file, move the value structure
	definition here. 

	* src/Gnumeric.idl: Add new interface for data access.
	
	* src/value-sheet.c: New file.  Moved here the value code that
	uses a Sheet directly.
	(value_dump): moved here.
	(value_cellrange_get_as_string): ditto.
	(encode_cellref): ditto.
	(value_area_get_width): ditto.
	(value_area_get_height): ditto.
	(value_area_get_x_y): ditto.
	(constants_init): ditto.
	(value_area_foreach): ditto
	(wrapper_foreach_cell_in_area_callback): ditto.
	(value_area_fetch_x_y): ditto.

1999-10-04  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (sheet_action_delete_sheet) : Use a
	  workbook_expr_relocate to invalidate references to the contents of
	  the deleted sheet.
	(cb_sheet_erase) : Renamed to cb_sheet_destroy_contents.

	* src/sheet.c (sheet_destroy_contents) : Renamed from
	  sheet_destroy_columns_and_rows.  Delete the cells directly
	  from the hash.  Don't use a range.

	* src/cellspan.c (row_destroy_span) : Set deleted span hash to NULL.

	* src/sheet.c (sheet_destroy_columns_and_rows) : Wipe all row spans
	  in one stage to avoid looking them up one by one.

1999-10-03  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-delete-cells.c (dialog_delete_cells) :
	  Specify the app as the parent.
	* src/dialogs/dialog-insert-cells.c (dialog_insert_cells) :
	  Ditto.

	* src/expr.[ch]  : (cell_ref_restore_absolute,
	  cell_in_range, do_expr_tree_invalidate_references,
	  expr_tree_invalidate_references, fixup_calc_new_cellref,
	  do_expr_tree_fixup_references, expr_tree_fixup_references) : Delete.

	  (cellref_relocate) : Rewrite to support intersheet,
	    moves, invalidation, and references to and from moving cells.
	  (expr_relocate) : Use new cellref_relocate.

	 * src/workbook.[ch] (workbook_fixup_references,
	   workbook_invalidate_references) : Delete.
	 (workbook_expr_relocate) : Replace with.

1999-10-02  Jody Goldberg <jgoldberg@home.com>

	* src/{selection.c, collect.c, complex.c } : Add include config.h.
	  So that we get the right #defines when including Workbook
	  in a bonobo envirnoment.

	From : Jon K Hellan <Jon.K.Hellan@item.ntnu.no>
	* src/dialogs/{col-width, dialog-zoom, names,
		     row-height, sheet-rename, summary}.glade :
	  Dialogs made with glade pop up for a moment in one position before
	  being moved to the proper place. This is fixed by setting "Visible" to
	  False in Glade.

	* src/print.c (print_page) : Make func pointer match new signature
	  for sheet_col_get_info.

1999-10-01  Jody Goldberg <jgoldberg@home.com>

	* src/cell.h : Add ColRowCollection, a structure to store
	  a segmented array of ColRowInfo *, and some of the other
	  useful information, like max_element, and default_style.

	  Rename data to 'spans' to facilitate removing dependancies
	  on old name.

	  Renumbered the CELL_ flags now that CELL_ERROR is gone.

	* plugins/* : Switch to ColRowCollection.
	* src/print.c : Ditto.
	* src/value.c : Ditto.
	* src/xml-io.c : Ditto.
	* src/dialogs/dialog-cell-format.c : Ditto, and use sheet_foreach_colrow.
	* src/sheet-view.c : Ditto.  Use sheet_{row,col}_fetch and document
	  why they are called.
	(sheet_view_scrollbar_display) : ifdef out untill some one wants it.

	src/dialogs/dialog-solver.c : Add include "tools.h"

	* src/sheet.[ch] : Massive reorg.
	  Rows and Cols are no longer in lists they are in segmented arrays.
	  Cols don't have lists of cells in them.
	  All the insert/delete row/col code was redone and simplified.
	  The Shift row/col is broken pending the merge with the new copy
	  code.

	* src/cellspan.c : Switch from 'data' to 'spans'

	* src/clipboard.c : Use boolean, not integer '1'

	* src/corba-sheet.c : Switch to ColRowcollection.
	(Sheet_cell_get_background) : #ifdef until this is implemented.

	* src/embeddable-grid.c (grid_view_new) : Add a cast to silent
	  warning.

	* src/item-grid.c (item_grid_draw_cell) : Paint the borders After
	  contents.  They still don't work, but this is slightly better.

	* src/expr.c (do_expr_tree_fixup_references) : Partial patch that fixes
	  the common case and probably breaks the uncommon.  Refs to
	  cells/ranges on the current sheet have sheet == NULL.  The
	  destination specifies the sheet, so only references on a different
	  sheet were fixed.  When I rework this code for use by the 'move'
	  operation I'll fix it.

	* src/gnumeric-sheet.c (move_cursor) : Move the cursor before making
	  the area visible, Reset the selection after the motion.

1999-09-27  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : Don't attempt to paint past
	  SHEET_MAX_{ROWS,COLS}.
	* src/gnumeric-sheet.c (gnumeric_sheet_compute_visible_ranges) :
	  Ditto.
	(move_cursor) : Set the cursor before making the area visible so that
	  the scrollbars know the real position.

1999-09-26  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (print_preview_new): Removed warning/

1999-09-26  Morten Welinder  <terra@diku.dk>

	* src/cell.c (cell_relocate): Plug leak.

1999-10-18  Morten Welinder  <terra@diku.dk>

	* src/xml-io.c (xml_write_print_info): Actually add print order,
 	paper name, and orientation to the output instead of just leaking
 	them.
	(xml_set_value_double): Don't throw away precicion; save using
 	more sane formats.

1999-10-18  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/formats.c: Added new formats for elapsed setup.

	* src/format.c (format_number): Add support for hour-elapsed,
	minute-elapsed, and second-elapsed.

1999-10-17  Morten Welinder  <terra@diku.dk>

	* src/eval.c (cell_get_dependencies): Plug leak.

1999-10-16  Miguel de Icaza  <miguel@gnu.org>

	* src/xml-io.c (xml_read_colrow_info): Set the Column/Row
	dimensions here after loading them, as the new
	sheet_set_zoom_factor can no longer be used to reset lingering
	values (the value of the pixels was being computed here after we
	had read the units).

	* src/eval.c (cell_get_dependencies): Prototype change.  We now
	take the Cell as an argument and we scan all the sheets that
	depend on us.

1999-10-14  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-stat.c: Fixed the optional argument handling of
 	TREND.  Implemented one-dimensional GROWTH mostly (const argument
 	not implemented yet).

1999-10-13  Morten Welinder  <terra@diku.dk>

	* src/sheet-object.c (sheet_object_destroy): Don't try to walk the
 	list we are deleting items from.

1999-10-12  Miguel de Icaza  <miguel@gnu.org>

	* src/style.c (font_init): Use a dialog box rather than a printf.

1999-10-08  Miguel de Icaza  <miguel@gnu.org>

	* src/item-cursor.c (item_cursor_do_drop): We do not want anting
	here either.

1999-10-11  Michael Meeks  <mmeeks@gnu.org>

	* gnumeric.desktop: remove, its auto-generated.
	
1999-10-11  Michael Meeks  <mmeeks@gnu.org>

	* src/Gnumeric.idl: Add a variable name for datanotify so it compiles!
	kill redundant (void) on count.

1999-10-10  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c (item_bar_event) : Typo.

1999-10-09  Morten Welinder  <terra@diku.dk>

	* src/print.c (sheet_print): Handle failures from gnome-print.

1999-10-09  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c (item_bar_event) : Ensure that we ungrab whenever
	  necessary.

	* src/item-grid.c (item_grid_realize) : Add a reasonable approximation
	  of the XL border styles.

1999-10-08  Morten Welinder  <terra@diku.dk>

	* src/clipboard.c (x_selection_handler): Plug leak.

1999-10-08  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c (item_bar_event) : Use item_bar_end_resize.
	(item_bar_end_resize) : Cleare resizing flag even if when have not
	  moved and created a resize marker.

1999-10-07  Miguel de Icaza  <miguel@gnu.org>

	* src/gnumeric-sheet.c (gnumeric_sheet_compute_visible_ranges):
	Fix typo here.

1999-10-07  Jody Goldberg <jgoldberg@home.com>

	* src/item-bar.c : Add tooltip to show width/height during resize.

	* src/gnumeric-util.[ch] (gnumeric_create_tooltip,
	gnumeric_position_tooltip) : New functions.

	* src/mathfunc.[ch], src/utils.[ch] : Move random_01, random_normal,
	  and gpow10 from utils -> mathfunc.

	* src/goal-seek.c : Add an include for mathfunc.h

	* src/sheet-view.c (sheet_view_new) : Init tip to NULL.
	(set_tip_label) : Delete.
	(create_tip) : Poach the inards and use as a starting point for
	  gnumeric_create_tooltip.
	(position_tooltip) : Rename and move to gnumeric-utils.

	* src/main.c : Add new command line parameter. --debug_ole

	* src/sheet.c (sheet_col_size_fit) : Handle empty col by using the
	  default width.
	(sheet_row_size_fit) : Handle empty row by using the default height.

	* src/item-grid.c (item_grid_find_row,
	item_grid_find_col) : Return a value in the overflow case.

	From : Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/dialog-zoom.glade: Place sheet list inside frame. 
	  Use frame label, not list column label.
	  Add padding.
	  Use 0 height drawing area to set minimum width of spin button.

1999-10-06  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook-format-toolbar.c (change_selection_font): Remove
	ants when we change the font.
	(set_selection_halign): And when we change the alignment.

	Many more left to be removed.  Left as an excercise to Jody :-)

	* src/sheet.c (sheet_start_editing_at_cursor): remove ants when we
	start entering new text.

	* src/sheet-view.c (sheet_view_selection_unant): Destroys the
	anted cursors from the sheet view.
	(sheet_view_selection_ant): Adds cursors to the sheetview.
	(sheet_view_construct): New group that is used to hold the
	selection-ant items.

	* src/gnumeric-sheet.c (gnumeric_sheet_key_mode_sheet): Kill ants
	on escape.
	(gnumeric_sheet_key_mode_object): ditto.

	* src/selection.c (sheet_selection_unant): New function, kills the
	selection ants.
	(sheet_selection_ant): New function, adds an anted selection to
	all the selected regions.

	* src/clipboard.c (do_clipboard_paste_cell_region): Do not paste
	beyond sheet boundaries.

	* src/item-grid.c (item_grid_find_row): Do not go beyond sheet boundaries.
	(item_grid_find_col): ditto.

	* configure.in: Generate gnumeric.desktop

	* gnumeric.desktop.in: New file, used to choose the correct
	gnumeric/gnumeric-bonobo executable name.

	* src/sheet-object-item.c: Updated to fit with the new Bonobo
	changes. 

1999-10-06  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-zoom.c (dialog_zoom_impl) : Have the custom zoom
	  spinbox call 'Ok' when enter is pressed.

	* src/sheet.c (sheet_destroy_contents) : Fix typo causing memory
	  corruption.

	* src/sheet.h : Decrease SHEET_MAX_ROWS to 16k until we can tune
	  memory usage.

	From : Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/dialog-printer.c (gnumeric_printer_dialog_run): 
	  Workbook: New parameter
	  Set initial focus.
	  Make <Enter> in entry fields invoke default button.
	  Specify the app as the parent.

	* src/dialogs/dialog-printer.h (gnumeric_printer_dialog_run): 
	  Change signature

	* src/print.c (sheet_print): 
	  gnumeric_printer_dialog_run has new signature

	* src/dialogs/dialog-sovler.c (add_strings_to_glist): Remove
	(add_radio_buttons): Remove unnecessary "_()"
	(dialog_solver_options, dialog_solver): Add missing "_()"

	* src/dialogs/utils-dialog.c: New file
	(ut_dia_entry_new_with_max_length, ut_dia_entry_new): 
	  Create entry fields where <Enter> activates the default button
	(hbox_pack_label_and_entry): Move from dialog-analysis-tools.c
	(add_strings_to_glist): Move from dialog-solver.c

	* src/dialogs/utils-dialog.h: New file
	(hbox_pack_label_and_entry, add_strings_to_glist): Move from tools.h

	* src/dialogs/dialog-cell-comment.c (dialog_cell_comment): 
	  Make OK button the default.

	* src/dialogs/dialog-cell-sort.c (order_box_new):  
	  Make <Enter> in entry field invoke default button.

	* src/dialogs/dialog-define-names.c (dialog_define_names): 
	  Make <Enter> in entry field invoke default button.
	  Specify the app as the parent.

	* src/dialogs/names.glade: ok button needs "can_default".

	* src/dialogs/dialog-summary.c (dialog_summary_update): 
	  Make <Enter> in entry fields invoke default button.

	* src/dialogs/summary.glade: Make OK button the default.
	  Change widget names used by program to avoid inadvertent
	  translation. 

	* src/dialogs/dialog-analysis-tools.c 
	(new_dialog): Make OK button the default
	(dialog_data_analysis): Initial focus and selection, Make OK button
	  the default.
	(add_check_buttons, add_output_frame, dialog_sampling_tool): Make
	  <Enter> in entry field invoke default button
	(hbox_pack_label_and_entry): Move to utils-dialog.c
	(dialog_random_tool): Replace pack_label_and_entry with
	  hbox_pack_label_and_entry  
	(pack_label_and_entry): Remove

	* src/dialogs/dialog-goal-seek.c (dialog_found_solution, 
	dialog_goal_seek): Make OK button the default
	(dialog_goal_seek): Make <Enter> in entry field invoke default button.

	* src/dialogs/dialog-paste-special.c (dialog_paste_special): 
	  Initial focus

1999-10-05  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_destroy_contents) : Mark freed segments with
	  NULL.

	* src/selection.c (selection_contains_colrow) : New function.
	* src/item-bar.c (item_bar_event) : Use it.

	From : Jon K Hellan  <Jon.K.Hellan@item.ntnu.no>

	* src/dialogs/{insert,delete}-cells.glade : New files.
	* src/dialogs/dialog-{insert,delete}-cells.c : Switch from using
	  Cauldron to using libglade.

	* src/plugin-manager.c (plugin_manager_new): 
	  Go away on <Esc>, set initial focus.

	* src/dialogs/sheet-rename.glade: Made OK button default.

	* dialog-simple-input.c (dialog_get_number): gnome_dialog_run instead
	  of run_and_close - otherwise entry widget is destroyed before it is
	  read.  Make <Enter> in entry field activate default button.
	(dialog_get_sheet_name) : Ditto.

	* src/workbook.c (workbook_rename_sheet): Update notebook label

	* src/workbook-cmd-format.c 
	(workbook_cmd_format_column_width,
	 workbook_cmd_format_row_height): Off by one error.

1999-10-04  Jody Goldberg <jgoldberg@home.com>
	From: Nick Lamb <njl98r@ecs.soton.ac.uk>

	* src/cursors.c (cursors_init, create_bitmap_and_mask_from_xpm) :
	  A small patch to invert the logic when handling black vs white in
	  cursors.  This works around a problem with some Xservers.
	  Bug 808.

1999-09-30  Miguel de Icaza  <miguel@gnu.org>

	* src/Gnumeric-value.idl: New file, move the value structure
	definition here. 

	* src/Gnumeric.idl: Add new interface for data access.
	
	* src/value-sheet.c: New file.  Moved here the value code that
	uses a Sheet directly.
	(value_dump): moved here.
	(value_cellrange_get_as_string): ditto.
	(encode_cellref): ditto.
	(value_area_get_width): ditto.
	(value_area_get_height): ditto.
	(value_area_get_x_y): ditto.
	(constants_init): ditto.
	(value_area_foreach): ditto
	(wrapper_foreach_cell_in_area_callback): ditto.
	(value_area_fetch_x_y): ditto.

1999-10-04  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (sheet_action_delete_sheet) : Use a
	  workbook_expr_relocate to invalidate references to the contents of
	  the deleted sheet.
	(cb_sheet_erase) : Renamed to cb_sheet_destroy_contents.

	* src/sheet.c (sheet_destroy_contents) : Renamed from
	  sheet_destroy_columns_and_rows.  Delete the cells directly
	  from the hash.  Don't use a range.

	* src/cellspan.c (row_destroy_span) : Set deleted span hash to NULL.

	* src/sheet.c (sheet_destroy_columns_and_rows) : Wipe all row spans
	  in one stage to avoid looking them up one by one.

1999-10-03  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-delete-cells.c (dialog_delete_cells) :
	  Specify the app as the parent.
	* src/dialogs/dialog-insert-cells.c (dialog_insert_cells) :
	  Ditto.

	* src/expr.[ch]  : (cell_ref_restore_absolute,
	  cell_in_range, do_expr_tree_invalidate_references,
	  expr_tree_invalidate_references, fixup_calc_new_cellref,
	  do_expr_tree_fixup_references, expr_tree_fixup_references) : Delete.

	  (cellref_relocate) : Rewrite to support intersheet,
	    moves, invalidation, and references to and from moving cells.
	  (expr_relocate) : Use new cellref_relocate.

	 * src/workbook.[ch] (workbook_fixup_references,
	   workbook_invalidate_references) : Delete.
	 (workbook_expr_relocate) : Replace with.

1999-10-02  Jody Goldberg <jgoldberg@home.com>

	* src/{selection.c, collect.c, complex.c } : Add include config.h.
	  So that we get the right #defines when including Workbook
	  in a bonobo envirnoment.

	From : Jon K Hellan <Jon.K.Hellan@item.ntnu.no>
	* src/dialogs/{col-width, dialog-zoom, names,
		     row-height, sheet-rename, summary}.glade :
	  Dialogs made with glade pop up for a moment in one position before
	  being moved to the proper place. This is fixed by setting "Visible" to
	  False in Glade.

	* src/print.c (print_page) : Make func pointer match new signature
	  for sheet_col_get_info.

1999-10-01  Jody Goldberg <jgoldberg@home.com>

	* src/cell.h : Add ColRowCollection, a structure to store
	  a segmented array of ColRowInfo *, and some of the other
	  useful information, like max_element, and default_style.

	  Rename data to 'spans' to facilitate removing dependancies
	  on old name.

	  Renumbered the CELL_ flags now that CELL_ERROR is gone.

	* plugins/* : Switch to ColRowCollection.
	* src/print.c : Ditto.
	* src/value.c : Ditto.
	* src/xml-io.c : Ditto.
	* src/dialogs/dialog-cell-format.c : Ditto, and use sheet_foreach_colrow.
	* src/sheet-view.c : Ditto.  Use sheet_{row,col}_fetch and document
	  why they are called.
	(sheet_view_scrollbar_display) : ifdef out untill some one wants it.

	src/dialogs/dialog-solver.c : Add include "tools.h"

	* src/sheet.[ch] : Massive reorg.
	  Rows and Cols are no longer in lists they are in segmented arrays.
	  Cols don't have lists of cells in them.
	  All the insert/delete row/col code was redone and simplified.
	  The Shift row/col is broken pending the merge with the new copy
	  code.

	* src/cellspan.c : Switch from 'data' to 'spans'

	* src/clipboard.c : Use boolean, not integer '1'

	* src/corba-sheet.c : Switch to ColRowcollection.
	(Sheet_cell_get_background) : #ifdef until this is implemented.

	* src/embeddable-grid.c (grid_view_new) : Add a cast to silent
	  warning.

	* src/item-grid.c (item_grid_draw_cell) : Paint the borders After
	  contents.  They still don't work, but this is slightly better.

	* src/expr.c (do_expr_tree_fixup_references) : Partial patch that fixes
	  the common case and probably breaks the uncommon.  Refs to
	  cells/ranges on the current sheet have sheet == NULL.  The
	  destination specifies the sheet, so only references on a different
	  sheet were fixed.  When I rework this code for use by the 'move'
	  operation I'll fix it.

	* src/gnumeric-sheet.c (move_cursor) : Move the cursor before making
	  the area visible, Reset the selection after the motion.

1999-09-27  Jody Goldberg <jgoldberg@home.com>

	* src/item-grid.c (item_grid_draw) : Don't attempt to paint past
	  SHEET_MAX_{ROWS,COLS}.
	* src/gnumeric-sheet.c (gnumeric_sheet_compute_visible_ranges) :
	  Ditto.
	(move_cursor) : Set the cursor before making the area visible so that
	  the scrollbars know the real position.

1999-09-26  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (print_preview_new): Removed warning/

1999-09-26  Morten Welinder  <terra@diku.dk>

	* src/cell.c (cell_relocate): Plug leak.

1999-09-26  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/workbook.c (workbook_do_destroy): rename name clean.

	* src/sheet.c (sheet_destroy): add name clean.

	* configure.in: Add vital conditional for libole2.

	* src/xml-io.c (xml_write_names): Write from a GList.
	(xml_workbook_write): pass a GList. (xml_read_names): add sheet arg.
	(xml_workbook_read): upd. name read. (xml_sheet_read): add sheet name
	read. (xml_sheet_write): write names.
	Clean several redundant forward references.

	* src/main.c: make startup_files const.

	* src/expr-name.c: Major API hack for scoped names.
	(expr_name_add, expr_name_create, expr_name_lookup): add docs
	+ scoped names. (expr_name_value): setup correct 'wb' for parsing.

	* src/parser.y (try_symbol): Add comment + hard code to workbook
	scope.

1999-09-26  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet-object.c (sheet_set_mode_type): Protect Bonobo code
	from being included if we dont have Bonobo.  

	* src/Makefile.am: reverted changes from the libole2 code.
	
1999-09-26  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/Makefile.am (gnumeric_libs): Fix so gnumeric compiles.

1999-09-26  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_copy_cell_range) : use boolean.

1999-09-26  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet-object.c (sheet_button_release): Load content from
	bonobo objects here.
	(sheet_view_object_unrealize): Keep the bookkeeping of realized
	objects in the GnomeCanvasItem destroy handler.

	* src/sheet-object-bonobo.c (sheet_object_bonobo_load_from_file):
	New base class for SheetObjectContainer and SheetObjectBonobo

	* src/sheet-object-container.c: Redid for reusing the new
	hierarchy SheetObjectBonobo hierarchy.

1999-09-25  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet-object.c (create_object): handle
	SHEET_MODE_CREATE_CANVAS_ITEM.

	* src/sheet.h (Sheet::mode_data): new field to keep per-mode data
	during the lifetime of the mode.

	* src/sheet-object-item.c: New sheet-object type.  This one is
	used for embedding Bonobo-based CanvasItems. 
	
1999-09-25  Lauris Kaplinski <lauris@ariman.ee>

	* configure.in: add et to ALL_LINGUAS

	* gnumeric.desktop: added Estonian strings

1999-09-25  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/dialogs/dialog-zoom.c (dialog_zoom): Correct glade name.
	(dialog_zoom_impl): use moveto after we know the final list size.
	(custom_selected): simplify. (radio_toggled): ditto.
	(select_sheet_cb): create. (dialog_zoom_impl): use update_zoom_but
	& complicate significantly :-) (update_zoom_buttons): create.

1999-09-25  Jody Goldberg <jgoldberg@home.com>

	* src/plugin.c (plugin_load) : Enable the error box when
	  loading a plugin fails.

	* src/item-grid.c (item_grid_draw) : Paint an empty
	  only if the cell does not exist.  VALUE_EMPTY cells should be
	  treated as std cells when drawing the background.
	(item_grid_draw_cell) : Draw the contents before the border.

1999-09-24  Morten Welinder  <terra@diku.dk>

	* src/widgets/gtk-combo-box.c (gtk_combo_box_finalize): Plug leak.

1999-09-24  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (do_expr_decode_tree) : Handle missing arguments.

1999-09-23  Morten Welinder  <terra@diku.dk>

	* src/widgets/widget-color-combo.c (color_combo_construct):
 	Now non-static since Miguel decided to prototype it.

	* src/regression.c (linear_regression, exponential_regression):
 	Change to multi-dimensional regression.  (Too bad linear_solve
 	does not handle it yet.)  All callers changed.

	* src/widgets/widget-color-combo.c (color_clicked): Plug leak.
	(color_combo_select_color): Plug leak.
	(emit_change): Plug leak.

1999-09-23  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/widgets/widget-color-combo.c (color_combo_new): Install the
	Excel color table.

1999-09-23  Morten Welinder  <terra@diku.dk>

	* configure.in (gnome-print): back to 0.8.

1999-09-23  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/style.c (style_font_new_simple): Be defensive at
	font-loading time.  Basically, gnome-fonts might be allocated with
	a NULL gdk_font.  Maybe we need to revise this strategy

1999-09-23  Morten Welinder  <terra@diku.dk>

	* configure.in (gnome-print): only require 0.7 -- that's the
 	latest cvs version.

	* gnumeric.spec.in (Requires): Ditto.

	* configure.in (gnome-print): fix test.

1999-09-23  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* gnumeric.gnorba (location_info): Dropped the IDL: prefix from
	the gnorba file, and use "GOADID:" now.

	* src/widgets/widget-color-combo.c (color_combo_class_init): Fixed
	memory leaks.

	* src/style.h: Keep the original colors handy here.

	* src/print-cell.c (print_cell_range, print_empty_cell): We now
	paint empty cells.  Now we paint the background for the cell.

	* src/print-cell.c

	* src/item-grid.c (item_grid_paint_empty_cell): Style leak fix.

	* src/print-cell.c (print_cell): Changed the way borders are
	printed to improve code reusability.

	* src/print-info.c (save_formats): New format name to fix in an
	upgradable fashion.
	(load_formats): ditto.
	(print_info_new): The defaults to load should use [PAGE] not
	[NUM], which explains why it was never being shown.

	* src/print-preview.c (print_preview_print_done): Close the
	context here so we have information available in the ->size
	field. 

1999-09-23  Morten Welinder  <terra@diku.dk>

	* src/regression.c (exponential_regression): Fix thingo.

	* src/widgets/widget-color-combo.c (color_table_setup): Static.
	(color_combo_construct): Static.
	(color_table_setup): really break out.

1999-09-23  Rodrigo Stulzer Lopes <rodrigo@conectiva.com.br>

	* configure.in: add pt_BR to ALL_LINGUAS

1999-09-23  Miguel de Icaza  <miguel@gnu.org>

	* src/print.c (print_page): Setup the rotation for each page.

1999-09-23  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_set_print_unit) : Suppress warning.

	* src/dialogs/dialog-zoom.c (dialog_zoom_impl) : Set the spinbox value
	  when we start with a custom zoom factor, round correctly.  Set the
	  parent to be gnumeric.

1999-09-22  Jody Goldberg <jgoldberg@home.com>

	* src/xml-io.c (xml_write_sheet_object) : Avoid warning about
	  unhandled object types.

	* src/sheet-object.c (control_point_handle_event) : unused variable.

1999-09-22  Miguel de Icaza  <miguel@gnu.org>

	* src/item-grid.c (item_grid_paint_empty_cell): I am now using a
	gc for the empty cells (as the default gc is used and abused by
	the cell-draw code, better to keep our own).

	TODO: queue an update on the regions with changed style.  Wonder
	why this is not being done automatically.  Need to check. 

	* src/widgets/widget-color-combo.c (color_combo_construct): Fix
	visuals for working with Imlib properly.

1999-09-22  Jody Goldberg  <jgoldberg@home.com>

	* src/dialog/dialog-zoom.c : rewrite.

1999-09-21  Morten Welinder  <terra@diku.dk>

	* src/widgets/widget-font-selector.c (reload_preview): Spelling
 	fix.

1999-09-21  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet.c (cell_is_homogeneous): Set size here to get correct
	feedback results.

	* src/workbook-format-toolbar.c (change_font_in_selection_cmd):
	Simplified to use apply_style_to_selection
	(apply_style_to_selection): Big nice wrapper.
	(change_font_size_in_selection_cmd): Implement.

	* src/pixmaps.h: Removed GNUMERIC_TEST_ACTIVE_OBJECT for release. 

	* src/workbook-format-toolbar.c: More toolbar work, now we have
	color selectors for foreground and background.

	* src/workbook.c: Split the format toolbar

	* src/workbook-format-toolbar.[ch]: Now they contain the
	format-toolbar code. 

	* src/sheet-object-graphic.c (sheet_object_filled_realize): Width
	is now in points, not pixels.

	* src/widgets/gtk-combo-box.[ch]: New files, they implement an
	extensible ComboBox for Gtk.

	* src/widgets/color-combo.[ch]: New files, they implement the
	ColorCombo box. 
	
1999-09-21  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-object-container.c (make_container_item): Add widget_handle.
	(sheet_object_container_destroy): clean.

	* src/sheet-object-widget.c (sheet_object_widget_realize): add widget
	handling hook.

	* src/sheet-object.c (sheet_object_event): renamed to canvas_event.
	(control_point_handle_event): use gdouble for x,y & remove duff w2w &
	dx*zoom code.

	* src/sheet-object.h: add various signals + a type.

	* src/sheet-object-widget.c (sheet_object_widget_construct): set press.

	* src/sheet-object.c (sheet_object_event, sheet_object_make_current): 
	remove redundant 'Sheet' argument.
	(control_point_handle_event): Add make_current to button press.
	(sheet_object_start_editing): clean + setup cursor data.
	(control_point_handle_event): Use sizing cursors.
	(sheet_object_event): Add 'press' cursor.
	(sheet_object_widget_event, sheet_object_widget_handle): handlers to pass
	events around.

	* src/sheet-object-container.c (user_activation_request_cb): update
	make_current.

	* src/cursors.h: Add new cursors.

	* src/cursors.c: ditto.

1999-09-21  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-stat.c (gnumeric_logest): Add some meat.

	* src/regression.c (general_linear_regression): Renamed from
 	general_regression.
	(exponential_regression): New function.

1999-09-21  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* samples/statfuns.xls: Updated the second PERCENTRANK test.
	
	* src/functions/fn-stat.c: Added stubs for LOGEST and GROWTH.

1999-09-20  Morten Welinder  <terra@diku.dk>

	* src/expr.c (do_expr_decode_tree): Plug leak.

	* src/functions/fn-stat.c (gnumeric_linest): Handle "const"
 	parameter also.  Introduce skeleton to handle "stat" parameter.
	(gnumeric_percentile): Fix PERCENTILE.

	* src/format.c (format_number): Plug leak.

1999-09-20  Jody Goldberg <jgoldberg@home.com>

	* plugins/{ff-csv, gda, guile, python, sample, text}/Makefile.am :
	  Do not specify private warnings.  Use the default set from
	  compiler-flags.m4.

	* src/cell.h (cell_deep_thaw_dependencies,
		      cell_deep_freeze_dependencies) : Remove non-existant
		      prototypes.

1999-09-19  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-stat.c: Implemented PERCENTILE() function.

1999-09-19  Jody Goldberg <jgoldberg@home.com>

	* src/value.c (value_release) : Releasing value_terminate should not
	  generate an error.

	* src/sheet-object-container.h : Add include
	  <bonobo/gnome-client-site.h>.

1999-09-18  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.h : Make SheetObjectType names
	  constistant with SheetModeType names, and add
	  GRAPHIC, BUTTON, and CHECKBOX.

	* plugins/html/epsf.c (epsf_write_wb) : RECTANGLE -> BOX.
	  ELLIPSE -> OVAL.
	* src/sheet-object.c (create_object) : Ditto.
	* src/xml-io.c (xml_read_sheet_object) : Ditto.

1999-09-18  Miguel de Icaza  <miguel@gnu.org>

	* src/dialogs/dialog-simple-input.c (dialog_get_sheet_name): use
	dialog_run_and_close here.
	(dialog_get_number): ditto.

	* src/format.c (format_add_thousand, format_remove_decimal,
	format_add_decimal): New routines.
	(format_number): Fixed bug in 'E', 'e' handler (format was
	incremented twice).

	* src/workbook-cmd-format.c: Hook up the add/remove decimal and
	add thousand actions.

	* src/sheet.c (range_is_homogeneous): Do not value_release a value
	terminate.

	* src/workbook-cmd-format.c (do_apply_style_to_selection): set
	sheet dirty.
	(workbook_cmd_format_column_auto_fit): ditto.
	(workbook_cmd_format_column_width): ditto.
	(workbook_cmd_format_row_auto_fit): ditto.
	(workbook_cmd_format_row_height): ditto.

	* src/workbook.c (workbook_rename_sheet): dirty sheet.

1999-09-19  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/workbook.c (about_cmd): make static.

	* src/sheet-object-container.c (sheet_object_container_load): fix
	return value.

	* src/workbook.c (create_format_toolbar): cast to widget not entry.

1999-09-19  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-stat.c (callback_function_make_list): Static.
	(init_make_list_closure): Static.

	* src/expr.c (eval_expr_real): Static.

	* src/functions/fn-math.c (gnumeric_sum): Static.
	(gnumeric_suma): Static.

	* src/analysis-tools.c (covariance_tool): Plug leak.
	(descriptive_stat_tool): Plug leak.
	(correlation_tool): Plug leak.
	(ranking_tool): Plug leak.
	(anova_single_factor_tool): Plug leak.
	(sampling_tool): Don't read past array.

	* src/sheet.c (sheet_destroy): Plug leak.

	* src/dialogs/dialog-cell-sort.c (dialog_cell_sort): Plug leak.

1999-09-18  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (range_is_homogeneous) : Ignore results from
	  sheet_cell_foreach_range it will always be NULL or
	  value_terminate.  Neither need to be freed.

	* src/value.c (value_release) : Re-enable test to avoid releasing
	  value_terminate.

1999-09-17  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet.c (sheet_row_size_fit): fetch row information, not
	column information.  Fix the routine.

	* src/workbook-cmd-format.c (workbook_cmd_format_column_auto_fit):
	(workbook_cmd_format_column_width): 
	(workbook_cmd_format_row_auto_fit): 
	(workbook_cmd_format_row_height): Fix the range being scanned to
	be inclusive.

1999-09-17  Jody Goldberg <jgoldberg@home.com>

	* samples/operator.xls : Updated to be robust in the
	  face of errors, and to use epsilon comparisons for the
	  artihmetic comparisons.

1999-09-18  Morten Welinder  <terra@diku.dk>

	* gnumeric.spec.in (Requires): Update libglade version.

	* src/dialogs/dialog-printer-setup.c (do_hf_config): Plug leaks.

	* src/sheet.c (zoom_cell_style): Plug leak.

	* src/functions/fn-date.c (get_serial_time): Be defensive.

	* src/expr.c (eval_expr_real): For integer 0^0, return #NUM!.
	(eval_expr_real): Adjust float power error check to match the
 	integer one.

	* src/style.c (style_new): Silence.

	* src/sheet.c (sheet_update_controls): Initialize all closure
 	members.

1999-09-17  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/dialogs/dialog-summary.c (dialog_summary_update): Change to
	workbook argument, and reparent to toplevel.

	* src/dialogs/dialogs.h: ditto.

	* src/workbook.c (summary_cmd): ditto.

1999-09-17  Miguel de Icaza  <miguel@gnu.org>

	* src/widgets/gnumeric-toolbar.c (gnumeric_toolbar_class_init):
	typo fix.

1999-09-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/widgets/gnumeric-toolbar.c (gnumeric_toolbar_class_init):
	Parent class is GtkToolbar, not itself.

1999-09-17  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c (create_format_toolbar): Make the size of the
	entry line onloy fit four zeros.
	(workbook_feedback_set): set the font even if no cached value
	exists. 

1999-09-17  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/workbook.c: Added ``Delete...'' entry to ``Edit'' menu.

1999-09-17  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook-cmd.c: New file.  Moved a bunch of commands here,
	and move to be moved.
	Implemented the set money format;   Implemented the percent formt.
	
1999-09-16  Miguel de Icaza  <miguel@gnu.org>

	* src/sheet.c (sheet_update_controls, cell_is_homogeneous):
	Include checks for font name and font size.

	* src/dialogs/dialog-printer-setup.c (dialog_printer_setup): Add
	call to gnome_dialog_set_parent here.

	* src/dialogs/tools.h: New file, moved here all the tools declarations.
	Please, try to keep indentation for public functions as the rest
	of the Gnumeric ones.

	* src/workbook.c: Enable comands Format/Column, Format/Row and
	Format/Sheet.
	(create_format_toolbar): Add font selector toolbar widget.
	(change_font_in_selection_cmd): New routine.  Applies a font to a
	selection in the workbook.
	(workbook_feedback_set): Upgraded feedback interface
	
	* src/sheet-view.c (sheet_view_row_size_changed): There is no need
	to call gnumeric_compute_visible_ranges, the sheet_row_set_height
	code does this.

	* src/item-bar.c (item_bar_event): Support also row-autosizing.

	* src/sheet.c (sheet_col_size_fit): Add this routine.
	(sheet_col_set_internal_width): New function.  Similar to its
	counterpart

	* src/dialogs/dialog-cell-format.c (dialog_cell_format): Change
	call to g_list_free for sheet_cell_list_free.

	* src/selection.c (sheet_cell_list_free): New routine.

	* src/workbook.c: Reworked toolbars again.  We now only have 2
	toolbars instead of 8 or so.

	* src/sheet.h (SHEET_MAX_ROWS): New excel supports 64k rows, mimic this.

	* src/widgets/gnumeric-toolbar.c: Added new file.  Handles the
	Gnumeric toolbars.

1999-09-17  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_col_get_unit_distance,
		       sheet_row_get_distance
		       sheet_row_get_unit_distance
		       sheet_col_get_unit_distance) : Constification.
	(sheet_init_default_styles) : Make the default row/col size
	  match excel more closely.

1999-09-16  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/func.c (functions_init): Remove misc_init.

	* src/functions/fn-misc.c: Removed, empty & redundant.

	* src/functions/Makefile.am: remove fn-misc.c

	* src/func.h: ditto.
	
	* src/sheet-object-container.c (sheet_object_container_load): Implement
	cleaner & simpler load method

	* NEWS (Michael): doh, move it into the correct version.

1999-09-16  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/print.c (sheet_print): Update to use gnumeric_porinter_dialog_run.
	(print_job_info_get): Add range parameter.

	* src/dialogs/Makefile.am (libdialogs_a_SOURCES): Added dialog-printer.[ch]

	* src/dialogs/dialog-printer.[ch]: New thin wrapper of GnomePrinterDialog
	to handle sheet selection.
	
	* src/sheet-object-container.c (sheet_object_container_land): Add
	comments about what needs doing.

	* src/sheet-object.c (sheet_object_event): renamed.
	Updated various SheetObject var names to 'so'.

1999-09-15  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-object-container.c (sheet_object_container_land): Cleaned
	debug, improved sizing logic.

1999-09-16  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.c (range_dump) : Typo.

	* src/selection.c (selection_to_list) : rename from
	  sheet_selection_to_list and add allow_intersection parameter.
	(selection_to_string) : rename from sheet_selection_to_string and
	  use selection_apply.

	* src/dialogs/dialog-cell-format.c (dialog_cell_format) : Adjust to
	  changes in selection_to_list.

1999-09-15  Morten Welinder  <terra@diku.dk>

	* src/sheet.c (cell_is_homogeneous): Always return a value.

	* src/ranges.c (range_dump): Fix destination.

	* src/selection.c (selection_apply): Plug leak.

1999-09-15  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-object.c (window_to_world): Remove.
	(sheet_motion_notify, sheet_button_release, sheet_object_drop_file): 
	clean to use gnome_canvas_window_to_world.

	* src/sheet-view.c (sheet_view_construct, (filenames_dropped): move

	* src/gnumeric-sheet.c (gnumeric_sheet_filenames_dropped),
	(gnumeric_sheet_new): to here + rename; makes more sense.

	* src/sheet-object.c (sheet_object_drop_file): Take a GnumericSheet.

	* src/parser.y (array_row:): Manged to support wierd MS style array
	semantics some people get {1\2\3;4\5\6} instead of {1,2,3;4,5,6}.

	* src/workbook.c (workbook_file_toolbar): Remove duplicate print icon.

	* src/pixmaps/preview.xpm: Stop gap icon; improved.

	* src/xml-io.c (xml_get_print_hf): Remove redundant precondition.

1999-09-14  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c: Split toolbars into mulitple toolbars;  Add a
	private field to Workbook structure. 
	Change the toolbar setup to have multiple dock-items.

	* src/format.c: Initialize this to NULL.

	* src/print-info.c (load_formats): Memory leak fix.

	* src/xml-io.c (xml_read_summary): Fixed memory leak.

1999-09-14  Morten Welinder  <terra@diku.dk>

	* src/dialogs/dialog-analysis-tools.c (tools): Make static.

	* src/print-info.c (load_formats): Plug leak.

	* src/functions/fn-eng.c (eng_functions_init): Arg fix.
	* src/functions/fn-string.c (string_functions_init): Ditto.
	* src/functions/fn-stat.c (stat_functions_init): Ditto.
	* src/functions/fn-sheet.c (sheet_functions_init): Ditto.
	* src/functions/fn-misc.c (misc_functions_init): Ditto.
	* src/functions/fn-math.c (math_functions_init): Ditto.
	* src/functions/fn-lookup.c (lookup_functions_init): Ditto.
	* src/functions/fn-logical.c (logical_functions_init): Ditto.
	* src/functions/fn-information.c (information_functions_init):
 	Ditto.
	* src/functions/fn-financial.c (finance_functions_init): Ditto.
	* src/value.c (value_terminate): Ditto.

	* gnumeric.spec.in (Requires): Update gnome-print dependency.

1999-09-14  Karl Eichwalder  <ke@suse.de>

	* src/workbook.c: The "import" item needs dots; it opens a dialog.

	* DEPENDS: Add gnome-print.

	* README: Increase gnome-print version (0.6); not sure, whether
	other version numbers are to be increased, too.  Fix typos; small
	prettifications.

1999-09-13  Jody Goldberg <jgoldberg@home.com>

	* src/ranges.c (range_dump) : Improve format.

	* src/workbook.c (deps_output) : The selection can be a region.

	* src/dialogs/dialog-cell-sort.c (dialog_cell_sor) :
	  sheet_selection_first_range returns a range.

	* src/print.c (sheet_print_selection) : Ditto.

	* src/selection.c (sheet_selection_first_range) : Simplify and move
	  closer to to sheet_verify_selection_simple.

	* src/workbook.c (insert_cols_cmd, insert_cols_cmd) : Handle
	  sheet_verify_selection_simple rename to selection_is_simple.

	* src/sheet.c (sheet_update_controls) : Use selection_apply
	  rather than sheet_selection_to_list which is expensive.
	(sheet_col_selection_type, sheet_row_selection_type) :
	  Constification.

1999-09-13  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/parser.y (forget_array): Created. exp: added array_row, array_exp,
	array_cols: created. (build_array): Implemented. (v_forget): added.

	* src/value.c (value_release): Update Array to only free if != NULL.

	* src/functions/fn-lookup.c (lookup_functions_init): add index.
	(gnumeric_index): Ghastly placeholder; we need more core functionality.
	(gnumeric_lookup): remove redundant value_duplicate fixing leak.
	(gnumeric_match): Implement as far as it goes.

	* src/workbook.c (workbook_delete_event): Nail fatal bug in #define for bonobo.

	* src/dialogs/dialog-printer-setup.c (dialog_print_info_new): Moved things into
	constructor and out of (dialog_printer_setup).
	(unit_changed): actually update the margin UnitInfo's value...

	* src/xml-io.c (xml_read_print_info, xml_write_print_info, xml_get_print_hf),
	(xml_set_print_hf): Header / footer, paper size writing.

1999-09-13  Karl Eichwalder  <ke@suse.de>

	* src/dialogs/hf-config.glade: Add missing `:'.  Is this the right
	place to fix this kind of a bug?
	* src/dialogs/hf-config.glade.h (N_): Ditto (I don't know how to
	autogenerate this file).

1999-09-13  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-misc.c, src/functions/fn-information.c: Moved the
	error functions to information functions file.

	* src/functions/fn-math.c, src/function/fn-lookup.c: Moved TRANSPOSE
	to lookup functions file.
	
	* src/functions/fn-stat.c: Added more examples.

	* src/dialogs/dialog-analysis-tools.c: Bug fix.  Pressing ESC key
 	means CANCEL now in the subdialogs.

1999-09-13  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/dialogs/dialog-printer-setup.c (do_setup_page_info): Fix initial display
	of icon: lr/td first.

	* src/xml-io.c (xml_sheet_read, xml_sheet_write): Add print info R/W.

1999-09-12  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/print-info.h: UnitName typo corrected.

	* src/dialogs/dialog-printer-setup.c (convert_to_mm, unit_editor_new): ditto.

	* src/xml-io.c (xml_read_print_info, xml_write_print_info): Implemented.
	(xml_read_summary): Cleaned preconditions to make Miguel happy.

	* src/print-preview.c (preview_destroyed, print_preview_new): Attach signal
	to the workbook and warn.

	* src/print.c (sheet_print): Remove redundant print_context_close_file.

	* src/embeddable-grid.c (grid_view_new): NULL a pointer.

1999-09-12  Michael Meeks  <mmeeks@gnu.org>

	* src/embeddable-grid.c (grid_view_activate): Hack to cope with new
	private Bonobo plug, just emit a warning.
	(grid_view_new): similarly hacked.

	* src/eval.c: Include ranges.h

	* src/selection.c (sheet_selection_first_range): Remove unused and
	cryptic base_col / base_row.

	* src/dialogs/dialog-cell-sort.c (dialog_cell_sort): remove base
	stuff.

	* src/workbook.c (print_setup_cmd, file_print_cmd),
	(file_print_preview_cmd): New print stuff.
	(deps_output): update to new first_range.

	* src/print-preview.c (print_preview_new): More wb->sheet.
	(sheet_destroyed): Renamed, (create_preview_canvas, render_page),
	(preview_file_print_cmd, create_toplevel): wb->sheet.
	include print.h (preview_file_print_cmd): Add active_sheet.
	(create_toplevel): Update name calc + add preconditions.

	* src/print-preview.h: update prototype + add _context proto.

	* src/print.c (print_job_info_get): more wb->sheet.
	(printjob_init_sheet): split out. (sheet_print_selection): implement.

	* src/sheet.c (sheet_new, sheet_destroy): Add print info bits.

	* src/workbook.c (workbook_do_destroy, workbook_init): Clean
	print-info bits.

	* src/dialogs/dialog-printer-setup.c (dialog_print_info_t):
	convert workbook -> sheet (do_print_preview_cb, do_print_cb),
	(dialog_print_info_new, dialog_printer_setup): ditto.
	(do_setup_main_dialog): preconditions.

	* src/dialogs/dialogs.h: Change prototype.

	* src/print.c (workbook_print): Implemented PRINT_ACTIVE_SHEETS,
	added default_range paramter: use for now; renamed (sheet_print)
	(print_sheet): preconditions (sheet_print_selection): renamed.

	* src/print.h (workbook_print): Move PrintRange enum here & re-name.

1999-09-11  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c (workbook_delete_event): Fix the delete_event
	setup. 

1999-09-11  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object-widget.c (sheet_object_widget_update_bounds) :
	  Don't zoom coords sheet_object_get_bounds takes care of that
	  for us.

	* src/sheet-object-container.c (sheet_object_container_update_bounds) :
	  Ditto.

	* src/sheet-object-graphic.c (sheet_object_filled_update_bounds) :
	  Ditto, renamed from sheet_object_filled_update to be more
	  consistant.

1999-09-10  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/corba-sheet.c: include selection.h

	* src/sheet.c: Include ranges.h (sheet_insert_object): remove unused.

	* src/file.c (workbook_try_read): Remove unused var.
	(fs_key_event): Sort out return type & cast.

	* src/selection.c: Add Jody as an author if he isn't going to :-)

	* src/sheet-object.c: Cheekily do the same for me.

1999-09-10  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/corba-sheet.c: Updated to the new sheet selection API
	changes. 

	* src/gnumeric-sheet.c (destroy_item_editor): Removed FIXME
	comment.  More fixing from Federico's talk
	(gnumeric_sheet_stop_cell_selection): ditto

	* src/cell.c: Replaced unrefs of windows with destroys.  Federico
	explained a thing or two to me today.

	* src/file.c (dialog_query_load_file): Added a key handler to
	handle ESC on dialog boxes to mean cancel.
	(workbook_save_as): ditto.

1999-09-10  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-object.c (window_to_world): Added debug.

	* src/widgets/widget-editable-label.c (el_start_editing): 

	* src/workbook.c (sheet_label_text_changed_signal): Return focus
	to the main sheet when finished.

	* src/widgets/widget-editable-label.c (el_stop_editing): Convert
	gtk_object_unrefs to gtk_object_destroy's kills wierd debug.
	(el_destroy): NULL freed pointer.
	(el_start_editing): Add vital widget_grab_focus.

	* src/cursors.h (cursor_set_widget): Use G_STMT_* in macros.

	* src/workbook.c (workbook_can_close): Add forward definition.
	(workbook_new): Update sizing algo. to fit to the screen better.

	* src/main.c (gnumeric_main): Process gtk draw events between loading
	files, can't slow us down and looks lots better !

1999-09-10  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-*: Added tons of examples to help strings.

1999-09-09  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-object.c (sheet_button_release), sheet_motion_notify),
	(sheet_object_set_bounds): Fix for arrows.

1999-09-09  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/workbook.c (workbook_delete_event): Fix object_unref for
	Bonobo case. (workbook_widget_delete_event): remove strange unref, this
	needs looking at.

	* src/sheet-object.c (sheet_view_object_unrealize, sheet_object_destroy),
	(sheet_object_destroy_control_points): Changed _unref to _destroy nailing
	scads of warnings.

	* src/sheet-object-container.c (sheet_object_container_destroy_views): 
	ditto.

	* src/sheet-object-container.c (sheet_object_container_land): Get
	auto sizing working.

	* src/sheet-object*.[ch]: Large overhaul, extensively re-wrote signal
	handling, and state passing. Generic object 'bounds' is now stored in
	sheet-object, and accessed via access procedures. Homegenized naming,
	Drasticaly simplified re-sizing modes.
	
	* src/sheet-view.c: Include selection.h to kill warnings.

	* src/sheet-object.c (sheet_object_get_bounds): Created.
	(sheet_view_object_unrealize): Fix the same list manipulation bug
	( it gets everywhere ).

1999-09-09  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-*: Started adding examples to all functions.

1999-09-08  Jody Goldberg <jgoldberg@home.com>

	* src/*.c : Have Range use CellPos, and SheetSelection use Range.

	* src/functions/fn-sheet.c (gnumeric_selection) :
	  Switch to selection_apply.

	* src/sheet.c (sheet_set_selection) : Keep GNUMERIC_SHEET_VIEW
	  local to sheet.c

	* src/selection.c (sheet_selection_change,
			   selection_append_range,
			   sheet_selection_extend_to) :
	  Use sheet_set_selection.

	* src/dialogs/dialog-cell-format.c (apply_font_format,
					    cell_properties_apply) :
	  adjust to changes in SheetSelection.

	* src/functions/fn-sheet.c (gnumeric_selection) : Switch to
	  selection_apply.

	* src/gnumeric-util.c (range_contains) : Ditto. Const.

	* src/selection.c (sheet_selection_clear,
			   sheet_selection_clear_comments,
			   sheet_selection_clear_content,
			   sheet_selection_clear_formats) :
	  Use selection_apply.
	(selection_apply) : New function abstracting selections enabling
	  correct support for overlapping selection regions.
	(sheet_selection_to_list) : Use selection_apply.

	* src/value.c (value_new_array_empty) : New function.

1999-09-08  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-object.c (control_point_handle_event): substantialy
	re-written, same bugs :-), fix tommorow.; added range clipping.

	* src/sheet-object-container.c (sheet_object_container_land): Add
	auto-size placeholder & argument.
	(sheet_object_container_destroy): gnome_object_destroy instead of
	gtk_object_destroy.

	* src/sheet-object.c (sheet_object_drop_file): remove duff realize
	and debug. Correct gnome_object_destroy to gtk_object_destroy.

1999-09-08  Morten Welinder  <terra@diku.dk>

	* gnumeric.desktop: Add Danish translations.

1999-09-08  Jody Goldberg <jgoldberg@home.com>

	* src/cell.c (cell_get_span) : Support VALUE_EMPTY.

1999-09-08  Michael Meeks  <michael@nuclecu.unam.mx>

	* src/sheet-view.c (filenames_dropped, sheet_view_construct): Move
	D&D activation to here, so we get sensible handling of positions.
	
	* src/sheet-object-container.c (user_activation_request_cb): typo.
	(sheet_object_drop_file): Emit the correct signal to realize, take
	a SheetView argument, clean 'msg's up.
	(sheet_object_container_new): Squashed warning.

	* src/workbook.c (filenames_dropped, workbook_new): Move D&D into
	sheet-view.c.

	* src/file.c (workbook_try_read): Split from workbook_read.
	(workbook_import, workbook_read): Correct casts & updated.

	* src/dialogs/dialog-function-select.c (function_definition_update),
	(function_categories_fill): Add casts to get round daft clist_append
	constification.

1999-09-08  Vincent Renardias  <vincent@ldsol.com>

	* src/dialogs/dialog-analysis-tools.c: A number of displayed strings
	were not marked as such.
	* po/fr.po: Updated accordingly.

1999-09-08  Pablo Saratxaga <srtxg@chanae.alphanet.ch>

	* src/workbook.c: changed "_Comments" to "Co_mments" as there is
	already "_Content" in the same menu

1999-09-07  Jody Goldberg <jgoldberg@home.com>

	* src/dialogs/dialog-function-select.c (function_definition_update,
	  function_categories_fill) : Const.

1999-09-07  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/workbook.c: Remove sample button from the toolbar.

	* src/item-bar.c (item_bar_event): Use the item_bar->resize_pos
	computed during button press. #2090 fixed

1999-09-07  Morten Welinder  <terra@diku.dk>

	* src/print-info.c (save_margin): Terminate the set of strings to
 	concatenate.

	* src/dialogs/dialog-printer-setup.c (do_setup_main_dialog): Plug
 	leak.

1999-09-07  Michael Meeks  <michael@imaginator.com>

	* src/pixmaps.h: Added button.xpm

	* src/sheet-object.c (sheet_object_drop_file): Created.

	* src/workbook.c (filenames_dropped): Move component d&d guts into
	sheet-object.

	* src/file.c (workbook_import, workbook_read): Add bonobo_object
	_destroy if we have bonobo.

1999-09-03  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/item-grid.c: Code now can draw emtpy cells with the correct style.

1999-09-03  Miguel de Icaza  <miguel@gnu.org>

	* src/dialogs/dialog-printer-setup.c (draw_margins): Added margin
	display preview. 

	* src/print-preview.c (preview_zoom_out_cmd): Zoom-in, zoom-out
	and move are now toggle buttons.

	* src/workbook.c (italic_cmd, bold_cmd): Simplified the code some.

	* src/dialogs/dialog-printer-setup.c (do_setup_page_info): Force
	the icon display here.
	(preview_page_create): Invert test.
	(PAGE_X, PAGE_Y): They are now the same values.
	(do_setup_page): Show the images here.

1999-09-02  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (create_toplevel): Add a toolbar.

	* src/print.c (compute_groups): Include the margins in the
	size computation.

	* src/print-cell.c (print_cell_range): Start printing from the
	start_row, not from zero.

	* src/print-preview.c: Change of plans.  We now use a metafile, we
	render all the code there.  And then we use the new metafile
	operations for rendering a specific page.

	* src/item-cursor.c (item_cursor_autofill_event): Change this to
	destroy again.

1999-09-01  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (print_preview_print_done): Show the first
	page here.

1999-09-03  Michael Meeks  <michael@imaginator.com>

	* src/sheet-object-container.c (sheet_object_container_land): Add
	return type to denote if we created and bound correctly.
	(sheet_object_container_creation_finished): Add warning on failure.
	(get_file_name): Kill warning.

1999-09-01  Michael Meeks  <michael@imaginator.com>

	* src/sheet-object-container.c (sheet_object_container_land): Add
	optional file argument and document.
	(sheet_object_container_creation_finished): update call's args.

	* src/sheet-object.h: Removed redundant sheet_object_register.

	* src/workbook.c (filenames_dropped): Hacked.

1999-09-07  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/item-bar.c (item_bar_event): Use the item_bar->resize_pos
	computed during button press. #2090 fixed

1999-09-07  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/format.c (format_number): "\" is an escape character for the
	next character on the format.

1999-09-07  Morten Welinder  <terra@diku.dk>

	* src/mathfunc.h: Make up for deficient header files.

	* src/cursors.c (create_bitmap_and_mask_from_xpm): Fix bitmap
 	loading.  This code isn't exactly elegant.

1999-09-06  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-view.[ch] (sheet_view_scrollbar_config) : Adjust scrollbar
	  increment.  Split out from sheet_view_size_allocate.

	* src/gnumeric-sheet.c (gnumeric_sheet_compute_visible_ranges) :
	  call sheet_view_scrollbar_config, to adjust scrollbar when region
	  changes.

1999-09-05  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (preview_canvas_event): Add an event handler
	for the preview canvas.  
	Make the drag action on MOVE mode move the canvas.
	(zoom_state): new routine, controls the toolbar widget display.

	* src/cursors.c: Add new zoom in and zoom out cursors.

	* src/dialogs/dialog-printer-setup.c (unit_editor_new): One line
	warning fix.

	* src/sheet.c (sheet_col_size_fit): Returns the size required to
	render every cell completely.

	* src/item-bar.c (item_bar_event): Delay column/row resizing
	action until the division is actually being dragged.  We need this
	to catch double-clicks for auto-sizing cells.
	(GDK_2BUTTON_PRESS):

	* src/dialogs/dialog-cell-format.c (create_background_radio,
	create_foreground_radio): Set the toggle button to the colored
	when the color selector has been clicked.

	* src/item-grid.c (item_grid_draw): Experimental code for drawing
	empty cells with the correct attributes.

	Only enabled if you use set gnumeric debugging flag above 1.  I do
	have some issues with selection drawing. 

1999-09-05  Richard Hestilow  <hestgray@ionet.net>

	* configure.in: Minor s/For/for library check message fix.
	
1999-09-03  Miguel de Icaza  <miguel@gnu.org>

	* src/dialogs/dialog-printer-setup.c (draw_margins): Added margin
	display preview. 

	* src/print-preview.c (preview_zoom_out_cmd): Zoom-in, zoom-out
	and move are now toggle buttons.

	* src/workbook.c (italic_cmd, bold_cmd): Simplified the code some.

	* src/dialogs/dialog-printer-setup.c (do_setup_page_info): Force
	the icon display here.
	(preview_page_create): Invert test.
	(PAGE_X, PAGE_Y): They are now the same values.
	(do_setup_page): Show the images here.

1999-09-02  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (create_toplevel): Add a toolbar.

	* src/print.c (compute_groups): Include the margins in the
	size computation.

	* src/print-cell.c (print_cell_range): Start printing from the
	start_row, not from zero.

	* src/print-preview.c: Change of plans.  We now use a metafile, we
	render all the code there.  And then we use the new metafile
	operations for rendering a specific page.

	* src/item-cursor.c (item_cursor_autofill_event): Change this to
	destroy again.

1999-09-01  Miguel de Icaza  <miguel@gnu.org>

	* src/print-preview.c (print_preview_print_done): Show the first
	page here.

1999-09-02  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_paste_region) : Check that another
	  workbook has not already freed the selection before releasing.
	(x_selection_received) : Ditto.
	(x_clipboard_bind_workbook) : Init clipboard_paste_callback_data.

1999-09-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet-object.c (sheet_object_update_coords) : Scale movements by
	  zoom factor.
	* src/sheet-object-widget.c (sheet_object_widget_update_coords) : Ditto.

1999-09-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_compute_col_row_new_size) :
	  The margin appears to be used for the border used to
	  mark the current cell.  This border is not scaled when
	  zoomed.

1999-09-01  Miguel de Icaza  <miguel@gnu.org>

	* src/file.c (workbook_read): If the file does not exist, create a
	1-sheet worbook.

	* src/print-preview.c: Re-enable zoom in and zoom out after the gnome-print
	fixes

1999-09-01  Jody Goldberg <jgoldberg@home.com>

	* src/sheet.c (sheet_move_column, sheet_shift_row,
	  sheet_insert_row, sheet_delete_row, sheet_shift_col) : Don't
	  relocate the expressions. (Bug 2041)

1999-09-01  Pablo Saratxaga <pablo@mandrakesoft.com>

	* configure.in,po/da.po: added Danish file

1999-08-31  Miguel de Icaza  <miguel@gnu.org>

	* src/dialogs/dialog-printer-setup.c (do_setup_main_dialog):
	Enable the print-preview buttons.

	* configure.in (have_bonobo): Test for gnome-print 0.5

	* src/print.c (workbook_print): Adapt to the new gnome-print;
	Added support for print preview.

	* src/print-preview.c: New file.  Implements the print preview
	control window.

	* src/functions/fn-financial.c: Add brace to remove ambiguity
	
1999-08-31  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-financial.c: Implemented ACCRINT() and DISC().

1999-08-30  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/dialogs/dialog-paste-special.c: Typo fix.

1999-08-29  Morten Welinder  <terra@diku.dk>

	* src/about.c (dialog_about): Add Ross Ihaka.

	* src/dialogs/dialog-paste-special.c: Typo.

1999-08-29  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-financial.c: Implemented ACCRINTM(), INTRATE(),
 	RECEIVED(), PRICEDISC(), and PRICEMAT().

	* src/func.h, src/functions/fn-date.c: Made get_date public.

1999-08-29  Morten Welinder  <terra@diku.dk>

	* src/functions/fn-lookup.c (gnumeric_indirect): Plug leak.

	* src/format.c (pre_parse_format): Don't overrun string.
	(format_number): Plug leak.

	* src/workbook.c (workbook_do_destroy): Typo.

1999-08-28  Miguel de Icaza  <miguel@gnu.org>

	* src/dialogs/*.glade.h: Make sure every dialog box has updated
	.glade.h and add glade.h generation to the summary, names and
	import glade files.

1999-08-28  Karl Eichwalder  <ke@suse.de>

	* gnumeric.desktop: Sort entries.
	(Name): Add `de'.
	(Comment): Ditto.

	* src/dialogs/dialog-zoom.c (dialog_zoom): Help xgettext to
	recognize the strings as `no-c-format'.
	* src/formats.c: Ditto.
	* src/gnumeric-sheet.c: Ditto.

1999-08-27  Karl Eichwalder  <ke@suse.de>

	* src/workbook.c: Typo.
	* src/workbook.c (sheet_action_delete_sheet): Change messages
	string.
	* src/workbook.c (sheet_action_delete_sheet): Ditto.

1999-08-26  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-financial.c: Implemented ISPMT().
	
1999-08-25  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* samples/finfuns.xls: Fixed the test of MIRR.

	* src/functions/fn-financial.c: Implemented FVSCHEDULE().
	
1999-08-24  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-financial.c: Implemented TBILLEQ() and started
	MIRR().
	
1999-08-23  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/functions/fn-financial.c: Implemented TBILLPRICE() and
 	TBILLYIELD().
	
1999-08-22  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/dialogs/dialogs-solver.c: Fixed a lot of things, memory
 	leaks and bugs.  The backend is still not there (but wait, one of
 	these days it may get there).

	* src/dialogs/dialogs.h, src/dialogs/dialogs-analysis-tools.c:
 	hbox_pack_label_and_entry made public.

	* src/collect.[ch], src/functions/fn-financial.c: Removed
 	collect_dates.  Added a flag COLLECT_DATES to
 	callback_function_collect instead.
	
1999-08-22  Miguel de Icaza  <miguel@gnu.org>

	* src/main.c (gnumeric_main): New Bonobos need to issue the
	bonobo_activate() call.

1999-08-21  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c (workbook_new_with_sheets): Fixed hardcoded
	buffer. 

1999-08-20  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* samples/finfuns.xls: Made all the dates to use DATE() function
	instead of using strings in scandinavian style.
	
1999-08-20  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-financial.c: Made the last two arguments of PMT and PPMT
 	optional.
	
1999-08-20  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-financial.c: DDB() implemented.

	* src/fn-stat.c: QUARTILE() implemented.
	
1999-08-20  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* po/de.po: Removed the last bogus msgid to make it compile again.

	* src/sheet.c (sheet_insert_object): Added #if ENABLE_BONOBO to
 	make it compile without BONOBO.

	* src/gnumeric-sheet.c (gnumeric_sheet_drag_data_get): Ditto.

	* src/collect.[ch]: Wrote collect_dates and collect_dates_value.

	* src/fn-financial.c: DB() and XNPV() implemented.  DOLLARDE() and
 	DOLLARFR() fixed.

	* src/fn-date.c, src/func.h: get_serial_date made public.

	* TODO: Killed the four functions above from the todo list.
	
1999-08-19  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c (workbook_container_get_object): Finish
	implementing this routine for responding to monikers.
	(create_graphic_cmd): temporarily bind this to
	Generic Bonobo object insertion.
	(cb_sheet_check_dirty): Make the dialog parent be the workbook
	window. 

	* src/workbook.h (Workbook): Include a GnomeUIHandler.
	
	* src/sheet.c (sheet_insert_object): Enable this function again
	and update it to match the latest Bonobo developments.

	* src/sheet.h (Sheet): Include a pointer to the active object
	frame. 

	* src/sheet-object.c (sheet_set_mode_type): Do deactivation of
	Bonobo frames here.

	*  src/gnumeric-sheet.c (gnumeric_drag_data_get): Beginning of
	drag and drop support for Bonobo monikers.

	* src/item-grid.c (drag_start): More DnD support for Gnumeric
	selections using Monikers.

	* src/sheet-object-container.c (user_activation_request_cb,
	view_activated_cb, get_file_name): New routines for dealing with
	the Bonobo object action in Gnumeric.

	(sheet_object_container_land): Do object selection here for now.
	Support both PersistStream and PersistFile

	* src/sheet-object.c: 

	* src/workbook.c (cb_sheet_check_dirty): Bind the dialog to the
	main window.

1999-08-20  Michael Meeks  <michael@imaginator.com>

	* src/cell.c (cell_set_text_simple): Add checks for over/under
	flow on integer reading... fall back to double values.

1999-08-19  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/cell.c (cell_content_changed): Ok, Paolo corrected me.  This
	is not what he wanted.  

1999-08-16  Michael Meeks  <michael@imaginator.com>

	* src/fn-lookup.c (gnumeric_indirect): Fix leak
	Update to use new cellref_*_get functions.

	* src/parser.y (return_cellref): Use new function.

	* src/sheet.c (cellref_get): Implemented
	(cellref_a1_get): Snarf from parser.y :-)
	(cellref_r1c1_get): Implemented.

1999-08-17  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/workbook.c (workbook_class_init): Added cell_content_changed
	signal.  
	(workbook_do_destroy): Do not enable widgets to be focused.

	* src/cell.c (cell_content_changed): Calls workbook_cell_changed.
	This is for Paolo and his speech system for GNOME.
	
	* configure.in: New bonobo detection code and support for not
	compiling Bonobo support even if it is present on the system
	
1999-08-17  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* samples/statfuns.xls: Updated the tests of LINEST and TREND to
	cover more possible cases.

1999-08-15  Jody Goldberg <jgoldberg@home.com>

	* src/format.c (split_time) : Use a integer to avoid problems with
	  rounding when compiling with optimization.  Be extra careful to
	  round the result of the initial scaling.

	* src/sheet-view.c (vertical_scroll_event, horizontal_scroll_event) :
	  Only move and append to the selection if the cursor actually moves.

	* src/dialog-function-wizard.c (arg_data_list_new) : Constness.

	* src/expr.c (eval_expr_real) : Add OPER_PERCENT.
	(do_expr_decode_tree) : Ditto.
	(expr_dump_tree) : Ditto.

	* src/expr.h : Ditto.

	* src/parser.y : Add function build_unary_op, and support
	  exp '%'.  Precedence is a GUESS.

1999-08-16  Michael Meeks  <michael@imaginator.com>

	* src/widget-editable-label.c (el_start_editing): Remove
	GTK_WIDGET_SET/UNSET_FLAGS (GTK_CAN_FOCUS): broken for
	scrolling notebooks.
	(el_stop_editing): ditto.

	* src/workbook.c (workbook_setup_sheets): remove
	unset FOCUS on notebook.

1999-08-15  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-stat.c: Implemented TREND (mostly).  Made the second
 	argument of LINEST optional.

1999-08-15  Jody Goldberg <jgoldberg@home.com>

	* src/expr.c (eval_expr_real) : Don't free empty cells
	  in OPER_CONCAT.

1999-08-14  Jody Goldberg <jgoldberg@home.com>

	* src/clipboard.c (clipboard_release) : Use the original
	  row/col to calculate offsets when pasting cells that relocate
	  references.
	(clipboard_copy_cell_range) : Handle relocation.

	* src/expr.c (do_expr_decode_tree) : Duplicate the error message
	  because someone is going to free it.
	(expr_relocate) : New Function.

	* src/cell.c (cell_relocate) : Use expr_relocate.
	(cell_copy) : Don't NULL out the row/col/sheet
	  in the copied cell.  It gets reset on entry and is useful
	  information.
	(paste_cell) : Handle relocate.
	(clipboard_copy_cell_range) : Ditto.

	* cell.h : Differentiate CELL_COPY_TYPE_CELL into
	CELL_COPY_TYPE_CELL_ABSOLUTE or CELL_COPY_TYPE_CELL_RELATIVE,
	to deal with cut vs paste.

	* src/sheet-autofill.c : Use cell_relocate to test for out of bounds.

1999-08-14  Jody Goldberg <jgoldberg@home.com>

	* src/workbook.c (wb_edit_key_pressed) : Support F4 toggling
	  abs/relative.

	* src/expr.h : Constify FunctionDefinition.

	* src/fn-information.c : Use 'Red' instead of 'red' to match XL.

	* src/func.c (function_get_category, fn_def_init,
		      function_add_nodes, function_add_args) : Constify.

1999-08-15  Morten Welinder  <terra@diku.dk>

	* src/fn-stat.c (gnumeric_frequency): Fix leak (bin_array).  Fix
 	leak (data_cl.entries).  Fix leak (bin_cl.entries).  Fix leak
 	(floats for data).  Fix leak (floats for bins).  Fix leak (count).
	(gnumeric_linest): Simplify.
	(gnumeric_intercept): Simplify.
	(gnumeric_slope): Simplify.
	(gnumeric_forecast): Simplify.

	* src/collect.c (collect_floats_value): Make non-static.
	(float_range_function2): Plug leak.

	* src/Makefile.am (GNUMERIC_BASE_SOURCES): Add regressions.[ch].

	* src/style.c (style_font_unref): Fix obsolete warning.

1999-08-12  Kjartan Maraas  <kmaraas@online.no>

	* src/fn-math.c: Typo fixes.
	
1999-08-12  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-stat.c: Implemented the simplest case of LINEST()
 	function.
	
1999-08-12  Jody Goldberg <jgoldberg@home.com>

	* src/fn-date.c (gnumeric_date) : Fix typo that was moving us 1900
	  years into the future.

	* src/formats.c (cell_format_numbers) :  Use 'Red' rather than 'red'
	  to match XL better.

1999-08-11  Jody Goldberg <jgoldberg@home.com>

	* src/gnumeric-sheet.c ( move_cursor_horizontal, move_cursor_vertical,
	  move_horizontal_selection, move_vertical_selection,
	  selection_cursor_move_horizontal, selection_cursor_move_vertical) :
	  selection_expand_horizontal, selection_expand_vertical) :
	  Support Ctrl-Arrow which jumps to the boundaries of non-blank
	  ranges.

	* src/sheet.c (sheet_find_boundary_vertical,
	  sheet_find_boundary_horizontal) :  New functions, to find the start
	  and end of ranges.  They also ensure that the corner which was moved
	  stays visible.
	(sheet_selection_extend_vertical) : Use sheet_find_boundary_vertical.
	(sheet_selection_extend_horizontal) : Use sheet_find_boundary_horizontal.

1999-08-11  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-string.c: Fixed the rounding of DOLLAR() function.

	* src/fn-financial.c: Some minor cleaning.

	* src/func.h: Added prototypes for callback_function_make_list.
	
	* src/fn-stat.c: Fixed PROB() function.

1999-08-11  Michael Meeks  <michael@imaginator.com>

	* plugins/text/text-io.c: Prototypes updated.

1999-08-11  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* TODO: Updated the remaining work of build-in functions.

	* src/fn-stat.c: Implemented FREQUENCY().

1999-08-09  Miguel de Icaza  <miguel@gnu.org>

	* src/xml-io.c (xml_workbook_write): Handle locale switching here.
	(xml_workbook_read): Handle locale switching here.

	* src/file.c: Removed all references to saving and re-setting the
	locale.  This should be handled in the xml-io code.

1999-08-10  Miguel de Icaza  <miguel@gnu.org>

	* src/workbook.c (workbook_do_destroy): remove g_free from the
	workbook.  We are now a GtkObject.

1999-08-09  Miguel de Icaza  <miguel@gnu.org>

	* src/xml-io.c (xml_workbook_write): Move the locale
	setting/resetting here, instead of putting it all over the place.

1999-08-09    <miguel@gnu.org>

	* src/xml-io.c (xml_workbook_read): Adjusted to use the new file
	open convention.

	* src/file.h: File open methods now take a workbook as an argument
	instead of creating it themselves.  Required for the
	GNOME::Persist bonobo interfaces.

	* src/file.c (workbook_read): Fix the workbook creation order to
	keep the locale correct if the file did not exist.

1999-08-10  Morten Welinder  <terra@diku.dk>

	* src/workbook.c (workbook_do_destroy): Don't free the workbook
 	ourselves.

1999-08-10  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* samples/statfuns.xls: Updated the tests of functions returning
	array values.

	* samples/dbfuns.xls: Added a test for GETPIVOTDATA function.
	Also added a very simple pivot table.
	
1999-08-10  Michael Meeks  <michael@imaginator.com>

	* TODO, DEPENDS, doc/Future-Roadmap, doc/Design: Updated,
	and added short plugin design section.

	* doc/saving.txt: Added short section on Summary Information.

1999-08-10  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-math.c: Finished ROMAN().  Gnumeric now supports all the
 	60 mathematical functions of Excel 2000.

1999-08-10  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-math.c: Added MDETERM().

1999-08-09  Michael Meeks  <michael@imaginator.com>

	* src/workbook.c (workbook_class_init): Moved hack to workbook.h,
	and removed comment.

1999-08-09  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/fn-math.c: Added MINVERSE().

1999-08-09  Michael Meeks  <michael@imaginator.com>

	* src/sheet.c (sheet_cell_add): Optimise by checking last
	element of the list for a simple append before calling
	g_list_insert_sorted. CRowSort took up way too much time in my
	profile :-). [ This fix is quite temporary ]

	* src/workbook.c (workbook_init): Conditionaly compile bonobo
	specific code.
	(workbook_class_init): Grotesque hack so it compiles.

1999-08-08  Jacob Berkman  <jberkman@andrew.cmu.edu>

	* src/workbook.c: use smaller menu stock icon instead of large one

1999-08-06  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/xml-io.c (xml_write_summary): I think this is the correct
	fix.  We should not add childs if no summary info is available.

	* src/corba-sheet.c (Sheet_cell_set_font): Use the standard
	procedure to set the font.

	* src/cell.c: deleted finally cell_set_font.

	* src/workbook.c: Reorganization to make the code be a GtkObject.
	Redone the destruction bits of the Workbook.

	* src/workbook.h: Split sheet.h into workbook.h and sheet.h

	* src/workbook.h: Now the Workbook is a GtkObject or a
	GnomeObject, depending on the compilation flags.

1999-08-05  Morten Welinder  <terra@diku.dk>

	* src/dialog-printer-setup.c (dialog_print_info_destroy): Plug
 	leaks.

	* src/print-info.c (hf_format_render): Plug leak.
	(render_opcode): Constify.

	* src/item-cursor.c (item_cursor_autofill_event): Don't unref, but
 	destroy.  We no longer own the ref.

1999-08-05  Michael Meeks  <michael@imaginator.com>

	* src/file.c (workbook_import): Fix control flow to have 1 return.
	fix leak.

1999-08-05  Jody Goldberg <jgoldberg@home.com>

	* src/func.c (function_get_category) : Lookup/store in sorted list.

1999-08-05  Morten Welinder  <terra@diku.dk>

	* src/cell.c (cell_set_font): Obsolete -- #if 0 for now.

	* src/cell.h: Remove now-static cell_formula_changed,
 	calc_text_dimensions, and cell_set_font.

	* src/dialog-analysis-tools.c (add_output_frame): Plug leak.

1999-08-05  Michael Meeks  <michael@imaginator.com>

	* src/file.c (workbook_import): Major hacks to get round quirks
	in libglade.

	* src/import.glade: Add label to the container.

1999-08-04  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/cell.c (calc_text_dimensions): Made static.
	(queue_cell): Killed dependency_deep_frozen routines, this was
	archaic code. 
	(cell_formula_changed): Made static.

	* src/sheet-autofill.c (autofill_register_list): Make static.

1999-08-03  Michael Meeks  <michael@imaginator.com>

	* src/workbook.c (workbook_setup_edit_area): Removed function
	wizard.

1999-08-03  Miguel de Icaza  <miguel@gnu.org>

	* src/corba-sheet.c (fill_corba_value): Corrected the argument here.
	
1999-08-03  Jody Goldberg <jgoldberg@home.com>

	* src/plugin.h (struct) : 'private' is a C++ keyword.

	* src/sheet.h : Add GHashTable *dependency_hash to sheet.

	* src/sheet.c (sheet_destroy) : Clear dependency_hash.

	* src/eval.c (dependency_hash_init) : dependency_hash sheet specific.
	(add_cell_range_dep) : Ditto.
	(cell_add_dependencies) : Ditto.
	(cell_drop_dependencies) : Ditto.
	(region_get_dependencies) : Ditto.
	(cell_get_dependencies) : Ditto.
	(add_cell_range_dep) : Increment ref_count AFTER looking for duplicates.

	* src/workbook.c (workbook_do_destroy) : Add some debugging code to
          catch dangling dependancies.

1999-07-27  Miguel de Icaza  <miguel@gnu.org>

	* src/corba-workbook-factory.c (WorkbookFactory_read): Duplicate
	CORBA Object server here.
	(WorkbookFactory_create_object): and here.

1999-08-03  Robert Brady  <rwb197@ecs.soton.ac.uk>
 
        * gnumeric.spec.in, README: require gnome-print 0.3 or greater.
	(BUGFIX #1829)

1999-08-02  Morten Welinder  <terra@diku.dk>

	* src/expr.c (eval_expr_real): Handle integer operations more
 	carefully with respect to overflow.

	* src/cell.c (cell_cleanout): Don't unlink unless there is a sheet
 	to unlink from.

	* src/collect.c (float_range_function2): Actually call the right
 	function.
	(collect_floats_value): Fix type of result.

	* src/mathfunc.c (range_rsq_pop, range_rsq_est): New functions.

	* src/fn-stat.c (gnumeric_pearson): Simplify.
	(gnumeric_rsq): Simplify.

1999-08-02  Jody Goldberg <jgoldberg@home.com>

	* src/fn-information.c (gnumeric_n) : Fix boolean support.

	* src/corba-sheet.c: Correct previous typo.

1999-08-02  Elliot Lee <sopwith@redhat.com>

	* gnumeric.spec.in: Fix the .spec file to include correct
 	documentation pieces.

	* doc/C/Makefile.am: Work with builddir != srcdir

	* plugins/lotus-123/Makefile.am: boot.h not needed. lotus-types.h is.

	* plugins/xbase/Makefile.am: boot.h not needed.

	* po/Makefile.in.in: v3

	* src/corba-sheet.c: Use a compilable thing for error string.

1999-08-02  Morten Welinder  <terra@diku.dk>

	* src/expr.c (eval_expr_real): Plug leak...

1999-08-02  Jody Goldberg  <jgoldberg@home.com>

	* src/expr.c (eval_expr_real): Fix bool <-> number comparisons to match
          excel approach.  TRUE&FALSE > numbers.

	* src/item-bar.c (item_bar_event) : Button3 should select the
          current row/col before bringing up the edit menu.

	* src/sheet.c (sheet_cell_foreach_range) : return NULL not FALSE
          on precondition failure.

	* src/value.[ch] : Add value_area_foreach

	* src/fn-date.c (gnumeric_networkdays) : Correct the modulo for
          weekends and add support for holidays via value_area_foreach.

	* src/sheet.c : Correct some documentation

1999-08-01  Jody Goldberg  <jgoldberg@home.com>

	* samples/operator.xls : Test workbook for operators.

	* src/Gnumeric.idl : Add VALUE_ERROR, VALUE_BOOLEAN, VALUE_EMPTY
          in a few more places
	* src/fn-lookup.c : Ditto.
	* src/fn-math.c : Ditto.
	* src/fn-stat.c : Ditto.
	* src/fn-string.c : Ditto.
	* src/dialog-cell-sort.c : Ditto.
	* src/corba-sheet.c : Ditto.

	* src/fn-eng.c : Support VALUE_BOOLEAN and simplify comparison logic in
          DELTA and GESTEP.

	* src/expr.c (compare_bool_bool) : New function.
          (compare_int_int, compare_float_float) : Take (Value *) and do cast
          internally.
	  (is_null_string) : Rename to value_is_empty_cell, support VALUE_EMPTY.
            and move to src/value.c.
	  (compare) : Rework to bring into closer compliance with XL.
          (expr_eval_real) : Ditto, replace 'Type [Mm]ismatch' with '#!VALUE'.
          use eval_expr rather than eval_expr_real for arithmetic binary
	  operators.  Use value_get_as_float rather than value_cast_to_float.
          (eval_expr) : Remap 'VALUE_EMPTY' to int(0)

	* src/value.h : Adjust enumeration so that BOOLEAN < INTEGER < FLOAT
	    remove value_cast_to_float

	* src/value.c (value_get_as_*) : Support NULL values.
	  (value_cast_to_float) : Remove.

	* src/sheet.c (sheet_cell_formula_unlink) : Add precondition to handle
          problems using deleted cells.

1999-08-01  Morten Welinder  <terra@diku.dk>

	* src/fn-stat.c (gnumeric_covar, gnumeric_correl): Simplify using
 	range functions.

	* src/workbook.c (file_open_cmd): Plug leak.

	* src/mathfunc.c (range_covar, range_correl_pop,
 	range_correl_est): New functions.

	* src/collect.c (collect_floats_value, float_range_function2): New
 	functions.

1999-08-01  Michael Meeks  <michael@edenproject.org>

	* src/workbook.c (workbook_setup_sheets): Added comment about making
	workbook sheets' notebooks scrollable.

	* src/fn-database.c (gnumeric_dmin, gnumeric_dmax, gnumeric_daverage):
	Only use the value if it is a number.
	(find_column_of_field): Use g_strcasecmp instead of strcmp.
	(criteria_test_equal, unequal): ditto; test this.

	* src/fn-information.c (gnumeric_cell): Changed broken cell_fetch's
	to cell_gets.

1999-08-01  Jody Goldberg  <jgoldberg@home.com>

	* src/fn-date.c (get_serial_date): Constify.  Improve handling of
 	date_serial 0.
	(gnumeric_networkdays): Add partial implementation.  (MW: turned
 	off.)

	* src/eval.c (add_value_deps): Handle empty value.

	* src/collect.c (callback_function_collect): Ignore empty values.

	* src/gnumeric-sheet.c (gnumeric_sheet_key_mode_sheet) : Support
	<C-PgUp> <C-PgDown> moving through the sheets.

	* src/Gnumeric.idl : Add VALUE_ERROR, VALUE_BOOLEAN, VALUE_EMPTY
	in a few more places.

	* src/corba-sheet.c : Ditto.

	* src/value.c (value_new_empty): New function.
	(value_dump, value_copy_to, value_get_as_bool,
 	value_get_as_string, value_get_as_int, value_get_as_float): Handle
 	empty value.

1999-08-01  Morten Welinder  <terra@diku.dk>

	* src/expr-name.c (expr_name_add): Fix bogus check.
	(expr_name_remove): Abort until someone fixes this.

	* src/style.c (style_font_unref): Unref the font.

	* src/expr.c (eval_expr_real): Fix OPER_CONCAT case.  From Jody.

	* src/value.c (value_cast_to_float): FMR fix from Jody.

1999-08-01  Manish Vachharajani  <mvachhar@vger.rutgers.edu>

	* src/sheet-object-container.c: fix reference to
	gnome_client_site_bind_bonobo_object to read
	gnome_client_site_bind_embeddable

1999-08-01    <jrb@redhat.com>

	* src/workbook.c: move the about-entry lower to make it more
	consistent with the rest of GNOME.

1999-08-01  Morten Welinder  <terra@diku.dk>

	* src/format.c (format_number): YAL -- yet another leak.

	* src/fn-string.c (gnumeric_text): Plug leak.

	* src/expr.c (do_expr_tree_unref): Plug array value leak.

	* src/cell.c (cell_set_array_formula): Unref the wrappers so we
 	don't leak a reference.

	* src/fn-math.c (gnumeric_countif): Initialise total_num member.

1999-07-31  Morten Welinder  <terra@diku.dk>

	* src/fn-database.c (free_criterias): Plug massive leak.
	(parse_database_criteria): Plug leak.
	(parse_criteria): Constify.
	(find_column_of_field): Plug leak.
	(parse_database_criteria): Plug leak.
	(gnumeric_dproduct): Plug leak.
	(gnumeric_dvar): Plug leak.
	(gnumeric_dmin): Plug leak.
	(find_column_of_field): Plug leak.

	* src/fn-math.c (gnumeric_seriessum): Plug leak.
	(gnumeric_subtotal): Plug leak.

	* src/fn-lookup.c (gnumeric_address): Fix memory corruption.

1999-07-31  Robert Meeks   <robert@imaginator.com>

	* src/fn-information.c (translate_table): Populated.
	
1999-07-31  Michael Meeks  <michael@edenproject.org>

	* src/fn-information.c (gnumeric_cell): Implemented col, row,
	address, contents. Start of format.
	(translate_cell_format): Start of format translation.

1999-07-31  Morten Welinder  <terra@diku.dk>

	* src/fn-logical.c (gnumeric_if): Fix case of first argument
 	yielding an error.

	* src/expr.c (expr_dump_tree): Constify.

	* src/func.c (function_iterate_do_value): Fix behaviour of strict
 	functions.

	* src/expr.c (do_expr_tree_invalidate_references): Handle
 	VALUE_BOOLEAN and VALUE_ERROR.
	(eval_expr_real): Make comparisons strict.

	* src/summary.c (summary_info_free): Fix leak.
	(summary_item_free): Fix leak.

	* src/fn-misc.c (gnumeric_iserror): Fix leak.
	(gnumeric_error_type): Fix leaks.
	(gnumeric_isna): Fix leak.
	(gnumeric_iserr): Fix leak.

	* src/fn-information.c (get_value_class): Fix leak.

1999-07-31  Michael Meeks  <michael@edenproject.org>

	* src/fn-information.c (gnumeric_isref): Implemented.

1999-07-30  James Youngman  <jay@gnu.org>

	* src/fn-eng.c (gnumeric_besseli): Implemented.
	(gnumeric_besselk): Implemented.
	(eng_functions_init): Add relevant inits.
	Include mathfunc.h

1999-07-30  Morten Welinder  <terra@diku.dk>

	* src/cell.c (cell_cleanout): New function.
	(cell_set_formula): Don't bother with CELL_ERROR.  Set value field
 	in all cases.
	(cell_set_array_formula): Set cell values.
	(cell_set_value_simple): Simplify using cell_cleanout.
	(cell_set_text_simple): Ditto.
	(cell_set_formula_tree_simple): Ditto.
	(cell_destroy): Ditto.
	(cell_get_text): Simplify.
	(cell_get_content): Ditto.

	* src/eval.c (cell_eval): Reorganise slightly.

	* src/expr.c (eval_expr_real): value should no longer be null.

	* src/cell.h (CELL_ERROR): Obsolete.

	* src/print-info.h (hf_formats): Make extern.

	* src/summary.h (summary_item_name): Make extern.

1999-07-29  Michael Meeks  <michael@edenproject.org>

	* src/cell.c (cell_set_text_simple): Chomp whitespace off the
	end of integers ( other spreadsheets do this ).

1999-07-28  Michael Meeks  <michael@edenproject.org>

	* src/summary.c: Update, was out of step with the header.

1999-07-28  Michael Meeks  <michael@edenproject.org>

	* src/item-grid.h: Added border_gc[BORDER_MAX] to ItemGrid.

	* src/item-grid.c (item_grid_draw_cell): Border rendering code.
	Make rendering conditional on debug - this looks awful.
	(item_grid_realize): ditto + struct of types in style_border_data.
	(item_grid_unrealize): clean up after myself.

1999-07-27  Jody Goldberg  <jgoldberg@home.com>

	* src/fn-date.c : Add EOMONTH, and partial WORKDAY.

	* src/formats.c : Add more date formats.

	* src/fn-math.c (gnumeric_transpose) : no need for an array
          if the input is a singleton.

	* src/expr.c : Add comment explaining the need for a re-org
          to correctly handle implicit intersetion vs arrays with
          operators.  Move all value_* functions into.

	* src/value.c : Here.

	* src/func.c : Move const value initialization into value.c.

	* src/clipboard.c (clipboard_prepend_cell) : Return Value * as per
          change to VALUE_ERROR.

	* src/style.h : Add STYLE_ORIENT_MAX to remove ugly magic number
          that will change when we add support for diagonals.

	* src/print-cell.c (print_cell_border, print_border) : Use enum
	  rather than hard coding the number of border types.

	* TODO : Add implicit intersection for operators.

1999-07-25  Jody Goldberg  <jgoldberg@home.com>

	* plugins/guile/plugin.c,
	  plugins/python/python.c
	  src/{Makefile.am, cell.[ch], collect.[ch], eval.c, expr-name.c,
	       expr.[ch], fn-database.c, fn-date.c, fn-eng.c, fn-financial.c,
	       fn-information.c, fn-logical.c, fn-lookup.c, fn-math.c,
	       fn-misc.c, fn-sheet.c, fn-stat.c, fn-string.c, format.c,
	       func.[ch], sheet-object-container.c, sheet.[ch]}
	  : Add VALUE_ERROR, VALUE_BOOLEAN, Change many signatures to return
	    Value for errors.

	* icons/chart_*.png : Add Some images in preparation for re-enabling
	  the graph wizard.

	* src/expr.c (eval_funcall) : When a single row or column is passed to
	  a function expecting a single value, take the intersection of the
	  evaluation position and the range.
	(cell_ref_get_abs_col, cell_ref_get_abs_row) : New functions.

	* src/value.[ch] : New files with Value support routines split out from
	  expr.[ch]

1999-07-26  Michael Meeks  <michael@edenproject.org>

	* src/corba-sheet.c (fill_corba_value): Remove redundant Sheet *
	from cellref_name.

1999-07-26  Michael Meeks  <michael@edenproject.org>

	* src/xml-io.c (xml_read_cell): Commented out freeze/thaw deps.

	* src/cell.c (cell_deep_freeze_dependencies): Added warning not to
	use: strangely it doesn't work... investigate later.

1999-07-25  Michael Meeks  <michael@edenproject.org>

	* src/xml-io.c (xml_read_cell): Add freeze/thaw dependencies,
	and fix exit condition to restore state to correct coolness.

	* src/cell.h: Added prototypes.

	* src/cell.c (cell_content_changed, cell_formula_changed): 
	(cell_deep_thaw_dependencies, cell_deep_freeze_dependencies): 
	Added optimisation for load/save stuff.

1999-07-25  Michael Meeks  <michael@edenproject.org>

	* src/xml-io.c (xml_read_summary): Fix some massive cock-ups, how
	did this ever work.
	(xml_read_names): ditto.
	(xml_workbook_read): Shifted read_names down to where we actualy
	have the inter-sheet reference names in place.

	* src/expr.c (expr_tree_invalidate_references): Debugging that
	needs cleaning to new PP stuff #if-def'd out.
	(expr_tree_fixup_references): ditto.

	* src/xml-io.c (xml_write_names, xml_read_names): Implemented
	(xml_workbook_write, xml_workbook_read): Hooks added, but reading
	disabled: something dodgy somewhere.

	* src/sheet.c (sheet_lookup_by_name): Fixed to use simply a
	Workbook pointer.

	* src/workbook.c (workbook_set_auto_expr): Fix old hack using
	new PP stuff.

	* src/sheet.c (sheet_fill_selection_with): Updated to new PP code.

	* src/parser.y (gnumeric_expr_parser): Updated to new PP code,
	removed redundant and nasty _unsafe_expr_parser hack. Essentialy
	nothing new, but removes daft parser_sheet and replaces with
	parser_workbook, leaving sheet stuff to the evaluation stage.

	* src/dialog-define-names.c: Major fixups, killed obscure bug
	cause by freeing a copy of a list I passed to gtk_list_append_items.

	* src/expr.c (expr_parse_string, do_expr_decode_tree): 
	(expr_decode_tree): Updated to new 

	* src/expr-name.c (expr_name_create): Added for convenience.
	(expr_name_value): Updated to new PP scheme

	* src/cell.c (cell_set_formula, cell_get_text, cell_get_content): 
	Update to new ParsePosition scheme.

	* src/expr.c (parse_pos_init, parse_pos_cell): Created.

	* src/expr.h: Add ParsePosition & prototpes

1999-07-25  Michael Meeks  <michael@edenproject.org>

	* src/dialog-define-names.c (update_edit): use expr_name_value.
	(grab_text_ok): Update to use new functions.

	* src/expr-name.c (expr_name_value): Added.
	(expr_name_create): Convenience function

	* src/xml-io.c (xml_workbook_write): Added names writing.

1999-07-24  Michael Meeks  <michael@edenproject.org>

	* src/expr-name.c (expr_name_add): Add check for circular
	references in (name_refer_circular): created.
	(add_real): More paranoia.

1999-07-23  Michael Meeks  <michael@edenproject.org>

	* src/expr-name.c (expr_name_list): Expand.
	(expr_name_remove): Serious bug freeing names.
	(expr_name_lookup): precondition.
	(expr_name_remove): more sanity checks.

	* src/dialog-define-names.c (fill_list): Append instead of inserting
	items. use "select" signal, hand the correct pointer on.
	Implemented guts, fixed lots of bugs.
	
1999-07-25  Karsten Weiss  <karsten@addx.au.s.shuttle.de>

	* src/print.glade.h: Fixed three typos.
	* src/hf-config.glade.h: Fixed a typo.
	Is this the right place to fix the typos or are they auto-generated
	from some other source?
	
1999-07-21  Miguel de Icaza  <miguel@gnu.org>

	* src/dialog-printer-setup.c (preview_page_destroy): Clear the
	pointers after unrefing.

	* src/print.c (setup_rotation): Add the rotation code for the
	vertical/horizontal printing.

1999-07-22  Michael Meeks  <michael@edenproject.org>

	* src/dialog-define-names.c (dialog_define_names): Removed all the
	dead code.
	Lots of new code ... not there yet though.
	
	* src/workbook.c: Enabled names menu item.

	* src/dialog-summary.c: add file header.

	* src/Makefile.am (glade_DATA): Added summary.glade and names.glade
	seems I didn't do this earlier: odd.

	* names.glade: Created.
	
1999-07-22  Michael Meeks  <michael@edenproject.org>

	* src/expr-name.c: Stylistic precondition fixes,
	simplification & workbook integration.

	* src/workbook.c (workbook_core_new): init names.
	(workbook_do_destroy): add name clean.

	* src/sheet.h: Add Workbook->names.

	* src/func.h: Added comments moved from expr.h

1999-07-21  Richard Hestilow  <hestgray@ionet.net>
	
	* gnumeric.gnorba: Fix "Embeddable" typo 
	(was IDL:/GNOME/Embeddable, should have been IDL:GNOME/Embeddable)

1999-07-21  Michael Meeks  <michael@edenproject.org>

	* src/widget-font-selector.c (fs_init): Convert g_error to
	g_warning on missing glade_xml_new.

	* src/Makefile.am (GNUMERIC_CORBA_GENERATED): Make this empty
	if BONOBO is not installed, should kill peoples Gnumeric.idl
	problems with luck.

	* configure.in: Add lotus-123

	* plugins/Makefile.am: ditto.

	* src/main.c: Remove xbase include.

1999-07-20  Jody Goldberg  <jgoldberg@home.com>

	* src/expr.c (value_area_fetch_x_y) : make value_zero local.
	(eval_expr) : renamed eval_expr_real, and allowed it to return NULL
	  in all the places that make sense.
	(eval_expr) : New function.  Calls eval_expr_real and returns 0 on
	  NULL with no error set.  Until VALUE_ERROR is in place things
	  will look funny.

1999-07-20  Miguel de Icaza  <miguel@gnu.org>

	* src/item-bar.c (bar_draw_cell): Move the dimension computaiton
	of the font after we have figured which font to use.  Before we
	did all the computaiton based on the default font, which is not
	always the font used (we use bold font for selected rows).

	This fixes the bug Morten reported.

1999-07-20  Jody Goldberg  <jgoldberg@home.com>

	* src/fn-math.c : Moved gpow10 from here.
	* src/utils.[ch] : to here.

	* src/expr.c (value_area_get_x_y) : return NULL in all cases of
	  invalid refernces dont fake a 0.
	Rename TYPE_ERROR -> TYPE_MISMATCH.
	(is_null_string) : New function.
	(compare) : Allow equality tests between empty/error things too.
	(eval_expr) : Allow comparisons of empty/error values.  It can handle
	  it now.
	(OPER_ARRAY) : Use value_area_get_x_y not fetch_x_y, handle empty/error.
	(value_get_as_string) : Fix typo in recent unlogged change.  The change
	  might break importing files from a different locale.

	* src/fn-string.c : Add TEXT, improve VALUE, REPLACE so that they
	  passes more tests.

	* src/number-match.c (compute_value) : Partial support for thousands
	  separator.  Why doesn't this code use locale ?

	* src/format.c (format_value) : better support for ranges, attempt to
	  work around problem of a thousands seperator in a date format.

	* src/cell-draw.c (cell_draw) : Fix potential for infinite loop
	  with HALIGN_FILL.
	* src/print-cell.c (print_cell_text) : Ditto.

	* src/parser.y (make_string_return) : A string of the form "..." is
	  a string, don't try to parse it as a number.

	* src/pattern-selector.[ch] : pattern_selector_select made static. In
	  preparation for different approach.

1999-07-19  Andreas Voegele <andreas.voegele@gmx.de>

	* src/parser.y (gnumeric_unsafe_expr_parser): Use the locale to
	figure out the correct separator

	* src/file.c (workbook_read): According to the GNU libc
	documentaiton retrieving the current locale should be done by
	passing NULL to setlocale as the locale argument.

1999-07-17  Michael Meeks  <michael@edenproject.org>

	* src/workbook.c (workbook_setup_edit_area): Enabled function
	wizard.

1999-07-16  Michael Meeks  <michael@edenproject.org>

	* src/summary.c (summary_item_as_text): Implemented.
	(summary_item_dump): Simplified.

	* src/xml-io.c (xml_write_summary, xml_read_summary): Created.
	(xml_workbook_read, xml_write_summary): Added summary stuff.

1999-07-17  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* doc/C/analysis-tools.sgml: Added documentation of anova, single
 	factor tool.

1999-07-14  Miguel de Icaza  <miguel@gnu.org>

	* src/fn-misc.c (gnumeric_error): Fixed usage of errors with the
	non-broken setup.

	* src/expr.c (error_message_set): Rewrote the error message logic
	to be clean and clear.  Simplified and followed the Gnumeric
	coding conventions.

1999-07-15  Michael Meeks  <michael@edenproject.org>

	* src/summary.c (summary_info_add): Add duplicate entry removal.
	Re-organised structures and enum for convenience.
	(summary_info_as_list, append_item): Created.
	(summary_item_dump): Made static.
	include stdio.h
	Add 'Category' and 'Manager'

	* src/workbook.c (summary_cmd): Create.
	Add 'Su_mmary' to file menu.

	* dialogs.h: Added summary_update.

	* src/Makefile.am (GNUMERIC_BASE_SOURCES): Add dialog-summary.c	

	* dialog-summary.c: Created.

	* summary.glade: Created.
	
1999-07-13  Jody Goldberg  <jgoldberg@home.com>

	* src/fn-lookup.c (gnumeric_lookup) : Support default args for
	  width & height.  Return cell_value directly for 1x1 results.
	(gnumeric_hyperlink) : Add stub.

	* src/expr-name.[ch] (expr_name_add, expr_name_lookup) : Const.

	* src/parser.y (make_string_return) : Handle special case of "" avoid
	  turning it into a number.

1999-07-13  Michael Meeks  <michael@edenproject.org>

	* src/Makefile.am (GNUMERIC_BASE_SOURCES): add summary.[ch]

	* src/workbook.c (workbook_core_new): Hook in summary info.
	(workbook_do_destroy): ditto.
	(deps_output): debugging hook.

	* src/sheet.h: Added SummaryInfo to Workbook.

	* src/summary.[ch]: Added.

1999-07-11  Michael Meeks  <michael@edenproject.org>

	* src/cell-draw.c (cell_draw): Added handy debug for when
	cell->text is duff.

1999-07-13  Morten Welinder  <terra@diku.dk>

	* src/fn-string.c (gnumeric_search): Actually start search where
 	advertised.
	(gnumeric_value): Try harder.

	* src/style.c (font_init): Print informative message instead of
 	just aborting.
	(style_shutdown): Remove old code.

	* src/mathfunc.h: Work around Irix incompatibility.

1999-07-13  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/dialog-analysis-tools.c, src/analysis-tools.c: Implemented
 	Anova, single factor tool.

	* src/dialog-analysis-tools.c, src/analysis-tools.c: Implemented
 	Anova, two-factor without replication tool.
	
1999-07-12  Miguel de Icaza  <miguel@nuclecu.unam.mx>

	* src/print-info.c (save_hf, print_hf_register): Save the headers
	and footers.  Implement registration of new formats.

	* src/dialog-printer-setup.c (do_hf_config): Added the editing
	facility to the formats.

1999-07-12  Jody Goldberg  <jgoldberg@home.com>

	* src/Gnumeric.idl : Add SplitsArray array exception for array-formula
	  support.

	* src/cell.[ch] (cell_set_border) : Const.

	* src/expr.[ch] (value_area_get_width, value_area_get_height) : Const.

	* src/fn-math.c : Added TRANSPOSE.

	* wizards/graphics/*.c : Minor text tweaks so that things come closer
	  to compiling.

1999-07-12  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* doc/C/analysis-tools.sgml: Small fixes and additions.
	
	* src/dialog-analysis-tools.c, src/analysis-tools.c: Added
 	Bernoulli distribution to the Random Number Generation tool.

	* src/analysis-tools.c: Finished Rank and Percentile tool.
	
	* src/analysis-tools.c: Fixed ``F/z/t Critical'' values of the
 	F-Test, t-Test, and z-Test Tools.
	
1999-07-12  Jukka-Pekka Iivonen  <iivonen@iki.fi>

	* src/dialog-analysis-tools.c, src/analysis-tools.c: Made ``Labels
 	in the first row'' option to actually work.  Killed some warnings
 	and bugs related to outputs too.

1999-07-12  Miguel de Icaza  <miguel@gnu.org>

	* src/cell.c (cell_set_font): Now takes a "points" argument.

	* src/Gnumeric.idl (Sheet): Take a double for the cell_set_font
	points parameter.

1999-07-11  Raja R Harinath  <harinath@cs.umn.edu>

	* configure.in: Don't use `foo >& /dev/null' style redirection, 
	use `foo > /dev/null 2>&1'.

1999-07-11  Miguel de Icaza  <miguel@gnu.org>

	* src/dialog-cell-format.c (apply_font_format): Use the
	FontSelector here. 

	* src/widget-font-selector.c (reload_preview): New approach for
	font loading, by using the scale explicitly I got it to work ;-).
	(font_selector_choose): New routine to set the font style.

	* src/sheet.c (sheet_init_default_styles): Change of plans, we are
	going to use 80 units for the default width.

	* src/widget-font-selector.c: New file.  A simplified and robust
	font selector for Gnumeric.
	(fs_fill_font_name_list): Free this.

1999-07-11  Jody Goldberg  <jgoldberg@home.com>

	* src/item-grid.c (context_cut_cmd, context_copy_cmd context_paste_cmd,
	    context_paste_special_cmd, context_insert_cmd, context_delete_cmd,
	    context_clear_cmd, context_cell_format_cmd, create_popup_menu,
	    item_grid_popup_menu) : Operate on Sheet* rather than ItemGrid*.

	* src/item-bar.c (item_bar_event) : Popup an item_grid_popup_menu
	  when Button3 is pressed.  Excel also adds an entry to change
	  col widths/row heights,  that will be next TODO.

	* src/dialog-insert-cells.c, src/dialog-delete-cells.c :
	  Short circuit the menus when an entire row/column is selected.  This
	  fixes the problem of selecting a column and accidentaly inserting a
	  row would clear the sheet inserting MAX_ROW rows and erasing
	  everything ...

	* src/cell-draw.c (cell_draw) : Remove use of str_trim_spaces and
	  correct the bounding rectangle size for multiline entries.
	(cell_split_text) : Rework logic to strip spaces when a forced split
	  causes a linebreak @ those spaces.  Plus more comments.

	* src/print-cell.c (cell_split_text, print_cell_text) : Ditto.
	  Switch accumulators to doubles.

	* src/parser.y : Moved dump_value from here.
	* src/expr.c : to here.  And changed the format of CellRanges
	  to be more appealing.

	* src/cell.c (cell_relocate) : Add some cruft to handle relinking
	  the corner cell of an array formula.

	* src/clipboard.c (clipboard_prepend_cell) : Renamed from
	  clipboard_append_cell.  So that there is truth in naming.
	(clipboard_copy_cell_range) : Reverse the result of
	  clipboard_prepend_cell so that the upper left corner is 1st.

	(Sheet *sheet, int col, int row, Cell *cell, void *user_data)
	* src/expr.c (eval_range) : New function to ensure that range
	  arguments are recalculated.
	 (eval_expr) : Use it.

	* src/sheet.c (range_check_for_partial_array) : New function.  To avoid
	  subdividing arrays does some obvious optimizations.
	(sheet_fill_selection_with) : Split out from here.
	(sheet_delete_col, sheet_delete_row) : Used here too.

1999-07-11  Michael Meeks  <michael@edenproject.org>

	* Sort ChangeLog out, apologies.

1999-07-10  Michael Meeks  <michael@edenproject.org>

	* src/func.c (function_iterate_do_value): Clean to use new
	macro.

	* src/fn-stat.c (gnumeric_rank, gnumeric_prob, gnumeric_steyx),
	(gnumeric_ftest, gnumeric_slope, gnumeric_percentrank),
	(gnumeric_ttest, gnumeric_forecast, gnumeric_intercept): New
	sheet support.

	* src/fn-math.c (gnumeric_countif): Cleaned with nicer sheet
	select macro.
	(gnumeric_sumif, gnumeric_sumx2my2, gnumeric_sumxmy2),
	(validate_range_numeric_matrix): Added new sheet support.
	
	* src/fn-information.c (gnumeric_countblank): Added correct
	sheet support.

	* src/fn-database.c (find_column_of_field): Add EvalPosition
	to get valid Sheet * from & use it.
	(parse_database_criteria, find_cells_that_match): Ditto.
	Update all references.

	* src/expr.c (value_area_get_height): Use eval_sheet
	(eval_funcall): Remove redundant Sheet * setting.

	* src/expr.h: Add eval_sheet to help all over the place.

	* src/eval.c (add_cell_range_deps): Use eval_sheet, and make
	warning more correct.

