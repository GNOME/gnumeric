2005-11-14  Jody Goldberg <jody@gnome.org>

	* Release 1.6.1

2005-11-14  Jody Goldberg <jody@gnome.org>

	The rest of the Maemo port.
	From eduardo.lima@indt.org.br
	http://bugzilla.gnome.org/show_bug.cgi?id=321073
	* src/Makefile.am
	* src/gnumeric-canvas.c
	* src/gui-file.c
	* src/item-grid.c
	* src/sheet-control-gui.c
	* src/wbc-gtk.c
	* src/wbcg-actions.c
	* src/workbook-control-gui-priv.h
	* src/workbook-control-gui.c : Merge the remaining Maemo/Hildon patches.

2005-11-14  Jody Goldberg <jody@gnome.org>

	* configure.in : bump goffice req to 0.1.2 to get morten's fix.
	  Add a < 0.2.0 to avoid problems when we branch.
	  Disable the DEPRECATED warnings in the stable release.

2005-11-13  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (cb_hscrollbar_adjust_bounds) : we weren't
	  extending while at the very top.
	(cb_vscrollbar_adjust_bounds) : ditto.

2005-11-13  Jean Brefort  <jean.brefort@normalesup.org>

	* src/gnumeric-canvas.c: (gnm_canvas_key_press),
	(gnm_canvas_commit_cb): use localized decimal separator [#80139].
	* src/gnumeric-canvas.h:
	* src/widgets/gnumeric-expr-entry.c: (cb_gee_key_press_event): ditto.

2005-11-10  Morten Welinder  <terra@gnome.org>

	* src/application.c (gnumeric_application_finalize): Free
	->clipboard_cut_range.

2005-11-06  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml.in : Include menu item for R1C1

2005-11-05  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c : Delete the original DOM based export.  The pseudo-sax
	  based variant is faster and lighter and there's not much point in
	  maintaining two code bases.

	* src/gnm-so-filled.c (gnm_so_filled_write_xml_dom) : delete.
	* src/gnm-so-line.c (gnm_so_line_write_xml_dom) : delete.
	* src/gnm-so-polygon.c (gnm_so_polygon_write_xml_dom) : delete.
	* src/sheet-object-cell-comment.c (cell_comment_write_xml_dom) : delete.
	* src/sheet-object-image.c (sheet_object_image_write_xml_dom) : delete.
	* src/sheet-object-widget.c
	(sheet_widget_frame_write_xml_dom) : delete.
	(sheet_widget_button_write_xml_dom) : delete.
	(sheet_widget_adjustment_write_xml_dom) : delete.
	(sheet_widget_checkbox_write_xml_dom) : delete.
	(sheet_widget_list_base_write_xml_dom) : delete.
	* src/sheet-object-graph.c (sheet_object_graph_write_xml_dom) : delete.
	(sheet_object_graph_prep_xml_sax) : new.
	(sog_xml_finish) : new.
	(sheet_object_graph_write_object) : use the sax interface.

	* src/xml-sax-read.c (xml_sax_wb) : ICK.  We are actually dependent on
	  the prefix for the namespace.  The change from gmr -> gnm broke the
	  version test here.  Add gnm to fix it.
	(xml_sax_wb_sheetname) : be more flexible and only create a sheet if
	  we really need it.
	(xml_sax_object_start) : implement.

2005-11-02  Jody Goldberg <jody@gnome.org>

	* src/sheet-autofill.c : remove the i18n flags for string lists as far
	  as I can tell they were always true.
	(type_is_compatible) : an item might be in
	  multiple lists.  Check that the current item is in the previous list
	  or that the previous item is in the current list.

2005-10-25  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c (collect_unique_elements) : yes that is the type
	  of equality and hash we want.  Remove the warning.

2005-11-01  Morten Welinder  <terra@gnome.org>

	* src/main-application.c: Move include of popt stuff here.  It has
	no business in libgnumeric.h

2005-11-01  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* README: Updated list archives URL (Debian #336699).

2005-11-01  Stepan Kasal  <kasal@ucw.cz>

	* src/sheet-filter.c, src/xml-io.c, src/tools/analysis-tools.c:
	#include <stdlib.h>, for the qsort() prototype.
	* src/gnumeric-gconf.c: In the non-gconf case, #include glib/gstdio.h.

2005-10-31  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-gconf.c: Implement non-gconf case, see #310354.
	(Patch from Allin Cottrell.)

2005-10-24  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_dump_defs): Describe args too.

2005-10-24  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_dump_defs): Do the minimum for the new
	function doc stuff.

2005-10-23  Jody Goldberg <jody@gnome.org>

	* src/parse-util.c (r1c1_rangeref_parse) : cut-n-paste-o
	(r1c1_get_index) : == max is ok, we're about to decrement.

	* src/parser.y (yylex) : special case check for #N/A which does not
	  end in '!' or '?'.
	(cellref) : Allow RANGEREF : RANGEREF

2005-10-15  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_format_general) : Fix fmt accelerators.
	  ctrl-~ == general not number
	  ctrl-! == number not accounting

	* src/gnm-format.c (format_value_gstring) : Use the last element as a
	  catch all. eg [>10][Blue]0;0 will fmt 1 in black even though it's
	  implicit condition is <0

	* src/sheet-view.c (sv_freeze_panes) : if frozen == unfrozen unfreeze
	  things.

2005-10-12  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (gnumeric_gnome_reqs): Require libgsf-gnome >= 1.13.0,
	  1.12.x cannot be used in combination with libgsf >= 1.13.2 anyway.
	* README: Sync all version requirements with configure.in.

2005-10-10  Morten Welinder  <terra@gnome.org>

	* src/stf.c (csv_tsv_probe): Fix a pile of content-probe issues.
	Fixes #318419.
	Handle empty csv files sanely.

2005-10-10  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_sheet_read) : xml_node_get_bool returns TRUE on
	  success.  Only set the value if we have one.  The other code is
	  reading directly into the value and setting it to a constant on
	  failure.

2005-10-10  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2005-10-10  Jody Goldberg <jody@gnome.org>

	* Release 1.6.0

2005-10-10  Jody Goldberg <jody@gnome.org>

	* configure.in : bump gsf req to avoid breakage in 1.13.1

2005-10-10  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pdhyper): Avoid infinite loop for NB==0, n==x.
	NOTE: Changed directly in genereated code.

2005-10-08  Jody Goldberg <jody@gnome.org>

	* src/cellspan.c (cell_calc_span) : numbers can span when centered
	  across selection. [Debian #286131]

2005-10-07  Jody Goldberg <jody@gnome.org>

	* src/style-border.c (style_borders_row_draw) : more rtl fixage.
	(style_borders_row_print) : ditto.

2005-10-07  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-write.c (xml_write_summary): Save all the summary
	items, not N copies of the first.  [#318254]

2005-10-06  Jean Brefort  <jean.brefort@normalesup.org>

	* src/gnumeric-pane.c: (build_so_menu): localize all menu items [#318042].
	* src/sheet-autofill.c: (in_list), (autofill_cell): use localized days
	and months names when autofilling [#318043].

2005-10-06  Jody Goldberg <jody@gnome.org>

	* src/style-conditions.c (gnm_style_conditions_eval) : whip up the
	  other conditions.
	* src/print-cell.c (print_merged_range) : support conditional styles
	  in merged cells.
	* src/item-grid.c (item_grid_draw_merged_range) : ditto.

2005-10-06  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=317806
	* src/dependent.c (cb_single_contained_collect) : do not collect
	  dynamic depends they may get cleared.
	(cb_range_contained_collect) : ditto.

2005-10-04  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : libspreadsheet_la_LDFLAGS is already defined use
	  += for WITH_WIN32

2005-10-04  Jody Goldberg <jody@gnome.org>

	* src/func-builtin.c (gnumeric_table_link) : finish
	* src/dependent.c (link_expr_dep) : take an EvalPos rather than just a
	  dep so that we can pass around array bound details.

2005-10-02  Jody Goldberg <jody@gnome.org>

	* src/ranges.c (range_intersection) : return FALSE if the ranges do
	  not overlap, but do not generate an error.
	  formula_import_biff8.xls

	* src/gnumeric-pane.c (gnm_pane_init) : Use a realize handler on the
	  canvas to create the object views.  Doing it sooner can break
	  because the canvas has not been attached to a container yet.
	  test-xls/prislistekomplett.xls

	* src/workbook-control-gui.c (wbcg_sheet_add) : only grab focus if we
	  are the current sheet.
	  samples/derivatives.gnumeric

	* src/xml-sax-read.c : Move to new libgsf xml interface.
	  Support un-namespaced variant of Name for compatibility.

	http://bugzilla.gnome.org/show_bug.cgi?id=317427
	* src/parse-util.c (gnm_1_0_rangeref_as_string) : new stripped down
	  variant of rangeref_as_string.
	* src/xml-sax-write.c (xml_io_conventions) : use it here.
	* src/xml-io.c (xml_io_conventions) : and here.

	* src/style.c (required_updates_for_style) : add super/sub script

2005-10-01  Stepan Kasal  <kasal@ucw.cz>

	* src/Makefile.am (libspreadsheet_la_LDFLAGS): Add a -release flag,
	  that says that there is no compatibility between releases.

2005-09-28  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_read_names): Check whether the expression is
	NULL, not whether the exp function pointer is.
	(xml_workbook_read): Setup context earlier.
	(xml_read_names): Work around bug 317427.

2005-09-28  Jean Brefort  <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_set_sheet): unlink dependent if necessary
	before setting the sheet.

2005-09-28  Jean Brefort  <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_dup): set the sheet of the dep with a
	call to dependent_set_sheet.

2005-09-26  Jody Goldberg <jody@gnome.org>

	* src/gnm-style-impl.h : Add a script element to GnmStyle
	* src/mstyle.c (elem_is_eq) : support scripts
	(elem_assign_content) : support scripts
	(gnm_style_new_default) : support scripts
	(gnm_style_get_pango_attrs) : support scripts
	(gnm_style_dump) : support scripts
	(gnm_style_set_font_script) : new.
	(gnm_style_get_font_script) : new.

	* src/GNOME_Gnumeric-gtk.xml.in  : Add the super/sub script
	  accelerators

	* gnumeric.xsd : update to include the new h/v alignments and to add
	  Script.

	* src/wbc-gtk.c (wbc_gtk_style_feedback) : support super/sub script
	  and fix support for double underline

	* src/wbcg-actions.c (toggle_font_attr) : support super/sub script
	(cb_font_subscript) : new.
	(cb_font_superscript) : new.

	* src/xml-io.c (xml_write_style) : ditto.
	(xml_read_style) : ditto.
	* src/xml-sax-read.c (xml_sax_styleregion_font) : ditto.
	* src/xml-sax-write.c (xml_write_gnmstyle) : ditto.

2005-09-27  Morten Welinder  <terra@gnome.org>

	* src/position.c (eval_pos_init_dep): Fix typo.

2005-09-26  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (show_gui) : protection against scg == NULL
	  Wallenbach-Formulas2003/chap17/thermometer chart.xls
	(disconnect_sheet_signals) : no need to warn when shutting down hidden
	  sheets.

	* src/format-template.c (gnm_auto_fmt_filter_edges) : This is not
	  correct, but at least it no longer causes a crash.  Rework things to
	  rationalize the handling of edges at some point in the future.

	* src/mstyle.c (gnm_style_set_shrink_to_fit) : cut-n-paste-o that
	  would erase wrap text with shrink to fit.
	(gnm_style_get_shrink_to_fit) : ditto.

2005-09-24  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (resize_pane_pos) : handle motion in frozen
	  areas.
	(sheet_control_gui_new) : use a blank label as a space rather than a
	  scrollbar.  Emmanuel's idea seems more consistent with frozen panes
	  than reseting the pane.
	(set_resize_pane_pos) : new utility to calculate the desired pane
	  position and block the signal.
	(resize_pane_finish) : renamed from cb_resize_pane_finish to be more
	  consistent.  Round the pane position to the col/row bound using
	  set_resize_pane_pos.
	(scg_set_panes) : position the resize panes.  Change the behavior not
	  to short circuit if the freeze status is unchanged.  This seems safe
	  and makes sue that set_resize_pane_pos is called.

	* src/dependent.c : warning suppression.

2005-09-22  Jody Goldberg <jody@gnome.org>

	* src/selection.c (sv_selection_to_plot) : Use the total number of
	  rows and cols to decide row vs col major.  Using just the first
	  range had the potential for problems with a singleton followed by a
	  full col.

	http://bugzilla.gnome.org/show_bug.cgi?id=314867
	* src/dependent.c (workbook_recalc) : queue an update to the auto
	  expr.

2005-09-20  Jody Goldberg <jody@gnome.org>

	* src/position.c : Add some gnm_ to the api.
	(gnm_cellref_set_col_ar) : new
	(gnm_cellref_set_row_ar) : new.

2005-09-20  Morten Welinder  <terra@gnome.org>

	* src/cell-draw.c: Don't use gdk_draw_layout_with_colors -- it
	breaks rich text.  (We might be able to use it if we can somehow
	deduce that rich text is not present, but that is a patch for
	later.)  Unset clip explicitly in the rotation case.

2005-09-19  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=316597
	* src/cell-draw.c (cell_draw) : gtk-2.8 clips more vigorously.
	  Don't clip at all for rotation rather than setting a clip of
	  0..maxint

2005-09-18  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Fix the way GCONF_SCHEMAS_INSTALL is set.
	  Update obsolete macros.

2005-09-17  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_press) : add a quick guard
	  around gtk_im_context_reset to avoid starting an edit for no reason.

2005-09-16  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_destroy_contents) : destroy filters and pivots
	  before remaining objects.  Those are higher order objects and may
	  contain objects themselves.  [#316533]

2005-09-15  Jody Goldberg <jody@gnome.org>

	* src/func-builtin.c (gnumeric_table_link) : new incomplete.
	(gnumeric_table_unlink) : new incomplete.
	(gnumeric_table) : implement 1d iteration.

2005-09-15  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_is_local_drag) : new.
	(cb_wbcg_drag_motion) : check for object drags here.
	(cb_wbcg_drag_leave) : here.
	(cb_wbcg_drag_data_received) : and here.
	(wbcg_set_toplevel) : include the local object targets.

	* src/gnumeric-canvas.c (cb_obj_autoscroll) : new.
	(gnm_canvas_object_autoscroll) : new.  A kludge to get sheet objects
	  to autoscroll again.

2005-09-15  Morten Welinder  <terra@gnome.org>

	* src/main-application.c (check_pango_attr_list_splice_bug): New
	function.
	(main): Call check_pango_attr_list_splice_bug.

2005-09-13  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=316026
	* src/sheet-control-gui.c (drag_object) : type 8 movement (sliding
	  full object) in rtl mode should snap coord 2, the right side.

2005-09-13  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (dep_hash_destroy): Don't start changing
	dependencies until we are done looking at containers.

2005-09-10  Stepan Kasal  <kasal@ucw.cz>

	* src/main-application.c (main): Change the type of variable "args"
	  to "gchar const **", call go_shell_argv_to_glib_encoding_free at
	  the end of the day.
	* src/ssconvert.c, src/ssindex.c: Likewise.
	* configure.in: Require goffice 0.1.0.

	* src/workbook.c (workbook_sheet_state_diff): It seems that the last
	  chunk of the change from 2005-08-27 was a mistake.  Remove it.

2005-09-09  Jody Goldberg <jody@gnome.org>

	* src/dependent.c (link_expr_dep) : honor new DEPENDENT_IGNORE_ARGS
	  flag which instructs the linker not to depend on the arguments to
	  the function.

2005-09-08  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump, prep for 1.6.0

2005-09-08  Jody Goldberg <jody@gnome.org>

	* Release 1.5.90

2005-09-08  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml.in : remove 'EditMetaData' it is not
	  complete.

2005-09-05  Jody Goldberg <jody@gnome.org>

	* src/expr.c (gnm_expr_is_data_table) : move this out of the xls
	  plugin.

2005-09-05  Stepan Kasal  <kasal@ucw.cz>

	* src/gnm-so-polygon.c, COPYING: Update FSF's address.

2005-09-05  Jody Goldberg <jody@gnome.org>

	* src/workbook-edit.c (wbcg_edit_start) : no need to do the selection
	  magic here.  We now over ride 'gtk-entry-select-on-focus' in the
	  ExprEntry widget.

2005-09-05  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_data_import_text) : s/druid/assistant/ [#311998]

2005-09-04  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_press) : only ignore keyboard
	  events for normal mode.  objects still accept escape [#314866]
	* src/gnumeric-pane.c (cb_control_point_event) : ignore other buttons
	  while dragging.

2005-09-04  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_scalar_as_str) : remove.  This was intended
	  as a fix for #152317.  Unfortunately it ended up breaking two other
	  things.  xml persistence could not tell if something was a string or
	  an expression.  User input would not be quoted.  A more functional
	  solution is to push this logic down into the xls exporter.

2005-09-02  Jody Goldberg <jody@gnome.org>

	* src/number-match.c : Make DEBUG_NUMBER_MATCH compile again.
	(format_match_init) : Ignore fmt elements that contain '@'

2005-09-01  Morten Welinder <terra@gnome.org>

	* src/gnumeric-pane.c (gnm_pane_display_obj_size_tip): Make the
	tooltips use "www x hhh" format.

2005-08-29  Jody Goldberg <jody@gnome.org>

	* configure.in : bump goffice req

2005-08-27  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_dispose) : Looks like this patch got
	  munged. Make it sane.

2005-08-29  Stepan Kasal  <kasal@ucw.cz>

	* src/ssconvert.c (convert): If output file name was not given,
	don't call go_shell_arg_to_uri.  Without gnome, this caused a segfault.

2005-08-28  Morten Welinder <terra@gnome.org>

	* configure.in: Post release bump.

2005-08-28  Morten Welinder <terra@gnome.org>

	* Release 1.5.5

2005-08-28  Morten Welinder <terra@gnome.org>

	* configure.in: Post release bump.

2005-08-28  Morten Welinder <terra@gnome.org>

	* Release 1.5.4

2005-08-26  Morten Welinder  <terra@gnome.org>

	* src/print.c (dialog_response): Reset page count.  [#314520]

2005-08-25  Stepan Kasal  <kasal@ucw.cz>

	* src/Makefile.am (check_PROGRAMS): Add test-pango only if WITH_GTK.
	(nodist_test_pango_SOURCES, nodist_gnumeric_component_SOURCES): Nuke,
	they only referred to nodist_gnumeric_SOURCES, which no longer exists.
	(UNUSED): Remove, this hack is no longer needed.

2005-08-24  Stepan Kasal  <kasal@ucw.cz>

	* src/workbook.c: Move the /* WITH_GTK */ comment to the right #endif.
	* src/gnm-so-polygon.c (so_polygon_view_set_bounds): Remove unused
	variable.

2005-08-23  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (set_cur_fmt): Split out.
	(cb_entry_cursor_pos): From here.
	(cb_entry_cursor_pos): use set_cur_fmt.  Fixes #314209.

	* src/dependent.c (dep_hash_destroy): Another case of
	don't-muck-with-the-hash-you-are-iterating-over.

2005-08-21  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_sheet_attach_at_pos) : don't signal until
	  after the controls have been added. [#314208]

2005-08-21  Jody Goldberg <jody@gnome.org>

	* src/mstyle.c (gnm_style_equal) : MSTYLE_COLOR_BACK == 0 now, there
	  is no longer an invalid entry at 0 with back at 1.
	(gnm_style_equal_XL) : ditto.

	* src/sheet-style.c (cb_style_list_add_node) : improve the debugging.

2005-08-18  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/commands.c (cmd_object_raise_redo): pull_to_front and
	pull_forward actions were inverted.

2005-08-17  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wbv_save_to_uri): Only close the output
	handle if it is not already closed.  (msole closes its sink.)

2005-08-15  Morten Welinder <terra@gnome.org>

	* configure.in: Post release bump

2005-08-15  Morten Welinder <terra@gnome.org>

	* Release 1.5.3

2005-08-15  Jean Brefort  <jean.brefort@normalesup.org>

	* src/workbook-control-gui.c: (cb_graph_dim_editor_update): unref the
	scg. Fixes #313463

2005-08-12  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (cb_dep_hash_destroy): Fix crashes related to
	changing a dependency container while we are looping over it.
	Fixed #312794.

	* src/sheet.c (sheet_finalize): Free ->sheet_views at the end
	because sheet_scrollbar_config as called via object removal can
	access it.

2005-08-12  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_destroy_contents): Move sheet object
	destruction here.
	(sheet_finalize): From here.

2005-08-12  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-widget.c
	(sheet_widget_radio_button_set_property): Fix warning.

2005-08-12  Jean Brefort  <jean.brefort@normalesup.org>

	* src/dialogs/dialog-about.c: (dialog_about): do not remove the
	grid which does not exist anymore.

2005-08-11  Jean Brefort  <jean.brefort@normalesup.org>

	* configure.in: needs libgsf-1.12.2
	* src/command-context-stderr.c: updated to new GSF_CLASS_FULL signature.
	* src/gnm-plugin.c: ditto.
	* src/gnm-so-filled.c: ditto.
	* src/gnm-so-line.c: ditto.
	* src/io-context-gtk.c: ditto.
	* src/sheet-filter.c: ditto.
	* src/sheet-object-cell-comment.c: ditto.
	* src/sheet-object-graph.c: ditto.
	* src/sheet-object-image.c: ditto.
	* src/sheet-object-widget.c: ditto.
	* src/widgets/gnumeric-expr-entry.c: ditto.
	* src/workbook-control-gui.c: ditto.
	* plugins/corba/corba-workbook.c: ditto.
	* plugins/python-loader/python-loader.c: updated to new
	GSF_DNAMIC_CLASS_FULL signature.

2005-08-11  Jody Goldberg <jody@gnome.org>

	* src/gnm-so-polygon.c : split out of filled and re-enable It's not
	  optimal, and the persistence is broken, but it does display.

2005-08-09  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (rendered_value_recontext): Fix the hack to
	make printing look like screen.  [#312912]

	* src/workbook-view.c (wbv_save_to_uri): Close the file before
	checking for errors.  Part of fix for #312930.

2005-08-09  Rodrigo Moya <rodrigo@gnome-db.org>

	* configure.in: require libgda/libgnomedb CVS HEAD.

2005-08-08  Morten Welinder  <terra@gnome.org>

	* src/ssindex.c: Fix typo.  [#312823]

2005-08-08  Sunil Mohan Adapa  <sunil@atc.tcs.co.in>

	* configure.in: Added "te" to ALL_LINGUAS.

2005-08-08  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* *: Updated FSF's address.

2005-08-07  Jody Goldberg <jody@gnome.org>

	* src/main-application.c : Add --no-warnings
	* src/io-context-gtk.c (icg_error_error_info) : use it.

2005-08-07  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_dispose) : do not free the uri until the
	  end to make debugging simpler.
	(workbook_sheet_hide_controls) : hide just controls not views.
	(cb_sheet_visibility_change) : restore just controls.

	* src/style-color.c (style_color_new_gdk) : new.
	* src/sheet-view.c (sv_get_control) : new.
	* src/sheet.c (sheet_destroy) : move the object deletion from here.
	(sheet_destroy_contents) : to here.

2005-08-04  Stepan Kasal  <kasal@ucw.cz>

	* src/Makefile.am (GNUMERIC_BASE): Add gnm-style-impl.h.
	* src/file-autoft.c: Add a missing include.

	* src/style-conditions.c (gnm_style_conditions_eval): Fix another
	  warning.

	* src/ssindex.c: Fix two option descriptions.

2005-08-03  Jody Goldberg <jody@gnome.org>

	* src/style-conditions.c (gnm_style_conditions_eval) : suppress a
	  warning and some debug spew.

2005-08-03  Stepan Kasal  <kasal@ucw.cz>

	* src/test-pango.c: Fix warnings.

2005-08-01  Jody Goldberg <jody@gnome.org>

	* src/consolidate.c (retrieve_row_tree) : Ignore elements that have no
	  data. [#308431]

	* src/workbook-edit.c (cb_entry_delete_text) : queue an update of the
	  edit items.  This is a kludge.  We should move to a centralized
	  dropdown rather than screwing with the selection. [#308303]
	(wbcg_edit_start) : don't autocomplete while editing in the editline.

	* src/sheet-object-image.c (sheet_object_image_new_view) : create the
	  image hidden.  The bound_set. will fix it later. [#308301]

2005-07-29  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_scalar_as_str) : New. be smarter about
	  constant strings.  There's no need to quote them when they are the
	  entire expression. #152317

2005-07-27  Morten Welinder  <terra@gnome.org>

	* src/value.c (find_rows_that_match): Band-aid for 311567.

2005-07-26  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* src/style.c (style_font_new_simple): use
	pango_font_description_copy() so that we store the exact
	font description we pass to pango. Partially Fix #161027.

2005-07-25  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-object-graph.c (sheet_object_graph_default_size): logical
	size of graph is a property of GogGraph now.

2005-07-23  Jody Goldberg <jody@gnome.org>

	Fix snap to grid for RTL mode.
	* src/sheet-control-gui.c (snap_pos_to_grid) : handle RTL and scaling
	  here.
	(snap_to_grid) : merge into.
	(apply_move) : here.

	Fix object motion in RTL mode.
	* src/gnumeric-canvas.c (gnm_canvas_window_to_coord) : new.
	* src/gnumeric-pane.c (cb_pane_drag_data_received) : use it here.
	(cb_gnm_pane_drag_motion) : and here.

2005-07-23  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* src/gnumeric-gconf.c (go_conf_set_str_list, go_conf_get_str_list):
	They didn't worked. Fix #308302.

2005-07-20  Morten Welinder  <terra@gnome.org>

	* src/mstyle.c (gnm_style_ref, gnm_style_unref): Add extra
	precondition.

	* src/commands.c (cmd_format_repeat): Handle NULL style.  Fixes
	#310924.

2005-07-18  Stepan Kasal  <kasal@ucw.cz>

	* src/libgnumeric.c: Remove double #include's.

2005-07-15  Jody Goldberg <jody@gnome.org>

	* src/print-info.c : Add Andreas to the list of Authors.
	(print_info_new) : Init the simple margins to -1 to signify unset.
	  Init the new flags.
	(print_info_margin_copy) : delete.
	(print_info_dup) : tidy up and handle the new flags.
	(print_info_get_margins) : if a margin is negative (unset) return 0.
	(print_info_set_n_copies) : delete.
	(print_info_get_n_copies) : delete.
	(print_info_set_orientation) : delete.
	(print_info_get_orientation) : delete.
	(print_info_make_config) : only set the margin in the print_config if
	  it is set.  Rework the orientation enum into a pair of bools to be
	  more XL compat.
	(print_info_load_config) : ditto.

	* src/gnumeric-gconf.c : s/right-then-down/across-then-down/ for RTL.
	(gnm_gconf_set_print_order_across_then_down) : renamed from
	  gnm_gconf_set_print_order_right_then_down.

	* gnumeric.xsd : margins are optional now.

2005-07-15  Jon K Hellan  <hellan@acm.org>

	* src/main-application.c (gnumeric_arg_parse): Call
	gnome_authentication_manager_init.

2005-07-14  Jon K Hellan  <hellan@acm.org>

	* configure.in (set_more_warnings): Add -Wno-pointer-sign, which
	silences the "pointer targets differ in signedness" warnings from
	gcc as of version 4.0. Should probaby be turned on again at some
	point.

2005-07-11  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (list_them): Cleanup.

	* src/workbook-view.c (wb_view_new_from_uri, wbv_save_to_uri): Use
	g_printerr, not g_print.
	* src/workbook-control-gui.c (cb_workbook_debug_info): Ditto.
	* src/workbook.c (workbook_dispose): ditto.

2005-07-05  Stepan Kasal  <kasal@ucw.cz>

	* .cvsignore: Replace "autom4te*.cache" by "autom4te.cache"

2005-07-04  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in, README: Bumped the goffice requirement to get
	GOG_MS_DIM_START, GOG_MS_DIM_END, GOG_MS_DIM_LOW, GOG_MS_DIM_HIGH.

2005-07-01  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_claim_clipboard): Plug leak.

2005-07-01  Jean Brefort  <jean.brefort@normalesup.org>

	* src/sheet-object-graph.c: inlude locale.h,
	(sheet_object_graph_write_object): fix a pointer compatibility warning.

2005-07-01  Jean Brefort  <jean.brefort@normalesup.org>

	* src/gnumeric-pane.c: (gnm_pane_drag_begin): add support to copy/paste and
	dnd charts to other apps.
	* src/gnumeric.h: ditto.
	* src/gui-clipboard.c: (graph_write), (x_clipboard_get_cb),
	(x_claim_clipboard): ditto
	* src/sheet-control-gui.c: ditto.
	* src/sheet-object-graph.c: ditto.
	(sheet_object_graph_get_object_target_list),
	(sheet_object_graph_write_object), (sog_exportable_init):
	* src/sheet-object-impl.h: ditto.
	* src/sheet-object.c: (sheet_object_exportable_get_type),
	(sheet_object_exportable_get_target_list),
	(sheet_object_write_object): ditto.
	* src/sheet-object.h: ditto.

2005-06-30  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_sheet_rename_check,
	workbook_sheet_change_protection,
	workbook_sheet_change_visibility, workbook_sheet_recolor,
	workbook_sheet_reorder_by_idx): Remove.  No longer used.

	* src/commands.c (command_redo_sheet_delete,
	cmd_reorganize_sheets_delete_get_this_sheet_info,
	cmd_reorganize_sheets_delete_shift_list,
	cmd_reorganize_sheets_delete_get_all_sheets_info,
	cmd_reorganize_sheets_delete_recreate_sheet,
	cmd_reorganize_sheets_delete_free, cmd_reorganize_sheets_undo,
	cmd_reorganize_sheets_redo, cb_slist_gdk_color_free,
	cmd_reorganize_sheets_finalize, cmd_reorganize_sheets_fix_list,
	cmd_reorganize_sheets):  Remove.  No longer used.

2005-06-28  Jody Goldberg <jody@gnome.org>

	* src/style-conditions.c (gnm_style_conditions_overlay) : when
	  applying a conditional overlay with a background colour to a base
	  without a pattern pretend the pattern is solid.

2005-06-27  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c: No ellipsis to Full Screen.

2005-06-25  Jody Goldberg <jody@gnome.org>

	* src/mstyle.c (gnm_style_dup) : no need to dup unassigned elements.

	* src/gnm-style-impl.h, src/style-conditions.c, src/style-conditions.h:
	  New files.

2005-06-25  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-read.c (xml_sax_hlink) : new.
	(xml_sax_input_msg) : new.

2005-06-22  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (random_01): Use the Mersenne Twister as
	fallback.
	* configure.in: Stop checking for functions we no longer use.

2005-06-22  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-pane.c (cb_gnm_pane_drag_motion): set snap_to_grid if
	SHIFT is pressed, state given by widget parent window.
	* src/sheet-control-gui.c (scg_drag_receive_same_scg): ditto.
	(scg_objects_nudge): fix typo.

2005-06-22  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : enable pango-test

2005-06-22  Jody Goldberg <jody@gnome.org>

	* * : s/MStyle/GnmStyle/
	      s/mstyle_/gnm_style_/
	      s/StyleHAlignFlags/GnmHAlign/
	      s/StyleVAlignFlags/GnmVAlign/

2005-06-20  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_rename_sheet): Prevent renames to "".

2005-06-14  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163414
	* src/item-bar.c (item_bar_event) : "If it hurts when you do that,
	  don't do that".  Position the tooltip above the cursor for row
	  headers too :-)

2005-06-14  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-gconf.c (gnm_gconf_get_toolbar_visible,
	gnm_gconf_set_toolbar_visible): New functions.

	* src/wbc-gtk.c (cb_add_menus_toolbars): Set toolbar visibility.
	(cb_handlebox_visible): Make changes to visibility permanent.
	(wbc_gtk_init): Don't set everything visible.

2005-06-13  Jody Goldberg <jody@gnome.org>

	* src/expr.c (gnm_expr_eval) : when evaluating an array pass the
	  cols/rows into the EvalPos.

	* src/position.c (eval_pos_init) : init new cols/rows member
	(eval_pos_init_dep) : ditto.
	(eval_pos_init_cell) : ditto.
	(eval_pos_init_sheet) : ditto.

2005-06-13  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2005-06-13  Jody Goldberg <jody@gnome.org>

	* Release 1.5.2

2005-06-13  Jody Goldberg <jody@gnome.org>

	* src/expr-name.c (gnm_named_expr_collection_lookup) : be more
	  careful.

2005-06-12  Jody Goldberg <jody@gnome.org>

	* src/value.c (value_get_as_bool) : handle err == NULL

2005-06-12  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_detach_view): Just dispose of the view.
	That will both break cycles and indirectly unref.
	(workbook_sheet_delete): Ditto.

	* src/workbook-view.c (wb_view_sheet_add): Don't leak a ref to the
	new view.

	* src/sheet-view.c (sheet_view_new): Ref the sheet view when we
	add it to the sheet's list of views.
	(sv_real_dispose): Unref as we remove from said list.

2005-06-10  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (link_cellrange_dep, unlink_cellrange_dep): Fix
	condition for swapping sheet indices.  Fix loop.
	(dependent_unlink): Don't try to unlink dynamic dependencies from
	a NULL container.

	* src/dependent.c (gnm_dep_container_sanity_check): New function.
	(dependents_revive_sheet): Check sanity here.
	(gnm_dep_container_dump): And here.
	(handle_outgoing_references): New function.  Properly unlink
	dependencies that reference stuff outside current sheet.
	(do_deps_destroy, do_deps_invalidate): Use
	handle_outgoing_references.

	* src/dependent.c (dependents_invalidate_sheets): Handle 3d deps
	here.  Avoid crashes by not modifying the hash while we go over
	it.
	* src/workbook.c (workbook_sheet_delete): Not here.

	* src/xml-sax-write.c (xml_write_sheet): Write visibility.

	* src/xml-sax-read.c (xml_sax_attr_enum): New function.
	(xml_sax_sheet_start): Restore visibility.

	* src/xml-io.c (xml_read_selection_info): Don't crash if we lack a
	view.
	(xml_write_selection_info): Ditto.
	(xml_sheet_read): Restore visibility.
	(xml_sheet_write): Write visibility.

2005-06-09  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_realize) : init the menu prefs on
	  realization.

2005-06-09  Jody Goldberg <jody@gnome.org>

	* src/item-edit.c (ie_scan_for_range) : call
	  gnm_expr_entry_set_parsepos to be sure we're using the right
	  notional position.  This only really matters for R1C1 refs.

	* src/rendered-value.c (rendered_value_render) : use the Sheet::convs
	  to display expressions.
	(cell_get_entered_text) : ditto.

	* src/parse-util.c (rangeref_as_string) : r1c1 support.
	(cellref_as_string) : ditto.

	* src/item-bar.c (item_bar_draw) : for r1c1 use numbers for col
	  headers.
	(item_bar_calc_size) : ditto.

	* src/sheet.c : Add use-r1c1 property
	(re_render_formulas) : split from
	(sheet_set_display_formulas) : here.
	(sheet_set_use_r1c1) : for use here.

	* src/wbcg-actions.c (toggle_actions) : Add r1c1 toggle
	* src/GNOME_Gnumeric-gtk.xml : use it

2005-06-09  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_sheet_delete): Merge
	workbook_sheet_detach into this.
	(workbook_sheet_detach): Removed.  All callers changed.

	* src/dependent.c (cb_dep_hash_destroy): Track changes to
	dependencies.
	(clear_revive_info): Free dep_exprs also.
	(dependents_revive_sheet): Undo changes to dependencies too.

2005-06-08  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (gnm_sheet_class_init): Rename "visible" property to
	"visibility" and make it an enum.  All users changed.
	* src/sheet.h (struct _Sheet): Ditto for is_visible member.

	* src/workbook-view.c (wb_view_sheet_remove): New function to
	mirror wb_view_sheet_add.
	* src/workbook.c (workbook_sheet_hide_controls): Use
	wb_view_sheet_remove.

2005-06-08  Ivan, Wogn Yat Cheung  <email@ivanwong.info>

	* src/sheet-control-gui.c (scg_drag_receive_uri_list):
	adapt to the change of go_get_mime_type(). [#304074]

2005-06-07  Jody Goldberg <jody@gnome.org>

	From Ivan, Wong Yat Cheung  <email@ivanwong.info>
	* src/Makefile.am : enable libspreadsheet

2005-06-07  Jody Goldberg <jody@gnome.org>

	* src/parser.y : Pass the convention to the range_ref parser

	* src/parse-util.c (r1c1_get_index) : make this more robust.
	(cellref_r1c1_get) : adjust calling to new get_index args.
	(r1c1_rangeref_parse) : new.
	(rangeref_parse) : connect into the r1c1 parser.
	(parse_util_init) : add an r1c1 convention set

2005-06-07  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_sheet_state_restore): Revive sheets
	being re-attached.

	* src/workbook-control-gui.c (scg_delete_sheet_if_possible): Use
	cmd_reorganize_sheets2.

	* src/sheet.h (struct _Sheet): Add extra "revive" member.

	* src/expr-name.c (gnm_named_expr_collection_relink,
	gnm_named_expr_collection_unlink): New functions.
	(gnm_named_expr_collection_free): Remove the extra indirection.
	All callers changed.

	* src/dependent.c (handle_dynamic_deps, handle_referencing_names):
	Extracted from do_deps_destroy.
	(do_deps_invalidate, clear_revive_info, dependents_revive_sheet):
	New functions.
	(dependents_link): Do not free the argument list.  All callers
	changed.
	(do_deps_destroy): Call clear_revive_info.
	(invalidate_name): Renamed from cb_name_invalidate.  Add "destroy"
	argument.  If not destroying, save the name-expression pairs.
	(cb_collect_deps_of_names): Collect also the names.
	(dependents_invalidate_sheet, dependents_invalidate_sheets): Add
	extra "destroy" argument.  All callers changed.
	(dep_hash_destroy): Walk over the hash once, not three times.

2005-06-06  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (lgamma): Define when needed.
	(lgamma_r): Base the implementation on lgammacor, not lgamma.

	* src/sheet-control-gui.c (scg_drag_receive_uri_list): Add warning
	about things we do not understand.

2005-06-04  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=165172
	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : quick and cheesy
	  handling of Delete while editing.  It forces an end to
	  autocompletion rather than unintentionally clearing the cell as if
	  we were not editing.

2005-06-04  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=164779
	* src/sheet-control-gui.c (scg_objects_nudge) : no nudging while
	  creating an object.

2005-06-04  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163589
	* src/print.c (print_page_cells) : Use the PrintInfo from the supplied
	  sheet rather than something global.
	(print_page_repeated_rows) : ditto.
	(print_page_repeated_cols) : ditto.
	(print_page_repeated_intersect) : ditto.
	(print_hf_element) : ditto.
	(print_hf_line) : ditto.
	(print_headers) : ditto.
	(print_footers) : ditto.
	(setup_scale) : ditto.
	(print_page) : ditto.
	(print_range_down_then_right) : ditto.
	(print_range_right_then_down) : ditto.
	(print_job_info_init_sheet) : ditto.
	(print_sheet_range) : ditto.
	(compute_sheet_pages) : ditto.
	(compute_pages) : ditto.
	(print_sheet) : ditto.
	(workbook_print_all) : delete.
	(sheet_print_real) : and merge into here.
	(print_job_info_update_from_config) : merge into print_job_info_init_sheet.
	(print_job_info_get) : Do not attempt to load a PrintInfo from the
	  first sheet.  We'll set things up on a per sheet basis.
	(print_job_info_destroy) : we do not have a local copy of a PrintInfo
	  anymore.

2005-06-04  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* tools/gconf-schemas-to-win32-reg.c (convert_schemalist):
	  Use REGEDIT4 so that Win9x knows.

2005-06-03  Jody Goldberg <jody@gnome.org>

	* src/gnumeric.h : s/GnmRow/GnmStyleRow/  That is clearer

2005-06-03  Jody Goldberg <jody@gnome.org>

	* configure.in : bump gsf req to 1.12.1 for the new GSF_DYNAMIC_CLASS
	  signatures

2005-06-02  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (binomialcf): Fix log_p case.
	(pfuncinverter): Handle NaNs better.
	(qbeta): Improve initial guess.

	* src/number-match.c (compute_value): When matching with
	strto[u]l, make sure to store the result in a variable large
	enough.  Fixes #306254.

2005-06-01  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_write_cell_and_position): Don't duplicate
	ExprIDs for arrays.
	* src/xml-sax-write.c (xml_write_cell_and_position): Ditto.

2005-06-01  Stepan Kasal  <kasal@ucw.cz>

	* src/ranges.c (undo_cell_pos_name, undo_range_name, undo_range_list_name):
	  New functions.
	(max_range_name_width, range_list_name_try): New static functions.
	* src/commands.c (undo_global_range_name, cmd_cell_pos_name_utility):
	(cmd_range_list_to_string_utility, cmd_range_to_str_utility): Nuke; all
	  callers should use the new functions from ranges.c.

	* schemas/gnumeric-general.schemas.in (max_descriptor_width):
	Change the default to 40; "Clearing contents in Sheet1!A12:C34"
	should fit in without truncating.  The prefix is about 20 chars
	and about 20 chars should remain for the range name itself.

2005-05-31  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-read.c (xml_sax_cell): Fix asserts.
	(xml_sax_cell_content): Guard against bogus values.

2005-05-31  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-read.c (gnm_xml_file_open) : register the doc if
	  necessary, and hook it too the application for destruction.

2005-05-31  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (random_hypergeometric): Define trivially using
	qhyper thus avoiding some performance problems.
	(qhyper): Move from plugins/fn-r/extra.c
	(pfuncinverter): Improve case where initial guess is outside valid
	range.

2005-05-31  Stepan Kasal  <kasal@ucw.cz>

	* src/dialogs/dialog-solver.c (solver_max_time_err): Move the
	  variable and its initialization...
	* src/gutils.c (gutils_init): ... here.
	* src/gutils.h (solver_max_time_err): Declare.
	* src/tools/solver/solver.c: Include gutils.h instead of the
	  declaration of solver_max_time_err.

2005-05-31  Stepan Kasal  <kasal@ucw.cz>

	* src/commands.c (cmd_set_text): Remove the variable `GObject *obj';
	it's not needed.  Similarly for other 43 command functions.

2005-05-31  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* src/ssconvert.c (main):
	* src/ssindex.c (main): Use go_shell_argv_to_glib_encoding() as well.

2005-05-31  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=304559
	* src/sheet-object-widget.c (sheet_object_widget_new_view) : keep the
	  view hidden until we can set the bounds

2005-05-30  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* src/main-application.c (main): Use go_shell_argv_to_glib_encoding(),
	so we can open file with name in any encoding when users "open" them in
	explorer (Win32).

2005-05-29  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=167584
	* src/sheet-object-widget.c (cb_adjustment_config_ok_clicked) : relink
	  after changing the expression.
	(sheet_widget_adjustment_set_details) : ditto.
	(cb_checkbox_config_ok_clicked) : ditto.
	(sheet_widget_checkbox_set_link) : ditto.

2005-05-29  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=165061
	* src/mstyle.c (mstyle_equal_header) : new
	* src/ranges.c (range_has_header) :  use it.

2005-05-29  Jody Goldberg <jody@gnome.org>

	* src/dependent.c (cb_collect_deps_of_name) : collect all deps of
	  names, even those we're about to lose.  Things need to be unlinked.

2005-05-27  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=305405
	* src/gui-clipboard.c (x_targets_received) : Add biff atoms to support
	  pastes from MS Excel.
	(table_content_received) : ditto.

2005-05-27  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (discpfuncinverter, pfuncinverter): Make public.

	* src/position.c (eval_pos_init_cell): Constness fix.

	* src/cell.h (CELL_TO_DEP): Preserve constness.

	* src/dependent.c (dump_range_dep): Use range_name.
	(cell_queue_recalc): Not const.

2005-05-26  Stepan Kasal  <kasal@ucw.cz>

	* src/clipboard.c: Remove unneeded includes.

	* src/gnumeric-gconf.c: Move common headers to the top, add more
	  stubs for build without gtk.

	* src/ranges.c (range_name): Simplify.
	(global_range_name): Make the first parameter const.
	* src/ranges.h (global_range_name): Ditto.

2005-05-26  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (discpfuncinverter): New function.
	(qpois): New implementation based on discpfuncinverter.

2005-05-25  Morten Welinder  <terra@gnome.org>

	* src/gui-clipboard.c (text_to_cell_region): Fall back to string.
	Fixes #305404.

	* src/workbook-control-gui.c (wbcg_create_edit_area): Add tooltips
	for ok_button, cancel_button, and func_button.

2005-05-23  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_reorganize_sheets_delete_recreate_sheet):
	Plug leak.

	* src/dependent.c (cb_name_invalidate): Fix a crash relating to
	globally scoped names.

	* src/workbook-edit.c (cb_entry_delete_text): Make this work for
	non-rich text also.  Turn off auto-completion.
	(cb_entry_insert_text): Make this work for non-rich text also.
	Turn off auto-completion if the insert is not at the end.
	(cb_entry_cursor_pos): Make this work for non-rich text also.
	Turn off auto-completion if the cursor is no longer at the end.
	(wbcg_edit_finish): Always turn off signals if they have been
	connected.
	(wbcg_edit_start): Always bind insert_text, delete_text, and
	cursor position signals here.
	(wbcg_edit_init_markup): Don't connect to insert_text, delete_text
	and cursor position signals here.
	(auto_complete_matches): Get rid of ugly event hack.

	* src/commands.c (command_redo): Keep a ref to the command and
	handle someone clearing the redo queue.  Fixes #305007.

2005-05-23  Stepan Kasal  <kasal@ucw.cz>

	* src/position.c (parse_pos_init): Don't perform the same check
	  twice.
	* src/graph.c, src/sheet-object-widget.c (*_debug_name): All these
	  functions now take a GString as the second parameter; adapt to it.

2005-05-21  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (dependents_link): Drop pointless rwinfo
	argument.  All callers changed.

2005-05-20  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (gnm_dep_container_dump): Dump also dynamic
	dependencies and name dependencies.

	* src/workbook-control.c (wb_control_parse_and_jump): Use
	expressions like A1, not A1:A1 for single cells.

2005-05-20  Stepan Kasal  <kasal@ucw.cz>

	* src/sheet-filter.c (filter_view_set_bounds): Remove unused
	  variable so.

2005-05-19  Morten Welinder  <terra@gnome.org>

	* src/sheet.h (struct _Sheet): add being_invalidated flag.

	* src/dependent.c (dependents_workbook_destroy): Renamed from
	workbook_deps_destroy.  Mark all sheets being_invalidated before
	actually doing so.
	(dependents_invalidate_sheet): Renamed from sheet_deps_destroy.
	(do_deps_destroy): Don't take a GnmExprRewriteInfo argument --
	create it locally.

	* src/expr.h (struct _GnmExprRewriteInfo): Combine
	GNM_EXPR_REWRITE_SHEET and GNM_EXPR_REWRITE_WORKBOOK into
	GNM_EXPR_REWRITE_INVALIDATE_SHEETS.

2005-05-19  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (pre_sheet_index_change): Use dependent_unlink
	directly as callback.
	(post_sheet_index_change): Use dependent_link directly as
	callback.

	* src/dependent.c (dependent_link, dependent_unlink,
	link_expr_dep, unlink_expr_dep): Drop the pos argument, infer when
	needed.  All callers changed.

2005-05-18  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (dependent_pos): New utility function.
	(dependent_set_sheet, dependent_add_dynamic_dep, dependent_unlink,
	dependents_link, do_deps_destroy, dynamic_dep_free): use
	dependent_pos.
	(link_expr_dep, unlink_expr_dep, dependents_unrelocate_free,
	dependents_unrelocate): Avoid cast.

2005-05-18  Jody Goldberg <jody@gnome.org>

	* src/expr-name.c (expr_name_new) : make public
	(expr_name_add) : accept a stub object.

2005-05-17  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_focus_other_sheet) : fix

2005-05-17  Morten Welinder  <terra@gnome.org>

	* src/expr-name.c (expr_name_set_expr): Don't relink deps for
	sheets that are being destroyed.

2005-05-16  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): Fix and simplify rotated case.

	* src/cell-draw.c (cell_draw): Simplify rotated case.

	* src/rendered-value.c (rendered_value_remeasure): Collect extra
	information for rotated values.
	(rendered_value_init): Setup a separate pool for rotated cells.
	(rendered_value_shutdown): Shut that down.

2005-05-16  Stepan Kasal  <kasal@ucw.cz>

	* src/sheet-control-gui.c (scg_drag_receive_uri_list): Change the
	  type of local variable `mime' to `const gchar *'.

2005-05-16  Morten Welinder  <terra@gnome.org>

	* configure.in (set_more_warnings): Kill -Wcast-align.  It does
	not catch anything useful.  We run-time check, either in gobject
	macros or else by virtue of running on a Sparc.  Also we do *tons*
	of valid cast from base classes to derived classes after carefully
	checking the dynamic type.

2005-05-16  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c (filter_foo_view_init) : remove debug spew

2005-05-16  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (PKG_PROG_PKG_CONFIG): Fix the explanation above.

2005-05-15  Jean Brefort  <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_vector_get_value),
	(gnm_go_data_matrix_get_value): always release the value returned by
	value_coerce_to_number.

2005-05-15  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Bumped the goffice requirement as we need GORegexp now.
	Enable a number of additional warnings (when available)
	for which the current code base is already virtually clean.
	* src/func.c, src/gnumeric-gconf.c: Clean up function declarations.
	* src/sheet.h: Include prototype for sheet_apply_border.

2005-05-13  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=164950
	* src/ranges.c (range_trim) : make this more efficient.

2005-05-14  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=165734
	* src/value.c (find_rows_that_match) : The column in the condition is
	  absolute, not relative to the start of the input range.

2005-05-14  Jody Goldberg <jody@gnome.org>

	* src/ranges.c (gnm_sheet_range_from_value) : renamed from
	  value_to_global_range.
	(gnm_sheet_range_new) : renamed from global_range_new.
	(gnm_sheet_range_free) : renamed from global_range_free.
	(gnm_sheet_range_overlap) : renamed from global_range_overlap.
	(gnm_sheet_range_dup) : renamed from global_range_dup.

	* src/value.c (value_new_cellrange_str) : renamed from
	  global_range_parse.

2005-05-13  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (get_rotated_layout_bounds): Remove.
	(rendered_value_remeasure): Rework the rotated case to match Excel
	much better.
	(rendered_value_new): Setup new noborders member.

	* src/sheet.c (sheet_apply_border): New functions.  Setting
	borders for rotated cells actually causes different rendering.

	* src/commands.c (cmd_format_undo): Fix CRITICAL.
	(cmd_format_redo): Use sheet_apply_border instead of going
	directly to sheet_style_apply_border.

	* src/cell-draw.c (cell_draw): Rework rotated case to match Excel
	much better.

	* src/style.c (style_default_halign): Handle that down rotations
	are now angles >180, not <0.

2005-05-13  Stepan Kasal  <kasal@ucw.cz>

	* src/xml-sax-read.c (content_ns, gnumeric_1_0_dtd): Mark these
	  variables with G_GNUC_UNUSED, the #warning below is enough.

2005-05-12  Jody Goldberg <jody@gnome.org>

	* src/value.c (parse_database_criteria) : remove old FIXME with a
	  simple test.

	http://bugzilla.gnome.org/show_bug.cgi?id=165700
	* src/commands.c (update_after_action) : re-focus only controls for
	  the current view, not all controls.

2005-05-12  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c (filter_expr_eval) : for regexp based matches
	  make sure we matched the whole string.

2005-05-10  Jean Brefort  <jean.brefort@normalesup.org>

	* src/value.c: (value_get_as_gstring): exchange row_sep and col_sep
	when formatting an array formula.

2005-05-10  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2005-05-10  Jody Goldberg <jody@gnome.org>

	* Release 1.5.1

2005-05-09  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_sheet_attach_at_pos): Add a ref to
	sheet to balance the unref in workbook_sheet_detach.
	(workbook_sheet_attach): Counter the above ref here.
	(workbook_sheet_add): Counter the above ref here.  Document that
	the returned sheet's ref is owned by the workbook.
	(workbook_sheet_detach): Get rid of sheet views here.  Replace
	almost all uses of this with workbook_sheet_delete.  (It was
	typically used to get rid of sheets that got created during a load
	which then failed.)

	* src/workbook-control-gui.c (wbcg_insert_sheet,
	wbcg_append_sheet): Use new cmd_reorganize_sheets2.

	* src/sheet.c (sheet_set_name): Fix logic to determine if a sheet
	is attached.
	(sheet_cell_destroy): Don't get rid of view here.

	* src/commands.c (command_undo): Hold a ref to cmd so it doesn't
	go away underneath us.  Don't crash if the undo command clears the
	undo queue.

	* src/workbook.c (workbook_sheet_state_diff): Implement.

	* src/workbook-control-gui.c (cb_sheet_label_drag_begin): Fix
	multihead issue.  Plug leak.

	* src/application.c (gnm_app_get_pixbuf): Remove.  All callers
	fixed.
	(add_icon): Don't install both a scalable and a fixed-sized icon.
	Fixes #302902.

2005-05-08  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-read.c (xml_sax_styleregion_start) : work around use of
	  negative rotations which are used to indicate vertical text.
	* src/xml-io.c (xml_read_style) : ditto.

2005-05-07  Jody Goldberg <jody@gnome.org>

	* src/style.h : Add a 'VALIGN_DISTRIBUTED' that was added in XP
	  dunno what it does yet.
	* src/dialogs/dialog-cell-format.c : Add an entry for DISTRIBUTED

	* src/mstyle.h : document the range of rotation

	* src/workbook-view.c : remove pointless include
	* src/hlink.c : remove pointless include

2005-05-07  Jean Brefort  <jean.brefort@normalesup.org>

	* src/dialogs/dialog-about.c: (dialog_about): add NULL third arg
	to go_data_vector_val_new and go_data_vector_str_new.
	* src/stf-parse.c: use go_setlocale instead of gnm_setlocale.
	* src/xml-io.c: (xml_workbook_write), (xml_workbook_read): ditto.
	* src/xml-sax-read.c: (gnm_xml_file_open): ditto.
	* src/xml-sax-write.c: (gnm_xml_file_save),
	(gnm_cellregion_to_xml): ditto.

2005-05-06  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_sheet_move): Public again.  Fix docs.

	* src/workbook-control-gui.c (gnm_notebook_page_num_by_label):
	Renamed from gtk_notebook_page_num_by_label.
	(cb_sheet_label_drag_data_received): Fix this in the presence of
	hidden sheets.
	(wbcg_sheet_move): Change to take old_pos, not new_pos which is
	trivial to get.  All callers changed.  Fix for the case where some
	sheets are hidden.

	* src/workbook.c (workbook_unref): Remove and replace calls with
	simple g_object_unref

2005-05-05  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_focus_other_sheet): New function.
	(workbook_sheet_hide_controls, workbook_sheet_delete): Use
	workbook_focus_other_sheet.
	(workbook_sheet_unhide_controls): Do nothing if sheet is already
	shown.
	(workbook_sheet_add): Take a numerical position, not a sheet
	pointer for placement.  All callers changed.
	(workbook_sheet_attach_at_pos): New function extracted from
	workbook_sheet_attach.
	(workbook_sheet_attach): Make this not take a placement parameter.
	All callers changed.
	(workbook_sheet_move): Make static, don't return a value, and make
	3d references.
	(workbook_sheet_state_new, workbook_sheet_state_free,
	workbook_sheet_state_restore, workbook_sheet_state_diff): New
	functions.

	* src/commands.c (cmd_reorganize_sheets2): New function.
	(cmd_rename_sheet): Use cmd_reorganize_sheets2.

	* src/dependent.c (do_deps_destroy): Fix sheet-remove crash.

2005-05-04  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (cb_show_menu_tip): Don't translate a space.

	* src/commands.c (cmd_rename_sheet): Simplify calling convention.
	Single caller fixed.

	* src/gui-util.c (gnumeric_popup_menu): If we have an event
	anchor, use that to figure out what screen to show the popup on.

2005-05-03  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (cb_zoom_change): New function,
	extracted from wbcg_zoom_feedback.
	(wbcg_zoom_feedback): Remove zoom_feedback method.
	(wbcg_sheet_add): Don't attach to sheet notify signals here.
	(wbcg_sheet_focus): Do it here so we only watch one sheet at a
	time.
	(wbcg_sheet_remove, wbcg_sheet_remove_all): Disconnect here too.

	* src/sheet.c (sheet_set_zoom_factor): Make static and add
	zoom-factor property.  All callers changed.

	* src/workbook-view.c (wb_view_prefs_update): Remove.

	* src/workbook-control-priv.h: Remove prefs_update member.

	* src/sheet-control-priv.h: Remove adjust_preferences and
	direction_changed members.

	* src/sheet-control-gui.c (sheet_control_gui_new): Also hook up to
	sheet:text-is-rtl.

	* src/workbook-control-gui-priv.h: Remove rtl property.  All users
	changed to use sheet's text_is_rtl (and some already were).

	* src/sheet-control-gui-priv.h: Remove text_is_rtl property.  All
	users changed to use sheet's text_is_rtl (and some already were).

	* src/xml-sax-read.c (xml_sax_sheet_name): Use g_object_set to set
	sheet properties.

	* src/workbook-control-gui.c (wbcg_sheet_add): Connect to more
	sheet properties.
	(workbook_control_gui_class_init): Eliminate
	wbc_class->menu_state.sheet_prefs.

	* src/sheet.c (gnm_sheet_set_property): Add properties
	"display-outlines-below" and "display-outlines-right".
	(sheet_adjust_preferences): No need to call
	wb_control_menu_state_sheet_prefs anymore.

	* src/sheet-control-gui.c (sheet_control_gui_new): Connect to
	notify signals for all the sheet properties that cause changed
	display.

2005-05-02  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_add): Connect to
	sheet::name, sheet:tab-foregound, sheet:tab-background.
	(wbcg_sheet_remove): Disconnect.
	(wbcg_sheet_rename): Remove this method from the class.

	* src/commands.c (cmd_reorganize_sheets_finalize): Plug leak.

	* src/workbook-control-gui.c (cb_sheet_label_drag_end): Plug leak.

	* src/workbook.c (workbook_detach_view): Call sv_dispose to break
	circular links.
	(workbook_sheet_hide_controls): Fix search for focus and thus
	return value.
	(workbook_set_dirty, workbook_is_dirty, workbook_is_pristine):
	Walk the sheet array, not the hash.

	* src/sheet.c (sheet_destroy): Call sv_dispose to break circular
	links.

	* src/sheet-view.c (sheet_view_new): Keep a ref to the sheet.
	(sv_dispose): New function.
	(sv_real_dispose): Renamed from s_view_finalize (and made proper
	for a dispose function).

2005-05-02  Morten Welinder  <terra@gnome.org>

	* src/sheet-view.c (sv_direction_changed): Make static and change
	to a notification handler.

	* src/sheet.c (sheet_attach_view): Fold into sheet_view_new.
	(sheet_detach_view): Fold into s_view_finalize.
	(gnm_sheet_init): Setup ->sheet_views properly here.

	* src/style-color.c (gnm_style_color_get_type): New function
	defining the type as a boxed type.

	* src/sheet.c: Add "name", "tab-foreground", and "tab-background"
	properties.
	(sheet_set_tab_color): Remove.  All callers changed to use
	g_object_set.
	(sheet_rename): Make static.  All callers changed to use
	g_object_set.

2005-04-21  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object.[ch]: Add sheet_object_get_target_list.

	* src/sheet-object-image.c (sheet_object_image_get_target_list):
	New. Gets targets object is able render itself as.
	(soi_imageable_init): Register get_target_list virtual.

	* src/sheet-object-graph.c (sheet_object_graph_get_target_list):
	New. Gets targets object is able render itself as.
	(sog_imageable_init): Register get_target_list virtual.

	* src/sheet-control-gui.c (scg_drag_send_image): Use
	go_mime_to_image_format to get format.

	* src/gui-clipboard.c (image_write): Use go_mime_to_image_format
	to get image format.
	(target_list_to_entries): New. Convert a target list to an array
	of GtkTargetEntries.
	(x_claim_clipboard): Use sheet_object_get_target_list to get
	targets for images.

	* src/gnumeric-pane.c (cb_test_so_imageable): Remove
	(target_list_add_list): New. Add targets from "added_targets" to
	"targets".
	(gnm_pane_drag_begin): Use sheet_object_get_target_list to get
	targets for images.

2005-04-29  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (gnm_sheet_class_init): Make lots of things
	properties.
	(sheet_set_visibility, sheet_toggle_show_formula,
	sheet_toggle_hide_zeros): Make static (and make the toggle ones
	actually toggle).

	* src/commands.c (cmd_toggle_rtl_redo): Use go_object_toggle.

	* src/sheet.c (sheet_set_direction): Make static.  Change all
	existing callers to use g_object_set.
	(gnm_sheet_class_init): Install PROP_RTL.

2005-04-28  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (AC_CANONICAL_HOST): Call explicitly, we use $host.
	(WITH_WIN32): Small changes to make more the same as in goffice.
	(--disable-plugins): Support this.
	(WINDRES): Add an AC_ARG_VAR declaration.
	And some whitespace changes.

2005-04-26  Morten Welinder  <terra@gnome.org>

	* src/print-info.c (hf_format_render): If format is NULL, simply
	return NULL.

	* src/print.c (print_hf_element): Handle NULL text from
	hf_format_render same as "".

	* src/gui-file.c (gui_file_save_as): Add a little crash safety.

2005-04-21  Stepan Kasal  <kasal@ucw.cz>

	* src/Makefile.am (gnumeric-paths.h): Rewrite the rule,
	  gnumeric-paths.sh* is no longer used.
	* src/gnumeric-paths.sh.in: Removed.
	* src/.cvsignore: Remove src/gnumeric-paths.sh.
	* configure.in: Don't generate gnumeric-paths.sh, rearrange the
	  gnumeric_* AC_SUBSTs.
	(gnumeric_gladedir, gnumeric_autoformatdir): Nuke.
	* src/dialogs/Makefile.am (gnumeric_gladedir): Replace by value.
	* templates/autoformat/Makefile.am (autoformatdir): New variable.
	(EXTRA_DIST): Don't use "%" when replacing suffixes; it's GNU make
	  specific.

2005-04-20  Stepan Kasal  <kasal@ucw.cz>

	gnm_sys_lib_dir() and such now just return the string;
	they don't take any parameter and don't allocate anything.

	* src/libgnumeric.h (gnumeric_lib_dir, gnumeric_data_dir):
	  Move to gutils.h; #include "gutils.h".
	(gnumeric_icon_dir, gnumeric_locale_dir): Move to gutils.c
	  and make static.
	* src/libgnumeric.c: Likewise.
	(gnm_pre_parse_init): Call gutils_init instead of doing it.
	(gnm_shutdown): Call gutils_shutdown instead of doing it.
	* gutils.h:
	* gutils.c (gutils_init, gutils_shutdown): New functions.
	(gnumeric_usr_dir): New static variable, set up in gutils_init.
	(gnm_sys_lib_dir, gnm_sys_data_dir, gnm_usr_dir): Just return
	  the static string; all callers fixed.
	(gnm_sys_glade_dir, gnm_sys_plugin_dir, gnm_usr_plugin_dir):
	  Nuked; callers fixed to build the string themselves.
	(gnm_icon_dir, gnm_locale_dir): New wrappers; callers fixed.
	(PLUGIN_SUFFIX): Renamed to ...
	(PLUGIN_SUBDIR): ..., and moved to .h.
	* src/gui-util.c (gnumeric_icondir): This function was removed;
	  callers fixed to use gnm_icon_dir.

	* src/sheet-object-image.c: Include goffice/utils/go-glib-extras.h

2005-04-20  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* src/wbc-gtk.c (wbc_gtk_init_font_name): Set
	"case-sensitive" to FALSE. Fix #161382.

2005-04-19  Morten Welinder  <terra@gnome.org>

	* src/clipboard.c (clipboard_init, clipboard_shutdown): New
	functions.
	(gnm_cell_copy_new): Alloc in pool.
	(cellregion_unref): Free from pool.

	* src/libgnumeric.c (gnm_common_init): Call clipboard_init.
	(gnm_shutdown): Call clipboard_shutdown.

	* */*.c: #include fixes.

	* src/rangefunc.c (range_mode): Fix the case where multiple
	different values occur equally often.

2005-04-18  Stepan Kasal  <kasal@ucw.cz>

	* src/libgnumeric.h (gnumeric_lib_dir, gnumeric_data_dir):
	(gnumeric_icon_dir, gnumeric_locale_dir): Declare as "const char*",
	  not "const char[]"; we use "&gnumeric_lib_dir" sometimes.
	* src/libgnumeric.c: Likewise.

2005-04-19  Stepan Kasal  <kasal@ucw.cz>

	* src/Makefile.am (SUFFIXES): Remove, Automake (at least >= 1.7)
	  deduces this.

2005-04-18  Stepan Kasal  <kasal@ucw.cz>

	* src/libgnumeric.h (gnumeric_lib_dir, gnumeric_data_dir):
	(gnumeric_icon_dir, gnumeric_locale_dir): Declare as "const char[]"
	to get rid of some warnings (unless we are on OS/2).
	* src/libgnumeric.c: Likewise.

2005-04-18  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Call PKG_PROG_PKG_CONFIG explicitly.
	* Makefile.am (dist-hook): Don't handle gnumeric.spec here, ...
	(EXTRA_DIST): ... it's enough to add it here.
	  I tested this change with automake versions 1.7.9, 1.8.5 and 1.9.5.
	* schemas/Makefile.am: To silence `automake -Wall', don't use
	pattern rules (with %.reg), use portable suffix rules instead.

2005-04-16  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* configure.in:
	* Makefile.am: New subdir 'tools', we now have a win32
	binary to build.

	* schemas/Makefile.am: Install .reg files into
	$prefix/etc/win32/reg. Two versions are served, i.e.
	.hkcu.reg and .reg. When the user chooses to install
	gnumeric/win32 for the "current user" only, use .hkcu.reg
	and otherwise .reg.

	* src/tools/Makefile.am:
	* src/tools/gconf-schemas-to-win32-reg.c: Moved to tools/;
	see tools/ChangeLog for details.

2005-04-15  Stepan Kasal  <kasal@ucw.cz>

	* schemas/Makefile.am (CLEANFILES): Add $(reg_DATA), if we are
	  building .reg files.
	Don't distribute $(schema_DATA).

2005-04-13  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pfuncinverter): Handle Newton search when log_p
	is TRUE.
	(dgamma1, dbeta1): Don't bail out for log_p.

2005-04-13  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_claim_clipboard): Don't clear clipboard
	if we still own CLIPBOARD.

	* src/sheet-control-gui.c (scg_drag_receive_uri_list): Handle a
	bunch of extra mime types for dropped files.
	(scg_drag_receive_cellregion,
	(scg_drag_receive_same_proc_other_scg,
	(scg_drag_send_clipboard_objects): Check that cell region is non
	null before using it.

2005-04-12  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_sendto): Fix setting of "problem".
	Handle failure of mkdtemp.

2005-04-11  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (qf): Make our own version of this.

2005-04-10  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* src/dialogs/dialog-preferences.c (cb_pref_font_hf_set_fonts,
	cb_pref_font_set_fonts):
	They were broken by my changes in 2005-04-08.

2005-04-09  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (qf): Make our own version of this.  It's quite
	simple now that we have a working qbeta.

2005-04-05  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=162951 : trivial
	* src/sheet-control-gui.c (scg_comment_display) : remove some
	  unnecessary code now that a gtk bug has been fixed.

2005-04-09  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* configure.in: Determine whether we are cross-compiling.

	* src/libgnumeric.[ch]: Path variables should not be const.

2005-04-08  Ivan, Wong Yat Cheung  <email@ivanwong.info>

	* schemas/Makefile.am: Convert .schemas to .reg if host_os ==
	win32 and we are not cross-compiling.

	* src/application.c (gnm_app_history_add):
	* src/libgnumeric.c (gnm_shutdown):
	* src/print-info.c:
	* src/dialogs/dialog-function-select.c
	(dialog_function_write_recent_func):
	* src/dialogs/dialog-preferences.c:
	* src/tools/auto-correct.c: adopt to the modified
	gnumeric-gconf's api.

	* src/tools/Makefile.am:
	* src/tools/gconf-schemas-to-win32-reg.c: New. The name
	explains itself.

	* src/gnumeric-gconf-priv.h:
	* src/gnumeric-gconf.[ch]: Introduce the concept of a
	"node". Implement the win32 backend.

2005-04-08  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pfuncinverter): Improve in the special case
	where one of the interval endpoints is 0.

	* src/xml-sax-write.c (gnm_xml_file_save): Untangle the
	do-we-compress logic and make it work.  Fixes #173030.
	* src/xml-io.c (gnumeric_xml_write_workbook): Ditto.

	* src/xml-sax-write.c (xml_write_cell_and_position): Fix crash.
	* src/xml-io.c (xml_write_cell_and_position): Ditto.

2005-04-04  Morten Welinder  <terra@gnome.org>

	* src/stf-export.c (stf_export_cell): Introduce "auto" mode and do
	something sensible with dates and times.  (Fixes #128936)

2005-04-04  Stepan Kasal  <kasal@ucw.cz>

	s/INCLUDES/AM_CPPFLAGS/  "automake -Wall" has told me this.

	* src/Makefile.am (non-intermediate): New dummy rule; see
		http://bugzilla.gnome.org/show_bug.cgi?id=172211 and
		http://bugzilla.gnome.org/show_bug.cgi?id=172212
	(.list.c, .list.h): Remove $(GLIB_GENMARSHAL); it didn't work
	  anyway, the prerequisities of an implicit rule are ignored.
	* Makefile.am: Use $(POFILES_FULL), not GNU-specific $(wildcard...).
	* configure.in (GLIB_GENMARSHAL): Full path is not needed.
	(POFILES_FULL): New AC_SUBSTed variable, contains full paths to
	  po/*.po files.
	(perl): Fix a typo, and a few cosmetic changes.
	(AC_OUTPUT): Remove plugins/perl/*.
	* plugins/perl/*: Removed.

2005-04-04  Morten Welinder  <terra@gnome.org>

	* src/stf-export.c: Derive from GsfOutputCsv.

2005-04-04  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-write.c (gnm_cellregion_to_xml) : add a namespace decl

2005-04-04  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-read.c : moved into the core from a plugin
	* src/xml-sax-write.c : ditto.
	(gnm_cellregion_to_xml) : new.

	* src/xml-io.c (xml_cellregion_write) : delete the DOM based version.
	(xml_init) : register the sax in/out routines

2005-04-04  Jody Goldberg <jody@gnome.org>

	* src/gui-clipboard.c (cellregion_to_string) : remove offset.

2005-04-02  Morten Welinder  <terra@gnome.org>

	* configure.in (perl): Fix perl checks.  (I hope.)

2005-04-02  Jean Brefort  <jean.brefort@normalesup.org>

	* src/style.c: (style_init), (style_shutdown): removed calls to
	number_format_init/shutdown (moved to goffice).

2005-04-01  Steve Murphy  <murf@e-tools.com>

	* configure.in: Added "rw" to ALL_LINGUAS.

2005-04-01  Morten Welinder  <terra@gnome.org>

	* src/stf.c (csv_tsv_probe): In the content phase, decode to UTF-8
	before testing.  (Fixes #167191.)

2005-04-01  Jon K Hellan  <hellan@acm.org>

	* src/gnm-so-filled.c (gnm_so_polygon_write_xml_dom)
	(gnm_so_polygon_write_xml_sax): Fix warnings.

2005-04-01  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (wbcg_sheet_add): Make the
	GNUMERIC_SHEET target GTK_TARGET_SAME_APP.
	(cb_wbcg_drag_data_received): Added source_widget parameter.

	* src/sheet-object.c (sheet_object_rubber_band_directly): Always
	return FALSE.

	* src/gnumeric-pane.c (drag_types_in, drag_types_out):
	New. Supported drag targets.
	(cb_pane_drag_data_received): Pass source widget to
	scg_drag_data_received.
	(cb_gnm_pane_drag_data_get): New. drag-data-get callback.
	(cb_gnm_pane_drag_motion): New. drag-motion callback.
	(cb_gnm_pane_drag_leave): New. drag-leave callback.
	(gnm_pane_drag_dest_init): New. Factor out of gnm_pane_init and
	Connect drag-data-get, drag-motion and drag-leave callbacks.
	(gnm_pane_init): Use it.
	(gnm_pane_objects_drag): New. Factored out of gnm_pane_object_move.
	(gnm_pane_object_move): Use it.
	(cb_test_so_imageable): New. Check if object is imageable.
	(gnm_pane_drag_begin): New. Start gtk drag.
	(cb_control_point_event): Use it.

	* src/sheet-control-gui.c (scg_paste_cellregion): New. Paste
	a cellregion.
	(scg_drag_receive_cellregion): New. Receive a dropped cellregion.
	(scg_drag_receive_uri_list): New. Receive a dropped uri list.
	(scg_drag_receive_same_scg): New. Receive a drop from same scg.
	(scg_drag_receive_same_proc_other_scg): New. Receive a drop from
	another scg in same process.
	(scg_drag_receive_same_process): New. Receive a drop from this
	gnumeric process.
	(scg_drag_data_received): Added source_widget parameter. Handling
	of each target moved to a separate function. Added support for gnumeric
	gtk clipboard format. Added support for process internal dnd which
	shortcuts the selection.
	(scg_drag_send_image): New. Send an image over the dnd selection.
	(scg_drag_send_clipboard_objects): New. Send selected objects over
	the dnd selection. Gnumeric gtk clipboard format is used.
	(scg_drag_data_get): New. Send selected objects over the dnd
	selection in requested format.

2005-04-01  Morten Welinder  <terra@gnome.org>

	* src/stf-export.c: Gut.  Use GsfOutputCsv.  (Fixes #126513.)

2005-03-31  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (regenerate_window_menu): Clean up and allow more
	windows in the menu.

	* src/search.c (gnm_search_replace_class_init): Make scope a
	property too.

	* src/commands.c (cmd_set_text): Improve undo description.  Fixes
	#171637.

	* src/workbook-view.c (wbv_save_to_uri): Don't set the error if we
	already have one.  Together with libgsf and goffice changes, this
	fixes #168581.

2005-03-31  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=87528
	* src/commands.c (cmd_paste_copy) : When not transposing and pasting
	  into a single cell, be more flexible and allow full cols/rows.

2005-03-31  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=87477
	* src/commands.c (cmd_paste_copy) : Use a nice simple tiling approach.

2005-03-30  Morten Welinder  <terra@gnome.org>

	* src/search.c (search_collect_cells): Drop sheet argument.  We
	already have it.  All callers changed.

	* src/commands.c (cmd_search_replace_do): Drop unused sheet and
	workbook arguments.  All callers changed.
	(cmd_search_replace): Drop sheet argument.  All	callers changed.

	* src/search.c: Adapt to goffice changes.  (Aka make it an object
	and cut most of it.)
	(gnm_search_replace_class_init): Define a pile of properties.

2005-03-29  Jody Goldberg <jody@gnome.org>

	* src/func.c (tokenized_help_new) : warning suppression.

	* src/expr.c (gnm_expr_is_array) : new.

2005-03-29  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_write_cell_and_position) : Take a value and
	  expression directly rather than a Cell to allow re-use between the
	  new clipboard data structure GnmCellCopy and GnmCell.

	* src/gui-clipboard.c (text_to_cell_region) : store data directly.
	(cellregion_to_string) : moved from clipboard.c and tweaked to support
	  the new data structure.
	(x_clipboard_get_cb) : no need for a pango context, we ignore variable
	  width formats when exporting.

	* src/sheet-style.c (style_list_get_style) : Use col & rol vs CellPos.

	* src/clipboard.c : Simplify GnmCellCopy and remove the ancient bogus
	  notion of keeping a copy of a full cell.
	(contents_as_expr) : renamed from cell_get_contents_as_expr, and
	  changed to take the expr and val directly.
	(apply_paste_oper_to_values) : deleted and merged into.
	(paste_cell_with_operation) : here.
	(gnm_cell_copy_new) : new.
	(paste_cell) : add some const.
	(clipboard_paste_region) : const and adjust to the changes.
	  We can test for pasting content here rather than per-cell.
	(cb_clipboard_prepend_cell) : use gnm_cell_copy_new.
	(cellregion_unref) : adjust to data structure change.
	(cellregion_to_string) : moved into gui-clipboard.c.  It's not really
	  gui specific but that is the only thing that uses it for now.

2005-03-29  Jon K Hellan  <hellan@acm.org>

	* src/xml-io.c (xml_cellregion_read): Silence warning.

2005-03-29  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (col_name_internal): Handle nagative column
	numbers a bit saner.

2005-03-29  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (--with-perl): Mention bug #171957.

2005-03-28  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (image_write): Look harder for selected
	imageable objects.

	* src/item-grid.c (drag_start): Remove.
	(item_grid_button_press): Don't call drag_start.

	* src/xml-io.c (xml_cellregion_read): Make param 'buffer' const.

2005-03-28  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_auto_expr_precision): New function.

	* src/workbook-control-gui.c (cb_auto_expr_precision_toggled): New
	function.
	(cb_select_auto_expr): Add a check item to control whether maximum
	precision is used.

2005-03-28  Jon K Hellan  <hellan@acm.org>

	* src/clipboard.[ch]: (clipboard_copy_obj): New. Returns a cell
	region with copies of objects in list. Factored out of
	gnm_app_clipboard_cut_copy_obj.

	* src/application.c (gnm_app_clipboard_cut_copy_obj): Use
	clipboard_copy_obj.

2005-03-28  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_auto_expr_recalc): Take format from
	auto-format.
	(wb_view_auto_expr_recalc): Plug leak.

	* src/xml-io.c: Don't include <goffice/utils/go-locale.h> which
	just went away and wasn't needed anyway.

	* src/*.c src/*/*.c plugins/*/*.c: Use canonical object property
	names.

2005-03-24  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=171503
	* src/gnumeric-gconf.c (gnm_gconf_set_printer_config) : take control
	  of the string.

2005-03-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/style-border.c (style_border_hash): use GPOINTER_TO_UINT
	  rather than just casting.

2005-03-24  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_clipboard_get_cb): Plug leak.

2005-03-24  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (tdistexp): Take a log_p flag.  Improve accuracy
	a tiny bit, mostly in the log case.
	(binApprox): Move logs earlier and improve log case's accuracy.

	* src/application.c (gnm_app_get_pixbuf): Use non-zero size.

	* src/print.c (print_hf_element): If we have no format, don't
	print anything.

2005-03-23  Morten Welinder  <terra@gnome.org>

	* src/numbers.h: For long double support, include sunmath.c if we
	have it.
	* configure.in: Check for sunmath.h

2005-03-23  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-graph.c (sheet_object_graph_write_image):
	New. Implements SheetObjectImageable. Extracted from
	sog_cb_save_as.
	(sog_cb_save_as): Use sheet_object_write_image.
	(sog_imageable_init): SheetObjectImageable gobject voodoo.

	* src/application.c (gnm_app_clipboard_cut_copy_obj): Save sheet
	object points dimensions as object data.

2005-03-23  Morten Welinder  <terra@gnome.org>

	* src/io-context-gtk.c (icg_processing_file): Fix for Win32.
	* src/main-application.c (warn_about_ancient_gnumerics): Fix for
	Win32.

	* src/workbook-view.c (wb_view_sendto): Use g_mkdir, not mkdir.
	(cb_cleanup_sendto): Use g_unlink and g_rmdir, not unlink and
	rmdir.

	* src/mathfunc.c (random_01): Use g_open, not open.

	* src/main-application.c (warn_about_ancient_gnumerics): use
	g_stat, not stat.

	* src/func.c (function_dump_defs): Use g_fopen, not fopen.

	* src/file-autoft.c (category_list_get_from_dir_list): Use
	g_file_test, not stat.

2005-03-23  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (HAVE_LIBZ): Don't define it, noone uses it, since
	  zlib is mandatory.

2005-03-22  Morten Welinder  <terra@gnome.org>

	* templates/autoformat/Makefile.am (install-data-local): Don't use
	${var#pat} and ${var%pat}; it's POSIX feature, but it doesn't work
	with Solaris' /bin/sh.

2005-03-22  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_update_action_sensitivity): Set
	editability of sheet tabs too.  Fixes #170958.
	(sheet_menu_label_run): If we have only one sheet, keep "Remove"
	in the menu, but make it inactive.  Disable everything when we
	have a guru.  Use an enum, not a define for bit fields.

2005-03-22  Stepan Kasal  <kasal@ucw.cz>

	* autogen.sh: REQUIRED_AUTOCONF_VERSION=2.54  We already required
	  that indirectly, by asking for Automake >= 1.7.2.
	* configure.in: AC_PREREQ(2.54)
	  - don't default to --without-gtk even if the reqs are not met;
	  - fail if someone tries --with-python=/path;
	  - when searching for $PYTHON, try python2.4 and such;
	  - don't generate stamp.h; the issue is solved by Automake 1.7.2;
	    see info '(autoconf)Automatic Remaking' for details.
	* stamp.h.in: Nuke.
	* .cvsignore: Remove stamp.h and stamp-h.in.

2005-03-21  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_dispose): Simplify using
	workbook_set_saveinfo.  Move destruction of local functions to
	here.
	(workbook_finalize): From here.
	(workbook_sheet_name_strip_number): Fix docs; handle overflow;
	return unsigned value.
	(workbook_sheet_get_free_name): Adapt to changes in
	workbook_sheet_name_strip_number.

2005-03-21  Stepan Kasal  <kasal@ucw.cz>

	* autogen.sh: Remove the unfortunate TRANSL_ONLY; fix the explanation
	  why we need our own copy of po/Makefile.in.in; use a nicer code to
	  generate po-functions/POTFILES.*.
	* README: Fix the Debian package name for pango, remove the intltool
	  requirement.
	* gnumeric.spec.in: Update the dependencies.

2005-03-17  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_claim_clipboard): Check for content == NULL.

2005-03-17  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (maybe_convert): Use go_guess_encoding.

2005-03-17  Stepan Kasal  <kasal@ucw.cz>

	* autogen.sh: Use egrep, not awk; there is a system which distributes
	  a very broken version of it.  Thanks to Morten for noting this.

2005-03-16  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (maybe_convert): Explicitly try ISO-8859-1 if
	locale fails.

	* src/workbook-control.c (wb_control_update_title): Handle NULL
	basename.

	* src/wbc-gtk.c (regenerate_window_menu): Ignore workbooks where
	we don't get a valid basename.

	* src/workbook-priv.h (struct Workbook): Remove .basename.

	* src/workbook.c (workbook_get_basename): Delete, it's unused.

	* src/parse-util.c (row_parse): Fix parsing problem.  [#170465]

2005-03-13  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=169830
	* src/gnumeric-pane.c (gnm_pane_init) : init the zoom.
	(gnumeric_pane_header_init) : ditto.

2005-03-16  Stepan Kasal  <kasal@ucw.cz>

	* autogen.sh: require intltool >= 0.29; fix IFS handling;
	  create po*/Makefile.in.in and po-functions/POTFILES.* ---
	  and if the traslators don't want anything but these files, they
	  can just run "TRANSL_ONLY=1 ./autogen.sh".
	* acinclude.m4: Nuked, it shouldn't be needed.
	* Makefile.am (ACLOCAL_AMFLAGS): Remove.
	* configure.in: Do AC_SUBST(ACLOCAL_AMFLAGS, $ACLOCAL_FLAGS);
	  don't show --with-guile in the help, don't configure
	  directories plugins/gb/ and plugins/guile/.
	* plugins/Makefile.am (SUBDIRS): Simplify the conditional
	  assignments; omit subdirs gb and guile.
	* plugins/gb/Makefile.am, plugins/guile/Makefile.am: Add a text to
	  the top, warning about POTFILES.skip.
	* src/pixmaps/Makefile.am (STRIP_BEGIN, STRIP_END, STRIP_DUMMY):
	  Remove these, I see no need for them; the cosmetic advantage
	  can be achieved with one echo.
	* configure.in (STRIP_BEGIN, STRIP_END, STRIP_DUMMY): Don't detect.

	In many files, fix the typo contraint --> constraint.

2005-03-15  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (image_write): New. Write an object as image
	to the clipboard.
	(x_clipboard_get_cb): Analyze clipboard content and advertise
	image formats when appropriate.

2005-03-15  Morten Welinder  <terra@gnome.org>

	* src/search.h (struct SearchFilterResult): Don't store cell and
	comment.

	* src/workbook.c (workbook_sheet_detach): Emit sheet_deleted
	signal here.
	(workbook_sheet_delete): Not here.
	(workbook_dispose): New function, extracted from
	workbook_finalize.
	(workbook_class_init): Install ->dispose.

2005-03-15  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-image.c (sheet_object_image_write_image):
	New. Implements SheetObjectImageable. Extracted from
	soi_cb_save_as.
	(soi_cb_save_as): Use sheet_object_write_image.
	(soi_imageable_init): SheetObjectImageable gobject voodoo.

	* src/sheet-object.[ch] (sheet_object_imageable_get_type): New. For
	the SheetObjectImageable interface.
	(sheet_object_write_image): New. Method of SheetObjectImageable.

	* src/sheet-object-impl.h: Add _SheetObjectImageableIface

	* src/gnumeric.h: Add SheetObjectImageableIface

2005-03-14  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (sheet_finalize): New function, split out from
	sheet_destroy.
	(sheet_destroy): Just unref objects we hold refs for, i.e., no
	longer finalize.  All callers changed to unref sheet also.
	(gnm_sheet_class_init): Install sheet_finalize.  Define
	detached_from_workbook signal.

	* src/workbook-control-gui.c (wbcg_validation_msg): Fix arg order
	of go_gtk_dialog_run call.

	* src/gui-file.c (gui_file_save_as): Don't force local-only file
	chooser.

2005-03-12  Jon K Hellan  <hellan@acm.org>

	* src/wbcg-actions.c: Add <Ctrl>+P accelerator for print.

	* src/gui-clipboard.c (table_content_received): Paste selection
	with only objects, no cells.

2005-03-10  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): Pretend to have zoom=100%.

	* src/sheet-control-gui.h (scg_get_style_font): Delete.  Expand
	into all callers.

	* src/rendered-value.c (rendered_value_new,
	rendered_value_render): Take zoom as a parameter.  All callers
	changed.
	(calc_indent): Take zoom instead of sheet as parameter.

2005-03-11  Jon K Hellan  <hellan@acm.org>

	* src/gnumeric-pane.c (gnm_pane_init): Add drag action
	GDK_ACTION_MOVE. Needed for drag receive from konqueror.

2005-03-11  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (text_content_received): New. Split out of
	complex_content_received.
	(image_content_received): New. Receive image data.
	(table_content_received): Renamed from complex_content_received
	and split.
	(x_targets_received): Renamed from x_clipboard_received.
	(x_request_clipboard): Use gtk_clipboard_request_targets-

2005-03-10  Jon K Hellan  <hellan@acm.org>

	* src/sheet-control-gui.c (scg_image_create): New. The parts which
	are common to scg_paste_image and scg_drag_receive_img_data.
	(scg_paste_image): New. Create an image at natural size and place
	it  at position given by range.
	(scg_drag_receive_img_data): Move parts to scg_image_create.

2005-03-09  Morten Welinder  <terra@gnome.org>

	* configure.in (with-long-double): ride on top of libgoffice's
	stuff.  That kills all the ugly stuff here.

2005-03-07  Jon K Hellan  <hellan@acm.org>

	* src/sheet-control-gui.c (scg_drag_data_received): Check for NULL.

2005-03-07  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received):
	Delegate text/uri-list to scg_drag_data_received.

	* src/sheet-control-gui.c (scg_drag_receive_img_data): New. Receive
	dragged image data.
	* src/sheet-control-gui.c (scg_drag_receive_img_uri): New. Receive
	dragged image uri.
	(scg_drag_receive_spreadsheet): New. Receive dragged spreadsheet
	uri.
	(scg_drag_data_received): New. Receive drag data.

	* src/gnumeric-pane.c (cb_pane_drag_data_received): New. Receive
	drag data.
	(gnm_pane_init): Register as drag destination.

2005-03-07  Morten Welinder  <terra@gnome.org>

	* configure.in: We no longer need the "finite" hackery.

	* src/mathfunc.c (mathfunc_init): Use goffice's nan etc.

2005-03-04  Jon K Hellan  <hellan@acm.org>

	* src/ssindex.c (main): Plugin api renamed.

	* src/ssconvert.c (main): Ditto.

2005-03-04  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-control-gui.c (apply_move): don't get rtl flag from
	gcanvas, since it can be not fully initialized.

2005-03-03  Jon K Hellan  <hellan@acm.org>

	* src/session.c (interaction_function): Deiconify toplevel before
	displaying save/cancel dialog.

2005-03-03  Morten Welinder  <terra@gnome.org>

	* src/item-cursor.c (item_cursor_target_region_ok): Fix
	go_gtk_query_yes_no arg order.
	* src/gui-file.c (check_multiple_sheet_support_if_needed): Ditto.
	(gui_file_save_as): Ditto.

2005-03-02  Morten Welinder  <terra@gnome.org>

	* configure.in (gnumeric_gtk_reqs): Get rid of GnomeCanvas.

2005-03-01  Jody Goldberg <jody@gnome.org>

	* (all plugins) :
	    s/GNUMERIC_MODULE_PLUGIN_INFO_DECL/
	    GOFFICE_MODULE_PLUGIN_INFO_DECL(GNUMERIC_VERSION)/

	* configure.in : Add the libgoffice depend and remove the
	  src/cut-n-paste/goffice dirs
	remove test for gnome_print_pango_create_layout.
	    pango_layout_set_ellipsize,
	    pango_context_set_matrix,
	    pango_context_get_font_map

	* src/Makefile.am : drop the built in libgoffice and pcre libraries
	  we pull them externally now.

2005-03-01  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (gnumeric_glade_group_value): Constify.
	* src/mstyle.c (mstyle_names): Constify.
	* src/summary.c (summary_item_name): Constify.

2005-02-28  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (rendered_value_render): For numbers, map
	'-' to U2212 which has same width as "+".

	* src/gnm-format.h: Define a bunch of unicode characters by name.
	* src/parser.y (yylex): Use these.
	* src/cell-draw.c (cell_calc_layout): Ditto.

2005-02-25  Morten Welinder  <terra@gnome.org>

	* src/main-application.c (main): Properly get rid of wbcgs when
	using --quit.

	* src/workbook-control-gui.c (wbcg_create_status_area): Keep a ref
	for ->auto_expr_label in case the idle handler for updating it
	triggers at an inconvenient time.
	(wbcg_finalize): Unref.

	* src/main-application.c (main): Fix leak.

	* src/gnumeric-gconf.c (gnm_conf_shutdown): Fix crash with --quit.

2005-02-24  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_save_as): Fix arg order for
	go_url_check_extension.

	* src/wbcg-actions.c: Mark action arrays const now that 142334 has
	been fixed.  Assume GTK_STOCK_ABOUT.

2005-02-23  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (cb_sheet_label_drag_data_received,
	cb_sheet_label_drag_leave, cb_sheet_label_drag_motion): Don't
	crash or complain if drag source is in a different process.

2005-02-22  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Fix creation of po-functions/POTFILES.
	* src/Makefile.am: Fix declarations for generated sources.
	* src/cut-n-paste-code/goffice/utils/Makefile.am: Likewise.
	* plugins/corba/Makefile.am: Likewise.
	* idl/Makefile.am: Likewise.

2005-02-18  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (count_character): Ignore completely empty
	lines.  They aren't telling us anything about separators.

2005-02-17  Jody Goldberg <jody@gnome.org>

	* src/func.c (cb_generate_po) : more validation in preparation for
	  regenerating the help and po.

2005-02-16  Jody Goldberg <jody@gnome.org>

	* src/libgnumeric.c (gnm_pre_parse_init) : set the path for the new
	  gnumeric-functions message catalog

	* src/gnumeric-gconf.c : Add an ifdef to silence the gconf warnings
	* src/io-context.[ch], src/io-context-priv.h : move into goffice/app

2005-02-15  Morten Welinder  <terra@gnome.org>

	* src/main-application.c: Typo.  [#167495]

	* src/gui-file.c (do_save_as): Expand into lone caller.  Destroy
	dialog right after we're done with it, so there user doesn't get
	to press Save while we save.

2005-02-14  Stepan Kasal  <kasal@ucw.cz>

	Don't use #include <src/xyz.h>, as `-I $(top_srcdir)' is not
	always in the flags; none of these headers is duplicate in the
	tree, so we can safely omit the dirname.

2005-02-14  Stepan Kasal  <kasal@ucw.cz>

	* src/solver.h: Define most of the structures even if !ENABLE_SOLVER.
	* src/xml-io.c (xml_read_solver, xml_write_solver): Compile these two
	  functions even if !ENABLE_SOLVER, so that we don't cripple the
	  files we open and save; the only thing we really cannot do is to
	  to compute the text presentation of the constraints.

2005-02-12  Jon K Hellan  <hellan@acm.org>

	* src/stf-parse.c (stf_parse_sheet): Don't crash if parsing
	doesn't return lines.

2005-02-12  Jody Goldberg <jody@gnome.org>

	* configure.in : move function docs into a distinct message catalog
	* */*.c : modify all function docs to start using the new format.
	* src/func.c (gnm_func_load_stub) : adjust to new GnmFuncHelp type
	(gnm_func_add) : ditto
	(tokenized_help_new) : ditto

2005-02-10  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=165982
	* src/gnm-plugin.c (gnm_plugins_init) : Use G_SEARCHPATH_SEPARATOR in
	  place of hard coding ':' to be more portable.
	* src/dialogs/dialog-plugin-manager.c (pm_gui_load_directory_page) :
	  ditto.

2005-02-09  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_add) : don't create a control
	  for a hidden sheet.

2005-02-09  Jody Goldberg <jody@gnome.org>

	For david@arabidopsis.info (David J Craigon):
	* src/ssconvert.c : Add -I flag to specify importer

2005-02-09  Jon K Hellan  <hellan@acm.org>

	* src/Makefile.am (GNUMERIC_BASE): Remove error-info.c.

2005-02-09  Stepan Kasal  <kasal@ucw.cz>

	* src/error-info.h: Nuke, we are using <goffice/app/error-info.h>.
	* src/Makefile.am: Remove it.

2005-02-09  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (TPUT_CMD, marker_ok, marker_fail, marker_no): Nuke.
	(BIG_CHECKING): New m4 macro, used to emphasize some of the checks.

2005-02-08  Jody Goldberg <jody@gnome.org>

	* configure.in : Post release bump

2005-02-08  Jody Goldberg <jody@gnome.org>

	* Release 1.5.0

2005-02-08  Jody Goldberg <jody@gnome.org>

	* src/print-info.c (print_hf_same) : add some protection

2005-02-06  Jean Brefort  <jean.brefort@normalesup.org>

	* src/sheet-object-widget.c: (cb_adjustment_value_changed): avoid
	recalculation on update, fixes #166085.
	(sheet_widget_adjustment_init_full),
	(cb_adjustment_config_ok_clicked),
	(sheet_widget_adjustment_write_xml_sax),
	(sheet_widget_adjustment_write_xml_dom),
	(sheet_widget_adjustment_read_xml_dom),
	(sheet_widget_adjustment_set_details): make constant and consistent
	scrollbar and slider max values, fixes #165173.

2005-02-05  Morten Welinder  <terra@gnome.org>

	* src/style.c (gnm_font_find_closest_from_weight_slant): Delete.

2005-02-05  Morten Welinder  <terra@gnome.org>

	* src/print.c: Avoid going PangoFontDescription -> GnomeFont ->
	PangoFontDescription.

2005-02-04  Morten Welinder  <terra@gnome.org>

	* src/item-bar.c (item_bar_calc_size): Measure height of letters
	not logical line height.  Use more pango and less magic.  This
	might kill #162600.

	* src/print.c (print_hf_element): Remove old #ifdef HAVE_foo.
	* src/cell-draw.c (cell_draw): Ditto.

	* src/print-cell.c: Eliminate old printing code.

	* src/style.c (style_font_new_simple): No need for setting
	->gnome_print_font any more.
	(style_font_unref): And no need to unref.

	* src/rendered-value.c (rendered_value_recontext): Copy font
	description too now that pango supports it.  Eliminate old #ifdef
	HAVE_foo.

	* src/mathfunc.c (gnumeric_fake_floor, gnumeric_fake_ceil): When
	adding epsilon, make sure that is <0.5.
	(gnumeric_fake_round, gnumeric_fake_trunc): Simplify in terms of
	gnumeric_fake_floor.
	Fixes #166188.

2005-02-03  Morten Welinder  <terra@gnome.org>

	* src/dependent.c: eliminate code predating micro hashes.

2005-02-03  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (micro_hash_resize): Correctly handle	#elems<=1.
	(unlink_range_dep): Plug leak.  [#159581]

2005-02-02  Morten Welinder  <terra@gnome.org>

	* src/format.c (fmt_general_float): Consistently use upper case
	"E" for general format when exponential notation is needed.

2005-02-02  Jean Brefort  <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_matrix_get_value): duplicate value before
	releasing (#166051)

2005-02-01  Jody Goldberg <jody@gnome.org>

	* gnumeric.xsd : Add entries for validation and hyperlinks

2005-02-01  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_csv_is_separator): Handle
	end-of-buffer correctly in the single-character case.
	[Fixes #165617]

	* src/commands.c (cmd_ins_del_colrow): Survive if the current
	clipboard does not hold a range (but holds a sheet object).
	[Fixes #165873]

2005-01-27  Morten Welinder  <terra@gnome.org>

	* src/complete-sheet.c (complete_sheet_search_iteration): Rework
	broken search strategy.

2005-01-27  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object): delta is
	1.0 / FooCanvas::pixels_per_unit for correct behaviour when zoom is !=
	100 %

2005-01-26  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object): don't invert
	move in rtl mode.
	* src/sheet-control-gui.c (snap_pos_to_grid): use correct SHEET_MAX
	depending on what to snap to grid.
	(snap_to_grid): handle rtl case, where GNUMERIC_CANVAS_FACTOR_X is
	0 in world coordinates. World coordinates are negative in rtl mode.
	(apply_move): positive delta means going downward in cell numbers.

2005-01-25  Morten Welinder  <terra@gnome.org>

	* configure.in (gnumeric_gnome_reqs): Upgrade requirements to
	something recent.

2005-01-25  Stepan Kasal  <kasal@ucw.cz>

	AC_PATH_PROG can be tricky: if the user sets the variable to
	something which doesn't look like a full path, autoconf proceeds
	with the test as if the variable were not set; no warning is issued
	(at least for autoconf versions <= 2.59).
	AC_CHECK_PROG is much more transparent: if the variable is nonempty,
	no test is executed.  Let's use it where possible.

	* configure.in (GCONFTOOL): Don't publish the variable, because
	  AM_GCONF_SOURCE_2, which is used after the check, has
	  ``gconftool-2'' hardwired anyway; clear the variable before use.
	  Call AC_CHECK_PROG instead of AC_PATH_PROG.
	(GLIB_GENMARSHAL): Explain why full path is needed.
	(GDK_PIXBUF_CSOURCE): Call AC_CHECK_PROG instead of AC_PATH_PROG.

2005-01-25  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: work on --with-perl; this partially fixes
		http://bugzilla.gnome.org/show_bug.cgi?id=158029

	  In AC_CHECK_LIB(perl,...) change the third parameter to `:'
	  so that it is nonempty and -lperl is not added to LIBS; this fixes
		http://bugzilla.gnome.org/show_bug.cgi?id=158379

	  A cosmetic change: Don't use `[ ]' as an empty argument of a macro,
	  it may confuse m4; use `[]' instead.

	  Another cosmetic change: the word for ``case'' doesn't need any
	  quoting nor prefix.

2005-01-25  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Initialize win32=no, in case someone has the variable
	  in the environment.
	  Fix the help string for --enable-ssindex.

2005-01-24  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	http://bugzilla.gnome.org/show_bug.cgi?id=164455
	* src/sheet-object-graph.c (sog_cb_save_as): fix svg size.

2005-01-24  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object): pass shift state
	to scg_objects_nudge.
	* src/gnumeric-pane.c (gnm_pane_object_move): alter real move values
	with feedback from scg_object_drags. With snap to grid real move can
	be different than what asked.
	(cb_slide_handler): update call to gnm_pane_object_move.
	(cb_control_point_event): update call to scg_object_drag.
	Pass shift state to gnm_pane_object_move.
	* src/sheet-control-gui.c (snap_pos_to_grid): new.
	(snap_to_grid): new.
	(apply_move): new.
	(drag_object): new.
	(drag_selected_objects): use drag_object.
	(scg_objects_drag): drag primary object first.

2005-01-22  J.H.M. Dassen (Ray) <jdassen@debian.org>

	http://bugs.debian.org/291265
	* src/file.c (gnm_file_saver_save) : Produce an error when no proper
	UTF-8 filename was produced.

2005-01-20  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_sheet_write) : store the rtl flag
	(xml_sheet_read) : read the rtl flag

	* src/workbook-control-gui.c (cb_notebook_switch_page) : set the
	  direction on page change
	(show_gui) : setting it here too.
	(set_dir) : new.
	(wbcg_set_direction) : new

	* src/wbcg-actions.c (cb_direction) : A quick and simple direction
	  setting action.  We need a better icon, and improved state.

	* src/style-border.c (style_border_hmargins) : lots of finicky
	  -1*offset style changes for rtl.

	* src/sheet.c (gnm_sheet_class_init) : Add some as yet unused get/set
	  property routines.
	(gnm_sheet_init) : new to init the direction based on the locale.  Use
	  a gtk routine for now.  There's a bug open to have that moved to
	  glib.
	(sheet_set_direction) : new.

	* src/sheet-view.c (sv_init_sc) : init the direction.
	(sv_direction_changed) : new.

	* src/sheet-object-cell-comment.c (comment_view_set_bounds) : fold the
	  old comment_get_points into here and invert things in RTL mode.

	* src/sheet-control-gui.c (scg_redraw_headers) : col coordinates are
	  negative for rtl mode.
	(scg_resize) : rework for rtl
	(scg_set_zoom_factor) : ditto.
	(bar_set_left_col) : ditto.
	(bar_set_top_row) : ditto.
	(gnm_canvas_set_top_left) : ditto.
	(calc_obj_place) : ditto.  Clarify which coordinate system we're in.
	(scg_direction_changed) : new virtual.
	(scg_scale_changed) :  renamed from scg_set_zoom_factor.

	* src/print.c (print_sheet_objects) : handle rtl. (needs testing)
	(print_page_cells) : simple rtl handling

	* src/mstyle.c : Add a text_dir element that defaults to CONTEXT right
	  now.  This is unused until it is better understood, but it is read
	  and written from xls.  We need to add xml support.

	* src/item-grid.c (item_grid_draw_merged_range) : handle rtl
	(item_grid_draw) : ditto.
	* src/print-cell.c (print_merged_range) : ditto
	(print_cell_range) : ditto.

	* src/item-edit.c (ie_layout) : swap directions in RTL mode.  We still
	  need more work here to honour the alignment better while editing.

	* src/item-cursor.c
	(item_cursor_request_redraw) : delete, we can use foo_canvas_item_request_redraw
	(item_cursor_update) : handle rtl
	(item_cursor_draw) : ditto
	(item_cursor_bound_set) : add some safety to avoid drawing before the
	  position is set, or if it is set to something invalid

	* src/item-bar.c (item_bar_draw) : major rework to handle RTL mode.
	  - swap the direction for the cells and the outlines
	(is_pointer_on_division) : handle rtl and clarify which coordinate
	  system the various inputs and results use.
	(ib_set_cursor) : simplify
	(outline_button_press) : RTL flips some coordinates.
	(item_bar_event) : ditto

	* src/gnumeric-simple-canvas.c (gnm_simple_canvas_x_w2c) : doh! handle
	  zoom

	* src/gnumeric-pane.c (gnumeric_pane_header_init) : handle rtl
	(gnm_pane_init) : ditto.
	(gnm_pane_colrow_resize_start) : ditto.
	(gnm_pane_colrow_resize_move) : ditto.
	(cb_slide_handler) : ditto.

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : Swap the
	  direction of arrow keys in rtl mode.
	(gnm_canvas_key_mode_object) : ditto
	(gnm_canvas_size_allocate) : always recompute visible range.  In RTL
	  mode we want to have things aligned on the left edge whose coord
	  moves.
	(gnm_canvas_find_col) : handle the rtl negation of world coords
	(gnm_canvas_redraw_range) : ditto
	(gcanvas_sliding_callback) : ditto.
	(gnm_canvas_handle_motion) : ditto.
	  NOTE : work around a bug in gtk's use of X.  When dragging past the
	  right edge of the sheet in rtl mode we are operating at the edge of
	  a 32k wide window and the event coords get larger than can be held
	  in a signed short.  As a result we get world coords of -65535 or so.
	  KLUDGE KLUDGE KLUDGE
	    with our current limit of 256 columns it is unlikely that we'll
	    hit -65535 (at appropriate zoom) as a valid coord (it would
	    require all cols to be 256 pixels wide.  it is not impossible, but
	    at least unlikely.  So we put in a kludge here to catch the screw
	    up and remap it.   This is not pretty,  at large zooms this is not
	    far fetched.
	(gnm_canvas_compute_visible_region) : things are more complicated for
	  rtl mode.

	* src/commands.c : Add undo for the rtl vs ltr mode

	* src/cellspan.c (cell_calc_span) : in rtl mode swap the meaning of
	  horizontal alignment.

	* src/GNOME_Gnumeric-gtk.xml.in : Add the rtl toggle action

2005-01-20  Jody Goldberg <jody@gnome.org>

	* configure.in : post branching bump

2005-01-19  Morten Welinder  <terra@gnome.org>

	* src/style.c (style_font_new_simple): Only create
	gnome_print_fonts for old printing code.

	* src/print-cell.c (using_old_printing_code): New public function
	extracted from print_cell.

2005-01-17  Jody Goldberg <jody@gnome.org>

	* configure.in : post release version bump
	  If everything is smooth we'll branch on Wed

2005-01-17  Jody Goldberg <jody@gnome.org>

	* Release 1.4.2

2005-01-16  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=161404
	* xmldocs.make : sync doc installation dir with where the code expects
	  it to live

2005-01-16  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=158692
	* src/preview-grid.c (pg_get_row_offset) : don't return SHEET_MAX_ROWS
	  if h =0.
	(pg_get_col_offset) : ditto.

2005-01-16  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=162631
	* src/gnumeric-pane.c (set_acetate_coords) : handle the race condition
	  for the rubber band directly case.

2005-01-15  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=162631
	* src/sheet-object.c (sheet_object_new_view) : return the new view, it
	  may actually be useful.

	* src/sheet-control-gui.c (cb_collect_objects_to_commit) : we actually
	  need to create the view here if it does not exist, otherwise we lose
	  the size

2005-01-13  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=162631
	* src/sheet-control-gui.c (cb_collect_objects_to_commit) : more
	  safety.

	* src/sheet-object.c (sheet_object_view_set_bounds) : be safer.

2005-01-15  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=161547
	* configure.in : Make the python test more robust

2005-01-14  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163438
	* src/format.c (format_compile) : notice fmts that request a fill
	(style_format_new_XL) : init the new is_var_width flag

	* src/rendered-value.c (rendered_value_render) : there are formats
	  other than General that have variable widths.  Are measurement of
	  col width and characters sucks.   We really need to do the fills at
	  a higher level where we have font metrics.

2005-01-14  Jody Goldberg <jody@gnome.org>

	http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=290388
	* src/sheet-object-cell-comment.c (comment_get_points) : This will
	  need work for RTL, but we do need to compensate for the zoom.

2005-01-14  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (cb_control_point_event) : fix double click
	  handling to not start a drag when the editor is gone

2005-01-13  Jody Goldberg <jody@gnome.org>

	http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=288157
	* src/colrow.c (colrow_set_sizes) : we need to rerender variable width
	  content when resizing all cols at the same time, just like we do for
	  smaller sections

2005-01-13  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=161782
	* templates/autoformat/Makefile.am : applied patch to use non
	  bash-specific variable substitution.

2005-01-13  Morten Welinder  <terra@gnome.org>

	* src/style.c (style_font_new_simple): Don't ref and unref the
	context.

2005-01-13  Jean Brefort  <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_matrix_load_values): don't write data outside of
	allocated matrix. Fixes #163626.

2005-01-12  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163223
	* src/style.c (style_font_string_width) : take a layout directly.
	(calc_font_width) : ditto.
	(style_font_new_simple) : keep the PangoFontMetrics and PangoLayout
	  here rather than as data members with no real purpose.  It should
	  make it easier to remove the scaling in here.
	NOTE : remove the prescaling of the font size.  It did not belong
	  here.  We use a scale attribute while measuring.  Eventually we can
	  split the calculation of metrics out and remove the ugly scale/zoom
	  param entirely.
	(style_font_unref) : we got rid of some data members.

	* src/style-font.h : A new header to make cleaning up the definition
	  of GnmFont easier.

	* src/mstyle.c (mstyle_get_pango_attrs) : Add a scale attribute
	  wrapper to scale all of the font sizes

2005-01-12  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163198
	* src/item-edit.c (get_top_left) : new function to get the top left
	  point based on the vertical alignment.
	(item_edit_draw) : the code was taken from here.
	(item_edit_event) : and used here to give pango_layout_xy_to_index a
	  reasonable coordinate.

2005-01-12  Jean Brefort  <jean.brefort@normalesup.org>

	* src/gui-file.c: (gui_get_image_save_info): test if file exists after
	adding extension.
	(gui_file_save_as): don't exit when file exists and
	user do not want to overwrite. Back to the file chooser instead.

2005-01-12  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_help_docs) : minor warning suppression

2005-01-11  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (gnm_pango_attr_list_splice): New function
	doing what pango_attr_list_splice should have done, i.e., simply
	splice.
	(cb_entry_insert_text): Use gnm_pango_attr_list_splice.

2005-01-10  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (wbcg_edit_finish): Copy the resulting
	markup as editing callbacks will otherwise destroy it.

2005-01-10  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163408
	* src/commands.c (cmd_ins_del_colrow_redo) : We only need to redo
	  things for cuts, not copies (Although that feels a bit odd).
	  Just un-ant things for now.

2005-01-09  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163407
	* src/commands.c (cmd_format_undo) : doh! resize only if we needed a
	  resize when the style was applied, not based on the properties of
	  the format we are restoring.

2005-01-09  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=162923
	* src/expr.c (gnm_expr_eval) : minor thinko, array result from a
	  function in a non-scalar context return the first element, not
	  #VALUE!.  I broke this when tweaking the implicit iteration by
	  forgetting that value_intersection handled that for me.

2005-01-09  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=163452
	* src/sheet-control-gui.c (scg_mode_clear) : handle being called
	  during destruction

2005-01-05  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=162888
	* src/clipboard.c (cb_dup_objects) : sheet_object_dup can fail, be
	  careful
	(paste_object) : ditto.
	* src/application.c (gnm_app_clipboard_cut_copy_obj) : ditto
	* src/gnumeric-pane.c (gnm_pane_object_start_resize) : ditto

2005-01-06  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (gnumeric_fake_floor, gnumeric_fake_ceil): Fix
	negative case.

2005-01-05  Morten Welinder  <terra@gnome.org>

	* src/rangefunc.c (range_sum): Just sum.  Don't try to be overly
	smart.
	(range_sumsq): Ditto.

2005-01-05  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (cb_sheet_object_widget_canvas_event) : handle
	  double click

	* src/sheet-object-widget.c (sheet_object_widget_class_init) : widgets
	  render quickly rubber band directly
	(sheet_widget_slider_create_widget) : do not draw the value

2004-12-31  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (set_acetate_coords) : don't crash if we have
	  not created a view yet.

2004-12-31  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (gnm_pane_object_start_resize) : watch press
	  events too.
	(cb_control_point_event) : launch an editor for double clicks

2005-01-04  Morten Welinder  <terra@gnome.org>

	* src/format.c (fmt_general_float): Use GNUM_FORMAT_G.  The days
	of glib <1.2.9 are over.
	(fmt_general_int): Ditto.

	* src/numbers.h (GNUM_FORMAT_G): Add.

	http://bugzilla.gnome.org/show_bug.cgi?id=162865
	* src/wbcg-actions.c: Fix Help->Contents and Edit->Clear->Contents
	accelerators.

2005-01-03  Morten Welinder  <terra@gnome.org>

	Patch for 161909:

	* src/sheet.c (sheet_cell_remove): Add new arg to control whether
	to flag dependencies.  All callers changed.
	(cb_empty_cell): Take whole flags argument.

	* src/clipboard.c (clipboard_paste_region): Handle new flag
	PASTE_NO_RECALC to help sorting speed.

	* src/sort.c (sort_contents): Paste using PASTE_NO_RECALC and
	handle dependencies ourselves.  Don't qsort if we have less than
	two elements.

2004-12-29  Morten Welinder  <terra@gnome.org>

	* src/format.c (format_month_before_day): Add Win32 version.
	(#161793, Ivan Wong.)

2004-12-22  Morten Welinder  <terra@gnome.org>

	* src/libgnumeric.h (gnumeric_popt_options): remove from here.

2004-12-20  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (wbcg_edit_add_markup): Use range 0-INT_MAX
	so we don't split anything.
	(cb_entry_cursor_pos): Ditto.
	(wbcg_edit_init_markup): The .cur_fmt from markup, not
	full_content, so we don't end up setting font sizes, etc.
	(cb_entry_cursor_pos): Don't do anything if the entry is empty.

2004-12-20  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (cb_delete_filter): Be much more careful.
	Things are unsigned.
	(cb_entry_cursor_pos): Fix confusion between editline.markup and
	edit_line.full_content.

	* src/format.c (gnm_format_parse_markup): Attribute offsets are
	unsigned.  Drop nops.
	(cb_attrs_as_string): Ditto.

2004-11-14  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-image.c (sheet_object_image_set_image) : renamed
	  from sheet_object_image_new to make the life cycle simpler for
	  importers.
	(soi_get_pixbuf) : No data == no pixbuf
	* src/wbcg-actions.c (cb_insert_image) : adjust to the name and
	  semantic change of sheet_object_image_set_image.

2004-12-17  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell_NEW): Fix origin correction.

	* src/rendered-value.c (rendered_value_remeasure): Render while
	rotated as pango turns off hinting in the font.

	* src/style.c (style_default_halign): Errors and booleans remain
	centered when rotated.  Numbers and text are left-aligned when
	rotated up and right-aligned when rotated down.

2004-12-15  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell_NEW): Print rotated.

	* src/cell-draw.c (cell_draw): Draw rotated text if
	HAVE_PANGO_CONTEXT_SET_MATRIX.

	* src/rendered-value.c (rendered_value_render): Rotated numbers
	are not variable width.
	(rendered_value_remeasure): Adjust width and height for rotation.

	* src/rendered-value.h (struct _RenderedValue): Eliminate
	display_formula and introduce might_overflow and rotation.

	* src/style.c (required_updates_for_style): Rotation changes
	requires height resizing.
	(style_default_halign): Rotated cells are aligned left by default,
	even for numbers.

	* src/sheet.c (cb_max_cell_height): Render rotated cells also.

2004-12-14  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pgamma): Improve accuracy for extreme arguments.

2004-12-13  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (lgamma1p): Make this work for x<0 also.

2004-11-20  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* src/print-info.h: Add "paper_width" and "paper_height" to struct
	PrintInformation, to support paper sizes for which gnome-print doesn't
	have a name.
	* src/print-info.c (print_info_make_config): Use paper_width and
	paper_height when there is no paper name.
	* src/print-info.c (print_info_set_paper_width,
	print_info_set_paper_height, print_info_get_paper_width,
	print_info_get_paper_height): New, get and set functions for
	paper_width and paper_height.
	* src/print-info.c (print_info_free, print_info_new, print_info_dup):
	Extended to handle the two fields added to struct PrintInformation.

2004-12-10  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2004-12-09  Jody Goldberg <jody@gnome.org>

	* Release 1.4.1

2004-12-09  Jody Goldberg <jody@gnome.org>

	* src/cell-draw.c (cell_calc_layout) : set wrapmode to word-char
	  rather than the default word so that long words will wrap

2004-12-09  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (gnm_pane_object_start_resize) : Add an
	  'is_creation' argument to avoid pretending we're creating an object
	  when clicking and releasing on the lower right resize marker.

2004-12-08  Jody Goldberg <jody@gnome.org>

	* src/hlink.c (gnm_hlink_url_activate) : use go_url_show
	* src/wbcg-actions.c (cb_help_web) : ditto.
	(cb_help_irc) : ditto
	(cb_help_bug) : ditto

2004-12-06  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_dump_defs): Use CSS for styling.

2004-12-03  Jody Goldberg <jody@gnome.org>

	* src/file-autoft.c (category_get_templates_list) : Use GDir in place
	  of struct dirent this is more portable.
	(category_list_get_from_dir_list) : ditto.
	* src/plugin.c (plugin_info_list_read_for_subdirs_of_dir) : ditto.

2004-11-30  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=160046
	* src/libgnumeric.c (gnm_pre_parse_init) : get the right pixmap and
	  translation paths for win32.

2004-11-30  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-simple-canvas.c (gnm_simple_canvas_x_w2c) : new.

2004-11-30  Morten Welinder  <terra@gnome.org>

	* src/gnm-so-line.c (so_line_view_set_bounds): Make sure sheet
	object direction is set.
	(gnm_so_line_get_property): Handle SOL_PROP_IS_ARROW for
	completeness.

2004-11-29  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=157732
	* src/gnumeric-pane.c (gnm_pane_display_obj_size_tip) : fix sign of
	  kludge

2004-11-29  Morten Welinder  <terra@gnome.org>

	* Makefile.am (gnumeric.desktop): Add bugzilla version info.

2004-11-28  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2004-11-28  Jody Goldberg <jody@gnome.org>

	* Release 1.4.0

2004-11-26  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=159581 #1
	* src/application.c (gnm_app_clipboard_cut_copy_obj) : patch leak

2004-11-26  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=159577
	* src/format.c (gnm_format_parse_markup) : return NULL on error

2004-11-26  Jody Goldberg <jody@gnome.org>

	* src/gui-file.c (gui_file_open) : Add a hook to open template files.
	  This is cheesy, but is better than nothing.

2004-11-26  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=159365
	* src/commands.c (gnm_reloc_undo_release) : new
	(cmd_ins_del_colrow_finalize) : use it
	(cmd_paste_cut_finalize) : use it.
	(gnm_reloc_undo_apply) : new
	(cmd_ins_del_colrow_undo) : use it.
	(cmd_paste_cut_undo) : use it.

	* src/sheet-object.c (sheet_objects_relocate) : store lost objects

	* src/sheet.c (sheet_colrow_insdel_finish) : take an optional undo
	  storage
	(sheet_colrow_insert_finish) : ditto.
	(sheet_colrow_delete_finish) : ditto.
	(sheet_insert_cols) : pass the undo info
	(sheet_delete_cols) : ditto.
	(sheet_insert_rows) : ditto.
	(sheet_delete_rows) : ditto.
	(sheet_move_range) : pass undo info to sheet_objects_relocate

2004-11-21  Jody Goldberg <jody@gnome.org>

	* src/sheet-view.c (sv_panes_insdel_colrow) : be more careful
	  inserting large numbers of cols/rows

2004-11-21  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_insert_rows) : no need to test when inserting
	  SHEET_MAX_ROWS
	(sheet_insert_cols) : ditto for SHEET_MAX_COLS

2004-11-21  Jon K Hellan  <hellan@acm.org>

	* src/ssindex.c: #include gog-object.h

2004-11-19  Jody Goldberg <jody@gnome.org>

	* configure.in : Add ssindex but leave it disabled by default because
	  it relies on unreleased changes to libgsf

2004-11-19  Jody Goldberg <jody@gnome.org>

	* src/style.c (gnm_font_find_closest_from_weight_slant) : add some
	  protection.

2004-11-19  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-gconf.c (gnm_conf_init_printer_decoration_font) : add a
	  default in case conf lookup fails.
	(gnm_conf_init_essential) : fix swapped max and default for print zoom

2004-11-18  Morten Welinder  <terra@gnome.org>

	* src/print.c (sheet_print): Fix leak for preview.  (#158566)

2004-11-15  Jody Goldberg <jody@gnome.org>

	* src/stf.c (stf_init) : register some suffixes and mime types
	* src/xml-io.c (xml_init) : ditto.

	* src/plugin-service.c (plugin_service_file_opener_read_xml) : parse
	  mime types too.

	* src/gui-file.c (gui_file_open) : Use the new lists of suffixes and
	  mime types from the openers rather than kluding something from
	  savers.

	* src/file.c (gnm_file_opener_setup) : store a list of suffixes and
	  mime types.
	(gnm_file_opener_finalize) : free the new lists.
	(gnm_file_opener_new) : take suffixes and mime types as arguments
	(gnm_file_opener_new_with_enc) : take suffixes and mime types as arguments
	(gnm_file_opener_get_suffixes) : new.
	(gnm_file_opener_get_mimes) : new.

2004-11-15  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c : Add text and markup properties to
	  checkbox/toggle button

2004-11-14  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (gnm_pane_display_obj_size_tip) : tweak the
	  pixel distances.  The far coordinates are excluded.

2004-11-14  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=151609
	* src/commands.c (cmd_objects_restore_location): new
	(cmd_objects_delete_undo): restore ordering of objects
	(cmd_objects_delete_finalize): free locations array
	(cmd_objects_delete): create and save locations array
	* src/sheet-object.h (sheet_object_get_stacking): new
	* src/sheet-object.c (sheet_object_get_stacking): new

2004-11-10  Jody Goldberg <jody@gnome.org>

	* src/style.c (required_updates_for_style) : for font size, and wrap
	  changes add a flag to resize row heights.
	* src/sheet.c (sheet_apply_style) : use the new SPANCALC_ROW_HEIGHT to
	  decide when to autosize the rows. (debian #228105)

2004-11-10  Jody Goldberg <jody@gnome.org>

	* configure.in : leave the old perl plugin disabled by default
	  distros can enable it if desired using --with-perl.
	  There are just too many build issues with it right now.

2004-11-09  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (GCONFTOOL, GLIB_GENMARSHAL, GDK_PIXBUF_CSOURCE):
	  Clarify descriptions of these variables to say that the absolute
	  path is required.

2004-11-09  Andreas J. Guelzow <aguelzow@taliesin.ca>

	for Harald Ashburner <hal.ashburner@gmail.com>:
	* sample/derivaties.gnumeric: update

2004-11-08  Morten Welinder  <terra@gnome.org>

	* src/history.c: Survive NULL basename (#157682).

2004-11-08  Jon K Hellan  <hellan@acm.org>

	* configure.in: Fix psiconv test.

2004-11-08  Morten Welinder  <terra@gnome.org>

	* configure.in (perl_msg): Disable buggy perl_construct check.

	* src/expr.h: Delete trailing comma in enum.
	* src/func.h: Ditto.

2004-11-07  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Call the "make" command for PY_EXTRA_LIBS with "-s".
	  Without it, out-of-source builds have problems due to interference
	  from make printing entering/leaving directory messages.
	* configure.in: Corrected $(GNUMERIC_PLUGIN_LDFLAGS) to
	  $GNUMERIC_PLUGIN_LDFLAGS.

2004-11-07  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.c (go_conf_get_short_desc) return
	  NULL if we don't have a desription
	(go_conf_get_long_desc): ditto

2004-11-07  Jody Goldberg <jody@gnome.org>

	* Release 1.3.93

2004-11-07  Jody Goldberg <jody@gnome.org>

	From Jean Brfort :
	* src/xml-io.c (xml_read_solver) : handle both formats of constraint
	  Per and post 1.4

2004-11-05  Jody Goldberg <jody@gnome.org>

	From Ivan Wong:
	* src/gui-util.c (gnumeric_icondir) : use the variable rather than the
	  compiled path.
	* configure.in : The win32 build needs some extra flags for the
	  plugins
	* Makefile.am : cheesy hack to build the charting plugins after we
	  have an execuable.

2004-11-07  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.h (gnm_gconf_set_autocomplete): new
	(gnm_gconf_set_unfocused_rs): new
	(gnm_gconf_set_num_recent_functions): new
	(gnm_gconf_set_prefer_clipboard): new
	* src/gnumeric-gconf.c (gnm_gconf_set_autocomplete): new
	(gnm_gconf_set_unfocused_rs): new
	(gnm_gconf_set_num_recent_functions): new
	(gnm_gconf_set_prefer_clipboard): new

2004-11-06  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.h (gnm_gconf_set_gui_resolution_h): new
	(gnm_gconf_set_gui_resolution_v): new
	* src/gnumeric-gconf.c (gnm_gconf_set_gui_resolution_h): new
	(gnm_gconf_set_gui_resolution_v): new

2004-11-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.h (gnm_gconf_set_file_overwrite): new
	(gnm_gconf_set_file_single_sheet_save): new
	(gnm_gconf_set_gui_transition_keys): new
	(gnm_gconf_set_gui_livescrolling): new
	(gnm_gconf_set_sort_retain_form): new
	(gnm_gconf_set_sort_by_case): new
	(gnm_gconf_set_sort_ascending): new
	(gnm_gconf_set_latex_use_utf8): new
	* src/gnumeric-gconf.c (gnm_gconf_set_file_overwrite): new
	(gnm_gconf_set_file_single_sheet_save): new
	(gnm_gconf_set_gui_transition_keys): new
	(gnm_gconf_set_gui_livescrolling): new
	(gnm_gconf_set_sort_retain_form): new
	(gnm_gconf_set_sort_by_case): new
	(gnm_gconf_set_sort_ascending): new
	(gnm_gconf_set_latex_use_utf8): new
	(gnm_gconf_set_show_sheet_name): new

2004-11-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.h (gnm_gconf_set_file_history_number): new
	(gnm_gconf_set_max_descriptor_width): change argument to gint
	(gnm_gconf_set_xml_compression): new
	(gnm_gconf_set_sort_dialog_max_initial): new
	(gnm_gconf_set_workbook_nsheets): new
	* src/gnumeric-gconf.c (gnm_gconf_set_file_history_number): new
	(gnm_gconf_set_max_descriptor_width): change argument to gint
	(gnm_gconf_set_xml_compression): new
	(gnm_gconf_set_sort_dialog_max_initial): new
	(gnm_gconf_set_workbook_nsheets): new
	(gnm_gconf_set_undo_size): set current prefs structure
	(gnm_gconf_set_undo_max_number): set current prefs structure

2004-11-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.c (gnm_gconf_set_hf_font): new
	* src/gnumeric-gconf.h (gnm_gconf_set_hf_font): new

2004-11-05  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.c (gnm_gconf_set_default_font_name): avoid
	  warning

2004-11-02  Stepan Kasal  <kasal@ucw.cz>

	* src/ssconvert.c (main): Don't call gsf_init(); gnm_common_init
	  will do it (via libgoffice_init) and we don't need it until then.

2004-11-05  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object) : ctrl+alt is the
	  logic place to do symmetric movement with the new layout.

2004-11-04  Stepan Kasal  <kasal@ucw.cz>

	* configure.in:
	  Add AC_ARG_VAR declarations for all variables used in
	  AC_PATH_PROG or AC_CHECK_PROG.
	  Clean up the checks for psiconv, perl and python.
	  Remove the check for jw.

2004-11-05  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object): change sheet object
	manipulation keybindings to something that is not a psychomotor test.

2004-11-04  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_mode_edit) : no need to finish editing
	  if we are not current sheet.

2004-11-03  Jody Goldberg <jody@gnome.org>

	* src/ranges.c (global_range_contained) : adjust the signature to
	  provide a Sheet* context.

2004-11-04  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (lgamma1p): Fix gnm_float buglet.

	* src/commands.c (cmd_selection_clear): Fix 157376.

2004-11-04  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=157238
	http://bugzilla.gnome.org/show_bug.cgi?id=157239
	* gnumeric-gconf.h (gnm_gconf_set_gui_window_x): new
	(gnm_gconf_set_gui_window_y): new
	(gnm_gconf_set_gui_zoom): new
	(gnm_gconf_set_default_font_size): new
	(gnm_gconf_set_default_font_name): new
	(gnm_gconf_set_default_font_bold): new
	(gnm_gconf_set_default_font_italic): new
	* gnumeric-gconf.c (gnm_gconf_set_gui_window_x): new
	(gnm_gconf_set_gui_window_y): new
	(gnm_gconf_set_gui_zoom): new
	(gnm_gconf_set_default_font_size): new
	(gnm_gconf_set_default_font_name): new
	(gnm_gconf_set_default_font_bold): new
	(gnm_gconf_set_default_font_italic): new

2004-11-03  Jody Goldberg <jody@gnome.org>

	* configure.in : fix the python test and sync it with the perl test

2004-11-02  Jody Goldberg <jody@gnome.org>

	* configure.in : extend the test for perl

	* src/sheet-control-gui.c (cb_collect_objects_to_commit) : set the
	  anchor of objects that are not rubber banded directly.
	* src/gnumeric-pane.c (cb_clear_indirect_rubber_bands) : Merge into
	  cb_collect_objects_to_commit.

2004-11-02  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=156732
	* src/gnumeric-gconf.c (gnm_gconf_set_recent_funcs):
	  also adjust the pref structure.

2004-11-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/rendered-value.c (rendered_value_get_text):
	  plug leak

2004-11-01  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2004-10-31  Jody Goldberg <jody@gnome.org>

	* Release 1.3.92

2004-11-01  Yukihiro Nakai  <nakai@gnome.gr.jp>

	* configure.in: Enable perl plugins
	* plugins/Makefile.am: Add perl-func, perl-loader

2004-11-01  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : DISTCLEAN GNOME_Gnumeric-gtk.xml it is generated

2004-09-15  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Add test for zlib, inspired by libxml2's configure.in;
	  this is needed to link excel.la correctly against libz, if it is
	  available only as a static library, not as a dynamic one.

2004-11-01  Morten Welinder  <terra@gnome.org>

	* src/gui-clipboard.c (text_to_cell_region): Fix type confusion.

	* src/dependent.c (dependents_unrelocate): Don't access sheet
	member in union unless there is supposed to be one.

2004-11-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.h (gnm_iter_search_t): new type
	(gnm_tree_model_iter_prev): new
	* src/gui-util.c (gnm_tree_model_iter_prev): new

2004-10-30  Stepan Kasal  <kasal@ucw.cz>

	A cleanup of ssconvert; don't require Gnome.

	* src/ssconvert.c (list_them): New general function which lists
	  importers or exporters.
	(convert): New function; the main functionality moved here.
	(mail): Use the above functions; call gsf_init and don't use
	  Gnome-specific functions.

2004-09-13  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Don't use test's operators -a and -o, they aren't
	  portable.  A small cleanup of the python detection code.

2004-10-31  Jody Goldberg <jody@gnome.org>

	* src/format.c (cb_attrs_as_string) : new.
	(gnm_format_parse_markup) : parse the content generated above
	(style_format_new_XL) : handle markup formats

2004-10-30  Jody Goldberg <jody@gnome.org>

	* src/formats.c (cell_format_classify) : handle the quick cheesy hack
	  to persist attr lists.

2004-10-28  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_update_action_sensitivity) :
	  renamed from wbcg_edit_set_sensitive (still a bogus title given that
	  we have related functionality in several places).  Moved the logic
	  to define what should be sensitive here, rather than from the model.
	  This allows us to reconfigure on sheet changes.

2004-10-28  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object) : up/down where
	  reversed.

2004-10-29  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_set_dirty) : update the title if dirtiness
	  changed

	* src/workbook-control.c (wb_control_update_title) : Add a HIGy '*'
	  for modified documents.

	* src/io-context-gtk.c : include string.h to avoid warning

	* src/sheet-control-gui.c (scg_cursor_extend) : finish the edit before
	  we extend.

	* src/item-edit.c (ie_layout) : handle zoom

2004-10-29  Morten Welinder  <terra@gnome.org>

	* src/io-context-gtk.c (icg_processing_file): Since the progress
	bar truncates text at the right, limit the text we set to 40
	characters (give or take) to ensure that the basename can be seen.

	* src/plugin-service.c (plugin_service_ui_finalize): Free actions
	using the right kind of freer.

	* src/wbc-gtk.c (wbc_gtk_init): Create custom_uis table here.
	(wbc_gtk_finalize): Destroy it here.

	* src/stf-export.c (stf_export_sheet): Plug leak.

2004-10-29  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (cb_add_custom_ui) : fix unmerging

2004-10-29  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-gconf.c (gnm_conf_init_extras) : typos in the broken
	  gconf case

2004-10-29  Jody Goldberg <jody@gnome.org>

	* src/format.c (append_hour) : be XL compat

2004-10-29  Jody Goldberg <jody@gnome.org>

	* src/file-autoft.c : clean up the handling of translations
	* src/format-template.c (format_template_new) : Name should be
	  translatable, not translated.

2004-10-29  Jody Goldberg <jody@gnome.org>

	* src/application.c (gnm_action_new) : new
	(gnm_action_free) : ditto
	(gnm_app_add_extra_ui) : ditto
	(gnm_app_remove_extra_ui) : ditto
	(gnm_app_foreach_extra_ui) : ditto

	* configure.in : enable the sample ui plugin
	* plugins/Makefile.am : ditto
	* plugins/python-loader/boot.c : ditto
	* plugins/python-loader/py-console.c : ditto
	* plugins/python-loader/python-loader.c : ditto

2004-10-27  Jody Goldberg <jody@gnome.org>

	* src/plugin-service.c : enable the ui service.
	* plugins/gnome-db/plugin-gnomedb.c : Use the new interface for the ui
	  plugin

	* src/sheet-object-graph.c (sheet_object_graph_default_size) : be
	  cheesy.  We're setting the bounds in so many places before this is
	  called that it's not safe to use the defaults from GogRenderer.  Not
	  a huge loss, those were pretty arbitrary.

2004-10-26  Jody Goldberg <jody@gnome.org>

	* src/libgnumeric.c (gnm_pre_parse_init) : Set the default
	  datadir/libdir based on the packge for WIN32

2004-10-28  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* plugins/excel/ms-chart.c (BC_R): handle dash_type property.
	(ms_excel_chart_read): use GO_LINE_NONE ofr invisible lines.

2004-10-27  Morten Welinder  <terra@gnome.org>

	* src/complex.c (complex_div, complex_sqrt): Improve accuracy.

	* src/gui-file.c (go_file_is_writable): Use G_IS_DIR_SEPARATOR
	instead of comparing to G_DIR_SEPARATOR.

2004-10-27  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* gnumeric.desktop.in, gnumeric.keys.in: Changed
	"comma-separated-values" to "text/comma-separated-values", as a "MIME
	type" without a slash in it is rejected by "update-desktop-database".

2004-10-26  Francisco Javier F. Serrador  <serrador@cvs.gnome.org>

	* schemas/gnumeric-dialogs.schemas.in: Fixed Typo

2004-10-26  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pgamma): Fix various accuracy problems for
	extreme cases.

	* Makefile.am (gnumeric.desktop): Use %U or %F for Exec as
	appropritate.

2004-10-25  Yukihiro Nakai  <nakai@gnome.gr.jp>

	* src/plugin-loader.c: (gnm_plugin_loader_load_base)
	Don't crash but warn when no load_base method.
	* src/plugin-service.c: (plugin_service_function_group_func_desc_load)
	Don't crash but warn when no func_desc_load method.

2004-10-21  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (logfbit): Make global.

2004-10-21  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/stf.c: (stf_apply_formats): use unsigned int
	* src/stf-parse.h: make col_import_array_len unsigned

2004-10-21  Jean Brefort  <jean.brefort@normalesup.org>
	* src/dialogs/dialog-solver.c: (revert_constraint_format): make constraints
	display correctly in all circumstances.

2004-10-21  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=139385
	* src/stf-parse.c (stf_parse_options_new) initialize
	  cols_exceeded
	(stf_parse_sheet): set cols_exceeded
	* src/stf-parse.h: add cols_exceeded to StfParseOptions_t
	* src/stf.c (stf_apply_formats): remove warning
	(stf_read_workbook_auto_csvtab): show warning if
	  cols_exceeded is set.

2004-10-21  Yukihiro Nakai  <nakai@gnome.gr.jp>

	* src/format-template.c: (xml_read_format_template_members)
	Gettextize author,name,descr field.

	* templates/autoformat/: Move xml to xml.in and gettextize them

2004-10-20  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas.in: change recalclag
	  description

2004-10-20  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/stf-parse.c (stf_parse_options_new): initialize
	  col_import_array_len
	(stf_parse_sheet): make sure we don't index beyond the end
	  of the col_import_array
	(stf_parse_region): ditto
	* src/stf.c (stf_apply_formats): ditto
	* src/stf-parse.h: add col_import_array_len to StfParseOptions_t

2004-10-21  Yukihiro Nakai  <nakai@gnome.gr.jp>

	* src/plugin-loader.c (gnm_plugin_loader_load_service):
	Output error when no set_attributes method.

2004-10-20  Morten Welinder  <terra@gnome.org>

	* src/gui-clipboard.c (x_clipboard_get_cb): Crash protection.

	* src/clipboard.c (cellregion_to_string): Add extra argument
	checks.

2004-10-19  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/.cvsignore: add GNOME_Gnumeric-gtk.xml

2004-10-19  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=132876
	* src/print.c (sheet_print): make the print dialog semi-modal.
	(dialog_destroy): new
	(dialog_response): new
	(sheet_print_real): new

2004-10-19  Morten Welinder  <terra@gnome.org>

	* src/Makefile.am (GNOME_Gnumeric-gtk.xml): Create this using a
	sed script for now.  We seem to have relied on intltool bugs not
	present in all versions.

	* src/print-info.c (render_path): Use go_dirname_from_uri.

	* src/workbook-view.c (cb_cleanup_sendto): Remove directory using
	rmdir, not unlink.

	* src/gui-file.c (go_file_is_writable): Use go_dirname_from_uri.

2004-10-18  Jody Goldberg <jody@gnome.org>

	* src/print-info.c (print_info_dup) : copy the margins.

2004-10-16  Yukihiro Nakai  <nakai@gnome.gr.jp>

	* src/GNOME_Gnumeric-gtk.xml: Obsolete
	* src/GNOME_Gnumeric-gtk.xml.in: Newly added for gettextize.
	* src/wbc-gtk.c: Gettextize the toolbar.

2004-10-18  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=152516
	* src/sheet-control-gui.c (scg_context_menu) : minor string change
	  It is clearer to say 'Cells' for insert and delete.

2004-10-16  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (gnm_pane_object_register) : Take a 'selectable'
	  argument to enable/disable the view selection mechanism.  This
	  routine is still useful for setting up bounds handlers.

2004-10-16  Jody Goldberg <jody@gnome.org>

	* src/print-info.c : delay the creation of a GnomePrintConfig until it
	  is really necessary.

2004-10-16  Jody Goldberg <jody@gnome.org>

	* src/func.c (function_call_with_list) : Everything can now return an
	  empty during evaluation.

2004-10-16  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-cell-comment.c (cell_comment_new_view) : add
	  bounds-changed handler.
	(cell_comment_event) : This now takes a GnmPane, not an scg.

	* src/sheet-object-cell-comment.c : Add a text property.

2004-10-14  Morten Welinder  <terra@gnome.org>

	* src/gutils.c (gnm_usr_dir): Use g_build_filename.  Note, that
	this means that we return the result without a terminating slash.

2004-10-13  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-widget.c (SOW_MAKE_TYPE): Add arguments for
	property support.
	(SheetWidgetButton): Add markup member.
	(sheet_widget_button_get_property,
	sheet_widget_button_set_property): New functions.

2004-10-13  Jean Brefort <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_vector_load_values),
	(gnm_go_data_matrix_load_values): fixes VALUE_STRING case, if a value
	is found, take it into account for minimum and maximum.

2004-10-13  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (regenerate_window_menu): Escape underscore in
	names.

2004-10-11  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_rename) : tell each view to update its edit line
	  in case the editline is displaying an expression that references the
	  name of a sheet.

	* src/commands.c (update_after_action) : Take a Workbook and run an
	  update on the current sheet for each control.

2004-10-11  Morten Welinder  <terra@gnome.org>

	* src/parser.y (gnm_expr_parse_str): Revive logic to add missing
	parenthesis.

	* src/gnumeric-pane.c (gnm_pane_release): Plug leak.

2004-10-10  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c : Add a ToggleButton type.
	(sheet_widget_checkbox_get_ref) : weaken to allow relative references
	  and assume they are relative to A1.
	(sheet_widget_adjustment_get_ref) :

2004-10-10  Jody Goldberg <jody@gnome.org>

	* gnumeric.spec.in : Let's stick with fedora core package names as the
	  defacto standard until something better presents itself.  There are
	  still no guarantees that this works.

2004-10-09  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (cb_sheet_object_widget_canvas_event) :
	  Simplify.  There's no need to select the object here.  We've
	  already handled it in the main handler (cb_sheet_object_canvas_event)

2004-10-09  Jean Brefort  <jean.brefort@normalesup.org>

	* src/graph.c: (gnm_go_data_matrix_eval),
	(gnm_go_data_matrix_finalize), (gnm_go_data_matrix_load_size),
	(cb_assign_matrix_val), (gnm_go_data_matrix_load_values),
	(gnm_go_data_matrix_get_value), (gnm_go_data_matrix_get_str),
	(gnm_go_data_matrix_class_init), (gnm_go_data_matrix_debug_name),
	(gnm_go_data_matrix_init), (gnm_go_data_matrix_new_expr),
	(gnm_go_data_get_dep): New GnmGODataMatrix class.
	* src/graph.h: ditto.
	* src/selection.c: (sv_selection_to_plot): updated to use GnmGODataMatrix
	and related stuff.
	* src/sheet-object.c: (sheet_objects_init): ditto.
	* src/workbook-control-gui.c: (cb_graph_dim_editor_update),
	(wbcg_data_allocator_editor): ditto.

2004-10-08  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object) : throw in
	  support for tabbing fwd/back through the list of objects.

	* src/sheet-object-widget.c (sheet_widget_checkbox_create_widget) :
	  Tweak to support toggle buttons too

2004-10-08  Jody Goldberg <jody@gnome.org>

	* src/sheet-object.c : Add a SheetObjectView interface and use it to
	  give us more control over things.

	* src/workbook-control-gui.c (wbcg_zoom_feedback) : no need to
	  reposition objects manually here.

	* src/print.c (print_sheet_objects) : Use sheet_object_can_print.

	* src/gutils.c : Clean up the name spacing

	* src/sheet-filter.c : Support the new SheetObjectView interface
	* src/sheet-object-cell-comment.c : ditto
	* src/sheet-object-graph.c : ditto
	* src/sheet-object-image.c : ditto
	* src/sheet-object-widget.c : ditto

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_object) :
	  - arrow moves the objects
	  - ctrl arrow expands an edge
	  - shift ctrl arrow shrinks an edge

	* src/commands.c (CmdObjectInsert) : delete
	(CmdObjectDelete) : Rename to CmdObjectsDelete and handle multiples
	(CmdObjectMove) : Rename to CmdObjectsMove and handle multiples

	* src/application.c (gnm_app_clipboard_cut_copy_obj) : handle multiple
	  objects.
	* src/gnumeric-pane.c : ditto.
	* src/sheet-control-gui.c : ditto.
	* src/item-grid.c : ditto.  Also there is no need to handle object
	  creation here as a special case just use the object editing
	  directly.

	* src/sheet-object.c (sheet_object_anchor_init) : pick a default that
	  we've actually implemented.

2004-10-08  Morten Welinder  <terra@gnome.org>

	* src/rangefunc.c (range_hypot): New function.

	* src/workbook.c (workbook_sheet_unhide_controls): New function.

	* src/sheet.c (sheet_set_visibility): Call
	workbook_sheet_unhide_controls as appropriate.

	* src/gui-file.c (gui_file_open): Start browsing in the same
	directory as the workbook from which we initiated the open.

	* src/commands.c (cmd_paste_cut_update_origin,
	update_after_action): Use workbook_autorecalc.

	* src/workbook.c (workbook_autorecalc): New function.

2004-10-07  Morten Welinder  <terra@gnome.org>

	* src/cmd-edit.c (sv_select_cur_inputs): Implement.

	* src/expr.c (gnm_expr_get_ranges): Implement.

2004-10-06  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (show_gui): Maximize when preferred
	size is larger than screen.

2004-10-05  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2004-10-05  Jody Goldberg <jody@gnome.org>

	* Release 1.3.91

2004-10-05  Jon K Hellan  <hellan@acm.org>

	* configure.in (gnumeric_reqs): Add pangoft2 requirement.  (Fixes
	#153701.)

2004-10-04  Jody Goldberg <jody@gnome.org>

	* configure.in : Add a test for mkfifo

2004-09-13  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Cleanup the mono detection code.  This way it
	  won't get to the ``configure --help'' which is good for the
	  upcoming stable release.

2004-10-01  Jody Goldberg <jody@gnome.org>

	* src/colrow.c (colrow_set_sizes) : no need to calculate the size if
	  we're assigning the default.  Clean up the logic for assigning the
	  default to
	  1) Not assign to an empty col/row
	  2) Break XL compat and have autosize of empty do the same thing for
	    col and row.

2004-10-01  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_open): Specifically list "*.csv" and
	"*.tsv" until we get a proper fix.  (Fixes #143135.)

2004-09-29  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (go_file_is_writable): Make the file-exist dialog
	use GTK_MESSAGE_WARNING and have buttons OK and Cancel.
	(gui_file_save_as): Cleaup.
	(do_save_as): Cleanup and move parts up to sole caller.

	* src/Makefile.am: Link in egg-recent.

	* src/clipboard.c (clipboard_copy_range): Fix
	gboolean/CellIterFlags confusion.
	* src/workbook-control-gui.c (cb_workbook_debug_info): Ditto.
	* src/sheet-view.c (sv_is_region_empty_or_selected): Ditto.
	* src/print.c (print_page): Ditto.

	* src/sheet.c (sheet_foreach_cell_in_range): Don't consider a cell
	with an un-evaluated expression empty.  Add paranoia.

2004-09-29  Jody Goldberg <jody@gnome.org>

	* src/commands.c (cmd_object_move) : extend to handle insertion too.

	* src/gnumeric-pane.c (cb_control_point_event) : Play fast and lose
	  with the undo records when duplicating an object by ctrl-click.
	  Assign the object the sheet as soon as we duplicate it but do not
	  list the undo until we record the resize on button release.

	* src/workbook-view.c (gnm_mailto_url_show) : fix.

	* src/session.c : suppress warning in the --without-gnome case

	* src/sheet-control-gui.c (scg_set_current_object) : new. uses the
	  handy dandy unrealized signal on a SheetObject.  With code split from
	(scg_object_stop_editing) : here.
	(scg_mode_edit_object) : and here.
	* src/gnumeric-pane.c (cb_control_point_event) : so that we could use
	  it here.

2004-09-28  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_mode_edit_object) :  fall back to edit
	  mode if the object is unrealized.

	* src/sheet-object.c (sheet_object_clear_sheet.) : merge some of the
	  nice features from finalize
	(sheet_object_finalize) : use sheet_object_clear_sheet.
	* src/sheet.c (sheet_destroy) : ditto.

	* src/gnumeric-pane.c (cb_control_point_event) : Make the copy
	  operation undo-able.

2004-09-28  Morten Welinder  <terra@gnome.org>

	* configure.in: Add check for pango_context_set_matrix.  We're
	going to need that for rotated text.

2004-09-28  Jody Goldberg <jody@gnome.org>

	* src/commands.c (cmd_object_raise_redo) : Don't use MAXINT/MININT it
	  causes trouble becaue -MININT is not expressable

2004-09-28  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=153871
	* src/gnm-so-filled.c (cb_filled_update_bounds) : line width counts
	  when sizing.

	* src/commands.c (cmd_object_delete) : Take an optional descriptor
	  string.  All callers changed.

	* src/application.c (gnm_app_clipboard_cut_copy_obj) : Use
	  cmd_object_delete for cuts to get undo.

	* src/sheet-object.c (sheet_objects_relocate) : properly clear the
	  sheet before we unref an object.
	(sheet_objects_get) : use range_contained.
	(sheet_objects_clear) : ditto.  This simplifies undo/redo.

2004-09-27  Jody Goldberg <jody@gnome.org>

	* src/application.c (gnm_app_clipboard_cut_copy_obj) : translate the
	  anchor back to a pseudo origin to make pasting easier.

	* src/clipboard.c (clipboard_paste_region) : handle paste contents
	  with only objects.  No need to do tiling or to clear things.

	* src/gutils.c (gnm_ptr_array_insert) : Make this smarter.
	  Just append if the requested element is >= len

	* src/item-grid.c (item_grid_event) : only auto-slide when we're
	  outside.  Inside we handle it locally fixes artificial movement that
	  seems to jump back to the start of the previous row/col

	* src/gnumeric-pane.c (cb_control_point_event) : Store the button that
	  initiated the object drag and check that when releasing.

	* src/commands.c (cmd_paste_copy) : handle pasting objects with no
	  content.

	* src/gutils.h : Fix the name spacing to be gnm_ in all cases.
	  gnumeric_ is too damn big, and we have not business using g_
	* src/gutils.c (gnm_usr_dir) : Check for empty home_dir

	* src/graph.c (gnm_go_data_vector_load_len) : handle missing
	  expression

	* src/gnm-so-filled.c (gnm_so_filled_read_xml_dom) : We still need to
	  Type field even though it is ugly.

	* src/xml-io.c (xml_cellregion_write) : cut-n-paste-o to fix
	  inter-process pasting
	(xml_cellregion_read) : Actually store the resulting objects
	(xml_read_sheet_object) : Don't set the sheet when extracting a
	  cellregion.

2004-09-27  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_sendto): Bring !WITH_GNOME case a
	lot closer to sanity.  Properly handle case where mkdir fails.
	(gnm_mailto_url_show): New function factored out from
	wb_view_sendto.

2004-09-27  Jody Goldberg <jody@gnome.org>

	* configure.in : drop the test for caddr_t we do not need it and it
	  does not work win32.
	  Export the epoch, major, minor version elements

	* src/workbook-view.c (wb_view_sendto) : a win32 portability patch for
	  mkdir.

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (gnumeric_xml_write_workbook) : respect the xml
	  compression preference a bit.  It's still uncompressed, or
	  compressed.  We'll need to patch gsf to be able to tune that
	  parameter.

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_sendto) : encode the right portion of
	  the url.

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_sendto) : cleanup and use the new url
	  encoding routine.

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml : Add InsertCurrentDateTime

	* src/wbcg-actions.c (cb_insert_current_date_time) : new

	* src/format.c (style_format_default_date_time) : new return
	  concatination of default date and time formats

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wbv_save_to_uri) : renamed from wbv_save_to_file
	  to clarify that it does not work for a simple path.
	(wb_view_sendto) : fix to use a uri.

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (cb_sheet_object_canvas_event) : Use the pane in
	  GnmCanvas rather than adding one to GnmSimpleCanvas

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-pane.c (gnm_pane_object_move) :  handle symmetric
	  movement via ctrl-click and object duplicate via ctrl-click on
	  acetate

	* src/gnumeric-pane.c (build_so_menu) : new
	(display_object_menu) : create a GtkMenu based on the actions.

	* src/sheet-object.c (sheet_object_populate_menu) : Rework the
	  interface to return action descririptors rather than a GtkMenu
	  Change all implementations

2004-09-26  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_cellregion_read) : read objects
	(xml_cellregion_write) : write them too

2004-09-25  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_edit_copy) : Use
	  gnm_app_clipboard_cut_copy_obj for objects
	(cb_edit_cut) : ditto.

	* src/sheet-object.c (sheet_object_populate_menu) : put the stacking
	  items into a sub menu.

2004-09-24  Jody Goldberg <jody@gnome.org>

	* src/clipboard.c (paste_object) : new.
	(clipboard_paste_region) : use it.
	(cb_dup_objects) : new.
	(clipboard_copy_range) : dup the objects in the range.
	(cellregion_new) : init the object list
	(cellregion_unref) : free the object list

	* src/sheet-object.c (sheet_object_dup) : make public, and tweak
	  interface.
	(sheet_object_clone_sheet) : adjust to the interface change.

2004-09-24  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-image.c (sheet_object_image_copy) : implement

	* src/wbcg-actions.c : update the actions to handle the new drawing
	  object types.

	* src/sheet-object.c (sheet_object_clone) : Change the interface to
	  have the wrapper create the object.  Then s/clone/copy/ and have it
	  just do the assignament rather, not allocation.
	* src/sheet-object*.c : s/clone/copy/ with related semantic changes

	* src/rendered-value.c (rendered_value_render) : trivial
	  constification

	* src/main-application.c (main) : Use bonobo_main WITH_GNOME just in
	  case.

	* src/gnumeric-pane.c (gnm_pane_object_register) : Change return type
	  to GObject.  There's no need to be more specific.
	(gnm_pane_widget_register) : ditto.

	* src/gnm-so-filled.c : Rewrite of the old SheetObjectGraphic
	  to use GogStyle, merge text into the base, and use GObject properties
	* src/gnm-so-line.c : Rewrite of the old SheetObjectFilled
	  to use GogStyle  and use GObject properties

	* src/Makefile.am : Adjust to the file changes for
	  sheet-object-graphic.c

2004-09-13  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (GCONF_SCHEMAS_INSTALL): AM_CONDITIONAL has to be
	  called in all branches.

2004-09-24  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_read_sheet_object) : add hooks to the old names
	  for GnmSOFilled, and GnmSOLine

2004-09-23  Jody Goldberg <jody@gnome.org>

	* src/commands.c (cmd_object_format) : undo redo for the new line and
	  filled objects.

2004-09-23  Jody Goldberg <jody@gnome.org>

	* configure.in (GNUMERIC_PLUGIN_LDFLAGS) : new macro to give the win32
	  folk a hook for the plugins.
	* plugins/*/Makefile.am : Use it
	* plugins/*/plugin.xml.in : Remove the .la for module names.  Core of
	  glib adds just before checking platform specific names.

2004-09-23  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_view_zoom_out) : in and out were reversed
	(cb_view_zoom_in) : ditto

2004-09-24  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): New wrapper function.  Turn on
	new printing by default.

	* src/gui-util.c (entry_to_int): Plug leak.
	(entry_to_float_with_format): Plug leak.

2004-09-23  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (cb_activate_default): New function to avoid
	endless recursion.
	(gnumeric_editable_enters): Activate via cb_activate_default.

	* src/rendered-value.c (rendered_value_recontext): Don't require
	Pango 1.6, but use it if we have it.

2004-09-23  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (rendered_value_recontext): Force
	wrap==FALSE when the source layout has only one line.
	(Mostly fixes #152265)

	* src/rendered-value.h (struct _RenderedValue): switch
	layout_natural_width and layout_natural_height be in terms of
	pango units.  All users changed.

	* src/cell-draw.c (cell_calc_layout): Switch srguments width,
	height, h_center, res_x, and res_y to be in terms of pango units.
	Ditto for internal variables rect_x, rect_y, hoffset, indent, and
	text_base.  All callers changed.

2004-09-23  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (rendered_value_remeasure): New function.
	(rendered_value_new): Use rendered_value_remeasure.
	(rendered_value_recontext): New function.

	* src/cell-draw.c (cell_calc_layout): Use
	rendered_value_remeasure.

	* src/print-cell.c (print_cell_NEW): Use rendered_value_recontext.

2004-09-22  Morten Welinder  <terra@gnome.org>

	* src/colrow.c (cb_clear_variable_width_content): Force a redraw.

	* src/cell-draw.c (cell_calc_layout): Drop rect argument.  Replace
	printing argument by y_direction argument.  Drop x1 and y1
	arguments.  Callers changed.
	(cell_calc_layout): Insert zero_width_space characters in the
	right spot.

	* src/print-cell.c (print_cell_NEW): Use size_pts.

2004-09-22  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_merged_range, print_cell): Take extra
	  PangoContext argument.  All callers changed.
	(print_cell_range): Create a pango context.

	(print_cell_OLD): Renamed from print_cell.
	(print_cell_NEW): New function.
	(print_cell): New macro to call _OLD or _NEW as appropriate.

	* src/rendered-value.c (rendered_value_new): Get rid of quantify
	  artifacts.

2004-09-22  Morten Welinder  <terra@gnome.org>

	* src/cell-draw.c (cell_draw): Get rid of quantify artefacts.
	(cell_calc_layout): Add rv and printing arguments, drop res_layout
	argument.  Make extern.  Caller changed.

2004-09-21  Morten Welinder  <terra@gnome.org>

	* src/print.c (print_hf_element): Print using pango layouts when
	possible.  Code adapted from bug #152939, kzamir@walla.co.il.

2004-09-16  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (cb_clear_rendered_cells) : fix the 'Serious Error'
	  warnings on zoom changes.

	* src/workbook-control-gui.c (wbcg_create_status_area) : drop some
	  frames in the status area and use GtkStatusbar to get the resize grip

	http://bugzilla.gnome.org/show_bug.cgi?id=152636
	* src/style.c (style_font_new_simple) : sizes in pts should not
	  include the zoom scaling, pretend that we actually measure that.

	http://bugzilla.gnome.org/show_bug.cgi?id=152244
	* src/sheet-object.c (cell_offset_calc_pixel) : return double to avoid
	  problems when we are at integer-epsilon, which would round to
	  integer-1 and systematicly lose precision.
	* src/sheet-control-gui.c (scg_object_view_position) : Use
	  foo_canvas_window_to_world instead of foo_canvas_w2c to move the
	  pixels back into canvas space.

	http://bugzilla.gnome.org/show_bug.cgi?id=152512
	* src/gnumeric-pane.c (control_point_set_cursor) : new.
	(cb_control_point_event) : use it.
	(new_control_point) : no longer a  need to specify the cursor
	(set_item_x_y) : ditto.
	(gnm_pane_object_set_bounds) : cursor are dynamic now.
	(set_acetate_coords) : ditto.

2004-09-14  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-image.c (soi_get_image_fmt): g_free is a poor
	substitute for g_slist_free.

2004-09-10  Jody Goldberg <jody@gnome.org>

	* src/commands.c (cmd_colrow_hide_correct_selection) : disable because
	  it irritates me.

	* src/wbcg-actions.c : Add ctrl-9, ctrl-shift-9 (hide,unhide rows)
	Add ctrl-0, ctrl-shift-0 (hide,unhide cols)

	* src/wbc-gtk.c (cb_add_menus_toolbars) : toggle std toolbar should be
	  ctrl-7

2004-09-10  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_new): Generate a proper URI here.

2004-09-09  Jody Goldberg <jody@gnome.org>

	* configure.in : Post release bump

2004-09-08  Jody Goldberg <jody@gnome.org>

	* Release 1.3.90

2004-09-08  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_toggle_visibility) : remember
	  whether to keep a toolbar when in fullscreen mode.
	(cb_visibility) : simplify.

	* src/wbcg-actions.c (cb_view_fullscreen) : new.
	(cb_help_irc) : throw something together.

	* src/wbc-gtk.c (wbc_gtk_create_status_area) : hide statusbar by
	  default in fullscreen mode.
	(cb_add_menus_toolbars) : hide toolbars by default in fullscreen mode.
	(cb_toolbar_activate) : simplify.
	(cb_handlebox_visible) : ditto.
	(cb_toggle_visibility) : new.
	(cb_wbcg_window_state_event) : handle fullscreen transitions.
	(wbc_gtk_init) : init the window_state_event handler.

2004-09-08  Jody Goldberg <jody@gnome.org>

	* src/stf.c (csv_tsv_probe) : accept files < 80 characters long

2004-09-08  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/wbcg-actions.c: Correct Z-Test menu item description and
	  title. We do not allow large sample calculations.

2004-09-07  Jody Goldberg <jody@gnome.org>

	* src/pixmaps/Makefile.am : Move to the splash for 1.4

2004-09-07  Jon K Hellan  <hellan@acm.org>

	* src/gui-util.[hc] (gnumeric_notice, gnumeric_notice,
	gnumeric_dialog_run, gnumeric_error_info_dialog_show): Replace
	WorkbookControlGUI first paremeter with GtkWindow.

	* src/gui-file.c (go_file_is_writable, gui_get_image_save_info,
	check_multiple_sheet_support_if_needed, do_save_as,
	gui_file_save_as): Use updated gui-utils

	* src/item-cursor.c (item_cursor_target_region_ok): Ditto

	* src/print.c (sheet_print): Ditto.

	* src/session.c (interaction_function): Ditto.

	* src/wbcg-actions.c (cb_edit_search_replace_query): Ditto.

	* src/workbook-control-gui.c (wbcg_error_error) Ditto.
	(wbcg_close_if_user_permits):

2004-09-06  Jody Goldberg <jody@gnome.org>

	* configure.in : Add a --disable-ssconvert for development.
	  Constantly linking gnumeric and ssconvert is irritating, but we do
	  want ssconvert enabled for releases.

2004-09-06  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml : Update to reflect some input from ui
	  review
	* src/wbcg-actions.c (actions) : ditto
	  s/Search/Find/
	  s/Search and Replace/Replace/

2004-09-02  Stepan Kasal  <kasal@ucw.cz>

	* configure.in (gnumeric_with_gnome): Fix typo.

2004-09-05  Jon K Hellan  <hellan@acm.org>

	* configure.in (GConf): Fix typo.

2004-09-04  Jon K Hellan  <hellan@acm.org>

	* src/wbc-gtk.c (wbc_gtk_init_undo_redo): Update action group of
	Repeat.

	* src/sheet-object-graphic.c (sheet_object_text_get_property,
	sheet_object_text_class_init): Add "label" property.

2004-09-03  Jody Goldberg <jody@gnome.org>

	* configure.in : expand the --with-gtk tests and make --with-gnome
	  conditional on --with-gtk

2004-09-02  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: start implementing --with-gui via the WITH_GTK
	  conditional.  Check also for pango, which is required even if no GUI
	  is used.  We use gtk+-2.0 >= 2.4.0 which requires pango >= 1.4.0; so
	  we ask pango >= 1.4.0 too.
	* configure.in: Implement --disable-solver option, --enable-plugins hack.
	* src/Makefile.am: Conditionalize solver, start using WITH_GTK.
	* plugins/Makefile.am: compile the mps plugin only if ENABLE_SOLVER
	  is set; --enable-plugins can override the plugin list.
	* src/solver.h: Don't declare anything if not !ENABLE_SOLVER; supply
	  a few stub macros instead.
	* src/wbcg-actions.c: Conditionalize on ENABLE_SOLVER.
	* src/xml-io.c (xml_read_solver, xml_write_solver): Likewise.

2004-07-31  Stepan Kasal  <kasal@ucw.cz>

	* configure.in: Gnomish autogen.sh uses ACLOCAL_FLAGS, if some of the
	  macros are in nonstandard places.  If you touch configure.in then,
	  aclocal.m4 is regenerated, but without ACLOCAL_FLAGS.  This change
	  ensures that ACLOCAL_FLAGS is propagated to the Makefile.
	* Makefile.am: ACLOCAL_AMFLAGS = @ACLOCAL_FLAGS@

	* src/ssconvert.c: s/exporter/importer/

2004-08-31  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (cb_chain_sensitivity): Renamed from
	cb_set_repeat_sensitivity and changed to take action directly.
	Caller changed.

2004-08-31  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-graphic.c (sheet_object_polygon_class_init):
	Initialize sheet_object_class.

2004-08-30  Jon K Hellan  <hellan@acm.org>

	* src/commands.c (cmd_merge_cells_repeat): Shut up warning.

	* src/gui-file.c (gui_wb_view_show): Remove bogus return.

2004-08-30  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_finalize): Destroy
	visibility_widgets.
	(wbcg_toggle_visibility): New function.
	(wbcg_copy_toolbar_visibility): Reinstate.
	(workbook_control_gui_init): Initialize visibility_widgets.

	* src/wbcg-actions.c (GNM_ACTION_DEF): Use new
	wbcg_toggle_visibility.

	* src/wbc-gtk.c (wbc_gtk_create_status_area): Add status bar to
	visibility widgets.
	(cb_toolbar_activate): Simplify.
	(cb_add_menus_toolbars): Add toolbars to visibility widgets.
	(wbc_gtk_set_toggle_action_state): Also look in toolbar actions.
	Ick -- this gets uglier by the day.

	* src/workbook-control-gui-priv.h (struct WorkbookControlGUI):
	Replace statusbar member by visibility_widgets.

2004-08-29  Jody Goldberg <jody@gnome.org>

	* configure.in :  post release bump to .90 to indicate transition to
	  beta status.

2004-08-29  Jody Goldberg <jody@gnome.org>

	* Release 1.3.2

2004-08-29   Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/item-bar.c (item_bar_draw): Fix group lines in row/column
	headers.

2004-08-28  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_new_with_type) : Renamed from sheet_new_special,
	  that name was not terribly clear.

2004-08-28  Jody Goldberg <jody@gnome.org>

	* src/pixmaps/Makefile.am : Add halign-fill and halign-general
	* src/application.c (gnumeric_application_setup_icons) : ditto

2004-08-28  Jody Goldberg <jody@gnome.org>

	* src/commands.c (cmd_merge_cells) : optionally center the merged
	  region
	* src/wbcg-actions.c (cb_merge_and_center) : new

2004-08-28  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml : Reorder Delete menu to put Col before
	  Row to be consistent with the other menus

2004-08-28  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_view_zoom_in) : new
	(cb_view_zoom_out) : new

2004-08-28  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c : Add ctrl +/- as accelerators for ins/del cells

2004-08-27  Jody Goldberg <jody@gnome.org>

	* src/plugin-service.c (plugin_service_file_opener_read_xml) :
	  simplify parsing of 'file_pattern' for importer filename probing.
	  All we every really needed was suffix matching.  None of the power
	  of fnmatch or optional case sensitivity was every used.
	(gnm_plugin_file_opener_probe) : use a nice simple suffix match.

2004-08-27  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-graphic.c :  convert markup to a property for
	  SheetObjectText

	* src/sheet-object-cell-comment.c : Add a property 'markup' to be used
	  eventually.

2004-08-27  Jon K Hellan  <hellan@acm.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=151152

	* src/workbook-control-gui.c (wbcg_close_if_user_permits): Define
	responses GNM_RESPONSE_SAVE_ALL, GNM_RESPONSE_DISCARD_ALL. These
	are negative, to work with druid logic in gnumeric_dialog_run.

2004-08-26  Jon K Hellan  <hellan@acm.org>

	* src/gui-file.c (gui_wb_view_show): New. Factored out of
	gui_file_read. Show  view in a wbcg. Use current or new wbcg
	according to policy.
	(gui_file_read): Use it.

2004-08-26  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c (cb_help_bug, cb_help_web): Do something
	useful here.  (Based on patch from ynakai@redhat.com.)

2004-08-25  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c (cb_filter_bounds_changed) : fix typo in cast
	  from new code for bounds-changed

2004-08-24  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=150530
	* src/sheet-object-cell-comment.c (cell_comment_write_xml_sax) : fix
	  in libgsf, but patched here too to tide us over until the next
	  libgsf release.

2004-08-24  Jody Goldberg <jody@gnome.org>

	* src/sheet-object.c (sheet_object_class_init) : declare a
	  bounds-changed signal.
	(sheet_object_update_bounds) : emit bounds-changed and assume the
	  views will do the right thing.  No need to manually walk the
	  realized list.  That should go away.

	* src/sheet-filter.c :  Adjust to using the bounds-changed signal
	  instead of doing it directly.
	* src/sheet-object-cell-comment.c : ditto.
	* src/sheet-object-graph.c : ditto.
	* src/sheet-object-graphic.c : ditto.
	* src/sheet-object-image.c : ditto.
	* src/sheet-object-widget.c : ditto.

	* src/sheet-control-gui.c (cb_scg_object_bounds_changed) :  new
	(scg_object_stop_editing) : disconnect the bounds changed signal here.
	(scg_mode_edit_object) : connect to it here.

	* src/gnumeric-pane.c (display_object_menu) : no need to use
	  sheet_object_view_control.  We can pull the info from the canvas.
	(cb_sheet_object_canvas_event) : ditto.
	(cb_sheet_object_widget_canvas_event) : ditto.
	(cb_sheet_object_view_destroyed) : ditto.
	(gnm_pane_object_register) : Add some convenience arguments to hook up
	  the bounds-changed handler and set the initial size.
	(gnm_pane_widget_register) :

2004-08-24  Jody Goldberg <jody@gnome.org>

	* src/application.c :  signals are guint, not GQuark.  Probably does
	  not matter, but it can't hurt to match the glib headers

	* src/sheet-object-cell-comment.c (cell_comment_write_xml_sax) : gsf
	  was more anal than libxml about handling NULL as strings.  new gsf
	  is more relaxed, but add some protection here until that is in
	  circulation.

	* src/xml-io.c (gnumeric_xml_read_workbook) : default to using the sax
	  exporter
	(xml_init) : cleanup.

	http://bugzilla.gnome.org/show_bug.cgi?id=150792
	* src/sheet.c (colrow_move) : Only ignore non-existent cells, not all
	  Blanks.  That includes things with VALUE_EMPTY which includes cells
	  whose expressions were just re-written.
	(sheet_move_range) : ditto.

2004-08-24  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received): Take
	advantage of newly minted go_file_split_uris.

2004-08-22  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received): Remove
	gnome-vfs dependency.

2004-08-14  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-image.c (sheet_object_image_write_xml_sax) : add a
	  'size-bytes' attribute to make optimization easier.

2004-08-22  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received): Convert
	uri to string before use.

2004-08-21  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_set_zoom_factor) : forward port the zoom kludge.
	  There is no time to do RenderedRegion for 1.4

2004-08-21  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=149945
	* src/value.c (find_column_of_field): Correct offset.

2004-08-21  Kjartan Maraas  <kmaraas@gnome.org>

	* configure.in: Add nb to ALL_LINGUAS.

2004-08-20  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_new_special) : renamed from sheet_new, and a
	  'type' added.  Not used yet.

2004-08-20  Morten Welinder  <terra@gnome.org>

	* configure.in: Check for asinh, acosh, atanh.

	* src/gutils.c (asinhgnum, acoshgnum, atanhgnum): Provide if
	needed.

	* src/parser.y (yylex): Take extra care not to run off the edge.

2004-08-17  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (mathfunc_init): Greatly simplify using goffice
	code.

	* src/libgnumeric.c (gnm_common_init): Init mathfunc after
	goffice.

2004-08-19  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Bumped the libgsf-gnome-1 requirement to make it
	consistent with the libgsf-1 requirement.

2004-08-18  Jon K Hellan  <hellan@acm.org>

	* configure.in (psiconv): Update psiconv.

2004-08-17  Etsushi Kato  <ekato@ees.hokudai.ac.jp>

	* src/gnumeric-canvas.c (gnm_canvas_key_press):
	gtk_im_context_reset(gcanvas->im_context) should be called after
	checking gtk_im_context_filter_keypress() and GDK_SHIFT_L, GTK_Alt_L,
	and GDK_Control_L. (bug #148473)

2004-08-17  Jon K Hellan  <hellan@acm.org>

	* src/wbcg-actions.c (cb_insert_image): is_save parameter to
	gui_image_file_select no longer needed.

	* src/sheet-object-image.c (soi_gdk_pixbuf_save): New. Callback
	which writes via gsf.
	(soi_get_image_fmt): New. Get a format descriptor for the original
	data in a SheetObjectImage.
	(soi_free_image_fmt): New. Free a format descriptor.
	(soi_cb_save_as): New. Choose file name and format and save
	image.
	(sheet_object_image_populate_menu): New. Put a "save as" entry in
	the object's context menu.

	* src/sheet-object-graph.c (soi_cb_save_as): Choose image format
	from a list.

	* src/gui-file.h (GnmImageFormat): Struct which describes an
	(image) file format.

	* src/gui-file.c (gui_image_file_select): Split the parts common
	to save and open into new function gui_image_chooser_new. Drop
	is_save parameter to _select.
	(gui_get_image_save_info): The parts of _select which have to do
	with saving go here. Add a format chooser.

	* src/file.[ch] (gnm_file_saver_fix_file_name): Rename to
	gnm_vrfy_uri_ext. Take an extension instead of a GnmFileSaver as
	1st parameter.

2004-08-16  Morten Welinder  <terra@gnome.org>

	* src/main-application.c (main): Plug leak.

2004-08-16  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/item-bar.c (item_bar_draw): Fix black line in row/column
	headers.

2004-08-14  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (wbcg_create_edit_area): Fix typo.

	* src/sheet-control-gui.c (sheet_control_gui_new): Ditto.

2004-08-13  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-image.c (sheet_object_image_read_xml_dom): Read
	image.

2004-08-11  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-image.c (sheet_object_image_new): Simplify
	using g_memdup.
	(sheet_object_image_print): fix up types to make gmorten happy.

2004-08-09  Jon K Hellan  <hellan@acm.org>

	* src/sheet-object-image.c (sheet_object_image_new): strdup the
	image type.
	(sheet_object_image_finalize): Free the image type.
	(soi_info_cb): New callback used to find image type.
	(soi_get_pixbuf): Install callback on pixbuf loader in order to
	find image type.
	(sheet_object_image_get_property): New gobject method to return
	type, data or pixbuf as object parameters.
	(sheet_object_image_class_init): Install properties.

2004-08-11  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (main): Handle non-URI output destinations.

2004-08-09  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-object-graph.c (cb_save_as) : Set zoom to 1.0 when
	exporting to SVG.

2004-08-02  Jody Goldberg <jody@gnome.org>

	* src/expr.c (gnm_expr_eval) : Functions returning an array when only
	  scalar results are permitted produce #VALUE!

	* src/style.c (style_default_halign) : Fix drilling down into arrays

	* src/wbc-gtk.c (cb_add_menus_toolbars) : Init state.

2004-08-01  Jody Goldberg <jody@gnome.org>

	* src/func.c (function_call_with_list) : Array parms seem to accept
	  scalars.

	* src/value.c (value_dup) : Accept NULL

	* src/expr.c (gnm_expr_eval) : do intersection for constant arrays too

2004-07-30  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init_zoom) : We need a label for the action
	  in case it is a menu item.

2004-07-30  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (cb_add_menus_toolbars): Plug leaks.

	* src/file.c (gnm_file_saver_unregister): First use, then free.

2004-07-30  Jon K Hellan  <hellan@acm.org>

	* src/command-context.c (format_message): Strange things happen if
	we treat the unknown string we are passed as a format string.

2004-07-30  Yukihiro Nakai  <nakai@gnome.gr.jp>

	* src/wbcg-actions.c: Don't forget to mark with N_()
	http://bugzilla.gnome.org/show_bug.cgi?id=148746

2004-07-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/hlink.h (GNM_HLINK_URL_TYPE): new
	(GNM_HLINK_URL): new
	(IS_GNM_HLINK_URL): new

2004-07-27  Morten Welinder  <terra@gnome.org>

	* configure.in: Check for log1p also.

2004-07-27  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-gconf.c (gnm_conf_init_printer_decoration_font): (void).
	* src/application.c (cb_flag_windows_changed): Ditto.

2004-07-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* configure.in: use AM_PROG_LEX rather than AC_PROG_LEX

2004-07-27  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (cb_regenerate_window_menu) : new.

2004-07-26  Jody Goldberg <jody@gnome.org>

	* configure.in :  bump pxlib req to 0.3.0 per Uwe's request

	http://bugzilla.gnome.org/show_bug.cgi?id=148412
	* src/workbook-control-gui-priv.h : typo in the new combos

2004-07-26  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (sheet_colrow_group_ungroup): Don't use ?: result
	as a structure.  Go via pointers.

2004-07-23  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c: Add Ctrl-Shift-D for double underline.

	* src/commands.c (cmd_merge_data): Fix 0/NULL mixup.
	* src/complete.c (complete_finalize): Ditto.
	* src/sheet.c (sheet_range_calc_spans, sheet_toggle_hide_zeros): Ditto.
	* src/colrow.c (colrow_set_sizes, colrow_restore_state_group): Ditto.
	* src/gui-util.c (gnumeric_popup_menu): Ditto.
	* src/item-cursor.c (item_cursor_unrealize): Ditto.
	* src/value.c (value_peek_string): Ditto.

	* src/expr.c (cb_bin_arith): Add const-casts.

	* src/format.c (format_entry_set_fmt): Use g_strdup, not plain
	strdup.

	* src/wbcg-actions.c: Add Ctrl-5 for strikethough.

2004-07-22  Jody Goldberg <jody@gnome.org>

	* src/workbook-edit.c (wbcg_edit_finish) : change 'accept' into an
	  enum and handle arrays and range fills here.

	* src/parser.y : Add distinct productions for array elements with
	  {1\2\3;4\5\6} vs {1,2,3;4,5,6}
	(build_array) : add some error messages empty and asymmetric arrays.

2004-07-22  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_set_standard_toolbar_visible) : delete
	(wbcg_set_format_toolbar_visible) : delete
	(wbcg_set_object_toolbar_visible) : delete
	(wbcg_copy_toolbar_visibility) : make virtual for now

	* src/wbcg-actions.c (cb_view_standard_toolbar) : delete
	(cb_view_format_toolbar) : delete
	(cb_view_object_toolbar) : delete

2004-07-22  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (cb_handlebox_visible) : new.
	(cb_add_menus_toolbars) : connect it here and create a menu entry in
	  the view menu to toggle the visibility.

2004-07-21  Morten Welinder  <terra@gnome.org>

	* src/gutils.c (expm1gnum): Supply this when missing.

2004-07-20  Jody Goldberg <jody@gnome.org>

	* configure.in : add test for sysconf as per Mark's request

	* src/gnumeric-pane.c (cb_pane_popup_menu) : cheese up a little hack
	  to get 'popup-menu' binding context menus for col/row headers too.
	(gnm_pane_clear_obj_size_tip) : new
	(gnm_pane_display_obj_size_tip) : new
	(gnm_pane_object_move) : use gnm_pane_display_obj_size_tip to provide
	 an indication of the object size.

2004-07-20  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (lbeta3): Use lgamma_rgnum.

	* src/gutils.c (lgamma_rgnum): When needed, supply this.

	* src/numbers.h (lgamma_rgnum): Add definition for this.

	* configure.in (lgamma_r): Check for this.  Check for long double
	version when needed.

2004-07-20  Morten Welinder  <terra@gnome.org>

	* src/ranges.c (range_is_infinite): Fix.  (Still unused, though.)

2004-07-19  Jody Goldberg <jody@gnome.org>
	win32 portability patch from Mark Gilbert

	* src/io-context.c (io_progress_update) : use g_get_current_time
	  instead of gettimeofday.

2004-07-19  Jody Goldberg <jody@gnome.org>

	* src/dialogs/dialog-about.c : Update a bit.  Add
	* doc/C/about-authors.xml  : ditto
	    - Emmanuel
	    - Jean
	    - Hal
	    - Uwe
	    - Michael Devine

2004-07-19  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_init) : make the dom exporter a lower priority
	  than the sax exporter so that we can start phasing it out.

2004-07-19  Jody Goldberg <jody@gnome.org>
	Uwe Steinmann <uwe@steinmann.cx>

	* plugins/Makefile.am : merge in the paradox importer

2004-07-19  Jody Goldberg <jody@gnome.org>

	* configure.in : Post release version bump

2004-07-19  Jody Goldberg <jody@gnome.org>

	* Release 1.3.1

2004-07-19  Jody Goldberg <jody@gnome.org>

	* src/ssconvert.c (main) : some typos

2004-07-17  Jody Goldberg <jody@gnome.org>

	* configure.in : Add a test for signgam

2004-07-19  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (wbcg_set_selection_halign) :  Make public
	  somewhat.
	(wbcg_set_selection_valign) : ditto.

	* src/wbc-gtk.c :  Adjust the borders to use stock items in place of
	  the old inline pixbuf silliness.  Add a valignment and halignment
	  combo.  Still need some way to indicate 'General' for both.

	* src/application.c (gnumeric_application_setup_icons) : add the
	  border icons to the set of stock items.

2004-07-17  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=147756
	* src/sheet-autofill.c (autofill_cell) : An ancient bug.

2004-07-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-general.schemas.in: Correct compression level
	  description

2004-07-16  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-paths.sh.in : Add version

2004-07-15  Jody Goldberg <jody@gnome.org>

	Some Seth UI feedback
	* src/wbcg-actions.c : s/Launch Guru/Insert Chart/

2004-07-13  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_copyrel): New command.

	* src/wbcg-actions.c (cb_copydown, cb_copyright): Implement.

2004-07-12  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_cur_sheet) :  new convenience
	  routine

	* src/wbcg-actions.c : tidy up a bit

	* src/wbc-gtk.c (wbc_gtk_init_undo_redo) : tie sensitivity of repeat
	  to undo.

2004-07-11  Jody Goldberg <jody@gnome.org>

	* src/commands.c (cmd_set_text_repeat) : new
	  (missing validation support)
	(cmd_area_set_text_repeat) :  new.
	(cmd_ins_del_colrow_repeat) : new.
	(cmd_clear_repeat) :  new.
	(cmd_format_repeat) :  new.
	(cmd_colrow_hide_repeat) :  new.
	(cmd_group_repeat) : new.
	(cmd_paste_copy_repeat) : new.
	(cmd_autofill_repeat) : new.
	(cmd_autoformat_repeat) : new.
	(cmd_unmerge_cells_repeat) : new.
	(cmd_merge_cells_repeat) : new.
	(cmd_clone_sheet_repeat) : new.

2004-07-09  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml : Add repeat as an accelerator
	* src/commands.c (func) : add some hooks for repeat

2004-07-12  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c: Use gtk about icon if available.

2004-07-09  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=146486
	* src/expr.c (cb_bin_arith) : handle VALUE_EMPTY for implicit
	  iteration with arithmetic operators.

	http://bugzilla.gnome.org/show_bug.cgi?id=146511
	* src/func.c (function_call_with_list) : Use value_get rather than
	  value_fetch
	* src/sheet.c (sheet_foreach_cell_in_range) : check for empty values too

2004-07-07  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.c (go_conf_get_short_desc): Check for NULL
	  pointer
	(go_conf_get_long_desc): ditto

2004-07-05  Jody Goldberg <jody@gnome.org>

	* src/workbook-cmd-format.c (workbook_cmd_mutate_borders) :  move into
	  wbcg-actions.c

	* src/sheet-autofill.c (fill_item_new) : fix an old leak

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) :  no need to
	  check for accelerators here any more.
	(gnm_canvas_commit_cb) :  nor here.
	(gnm_check_ctrl_mask) :  delete and make these real accelerators the
	  way they belong.

	* src/wbcg-actions.c
	(cb_format_as_number) : a real accelerator
	(cb_format_as_currency) : ditto
	(cb_format_as_accounting) : ditto
	(cb_format_as_percentage) : ditto
	(cb_format_as_scientific) : ditto
	(cb_format_as_time) : ditto
	(cb_format_as_date) : ditto
	(cb_format_add_borders) : ditto
	(cb_format_clear_borders) : ditto

	* src/GNOME_Gnumeric-gtk.xml :  Add the new accelerators
	* src/application.c (gnumeric_application_setup_icons) : Rename the
	  icons to match the verbs (Percentage, Accounting)

2004-07-02  Jody Goldberg <jody@gnome.org>

	* configure.in : Make gconf conditional and test for uname

2004-07-01  Jody Goldberg <jody@gnome.org>

	* src/cmd-edit.c (sv_select_cur_depends) : find deps even for empty
	  cells.

2004-06-30  Jody Goldberg <jody@gnome.org>

	* src/stf.c (stf_init) : cvs exporter is one sheet only

	* src/gnumeric-gconf.c (get_schema) : typo
	(go_conf_get_type) : implement for #ifdef WITH_GNOME

2004-06-23  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* configure.in:
	* src/Makefile.am:
	* src/cut-n-paste-code/Makefile.am: removed pcre subdir.
	* src/graph.c: (cb_assign_val), (gnm_go_data_vector_load_values),
	(gnm_go_data_vector_get_value): changed gnm_nan to go_nan.
	* src/format.h:  replaced gnumeric_reg* by go_reg*
	* src/formats.c: (my_regerror), (currency_date_format_init),
	(currency_date_format_shutdown), (cell_format_simple_number),
	(cell_format_is_number), (cell_format_is_fraction): ditto.
	* src/number-match.c: (format_match_release),
	(format_match_create), (format_match): ditto.
	* src/plugin-service.c: (plugin_service_define): ditto.
	* src/regutf8.c: (gnumeric_regcomp_XL): ditto.
	* src/regutf8.h: ditto.
	* src/search.c: (search_replace_free), (search_replace_compile),
	(search_match_string), (search_replace_string): ditto.
	* src/search.h: ditto.
	* src/sheet-filter.c: (filter_expr_release), (filter_expr_eval): ditto.
	* src/widgets/widget-format-selector.c: (populate_menu): ditto.
	* src/workbook-control-gui.c: (wbcg_sheet_focus),
	(cb_notebook_switch_page): Added missing spaces.
	* src/cut-n-paste-code/pcre: Moved whole tree to goffice.
	* tools/import-pcre: Updated to the new path and replaced gnumeric_ by go_.

2004-06-22  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=134014
	* src/print-cell.c (print_merged_range) : sync with canvas item
	  recalling that y-coords are negative.  Enable diagonals.

2004-06-20  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : re-enable ssconvert as a test program for now to
	  avoid rebuilding it all the time.

2004-06-15  Jody Goldberg <jody@gnome.org>

	* src/sheet-object.c (sheet_objects_get) : don't reverse the z
	  ordering

2004-06-17  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/consolidate.c (simple_consolidate): dao_set_cell_expr now
	  absorbs the expr reference.
	(colrow_consolidate): ditto

2004-06-16  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wbv_save_to_file): Simplify using
	go_file_create.

	* src/wbc-gtk.c (wbc_gtk_reload_recent_file_menu): Convert
	filename to UTF-8 before constructing the label.  Use uri if the
	filename cannot be represented in UTF-8.

	* src/sheet-object-graph.c (cb_save_as): Handle dumping to uris.

	* src/gui-file.c (gui_image_file_select): Take and return uris.

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received):
	Simplify with go_file_open.

2004-06-15  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=142700
	* src/workbook-view.c (wb_view_sheet_focus): set current_sheet
	  before adjusting focus.

2004-06-15  Morten Welinder  <terra@gnome.org>

	* src/history.c (history_item_label): Fix thinko.  Avoid double
	UTF-8 encoding.

2004-06-14  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_reload_recent_file_menu): If available,
	use just filename for tooltip.  (Non-ascii looks nicer, and it's
	shorter.)

2004-06-13  Jody Goldberg <jody@gnome.org>

	* src/command-context-stderr.c : fix class decl to match change to
	  interface

2004-06-13  Jody Goldberg <jody@gnome.org>

	* configure.in : bump req for libgsf to 1.10.0 (still in cvs)

2004-06-11  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wbv_save_to_file): Make this work with uris.

	* src/history.c (history_item_label): Now gets uri argument.

	* src/workbook.c (workbook_set_uri): Ranamed from
	workbook_set_filename.
	(workbook_get_uri): Renamed from workbook_get_filename.

	* src/application.c (gnm_app_history_add): Change to take uri.
	All callers changed.

	* src/wbc-gtk.c (wbc_gtk_reload_recent_file_menu): Adapt to uris.

	* src/gui-file.c (gui_file_read, do_save_as, go_file_is_writable):
	Changed to take uri.  All callers changed.

	* src/workbook-view.c (wb_view_new_from_uri): Renamed from
	wb_view_new_from_file and adapted to take uri.  All callers
	changed.
	(wb_view_save_as): Change to take uri.  All callers changed.

2004-06-08  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=143577
	* src/style-border.c (style_border_print_diag) : handle NULL and none
	(style_border_set_pc) : back out my incorrect fix and sync with gui.

2004-06-08  Morten Welinder  <terra@gnome.org>

	* src/gutils.c (gnm_destroy_password): New function.

2004-06-05  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-image.c : add sax export, and actually dump the
	  images.
	* src/sheet-object-widget.c : add sax export
	* src/sheet-object-graph.c : ditto.
	* src/sheet-object-cell-comment.c : ditto.

	* src/workbook-view.c (wbv_save_to_file) : warning suppression

	* src/xml-io.c (gnm_xml_out_add_color) : new
	(gnm_xml_out_add_cellpos) : new.

2004-06-04  Morten Welinder  <terra@gnome.org>

	* src/parser.y (arg_list): handle the empty arg in =IF(TRUE,)
	properly.

	* src/expr.c (gnm_expr_get_func_argcount): New function.

2004-05-31  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_get_sheet) : new.
	(gnm_go_data_get_expr) : new.

	http://bugzilla.gnome.org/show_bug.cgi?id=143367
	* src/item-grid.c (item_grid_realize) : make the seperator a dark
	  colour rather than black.

2004-05-27  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_sheet_hide_controls) : split out from.
	(workbook_sheet_detach) : here.

	* src/dependent.c (dependent_queue_recalc_list) : fix dynamic depends.

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received) : handle
	  dragging from nautilus -> gnumeric too.

	* src/main-application.c (main) : Use the new virtuals

	* src/io-context.c (gnm_io_context_set_num_files) : new
	(gnm_io_context_processing_file) : new.

	* src/io-context-gtk.c (icg_processing_file) : renamed from
	  icg_inc_files_done.
	(icg_set_num_files) : renamed from icg_set_files_total.
	(icg_class_init) : hook up the file handlers to the new virtual.

	* src/expr.c (gnm_expr_extract_ref) : return a RangeRef
	(gnm_expr_range_op) : new to handle intersection and union properly
	(gnm_expr_eval) : split the common code out of here.

2004-05-26  Morten Welinder  <terra@gnome.org>

	* src/parser.y (yylex): Ignore spaces in lots of places, notably
	before and after operators.  (XL has chosen space as an operator,
	but luckily it only makes sense in a few places.)

2004-05-26  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* src/sheet-object-widget.c: (sheet_widget_combo_create_widget):
	replaced GnmComboText by GoComboText.

2004-05-25  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/application.c: add "Gnumeric_Visible" icon
	* src/pixmaps/visible.png: new
	* src/pixmaps/Makefile.am: include src/pixmaps/visible.png
	* src/commands.h (cmd_reorganize_sheets): add arguments
	* src/commands.c: add NULL arguments to all calls to
	  cmd_reorganize_sheets throughout.
	(cmd_reorganize_sheets_*): handle visibility changes
	* src/sheet.h (sheet_set_visibility): new
	(sheet): add is_visible field
	* src/sheet.c (sheet_set_visibility): new
	(sheet_new): initalize is_visible field
	* src/workbook-control-gui.c: add NULL arguments to all calls to
	  cmd_reorganize_sheets
	* src/workbook.h (workbook_sheet_change_visibility): new
	* src/workbook.c (workbook_sheet_change_visibility): new

2004-05-24  Morten Welinder  <terra@gnome.org>

	* src/expr.c (negate_value): New function, extracted from
	gnm_expr_eval and cb_iter_unary_neg.
	(gnm_expr_eval, cb_iter_unary_neg): Use it.
	(cb_iter_unary_neg, cb_iter_percentage): Fix crash for empties.

2004-05-22  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* src/expr.c: (cb_iter_unary_neg), (cb_iter_percentage): make it compile again by changing
	variable names "a" and "pos" by "v" and "ep".
	* src/gui-util.c: (gnumeric_notice_nonmodal), (cb_parent_mapped),
	(gnumeric_combo_enters): replaced gtk_signal by g_signal and deleted
	gnumeric_combo_enters as it is not used anymore and I could not find a replacement
	for gtk_combo_disable_activate usable with GtkComboBoxEntry.
	* src/gui-util.h: removed gnumeric_combo_enters.

2004-05-21  Jody Goldberg <jody@gnome.org>

	* src/expr.c : support implicit iteration for operators.  We now
	  support all major evaluation mechanisms in ms excel.

2004-05-19  Jody Goldberg <jody@gnome.org>

	* configure.in : bump libglade req to 2.3.6 to get the new combos
	  Merge in an as yet unused test for mono while we're in here.

2004-05-11  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=142836
	* src/stf.c (stf_write_csv): use current sheet rather than first
	  sheet.

2004-05-17  Morten Welinder  <terra@gnome.org>

	* src/sheet-autofill.c (autofill_cell): Handle default case, just
	in case.

2004-05-16  Adrian Custer <acuster@gnome.org>

	* src/ssconvert.c: exports -> exporters in user visible
	strings. Added translation tags.

2004-05-15  Jody Goldberg <jody@gnome.org>

	* src/format.c (format_value_gstring) : if nothing matches for numbers
	  use the first fmt, other types == general.
	(style_format_condition) : errors do not match strings, but bools do
	(format_compile) : assign std conditions to any element without one,
	  even the last.

2004-05-16  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* src/dialogs/autofilter-expression.glade: replaced GtkOptionMenu by GtkComboBox.
	* src/dialogs/autofilter-top10.glade: ditto.
	* src/dialogs/autoformat.glade: ditto.
	* src/dialogs/cell-format.glade: ditto.
	* src/dialogs/consolidate.glade: ditto.
	* src/dialogs/dao.glade: ditto.
	* src/dialogs/dialog-autofilter.c: (map_op), (cb_autofilter_ok),
	(cb_top10_type_changed), (init_operator), (dialog_auto_filter):
	* src/dialogs/dialog-autoformat.c: (cb_category_changed),
	(dialog_autoformat): ditto.
	* src/dialogs/dialog-cell-format.c: (cb_rotate_canvas_realize),
	(validation_rebuild_validation),
	(cb_validation_error_action_changed), (cb_validation_sensitivity),
	(build_validation_error_combo), (fmt_dialog_init_validation_page),
	(cb_fmt_dialog_dialog_buttons): ditto.
	* src/dialogs/dialog-consolidate.c: (construct_consolidate),
	(setup_widgets): ditto.
	* src/dialogs/dialog-hyperlink.c: (dhl_cb_menu_changed),
	(dhl_init): ditto.
	* src/dialogs/dialog-printer-setup.c: (do_header_customize),
	(do_footer_customize), (header_changed), (footer_changed),
	(fill_hf), (do_setup_hf_menus), (do_setup_hf),
	(print_setup_get_sheet), (do_setup_sheet_selector): ditto.
	* src/dialogs/dialog-stf-format-page.c:
	(format_page_trim_menu_changed), (stf_dialog_format_page_prepare),
	(stf_dialog_format_page_init): ditto.
	* src/dialogs/dialog-stf.glade: ditto.
	* src/dialogs/hyperlink.glade: ditto.
	* src/dialogs/print.glade: ditto.
	* src/widgets/gnm-dao.c: (gnm_dao_init), (gnm_dao_get_data),
	(gnm_dao_set_put): ditto.
	* src/dialogs/dialog-stf-export.c:
	(sheet_page_separator_menu_changed),
	(stf_export_dialog_format_page_init), (stf_export_dialog_finish): ditto.
		Replaced also GtkCombo by GtkComboBoxEntry.
	* src/dialogs/dialog-stf-export.glade: ditto.

2004-05-11  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/workbook-view.c (wbv_save_to_file): add omitted declaration

2004-05-07  Jody Goldberg <jody@gnome.org>

	* src/command-context-priv.h : Make this an interface
	* src/command-context.c : support the change here.
	* src/command-context-stderr.c : here.
	* src/io-context-gtk.c : here
	* src/io-context-priv.h : here
	* src/io-context.c : here.
	* src/workbook-control-gui.c : here
	* src/workbook-control.c : and here

	* src/GNOME_Gnumeric-gtk.xml : Move the toolbars out, they will be
	  generated.  Add FullScreen.

	* configure.in : bump libgsf dep and add the new goffice/app directory

2004-05-03  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=140671
	* src/commands.c (cmd_paste_cut_undo) : we don't know the SheetView
	  associated with the origin sheet.

	* src/selection.c (sv_selection_set) : add some safety

2004-05-04  Morten Welinder  <terra@gnome.org>

	* src/validation.c (validation_new): Make sure
	VALIDATION_TYPE_CUSTOM is only paired with VALIDATION_OP_NONE.
	(validation_eval): Balance recounting.

2004-04-27  Jody Goldberg <jody@gnome.org>

	* src/file.c (go_file_open) : fix the gnome-vfs case

2004-04-22  Morten Welinder  <terra@gnome.org>

	* src/print-info.c (print_info_get_orientation): Plug leak.

2004-04-22  Jody Goldberg <jody@gnome.org>

	* src/sheet-autofill.c (autofill_cell) : Assign the value format in
	  all cases accept expressions.  Use cell_set_value, not
	  sheet_cell_set_value so that we can assign the format before we
	  render, and to avoid doing things piece meal.

2004-04-21  Morten Welinder  <terra@gnome.org>

	* src/format.c (format_destroy): Let's try unref in here.

	* src/stf-export.c (stf_export): Fix compilation.

2004-04-20  Jody Goldberg <jody@gnome.org>

	* src/stf-export.c (stf_export_sheet) : simplify

2004-04-20  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_sheet): Handle the case of more
	columns than we have room for in the sheet.

2004-04-19  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* README: Corrected the Debian package names.

2004-04-19  Jody Goldberg <jody@gnome.org>

	* src/workbook-edit.c (cb_entry_insert_text) : be clear which values
	  are measured in bytes (PangoAttribute) and which are in characters
	  (GtkEditable)
	(cb_entry_cursor_pos) : ditto.
	(cb_entry_delete_text) : ditto.
	(wbcg_edit_add_markup) : ditto.

2004-04-19  Jody Goldberg <jody@gnome.org>

	* src/rendered-value.c (rendered_value_new) : don't apply markup to
	  the shared set of attributes associated with the style make a local
	  copy.

2004-04-17  Jody Goldberg <jody@gnome.org>

	* src/item-edit.c (item_edit_draw) : tidy up a bit and check for pixel
	  matching stock cell drawing so that things do not shift.
	(ie_layout) : ditto.

	* src/value.c (parse_database_criteria) : revert change from 2004-03-31
	  rather than moving to g_new/g_free to make the g_free work, leave
	  the g_alloca and remove the unnecessary g_free.

2004-04-16  Morten Welinder  <terra@gnome.org>

	* src/rangefunc.c (range_mode): Use g_hash_table_new_full.
	(cb_range_mode): Delete.

2004-04-15  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (phyper): New implementation.

2004-04-13  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_set_action_label): Set the right tooltip.

2004-04-12  Jody Goldberg <jody@gnome.org>

	* src/format.c (style_format_new_markup) : new.

	* src/commands.c (cmd_set_text*) : Handle markup

2004-04-12  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pow1p, pow1pm1): New functions.
	(random_levy_skew): Use pow1p.

2004-04-12  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pf): New implementation.

	* src/history.c (history_item_label): Handle accel_number >= 10
	better.  Handle "_" properly.

2004-04-09  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (pcauchy): New implementation.

	* src/gutils.c (erfgnum): Improve precision for small x.
	(modfgnum): Fix precision for huge x.
	(frexpgnum): Fix precision for huge x.

	* src/mathfunc.c (pbeta): New implementation.
	(lgamma1p, swap_log_tail, log1pmx): New function.

2004-04-08  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (check_underlines): Make UTF-8 safe.

2004-04-08  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* src/selection.c: (sv_selection_to_plot): skip errors dims.

2004-04-08  Jody Goldberg <jody@gnome.org>

	* src/gnumeric-gconf.c (gnm_conf_init_essential) : move the live
	  scroll delay and the autocompletion status here from.
	(gnm_conf_init_extras) : here.  So that we initialize it before we
	  copy it when creating aworkbookview.

2004-04-07  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_read): Make sure new windows appear
	on the right screen.
	* src/wbcg-actions.c (cb_file_new): Make sure new windows appear
	on the right screen.

2004-04-07  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c (cb_file_new): Copy toolbar visibility to new
	window.
	* src/gui-file.c (gui_file_read): Copy toolbar visibility to new
	window.

	* src/wbc-gtk.c (wbc_gtk_create_status_area): Show statusbar.
	(check_underlines): New code to debug underline collisions.
	(wbc_gtk_init): Show everything here.

	* src/workbook-control-gui.c (wbcg_set_toolbar_visible): Update
	menus too.
	(wbcg_copy_toolbar_visibility): New function.
	(show_gui): Call gtk_widget_show, not gtk_widget_show_all, so as
	not to interfere with toolbar visibility.

	* src/wbcg-actions.c (cb_view_standard_toolbar,
	cb_view_format_toolbar, cb_view_object_toolbar,
	cb_view_statusbar): Only do something when we're not already
	updating the ui.
	(var actions): Fix underline collissions.

2004-04-07  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: substitute WARN_CFLAGS as
	src/cut-n-paste-code/foocanvas/libfoocanvas/Makefile references it
	directly.

2004-04-05  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (cb_add_menus_toolbars): Identify toolbars.
	(cb_handlebox_popup): Remove this.
	(cb_handlebox_dock_status): Fiddle with style to work around
	gtk_handle_box bug.
	* src/workbook-control-gui.c (wbcg_set_standard_toolbar_visible,
	wbcg_set_format_toolbar_visible, wbcg_set_object_toolbar_visible,
	wbcg_set_statusbar_visible): New functions.

	* src/wbcg-actions.c (cb_view_standard_toolbar,
	cb_view_format_toolbar, cb_view_object_toolbar,
	cb_view_statusbar): New functions.
	(var toggle_actions): Hook them up.

2004-04-02  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_open): Use savers' extensions as a
	proxy for all spreadsheet files.  this is not ideal, but far
	better than hardcoding "*.gnumeric" and "*.xls".
	(gui_file_save_as): Ditto.

	* src/wbc-gtk.c (wbc_gtk_finalize): New function.
	(wbc_gtk_class_init): Hook it up.

2004-04-01  Jody Goldberg <jody@gnome.org>

	* src/style-border.c (style_border_draw_diag) : sync with the printing
	  code to not draw into the center of bordering double borders

	* src/item-edit.c (item_edit_event) : basic cursor position support.

	* src/print-cell.c (print_cell_background) : draw diagonals.
	* src/style-border.c (style_border_print_diag) : fill in.  Where did
	  this code go ?  I could have sworn I implemented this years ago.

2004-04-01  Morten Welinder  <terra@gnome.org>

	* src/format.c (append_hour_elapsed): Fix precision issues.
	http://bugzilla.gnome.org/show_bug.cgi?id=138182.

2004-04-01  Christian Neumair  <chris@gnome-de.org>

	* src/sheet-control-gui.c:
	* src/wbcg-actions.c:
	* src/GNOME_Gnumeric-gtk.xml: Put delete actions from edit main menu
	into their own submenu, add stock icon to clear submenu.

2004-03-31  Morten Welinder  <terra@gnome.org>

	* src/value.c (parse_database_criteria): Since we're g_free-ing,
	allocate with g_new and not g_alloca.

	* src/gui-file.c (gui_file_save_as): Don't create an extra, bogus
	combo box.

2004-03-30  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2004-03-30  Jody Goldberg <jody@gnome.org>

	* Release 1.3.0

	* Makefile.am : Add distcleancheck_listfiles, and distuninstallcheck_listfiles
	  to keep automake from complaining about the docs.
	  Clean the .desktop and .keys file
	  Dist the new gnome-common auto installed xmldoc.make and omf.make

	* autogen.sh : require automake 1.7.2 to get the *_listfiles support
	  required to make the doc build pass distcheck.

	* omf-install/* : delete

	* configure.in : remove omf-install, plugins/gb/Makefile,
	  plugins/uihello/Makefile

	* schemas/Makefile.am : clean the generated schema files

	* src/cell-draw.c (cell_calc_layout) : mark hashed values as variable
	  width so that they resize when columns change size.

	* src/item-grid.c (item_grid_event) : clear the cursor timer when the
	  mouse leaves the grid (eg enters the edit item)

2004-03-30  Jody Goldberg <jody@gnome.org>

	Test case.  Enter string into C3 that spans into E3 then change
	alignment
	* src/commands.c (cmd_format_undo) : be lazy, queue a full redraw in
	  case spans changed.
	(cmd_format_redo) : ditto.

2004-03-28  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c : cheat and install a SheetInsert action to avoid
	  having an 'Insert' entry in the insert menu because we named the
	  InsertSheet action for the Sheet menu.

	* src/item-edit.c (ie_layout) : Support rich text.

	* src/wbc-gtk.c (wbc_gtk_style_feedback) : Pull the values from
	  @changes if it is supplied.
	(cb_post_activate) : new.
	(wbc_gtk_init) :  Only restore focus when we aren't editing.
	  Otherwise every time the style feedback changes we lose focus.

2004-03-26  Jody Goldberg <jody@gnome.org>

	* src/workbook-edit.c (cb_delete_filter) : first step in syncing the
	  markup when content changes.
	(cb_entry_delete_text) : ditto.

2004-03-25  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_help_docs) : quick an dirty

2004-03-26  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_reload_recent_file_menu): Make UTF-8 safe
	and stop using tooltips for storing filenames.

	* src/history.c (history_item_label): Make this UTF-8 safe.

2004-03-25  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=137818
	* src/style.c (required_updates_for_style) : redraw for h-align,
	  striketrough, underline, and font colour changes.

	* src/application.c (gnumeric_application_setup_icons) : pull in some
	  icons

2004-03-20  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c : Move the font actions into a distinct group.

	* src/wbc-gtk.c (wbc_gtk_actions_sensitive) : start to account for
	  font vs normal actions.  This interface sucks.  We'll need something
	  more functional as the number of action groups increases (eg clipboard)
	(wbc_gtk_init_color_fore) : move into font group
	(wbc_gtk_init_font_name) : move into font group
	(wbc_gtk_init_font_size) : move into font group
	(wbc_gtk_set_toggle_action_state) : split font actions into a distinct
	  group
	(cb_handlebox_dock_status) : ditto.
	(wbc_gtk_init) : ditto.

2004-03-19  Morten Welinder  <terra@gnome.org>

	* src/plugin-util.c (gnumeric_fopen): Ditto.
	* src/format-template.c (format_template_save): Delete unused
	function.

2004-03-18  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-canvas.c (row_scroll_step): Use a continious
	function, not a step function.
	(col_scroll_step): Ditto.

2004-03-18  Guntupalli Karunakar  <karunakar@freedomink.org>

	* configure.in: Added "mr" for Marathi to ALL_LINGUAS.

2004-03-17  Morten Welinder  <terra@gnome.org>

	* src/gutils.c (gnm_string_append_gstring): New function.

	* src/format.c (format_get_decimal, format_get_thousand,
	format_get_currency): Return a GString*.  All callers changed and
	happy since they don't need to call strlen.
	(convert1): Operate of GString.

2004-03-17  Christopher James Lahey  <clahey@ximian.com>

	* configure.in: Added
	src/cut-n-paste-code/goffice/libpresent/Makefile and
	src/cut-n-paste-code/goffice/test/Makefile.

2004-03-16  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=137357
	* src/item-bar.c : Use a custom detail 'GnmItemBarCell' rather than
	  the more generic 'button' to keep some themes 'industrial and gorilla'
	  from freaking out at the lack of button.

2004-03-16  Jody Goldberg <jody@gnome.org>

	* configure.in : bump the gtk req to reflect the churn in the filesel

2004-03-16  Morten Welinder  <terra@gnome.org>

	* src/sheet-autofill.c (autofill_cell): Kill some read-only
	warnings.

2004-03-16  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* configure.in: add src/cut-n-paste-code/goffice/data/Makefile.in

2004-03-11  Jody Goldberg <jody@gnome.org>

	* src/stf.c (csv_tsv_probe) : Be more forgiving about what might be
	text.  Accept
	    1) *.txt
	    2) Anything that has no null characters in the first 80 bytes
	It won't catch everything, but it should be marginally better.

2004-03-08  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init) : split the menus into a distinct
	  group.  There's no need to senstize them

2004-03-12  Jean Brefort  <jean.brefort@ac-dijon.fr>

	* src/graph.c (gnm_go_data_vector_load_values): changed initial maximum
	from G_MINDOUBLE to - G_MAXDOUBLE.

2004-03-13  Christopher James Lahey  <clahey@ximian.com>

	* configure.in: Added
	src/cut-n-paste-code/goffice/drawing/Makefile and
	src/cut-n-paste-code/goffice/ms-compat/Makefile.

2004-03-11  Kjartan Maraas  <kmaraas@gnome.org>

	* src/wbc-bonobo.c: (wbcb_style_feedback): Remove extraenous
	semicolon from a test.
	* src/wbc-gtk.c: (wbc_gtk_style_feedback): Same here. Closes
	bug #136849.

2004-03-09  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_close_if_user_permits): Set the
	ATK_ROLE_ALERT for dialog.

	* src/item-bar.c (ib_draw_cell, item_bar_draw): Avoid deprecated
	gtk_draw_shadow call.

2004-03-06  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-graphic.c (sheet_object_text_finalize) : release
	  the markup.
	(sheet_object_text_new_view) : set the attributes.
	(sheet_object_text_clone) : handle the attributes.
	(gnm_so_text_set_font_color) : delete.
	(gnm_so_text_set_markup) : new.

2004-03-05  Jody Goldberg <jody@gnome.org>

	* src/colrow.c (colrow_set_sizes) : force re-render of variable width cells
	(colrow_restore_state_group) : ditto

	* src/rendered-value.c (rendered_value_render) : privatize

	* src/style.c (required_updates_for_style) : Now that rendered values
	  contain size info too we can dispense with the distinction between
	  rendering and sizing.  Without this changing the font size would not
	  resize because the rendered value cached the size and was not
	  re-rendered until draw, rather than at row-height calc.

2004-03-05  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_save_as): We no longer need to show
	extra-widgets in the file chooser outselves.

2004-03-05  Christian Neumair  <chris@gnome-de.org>

	* src/gui-file.c: free from deprecated GtkOptionMenu, use
	  GtkComboBox instead.

2004-03-04  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c : rework the List and combo to use a
	  shared base.  Then store and restore the dependents in xml

	http://bugzilla.gnome.org/show_bug.cgi?id=135946
	* src/formats.c : Add mmmmm-yy and mmmmm as defaults
	* src/format.c (append_month) : support them.

	* src/main-application.c (gnumeric_arg_parse) : When we don't need a
	  gui we still need to initialize gobject.

2004-03-01  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_image_file_select): Adapt to latest gtk+ cvs
	head.

2004-02-29  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=126563
	* src/sheet.c (sheet_dup) :

2004-02-28  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=74205
	* src/item-edit.c : Display blue range designator even in other panes

2004-02-27  Morten Welinder  <terra@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=135609
	* src/parse-util.c (rangeref_as_string): Before dropping the
	second half of the range, make sure the $-designations agree also.

2004-02-26  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (fsel_key_event, fsel_delete_event,
	fsel_handle_cancel, fsel_handle_ok, fsel_dialog_finish): Delete.
	(gnumeric_dialog_file_selection): Remove GtkFileSelector version.

2004-02-25  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (update_preview_cb): Keep the preview, possibly
	blank, at all times to avoid flicker.

2004-02-23  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_image_file_select): New arg "is_save" for
	button and dialog naming.  All callers changed.

	* src/sheet-object-graph.c (cb_save_as): Use
	gui_image_file_select.  Plug leak.

2004-02-22  J.H.M. Dassen (Ray) <jdassen@debian.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=135044
	* src/commands.c (cmd_resize_colrow): Fixed incorrect string

2004-02-21  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=134627
	* src/workbook-view.c (wb_view_selection_desc) : Display name of edit
	  position after releasing Shift key, not the top left

	* src/workbook-control-gui.c (cb_wbcg_drag_data_received) : disable
	  the gnome-vfs portions.  They did not work anyway.  We can probably
	  just #ifdef it in the future, I can't see an easy way to put that into
	  a plugin.

	* src/wbc-gtk.c (cb_font_name_changed) : quick and dirty enabling.
	(cb_font_size_changed) : ditto.

	* src/stf.c (stf_write_workbook) : remove the pointless wrapping of a
	  pointer and just return the result directly.

	http://bugzilla.gnome.org/show_bug.cgi?id=97216
	* src/sheet-control-gui.c (scg_mode_create_object) : Go back to the
	  primary sheet when creating an object

	http://bugzilla.gnome.org/show_bug.cgi?id=131588
	* src/rangefunc.c (range_sum) : use long double if it is available

	* src/mstyle.c (mstyle_new_default) : remove the gconf usage it did
	  not belong here.
	* src/style.c (font_init) : ditto.

	* src/normal-args.c : deleted. content moved

	* src/main-application.c : Move the arg handling into here, and #ifdef
	  it rather than using external files.  It makes it easier to read.
	  For the non gnome case we need to manually add gtk deps.  Now that
	  we're not so dependent on gnome we can do more magic and move to a
	  more abi-style approach with --convert and abi-commands in place of
	  ssconvert

	* src/libgnumeric.h : drop the arg handler stubs

	* src/libgnumeric.c (gnm_shutdown) : gconf shutdown is handled
	  internally now.

	* src/hlink.c (gnm_hlink_url_activate) : conditionalize gnome depend.

	* src/gutils.c (gnumeric_sys_data_dir) : Use g_build_path, just to be
	  pedantic.
	(gnumeric_sys_lib_dir) : ditto.

	* src/gui-util.c (gnumeric_dialog_run) : Don't destroy the dialog
	  until a stock response comes in (useful for druids)
	(gnumeric_help_display) : conditionalize gnome.
	(gnumeric_icondir) : new.
	(gnumeric_load_image) : use it.
	(gnumeric_load_pixbuf) : use it.

	* src/gnumeric-gconf.c (gnm_app_get_gconf_client) : moved to here.
	(gnm_conf_init_essential) : handle the font stuff here.

	* src/gnumeric-gconf-priv.h : Clean up the default font keys and move
	  them here.

	* src/application.c : remove the gconf_client
	(gnm_app_get_gconf_client) : move for now.
	(gnm_app_release_gconf_client) : delete.

	* src/Makefile.am : Further down the path of making gnome optional

	* icons/Makefile.am : Add the new about box image, dunno where/how to
	  use it yet.

	* configure.in : corba is dependent on gnome for now.
	  Move libgnome* into the gnome specific libs
	  Add the new radar plot engine

	* src/wbc-gtk.c (cb_show_menu_tip) : fix leak.

2004-02-20  Jon K Hellan  <hellan@acm.org>

	* src/gui-util.c: Don't include preview-file-selector.h.

	* src/workbook-control-gui.c: Ditto.

	* src/wbcg-actions.c: Ditto.

2004-02-19  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_image_file_select): Add new "initial"
	argument.  Caller changed.

2004-02-18  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_image_file_select): New function.

	* src/wbcg-actions.c (GNM_ACTION_DEF): Use gui_image_file_select.

	* src/gui-file.c (file_format_changed_cb): Use
	gtk_widget_set_sensitive.

	* src/gui-util.c (gnm_fixup_filechooser_size): Remove this.  No
	longer needed.

2004-02-17  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_open): Destroy file selector before
	calling opener.  (File selector grabs focus so stf-import could
	not be interacted with.)

	* src/print.c (compute_scale_fit_to): For 0 pages, just return
	100%.

2004-02-13  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (gnm_fixup_filechooser_size): New function.
	(gnumeric_dialog_dir_selection): Delete.

	* src/gui-file.c (gui_file_save_as, gui_file_open): Use
	gnm_fixup_filechooser_size.

2004-02-11  Morten Welinder  <terra@gnome.org>

	* src/print.c (compute_scale_fit_to): Guard against pages <= 0.
	Use doubles, not floats.
	(print_range_down_then_right, print_range_right_then_down,
	compute_group): Use doubles, not floats.

2004-02-09  Morten Welinder  <terra@gnome.org>

	* src/workbook-object-toolbar.c: Properly include
	<gnumeric-config.h> so the tests will work.

2004-02-04  Morten Welinder  <terra@gnome.org>

	* src/parser.y (yylex): Accept a few unicode characters.

2004-02-04  Jody Goldberg <jody@gnome.org>

	* src/sheet.c : Make Sheet a cheesy sort of GObject.  Leave the macros
	  as the old signature based variants for now.

2004-02-04  Jody Goldberg <jody@gnome.org>

	* src/gui-file.c (gui_file_open) : add a label and mnemonic for the
	  type selector.

2004-02-02  Jody Goldberg <jody@gnome.org>

	* src/session.c : make conditional on WITH_GNOME

2004-02-03  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c (toggle_current_font_attr): Remove debug
	spew.

2004-02-01  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (cb_custom_color_created) : mark the custom dialog as
	  a transient of the wbcg.

2004-02-01  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (wbcg_toolbar_timer_clear) : people
	  didn't like it so remove it to allow custom color selection to work.
	  With it in place the action was still insensitive when the
	  color_changed fired so the activation was ignored.

	* src/wbc-gtk.c (wbc_gtk_init) : connect the post_activate signal
	  as a swapped_object to avoid calling it after we use an accelerator
	  to quit.

2004-02-01  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gui-util.c (gu_delete_handler): new
	(gnumeric_dialog_file_selection): catch window manager deletion
	  of the dialog.

2004-01-28  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=131933
	* src/format.c (update_lc) : catch mismatched monetary and numeric
	  locales that set result in the decimal seperator and thousands
	  seperator being the same.

2004-01-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* schemas/gnumeric-dialogs.schemas.in: Add schemas corresponding to
	  the new printing keys.

2004-01-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf-priv.h: add many more printing related keys
	* src/gnumeric-gconf.c (gnm_conf_init_essential): initialize
	  printing variables from gconf
	(gnm_gconf_set_print_center_horizontally): implement
	(gnm_gconf_set_print_center_vertically): implement
	(gnm_gconf_set_print_grid_lines): implement
	(gnm_gconf_set_print_even_if_only_styles): implement
	(gnm_gconf_set_print_black_and_white): implement
	(gnm_gconf_set_print_titles): implement
	(gnm_gconf_set_print_order_right_then_down): implement
	(gnm_gconf_set_print_scale_percentage): implement
	(gnm_gconf_set_print_scale_percentage_value): implement
	(gnm_gconf_set_print_scale_width): implement
	(gnm_gconf_set_print_scale_height): implement
	(gnm_gconf_set_print_repeat_top): implement
	(gnm_gconf_set_print_repeat_left): implement
	(gnm_gconf_set_print_tb_margins): implement
	(gnm_gconf_set_print_header_formats): implement
	* src/print-info.c (load_formats): add saved custom formats

2004-01-28  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/gnumeric-gconf.c (gnm_conf_init_essential): initialize new
	  configuration variables
	(gnm_conf_init_extra): move some items to essential
	(gnm_gconf_set_print_center_horizontally): new stub
	(gnm_gconf_set_print_center_vertically): new stub
	(gnm_gconf_set_print_grid_lines): new stub
	(gnm_gconf_set_print_even_if_only_styles): new stub
	(gnm_gconf_set_print_black_and_white): new stub
	(gnm_gconf_set_print_titles): new stub
	(gnm_gconf_set_print_order_right_then_down): new stub
	(gnm_gconf_set_print_scale_percentage): new stub
	(gnm_gconf_set_print_scale_percentage_valuee): new stub
	(gnm_gconf_set_print_scale_width): new stub
	(gnm_gconf_set_print_scale_height): new stub
	(gnm_gconf_set_print_repeat_top): new stub
	(gnm_gconf_set_print_repeat_left): new stub
	(gnm_gconf_set_print_tb_margins): new stub
	(gnm_gconf_set_print_header_formats): new stub
	* src/gnumeric-gconf.h: various new functions (see above) and
	  fields to the pref structure.
	* src/print-info.c: remove dependence on libgnome/gnome-config.h
	(load_margin): deleted
	(load_hf): deleted
	(load_range): deleted
	(load_formats): remove gnome-config stuff
	(print_info_new): switch to gconf functions
	(save_margin): deleted
	(save_range): deleted
	(save_hf): deleted
	(save_formats): use gconf
	(print_info_save): use new gconf functions
	(print_info_set_orientation): new
	(print_info_get_orientation): new
	* src/print-info.h: remove orientation field in pi
	(print_info_set_orientation): new
	(print_info_get_orientation): new
	* src/xml-io.c (xml_write_print_info): use print_info_get_orientation
	(xml_read_print_info): use print_info_set_orientation

2004-01-27  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_save_as): Switch to file chooser.

2004-01-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/print.c (sheet_print): remove warnings

2004-01-27  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_open): Cleanup and hack a better size.

2004-01-26  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* configure.in: bump libgnomeprint[ui] requirement to 2.5.2
	* src/print.c (sheet_print): don't close the print dialog on preview
	  and use gnome_print_dialog_run to avoid overwriting files without
	  dialog

2004-01-26  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_open): Switch to file chooser.

	* src/gui-util.c (gnumeric_dialog_file_selection): Handle file
	chooser widgets too.

2004-01-26  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=132448
	* src/wbcg-actions.c (cb_auto_filter) : fix
	* src/selection.c (selection_first_range) : improve readability of
	  error message.

	http://bugzilla.gnome.org/show_bug.cgi?id=127138
	* src/wbcg-actions.c (cb_view_freeze_panes) : Don't get confused by an
	  attempt to freeze without centering when the top or left is not 0.

2004-01-24  Andreas J. Guelzow <aguelzow@taliesin.ca>

	* src/cell-draw.c (cell_calc_layout): new
	(cell_draw): move the pango layout code into cell_calc_layout

2004-01-24  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-graphic.c : defaults for color combos are now more
	  useful.  The actions can set them up for toolbars in one place
	  rather than users setting the combo in dozens.

2004-01-23  Jody Goldberg <jody@gnome.org>

	* src/workbook.c (workbook_find_command) : new utility

	* src/wbc-gtk.c (cb_undo_activated) : port to new interface
	(cb_redo_activated) : port to new interface

	* src/sheet-control-gui.c (scg_object_update_bbox) : silence
	  irritating warning.

2004-01-23  Jody Goldberg <jody@gnome.org>

	* configure.in : bump the gtk and glib depends to yesterday's releases

2004-01-22  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c : clean up the border combo and adapt to its new api

2004-01-16  Jody Goldberg <jody@gnome.org>

	* configure.in : check for symbolic link support
	* src/Makefile.am : install executable as
	    gnumeric-<version>
	  with a symlink to that from gnumeric

2004-01-16  Jody Goldberg <jody@gnome.org>

	* src/stf.c (stf_write_workbook) : update the string and drop the
	  warning.

	* src/wbc-gtk.c (wbc_gtk_init) : enable translations for menus and
	  toolbars.

2004-01-16  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c : Fix some accelerators and enable colour combos.
	  Some undo/redo is working too.

	* src/style-color.c (style_color_new_go) : new.

	* configure.in : Push the goffice include up here until it can get a
	  pkg file.

	* autogen.sh (REQUIRED_AUTOMAKE_VERSION) : bump automake version to
	  get stricter distchecks.

2004-01-14  Jody Goldberg <jody@gnome.org>

	* gnumeric.mime : prune this to just types gnome-mime-data does not
	  appear to have.

2004-01-15  Andreas J. Guelzow  <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=131343
	* src/print.c (print_job_info_update_from_config): new
	(print_job_info_get): move some code into
	  print_job_info_update_from_config
	(sheet_print): call print_job_info_update_from_config after the
	  user may have changed the paper info in the print dialog.

2004-01-14  Jon K Hellan  <hellan@acm.org>

	* README: Spellcheck

2004-01-14  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c : silence some warnings from the zoom combo.  It's not
	  functional yet so why spew errors.
	- Add status line display of menu tooltips
	- Fix accel for the display formula toggle

2004-01-13  Jody Goldberg <jody@gnome.org>

	* src/func.c (function_call_with_list) : fix the address tests by
	  allowing missing optional args to get passed as NULL.

2004-01-12  Morten Welinder  <terra@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml: remove menu entris for bold, etc.
	(Probably accidentally committed.)

2004-01-11  Jon K Hellan  <hellan@acm.org>

	* src/GNOME_Gnumeric-gtk.xml: Add accelerators for bold, italic
	and underline.

2004-01-10  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c : Display the progress bar
	  enable the sensitzation/desensitization of the actions.  NOTE :
	  requires a gtk patch that is not in cvs yet.
	  Set a tooltip for the border and colour combos, requires another gtk
	  patch that is not in cvs.

	* src/gnumeric-pane.c : Conditionally disable the stipple border for
	  now, but fix it to scale properly with zoom anyway.

	* src/Makefile.am (bonobo_component_ui_DATA) : install the GtkAtion ui
	  file for now.  We can cleanup later.  Display ssconvert too, that
	  needs to merge or move to a new dir.  It doubles link time.

2004-01-09  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c: Add invisible CopyDown and CopyRight
	actions.  Stubbed so far.
	Remove accelerator for double underline as it collided with
	single underline.

2004-01-08  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=130172
	* src/func.c (function_call_with_list) : A major change
	  Do not do the empty conversion to int(0) in expr_eval
	  ALLOW scalars to return empty/NULL, the convert them to empty for
	  most types, and int(0) for float/bool.  Which makes
	  'S' the same as 's' for all purposes accept documentation.

	* src/GNOME_Gnumeric-gtk.xml : No need to name items their action is
	  sufficient as long as they are unique in their parent.

	* src/cell.h (CELL_HAS_NEW_EXPR) : AARRRGGH.  Actually a sign a
	  _unique_ value to it.

	* src/gnumeric-pane.c (cb_control_point_event) : change the cursor
	  when dragging.  Only start dragging on button 1 down.  Ignore other
	  buttons while dragging.
	(cb_sheet_object_canvas_event) : ditto.

	* src/main-application.c (main) : set the app name.

2004-01-07  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=130700
	* src/format.c (format_entry_ctor) : init the new 'suppress_minus'
	  entry.
	(format_compile) : initialize supress minus if the condition is of the
	  form [<=(val <= 0)] or [<(val < 0)] I hope this is a reasonable
	  approximation of MS Excel.
	(render_number) : pull out all the old elements that added minus signs
	(format_number) : handle the new entry based suppress minus operator
	  here, and prepend the sign.

	* src/wbcg-actions.c : Sync labels and mnemonics with the old
	  bonobo/gnomeui menus

2004-01-06  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (cb_add_menus_toolbars) : Enable/Disable the arrow
	  contraction on the toolbars if the handlbox is docked/undocked.
	  This avoids having floating toolbars with nothing but the collapse
	  arrow.

	* configure.in : re-enable the *DEPRECATED*
	and add a pile of #undef/#warning to make sure things still work

2004-01-06  Jody Goldberg <jody@gnome.org>

	The initial pass at GtkAction custom combos are mucho broken
	* src/sheet.c (sheet_toggle_hide_zeros) : move this out of the macro
	  in wbcg.
	(sheet_toggle_show_formula) : ditto.

	* src/sheet-object-graph.c (cb_save_as) : add jpg, and translate the
	  error message now that string freeze is done.

	* src/gui-util.c : restore DISABLE_DEPRECATED
	(gnumeric_toolbar_insert_with_eventbox) : delete.
	(gnumeric_toolbar_append_with_eventbox) : delete.
	(gtk_button_stock_alignment_set) : delete.
	(gnumeric_toolbar_new) : delete.
	(gnumeric_inject_widget_into_bonoboui) : move the wbc-bonobo.c
	(gnumeric_toolbar_get_widget) : delete.
	(gnm_widget_disable_focus) : move here from workbook-format-toolbar.c

	* workbook-format-toolbar.{c,h} : move contents into
	* wbcg-actions.c : this new file
	* wbc-gtk.c : or this new file
	* wbc-bonobo.c : or this new file (WHICH DOES NOT COMPILE OR WORK)
	  Should probably merge into workbook-control-component or something
	  like that

	* src/gnm-marshalers.list (VOID) : Use the stock marshallers in glib
	  directly rather than adding our own wrappers.
	* src/application.c : here

	* src/GNOME_Gnumeric.xml : rename FileExit -> FileQuit to be consistent
	* src/GNOME_Gnumeric-gtk.xml : new file for GtkAction
	  NOTE NOTE NOTE
	  You must be running in gnumeric/src
	  I Repeat
	  YOU MUST BE RUNNING IN gnumeric/src
	  for anything to work right now.  I don't quite know how I want to
	  handle the file yet (the bonobo approach was irritating) we'll see.

	* configure.in :
	- Add goffice/gui-utils
	- Get rid of --with-bonobo
	- Add --with-gnome
	- Add --enable-bonobo-component
	* plugins/Makefile.am : Adapt to that.
	* src/Makefile.am : ditto, and add the new files.

2004-01-05  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=130424
	* src/commands.c (cmd_set_text_redo) : remove manual kludge.
	* src/dependent.h (cell_eval) : move from here
	* src/cell.h (cell_eval) : to here.  Add a new flag CELL_HAS_NEW_EXPR
	* src/cell.c (cell_set_expr_internal) : set the flag here.
	* src/rendered-value.c (rendered_value_new) : test it here.

	http://bugzilla.gnome.org/show_bug.cgi?id=130582
	* src/sheet-control-gui.c (scg_cursor_move) : don't scroll the other
	  panes unless we absolutely have to.  Apparently we only fuxed normal
	  cursor movement for http://bugzilla.gnome.org/show_bug.cgi?id=77303
	  This fixes rangesel too.

2003-12-29  Jody Goldberg <jody@gnome.org>

	* * : Move everything to glib/gi18n.h in place of gnumeric-i18n.h
	* gnumeric-i18n.h : delete

	* configure.in : Looks like we're really requiring gtk/glib 2.3.1 at a
	  minimum.  In reality it's probably closer to CVS at this point.  I'm
	  kinda looking forward to the gtk freeze.

2003-12-24  Morten Welinder  <terra@gnome.org>

	* src/io-context-gtk.c (cb_realize): Remove workaround for old
	gtk.
	* src/stf-parse.c (stf_parse_lines): Ditto.
	* src/workbook-control-gui.c (wbcg_get_gtk_settings): Ditto.
	(show_gui): Ditto.

	* src/gui-util.c (gdk_cursor_new_from_pixbuf): Remove.

2003-12-23  Jody Goldberg <jody@gnome.org>

	* configure.in : post BRANCH bump
	  require gtk/glib 2.3.0, that will probably go up shortly
	  as we depend more on head directly
