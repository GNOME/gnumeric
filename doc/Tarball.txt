This is a way to produce a gnumeric tarball for distribution using Debian
sid.

Create a working environment:
	pbuilder login --distribution woody
(we start with woody as things don't build with sid's versions of intltool
and gettext)

Copy the CVS tree into the working environment
	tar cf - gnumeric-cvs-gnome_1_4 | \
		(cd /var/cache/pbuilder/build/1234/tmp && sudo tar xvf - ) 

Inside the working environment:
Consistent ownership:
	chown -R 0.0 /tmp/gnumeric-cvs-gnome_1_4
Deal with the lack of a proper homedir:
	export HOME=/root
	export XAUTHORITY=/root/.Xauthority
Get the known working woody versions of relevant tools:
	apt-get -y install gettext intltool debhelper
	echo "gettext hold" | dpkg --set-selections
	echo "intltool hold" | dpkg --set-selections
Then upgrade to sid for everything else:
	cp /etc/apt/sources.list /tmp
	sed -e 's/woody/sid/g' < /tmp/sources.list > /etc/apt/sources.list
	apt-get update && apt-get -y dist-upgrade
Install the build dependencies listed in debian/control, except for sid's
debhelper (as it depends on po-debconf which depends on a newer gettext) and
gettext itself:
	apt-get -y install libtool bison flex docbook-utils
		gnome-doc-tools scrollkeeper libglib1.2-dev libgnome-dev
		libglade-gnome0-dev libgal-dev libgnomeprint-dev libxml-dev
		libole2-dev libbonobo-dev python2.2-dev libgda-dev
There are a few packages that are not build dependencies for a regular
Debian build of gnumeric, but that we do need in creating an upstream
tarball:
	apt-get -y install gnome-common automake1.7
Ensure we can build --with-evolution:
	apt-get -y install evolution

Generation of func.defs uses the gnumeric that's being built, and thus needs
X; it needs locales as well:
	apt-get -y install locales xvfb xbase-clients xfonts-base
Configure locales: set /etc/locale.gen to
		de_DE ISO-8859-1
		es_ES ISO-8859-1
		hu_HU ISO-8859-2
		ja_JP.EUC-JP EUC-JP
		ja_JP.UTF-8 UTF-8
		nl_NL ISO-8859-1
		no_NO ISO-8859-1
		pl_PL ISO-8859-2
		pt_PT ISO-8859-1
		ru_RU ISO-8859-5
		sk_SK ISO-8859-2
		sv_SE ISO-8859-1
and do
	locale-gen
Ensure Xvfb has a security policy file available to it:
	apt-get -y install xserver-common
And start the virtual framebuffer X server:
	Xvfb :99 &
	DISPLAY=:99 ; export DISPLAY
Now throw out the old automake; this needs to be done forcefully as woody's
intltool doesn't know about the Provides: automaken which sid's various
automake versions offer.
	dpkg --force-depends --purge automake1.4	
OK, now build the tarball:
	cd /tmp/gnumeric-cvs-gnome_1_4
	debian/rules && ./configure -v --with-bonobo --with-evolution
	make && make distcheck
