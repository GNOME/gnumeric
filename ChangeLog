2007-04-20  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_update_history): New function,
	extracted from workbook_dispose.
	(workbook_dispose): Don't update file history here.

	* src/gui-file.c (gui_file_read, gui_file_save_as, gui_file_save):
	Call workbook_update_history on success.

	* src/ssindex.c (ssindex): Avoid updating the recect-files list.

2007-04-18  Morten Welinder  <terra@gnome.org>

	* src/print-info.c (print_info_get_paper): Fix return types.

	* src/commands.c (cmd_rename_sheet): Send errors to the command
	context [==gui], not just stderr.

2007-04-16  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print.c (print_page): handle scaling
	(compute_n_pages): new
	(compute_scale_fit_to): rewrite to approximate best scaling factor
	(compute_sheet_pages_add_sheet): avoid warning
	(compute_sheet_pages_across_then_down): handle scaling

2007-04-15  Morten Welinder  <terra@gnome.org>

	* src/sort.c (gnm_sort_contents): Set locale around sorting, if
	needed.
	* src/wbcg-actions.c (sort_by_rows): Set NULL locale.
	* configure.in: revert previous change.

2007-04-15  Christophe Merlet  <redfox@redfoxcenter.org>

	* configure.in: Added "oc" (Occitan) to ALL_LINGUAS.

2007-04-12  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* schemas/gnumeric-dialogs.schemas.in: fix schema for gtk-setting

2007-04-10  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (advanced_clicked): Labels were flipped.  [#428225]

2007-04-07  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* src/wbcg-actions.c (cb_help_docs): Use 'ghelp' rather than 'help'
	  as the URI scheme when calling yelp. The 'ghelp' URI scheme is
	  implemented directly in yelp, whereas 'help' causes yelp to search
	  for a libvfs-help.so helper module which doesn't exist on my system
	  anymore.

2007-04-06  Pema Geyleg  <pema.geyleg@gmail.com>

	* configure.in: Added 'dz' to ALL_LINGUAS.

2007-04-05  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print.c (PrintingInstance): add fields
	(SheetPrintInfo): new struct
	(printing_instance_delete): handle new fields
	(compute_sheet_pages_add_sheet): new
	(compute_pages): only set up the list of sheets to paginate
	(gnm_paginate_cb): new callback
	(gnm_begin_print_cb): don't paginate here
	(gnm_print_sheet): hook up gnm_paginate_cb callback

2007-04-04  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/gnm-so-filled.c (gnm_so_filled_draw_cairo): initialize obj

2007-04-04  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/xml-sax-write.c (xml_write_print_info): free paper name string
	* src/print-info.c (print_info_get_paper): create importable name for 
	custom paper sizes.
	* src/print-info.h (print_info_get_paper): change return type
	
2007-04-04  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Bumped goffice dependency to reflect that goffice trunk
	is needed as building against goffice 0.3.7 now fails.

2007-04-03  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* schemas/gnumeric-dialogs.schemas.in: replace 
	/schemas/apps/gnumeric/printsetup/printer-config with
	/schemas/apps/gnumeric/printsetup/gtk-setting
	* src/sheet.c (gnm_sheet_init): add new argument to 
	print_info_new
	* src/gnumeric-gconf.c (gnm_conf_init_print_settings): add argument
	(gnm_gconf_init_printer_defaults): new
	(gnm_conf_init_extras): use gnm_gconf_init_printer_defaults
	(gnm_conf_init_essentials): move stuff to gnm_gconf_init_printer_defaults
	(gnm_gconf_set_page_setup): new
	(gnm_gconf_get_page_setup): new
	(gnm_gconf_get_print_settings): new
	(gnm_gconf_set_printer_config): deleted
	* src/gnumeric-gconf.h (gnm_gconf_init_printer_defaults): new
	(gnm_gconf_set_page_setup): new
	(gnm_gconf_get_page_setup): new
	* src/xml-sax-write.c (xml_write_print_info): use print_info_get_margins
	* src/gnumeric-gconf-priv.h (PRINTSETUP_GCONF_PRINTER_CONFIG): deleted
	* src/print.c (gnm_print_sheet): use gnm_gconf_[gs]et_print_settings
	* src/xml-io.c (xml_print_info_fix_margins): deleted
	(xml_read_print_margins): use print_info_set_margins
	* src/print-info.c (print_hf_free): It is now normal to be called with NULL.
	(print_info_free): drop unneeded items
	(print_info_dup): ditto
	(print_info_load_defaults): new
	(print_info_new): add argument and defer initialization
	(print_info_save): we may have to modify the pi by loading defaults
	(print_info_get_margins): use GtkPageSetup
	(print_info_set_margin_*): ditto
	(print_info_set_paper): ditto
	(print_info_set_margins): use gtk_page_setup_set_*
	(print_info_[sg]et_paper_width): deleted
	(print_info_[sg]et_paper_height): deleted
	(print_info_make_config): deleted
	(print_info_[gs]et_paper): use GtkPageSetup
	(print_info_set_paper_width_height): new stub
	(print_info_get_paper_width): new return type and use GtkPageSetup
	(print_info_get_paper_height): ditto
	* src/print-info.h (PrintMargins): move items to GtkPageSetup
	(_PrintInformation): drop unneeded items
	(print_info_new): add argument
	(print_info_load_defaults): new
	(print_info_make_config): deleted
	(print_info_load_config): deleted
	(print_info_get_paper_width): deleted
	(print_info_get_paper_height): deleted
	(print_info_set_paper_width_height): new
	(print_info_get_paper_width): change return type
	(print_info_get_paper_height): change return type
	

2007-04-02  Morten Welinder  <terra@gnome.org>

	* src/search.c (gnm_search_replace_cell): Normalize strings before
	matching.
	(gnm_search_replace_value): Ditto.
	(gnm_search_replace_comment): Ditto.

2007-04-01  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/gnumeric-gconf.c (gnm_gconf_set_print_settings): new
	(gnm_conf_init_print_settings): new
	(gnm_gconf_set_print_settings_cb): new
	(gnm_conf_init_extras): call gnm_conf_init_print_settings
	* src/gnumeric-gconf.h (gnm_gconf_set_print_settings): new
	(gnm_app_prefs): add print_settings field
	* src/gnumeric-gconf-priv.h (PRINTSETUP_GCONF_GTKSETTING):
	new key 
	* src/print.c (gnm_print_sheet): save/restore printsettings

2007-03-29  Pema Geyleg <pema.geyleg@gmail.com>

	* configure.in: Added 'dz' to ALL_LINGUAS

2007-03-29  Jody Goldberg <jody@gnome.org>

	* src/sheet-style.c (sheet_style_set_col) : new.  placeholder to
	  simplify future extensions when cols/rows have styles.
	(sheet_style_set_row) : ditto.
	(sheet_style_apply_col) : ditto.
	(sheet_style_apply_row) : ditto.
	(sheet_style_apply_pos) : new convenience.

	* src/ranges.c (range_init_cols) : new.
	(range_init_rows) : new.

2007-03-29  Jody Goldberg <jody@gnome.org>

	* component/gnumeric.c (go_gnm_component_class_init) : the print
	  method is now gone.

2007-03-29  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (set_money_format): New function to select an
	appropriate money format for a given number.  Fixes rest of
	#423603.

2007-03-29  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* delete the "print" field from all sheet objects. We
	are now using the draw_cairo method
	* src/print-cell.c (gnm_print_make_rect_path): delete
	(print_cell): delete
	(print_rectangle): delete
	(print_cell_background): delete
	(print_merged_range): delete
	(gnm_print_cell_range): delete
	* src/sheet-object.c (sheet_object_print): delete
	* src/print-cell.h (gnm_print_make_rect_path): delete
	(gnm_print_cell_range): delete
	* src/sheet-object.h (sheet_object_print): delete
	* src/sheet-object-cell-comment.c (cell_comment_print): delete
	* src/dialogs/dialog-printer-setup.c: comment out all currently 
	  unused functions
	(PrinterSetupStateNew): rename to PrinterSetupState
	(printer_setup_state_new_new): rename to printer_setup_state_new
	* src/dialogs/dialogs.h (dialog_printer_setup): does not depend on 
	gnomeprint
	* src/dialogs/Makefile.am: remove libgnomeprint condition
	* src/style-font.h: remove libgnomeprint include
	* src/xml-sax-read.c: comment out gnomeprint dependency
	* src/xml-sax-write.c: ditto
	* src/xml-io.c: ditto
	* src/gnumeric-gconf.c (gnm_conf_init_extras): remove libgnomeprint 
	dependency
	* src/sheet-object-graph.c (gnm_sog_print): delete
	* src/pattern.c (gnumeric_background_set_pc): delete
	* src/pattern.h (gnumeric_background_set_pc): delete
	* src/gnm-so-line.c (gnm_so_line_print): delete
	* src/Makefile.am: remove libgnomeprint condition
	* src/sheet-filter.c: remove "print" field
	* src/validation.c: ditto
	* src/sheet-object-image.c (gnm_soi_print): delete
	* src/gnm-so-filled.c (make_rect): delete
	(make_ellipse): delete
	(gnm_so_filled_print): delete
	(set_color): delete
	* src/style-border.c (style_border_set_pc_dash): delete
	(style_border_set_pc): delete
	(print_hline): delete
	(print_vline): delete
	(gnm_style_borders_row_print): delete
	(gnm_style_border_print_diag): delete
	* src/style-border.h (style_border_set_pc_dash): delete
	(style_border_set_pc): delete
	(gnm_style_borders_row_print): delete
	(gnm_style_border_print_diag): delete
	* src/wbcg-actions.c: enable print commands
	* src/print-info.c: comment out libgnomeprint dependencies
	* src/print-info.h: ditto
	* src/wbc-gtk.c: remove print menu disabling
	* src/sheet-object-impl.h:  remove "print" field
	* src/gnm-so-polygon.c (gnm_so_polygon_print): delete
	* plugins/excel/ms-excel-read.c: comment out gnomeprint dependency
	* configure.in: remove libgnomeprint tests
	* component/gnumeric.c: comment out gnomeprint dependency

2007-03-29  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print.c: uncomment (#if 0 ... #endif)
	  currently unused code and gemove gnomeprint includes
	(sheet_print_selection): deleted
	(PrintingInstance): change wbcg to wbc
	(compute_sheet_pages): adjust for wbcg -> wbc change
	(gnm_print_sheet): ditto

2007-03-28  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print.c (PrintingInstance): add wbcg
	(compute_sheet_pages): handle selection & printarea
	(gnm_begin_print_cb): ditto
	(print_sheet): deleted
	* src/sheet.h (sheet_get_printarea): add arguments
	* src/sheet.c (sheet_get_printarea): add arguments and ignore 
	  printarea if requested

2007-03-28  Jean Brefort  <jean.brefort@normalesup.org>

	* src/Makefile.am: removed regression.c
	* src/func-builtin.c: use new names for range functions.
	* src/rangefunc.c: changed names of functions, and use the versions in
	goffice when available.
	* src/rangefunc.h: ditto.
	* src/regression.h: ditto.
	* src/regression.c: removed obsolete.

2007-03-27  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print.h: add keys
	(PrintRange): add further options
	* src/print.c (PrintingInstance): add more fields
	(compute_sheet_pages): add selection and ignore_printarea args & 
	  clean up
	(compute_pages): handle various print ranges
	(PrintDialogState): deleted
	(dialog_destroy): deleted
	(sheet_print_real): deleted
	(dialog_response): deleted
	(gnm_begin_print_cb): discover print range
	(widget_button_cb): new
	(gnm_create_widget_cb): new signal handler
	(gnm_custom_widget_apply_cb): new signal handler
	(gnm_print_sheet): prepare custom widget to handle print ranges

2007-03-26  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/sheet-object.h (sheet_object_draw_cairo): add rtl argument 
	* src/sheet-object.c (sheet_object_draw_cairo): add rtl argument 
	* src/print.c (print_sheet_objects): clip to cell range and handle
	rtl sheets
	(print_page_cells): Rows are determining the height and cols the width!
	(gnm_print_sheet): enable progress reporting
	* component/gnumeric.c (go_gnm_component_draw): add rtl argument to
	  sheet_object_draw_cairo

2007-03-23  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/style-border.c (gnm_style_border_print_diag_gtk): remove
	  debug spew
	* src/print.c (print_sheet_objects): use gtkprint
	(print_page_cells): enable sheet object printing and prepare
	  clipping region
	(print_page): clipping should happen in print_page_cells
	
2007-03-22  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print-cell.c (print_cell_background_gtk): Enable diagonal
	  border
	(print_merged_range_gtk): handle borders
	(gnm_gtk_print_cell_range): ditto
	* src/style-border.h (gnm_style_borders_row_print_gtk): new
	(gnm_style_border_print_diag_gtk): new
	* src/style-border.c (gnm_style_borders_row_print_gtk): new
	(gnm_style_border_print_diag_gtk): new
	(style_border_set_gtk_dash): new
	(style_border_set_gtk): new
	(print_hline_gtk): new
	(print_vline_gtk): new
	
2007-03-21  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/pattern.h (gnumeric_background_set_gtk): new
	* src/pattern.c (gnumeric_background_set_gtk): new
	* src/print-cell.c (print_cell_gtk): fix vertical alignment
	(print_rectangle_gtk): new
	(print_cell_background_gtk): new
	(print_merged_range_gtk): new
	(gnm_gtk_print_cell_range): Enable merged and background printing.
	
2007-03-20  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print-cell.c (print_cell_gtk): set up clipping
	and some sort of rotated printing
	* src/print.c (print_page): prepare for clipping of whole 
	page (currently disabled since it involves a heavy
	performance hit).

2007-03-19  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/print-cell.c (print_cell_gtk): new
	(gnm_gtk_print_cell_range): new
	* src/print-cell.h (gnm_gtk_print_cell_range): new
	* src/print.c (PrintingInstance): new struct type
	(printing_instance_new) : new
	(pi_free): new
	(printing_instance_delete): new
	(print_page_cells): Switch to GtkPrintContext & Cairo
	(print_page): ditto
	(compute_sheet_pages): ditto
	(compute_pages): ditto
	(compute_group): drop PrintJobInfo
	(print_range_*_then_*): delete
	(compute_sheet_pages_add_range): new
	(compute_sheet_pages_across_then_down): new
	(print_page_repeated_rows): disable temporarily
	(print_page_repeated_cols): ditto
	(gnm_begin_print_cb): new
	(gnm_end_print_cb): new
	(gnm_draw_page_cb): new
	(gnm_print_sheet): use GtkPrintOperation
	* src/print-info.h (_PrintInformation): add page_setup
	(print_info_get_page_setup): new
	(print_info_set_page_setup): new
	* src/print-info.c (print_info_free): handle page_setup
	(print_info_new): ditto
	(print_info_dup): ditto
	(print_info_get_page_setup): new
	(print_info_set_page_setup): new
	* gnumeric.spec.in: require gtk 2.10
	* configure.in: require gtk 2.10

2007-03-16  Jean Brefort  <jean.brefort@normalesup.org>

	* src/collect.c: made some functions public:
	collect_floats_value_with_info, union_of_int_sets,
	and strip_missing.
	* src/collect.h: ditto.

2007-03-15  Morten Welinder  <terra@gnome.org>

	* src/application.c (gnm_app_history_get_list,
	gnm_app_history_add): Base on GtkRecentManager.  Fixes #115112.
	(gnm_app_create_opener_filter): New function.
	(gnm_app_history_add): Take extra mimetype argument.  All callers
	changed.
	(gnm_app_history_get_list): Ignore local files that no longer
	exist.

	* src/gui-file.c (gui_file_open): Use
	gnm_app_create_opener_filter.

	* src/gnumeric-gconf.c: Remove functions related to file history.

	* schemas/gnumeric-general.schemas.in: Remove entries related to
	file history.

	* configure.in: Require gtk+ 2.12.0

2007-03-13  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c (format_value_common): Ignore markup formats
	here.  Fixes #417632

	* src/gutils.c (cb_gnm_pango_attr_dump): Be smarter about enums.

2007-03-08  Morten Welinder  <terra@gnome.org>

	* src/mstyle.c (gnm_style_new_default): Use gnm_style_set_format,
	not gnm_style_set_format_text.
	(gnm_style_set_format_text): Change comments to make it clear that
	this takes an untranslated format string.

	* src/wbcg-actions.c (apply_number_format): Take a format, not a
	string.
	(apply_number_format): New function taking an actual format.
	(cb_format_as_general): Use go_format_general directly.
	(cb_format_as_date): Use go_format_default_date directly.  Fix
	swapped descriptors.
	(cb_format_as_time): Use go_format_default_time directly.  Fix
	swapped descriptors.
	(cb_format_as_number, cb_format_as_percentage,
	cb_format_as_scientific): Build a format here.
	(cb_format_as_currency, cb_format_as_accounting): Ditto.  This
	still relies on go_format_builtins, though.

2007-03-07  Morten Welinder  <terra@gnome.org>

	* src/sheet-view.c (sv_panes_insdel_colrow): Fix corrections for
	row deletions before the top-left frozen corner.  Fixes #308562.

2007-03-06  Morten Welinder  <terra@gnome.org>

	* src/sheet-autofill.c (afm_teach_cell): Use
	gnm_format_is_date_for_value correctly.  Fixes #414815.
	(afa_teach_cell): Fix tests for n >= 2.

2007-03-05  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_decimal_number): Require three
	digits after the thousands separator.

2007-03-04  Jody Goldberg <jody@gnome.org>

	* src/func-builtin.c (gnumeric_table) : patch logic.

2007-03-04  Jody Goldberg <jody@gnome.org>

	* src/parse-util.c (gnm_expr_conventions_new_full) : Start
	  homogenizing the structure so that parsing and formating use shared
	  gunichar, rather than a semi-random collection of booleans on
	  import and char * on export.
	  - ::name_parser renamed ::input.name
	  - ::unknown_function_handler replaced by ::input.func which is
	      called for all functions not just unknown.
	  - ::function_rewriter_hash deleted.  This was not 64bit clean
	  - ::output_sheet_name_sep => a gunichar and renamed ::sheet_name_sep.
	  - ::cell_ref_handler => ::output.cell_ref
	  - ::range_ref_handler => ::output.range_ref
	  - ::sheet_name_quote => ::output.sheet_name_quote

	(cellref_as_string) : ditto.
	(std_expr_name_handler) : ditto.
	(std_func_map) : new.

	* src/xml-sax-write.c (xml_io_conventions) : adapt to changes.
	* src/xml-io.c (xml_io_conventions) : ditto.
	* src/value.c (value_get_as_gstring) : ditto.
	* src/expr.c (do_expr_as_string) : ditto.

	* src/parser.y : s/SEPARATOR/ARG_SEP/
	Remove the ARRAY_START_COMMA and ARRAY_START_BSLASH tokens
	Remove the duplicate comma/bslash productions for arrays.
	Use an 'in_array' flag in the state to allow the lexer to
	differentiate an ARG_SEP from an ARRAY_COL_SEP and an ARRAY_ROW_SEP.

	* src/sheet-object-graph.c (gnm_sog_get_object_target_list) : compiler
	  warnings.

	* src/func.c (gnm_func_placeholder_factory) : delete.

2007-03-04  Morten Welinder  <terra@gnome.org>

	* configure.in: Post-release bump.

2007-03-04  Morten Welinder <terra@gnome.org>

	* Release 1.7.8

2007-02-26  Morten Welinder  <terra@gnome.org>

	* src/gui-file.c (gui_file_open): Tentatively hide format and
	character set selection behind an "Advanced" button to free up
	some screen real estate.

	* */*.c: Deal with goffice changes.

	* src/gnm-format.c (gnm_format_specialize): New function.
	(gnm_format_is_date_for_value): Base on gnm_format_specialize.

	* src/rendered-value.c (gnm_rendered_value_shutdown): Use slice
	allocator when available.

	* src/dependent.c (dependent_types_shutdown): Use slice allocator,
	when available, for some of the pools.

	* src/str.c (gnm_string_shutdown): Use the hash table to report
	leaked strings.  Use slice allocator when available.

	* src/value.c (value_shutdown): Use slice allocator when
	available.  Keep a running count of allocations and report leaks
	on shutdown.

	* src/commands.c (cmd_copyrel): Handle non-singleton areas.
	[#112847] Also switch to GOUndo.

	* */*.c: Use <stdio.h> only when needed.

2007-02-24  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (wbcg_edit_start): If formatting as date
	fails, revert to number.

	* src/gnm-format.c (hash_fill): Clear the string.

2007-02-22  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (cellref_r1c1_get): Allow lowercase "r" and
	"c".  Do not allow a reference to be immediately followed by a
	letter.
	(r1c1_rangeref_parse): Do not allow a reference to be immediately
	followed by a letter.  Fixes #410609.

2007-02-21  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_add): When the first
	sheet is attached, make sure to update rtl, zoom, etc.  Fixes
	#410365 and #410371.

	* src/sheet.c (sheet_expr_conventions): New function.

2007-02-16  Morten Welinder <terra@gnome.org>

	* Release 1.7.7

2007-02-13  Morten Welinder  <terra@gnome.org>

	* src/sheet-view.c (sheet_view_new): Add handler for r1c1 changes.
	(sv_real_dispose): Remove handler.
	(sv_sheet_r1c1_changed): New function.

	* src/workbook-view.c (wb_view_selection_desc): Use
	parsepos_as_string to get R1C1 right.  Fixes #407247.

	* src/parse-util.c (cell_name): Use R1C1 notation as appropriate.
	(parsepos_as_string): New function.

	* src/wbcg-actions.c (cb_edit_search_replace_query): Use cell_name,
	not cellpos_as_string.
	* src/sheet.c (cb_cell_pool_leak): Ditto.

	* src/workbook-control.c (wb_control_parse_and_jump): Resolve
	relative references.  Fixes #407274.

2007-02-07  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_csv_cell): Don't drop whitespace that
	happens to be separators.
	(stf_parse_csv_line): Trim fields as requested.

	* src/dependent.c (workbook_recalc): For now, any recalc needs to
	lead to a redraw.  This is highly suboptimal, but will have to do
	for now.

2007-01-29  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c (sheet_widget_list_base_get_result_dep) : new.
	(sheet_widget_list_base_get_content_dep) : new.

2007-01-29  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c : improve some docs

2007-01-24  Morten Welinder  <terra@gnome.org>

	*/*.c: Include new go-locale.h as needed.

	* src/numbers.h (gnm_render_number): Remove.

2007-01-22  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match): Don't compare a pointer to
	GO_FORMAT_GENERAL, even if the latter is zero.
	*/*.c: Deal with GOFormat now being opaque.

	* libspreadsheet-1.7.pc.in (GOffice_plugins_dir): Fix undefined
	variables.  [#399550]
	Eliminate EXTRA_LIBS and EXTRA_INCLUDES now in goffice.
	Fix goffice require.

2007-01-19  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.h : Add some new condition types to facilitate ODF
	  import.

2007-01-19  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (workbook_recalc): Reinstate a version of
	redraw-after-recalc.  I don't like it, but the alternative is to
	ask for redraw on a per-cell basis.

2007-01-18  Morten Welinder <terra@gnome.org>

	* */*.c: clean up interface between xmlChar and char.

2007-01-18  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-read.c (xml_sax_condition) : use gnm_style_new rather
	  than gnm_style_new_default.  We only want to fill in the required
	  fields, not all of them.
	* src/xml-io.c (xml_read_style) : fix the original here by adding an
	  'leave_empty' argument that can force the use of style_new.

2007-01-17  Morten Welinder  <terra@gnome.org>

	* src/cell-draw.c (cell_draw): Render as necessary.

	* src/graph.c (gnm_go_data_preferred_fmt): Handle the case of a
	missing expression in the dep.

	* src/xml-sax-read.c (xml_sax_condition): Merge
	xml_sax_style_condition_style_start into here.
	(xml_sax_condition_end): Merge xml_sax_style_condition_style_end
	into here.  Rearrange parser to use recursive entry.
	(xml_sax_object_start): Update progress here.
	(xml_sax_object_end): Not here.  Object isn't ready yet.

	* src/gui-util.c (gnm_pixbuf_tile): Round sizes up to 1 pixel, if
	needed.

	* src/xml-sax-read.c (gnm_xml_file_open): Clear state->cond.
	(xml_sax_style_condition_style_start,
	xml_sax_style_condition_style_end): New functions.
	Fixes part of #397679.

2007-01-16  Morten Welinder  <terra@gnome.org>

	* src/Makefile.am (gnumeric_LDADD): Don't add in popt since we do
	not use it directly anymore.  Fixes #396329.

2007-01-10  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-read.c (maybe_convert): Always be quiet if no
	conversion actually takes place, e.g., if everything is plain
	ASCII.

2007-01-09  Morten Welinder  <terra@gnome.org>

	* */*.c: No need to reset errno before go_strtod and gnm_strto.

	* src/xml-sax-read.c (xml_sax_double): Don't use g_strtod.  We do
	not need or want dual-locale semantics.
	(gnm_xml_attr_double): Ditto.

	* src/sheet.c (sheet_range_bounding_box): Respan as needed.
	Fixes #393359.

	* src/item-grid.c (item_grid_draw): Handle respans outside the
	loop, not inside.

	* src/dependent.c (gnm_cell_eval_content): Optimize the
	value-didn't-change case.
	(workbook_recalc): Don't force full-sheet redraws here.

	* src/xml-sax-read.c (gnm_xml_file_open): Initialize
	seen_cell_contents.

2007-01-08  Morten Welinder  <terra@gnome.org>

	* src/numbers.h (gnm_strto): Map this to go_strtod or go_strtold.
	Fixes #393347.

2007-01-06  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (cb_font_size_changed): Kill a few conversions.

2007-01-05  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c (gnm_format_is_date_for_value): New function.
	* src/sheet-autofill.c (afm_teach_cell): Use
	gnm_format_is_date_for_value.

	* src/stf-export.c (try_auto_date): Use
	gnm_format_is_date_for_value.

	* src/auto-format.c (is_date): Use go_format_is_date.

2007-01-03  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-read.c (xml_sax_cell_content): Handle v7 contents.
	Fixes #392054.
	(gnm_xml_file_open): Set up progress feedback.  Fixes #392546.
	(maybe_update_progress): New function.
	(xml_sax_style_region_end): Call maybe_update_progress.
	(xml_sax_cell_content): Ditto.

2007-01-02  Morten Welinder  <terra@gnome.org>

	* src/main-application.c (main): Call g_thread_init. Fixes #392050.
	* src/ssindex.c (main): Ditto.
	* src/ssconvert.c (main): Ditto.  Also increase stack
	size, if needed.

	* src/xml-sax-read.c (xml_sax_sheet_name): Handle missing sheet
	index better.  [#392054]

2006-12-29  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (gnm_expr_conventions_new_full): Theoretical
	leak plug.

	* src/xml-sax-read.c (xml_sax_named_expr_end): Delay all names.
	(handle_delayed_names): New function.
	(gnm_xml_file_open): Actually handle delayed names.  What a
	concept!

	* src/parser.y (parser_simple_val_or_name): Add support for
	disallowing the use of undefined names.

	* src/xml-sax-read.c (xml_sax_print_margins_unit): Even if we
	don't have gnome-print, avoid throwing an unknown-attribute error.

2006-12-28  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-graph.c (gnm_sog_foreach_dep): New function.

	* src/sheet-object-widget.c (sheet_widget_adjustment_foreach_dep,
	sheet_widget_checkbox_foreach_dep,
	sheet_widget_radio_button_foreach_dep,
	sheet_widget_list_base_foreach_dep): New functions.

	* src/sheet-object.c (sheet_object_invalidate_sheet): Reimplement
	in terms of sheet_object_foreach_dep.
	(sheet_object_foreach_dep): New function.
	(sheet_objects_dup): Fixup references to source sheet. Fixes
	#158825.

	* src/sheet.c (sheet_dup_names): Properly relocate expressions to
	the new sheet.  Copy permanent names too, as long as they are
	editable.
	(cb_sheet_cell_copy): Relocate expressions from source to target
	sheet.

	* src/expr.c (gnm_expr_top_relocate_sheet): New convenience
	function.

2006-12-28  Emmanuel Pacaud <emmanuel.pacaud@lapp.in2p3.fr>

	* src/pixmaps/expr-entry.png: convert to 16x16 image.
	* src/widgets/gnumeric-expr-entry.c (gee_set_property): request a menu
	sized icon instead of icon size.

2006-12-27  Morten Welinder  <terra@gnome.org>

	* src/expr-name.c (gnm_named_expr_collection_lookup): Make public.

	* src/sheet.c (sheet_dup_names): First cut at this.

2006-12-26  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c (format_value_common): Use long double version
	of go_format_value_gstring as appropriate.

2006-12-24  Jody Goldberg <jody@gnome.org>

	* src/io-context-gtk.c (cb_realize) : request no decoration for the
	  splash.
	(icg_processing_file) : do not push the splash to the top for every
	  file.  It's damn irritating.

	* src/GNOME_Gnumeric-gtk.xml.in : Hook up the DataTable dialog
	  and re-order Text-To-Columns.

	* src/sheet-object-widget.c (cb_collect) : handle reference to blank
	  cells.

	* src/gnm-so-filled.c (gnm_so_filled_user_config) : give labels their
	  own title.

2006-12-21  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=388505
	* src/sheet.c (cb_outline_level) : fix signature from 2006-06-25
	  breakage.

2006-12-20  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c (format_value_common): Do colours right.

2006-12-19  Jody Goldberg <jody@gnome.org>

	* src/sheet-object.h (SheetObjectAnchor::types) : simplfy to remove
	  the vector 'type' the offsets are now always as percentages of cell
	  size relative to the cell_bound.  The parent, GODrawingAnchor will
	  eventually have the absolute positions, and the sheet object itself
	  will specify how which set of coords in normative.

2006-12-18  Jody Goldberg <jody@gnome.org>

	* src/format-template.c (xml_read_format_template_members) : revert
	  inadvertent renaming of the xml element names.
	(format_template_new_from_file) : ditto.
	(xml_write_format_template_members) : ditto.

2006-12-18  Jody Goldberg <jody@gnome.org>

	* src/func-builtin.c (gnumeric_table) : patch leak.

2006-12-18  Jody Goldberg <jody@gnome.org>

	* src/gnm-format.c (format_value_common) : minor patch to keep text in
	  black until it's clear where to get it from.

2006-12-18  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c: Don't include goffice's format-impl.h,
	(format_value_common): New function, mostly
	extracted from gnm_format_layout, but using
	go_format_value_gstring.
	(find_entry, gnm_style_format_condition): Remove.
	(hash_fill): Generalize to handle layouts and strings alike.
	(format_value_gstring): Simplify using format_value_common.

	* src/workbook-edit.c: Don't include goffice's format-impl.h,

2006-12-18  Jody Goldberg <jody@gnome.org>

	* configure.in : Post release bump

2006-12-17  Jody Goldberg <jody@gnome.org>

	* Release 1.7.6

2006-12-17  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c (format_value_gstring): Don't pay attention to
	need_abs here.  That breaks DOLLAR, somehow.

2006-12-17  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c (sheet_widget_list_base_set_selection) :
	  if the selection is greater than the number of elements select the
	  last item.

2006-12-17  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=135966
	* src/gnumeric-pane.c (gnm_pane_widget_register) : Callers can call
	  gnm_pane_object_register themselves, but we need to interpose an
	  event handler for all child widgets so that right click can always
	  select the object.
	* src/sheet-object-widget.c (sheet_object_widget_new_view) : Call
	  gnm_pane_object_register directly.

2006-12-17  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c (cb_combo_model_changed) : set text column
	  here.
	(sheet_widget_combo_create_widget) : accept loading with no model.

2006-12-17  Jody Goldberg <jody@gnome.org>

	* src/item-cursor.c (item_cursor_draw) : don't draw an autofill handle
	  for hidden cursors. [#365960]

2006-12-16  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.h : add GNM_FILTER_OP_BOTTOM_MASK, and 
	  GNM_FILTER_OP_PERCENT_MASK.

	* src/xml-sax-read.c (xml_sax_filter_condition) : make bucket count a
	  float.
	* src/xml-sax-write.c (xml_write_filter_field) : ditto.
	* src/xml-io.c (xml_read_filter_field) : ditto.
	* src/sheet-filter.c (gnm_filter_condition_new_bucket) : ditto.
	* gnumeric.xsd : ditto.

2006-12-16  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c : implement combos and lists.

2006-12-15  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (gnm_rendered_value_new): Improve handling
	of invalid dates.
	* src/cell-draw.c (cell_calc_layout): Ditto.

2006-12-14  Morten Welinder  <terra@gnome.org>

	* src/test-format.c: Remove.

	* src/rendered-value.c (gnm_rendered_value_new): If we get an
	error, force a variable field.  This handles #### for negative
	dates.

	* src/gnm-format.c (format_value_gstring): Return error code.
	Handle errors from number formatting.
	(gnm_format_layout): Ditto.

2006-12-12  Morten Welinder  <terra@gnome.org>

	* src/ssindex.c (main): Don't print debug stuff on stdout.  That's
	where our output is supposed to go.

	* configure.in (set_more_warnings): Turn on ssindex by default.
	SuSE ships it and uses it, so we might as well start testing it
	more.

2006-12-11  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-widget.c (sheet_widget_button_set_label,
	sheet_widget_checkbox_set_label,
	sheet_widget_radio_button_set_label): Use go_str_compare and
	handle overlapping strings.

2006-12-11  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-widget.c (cb_adjustment_value_changed): Make
	action undoable.
	(sheet_widget_adjustment_init_full): Don't set signal handler here
	-- we need one signal per widget so we can figure out the invoking
	wbc.
	(sheet_widget_scrollbar_create_widget,
	sheet_widget_slider_create_widget,
	sheet_widget_spinbutton_create_widget): Set signal hanlder here.
	(cb_adjustment_widget_value_changed): Renamed from
	cb_adjustment_value_changed and changed to take a widget
	parameter.  Add undo support.
	(widget_wbc): New function.
	(cb_checkbox_toggled): Get the wbc from the widget.

2006-12-10  Morten Welinder  <terra@gnome.org>

	* src/clipboard.c (cb_clipboard_copy_range_undo): Take a command
	context as argument instead of faking it.

	* src/commands.c (cmd_so_set_value_undo): Supply the command
	context to the undo operation.

2006-12-09  Morten Welinder  <terra@gnome.org>

	* src/sheet-object-widget.c (cb_checkbox_toggled): Make action
	undoable.

	* src/commands.c (cmd_so_set_value): New function.

	* src/clipboard.c (clipboard_copy_range_undo): New function.

2006-12-09  Jody Goldberg <jody@gnome.org>

	* src/sheet-object-widget.c : Add sax parsers.

	* src/xml-sax-read.c : s/gsf_state/xin/g to be consistent.
	(gnm_xml_file_open) : set the unknown handler.
	(xml_sax_unknown) : unknown nodes under Object are object types.
	(xml_sax_object_start) : split out into ..
	(xml_sax_read_obj) : here.  Add a kludge to clean up the state->so
	  even when called from the unknown handler.

	* src/sheet-object-cell-comment.c (cell_comment_prep_sax_parser) :
	  return TRUE for the updated interface.

	* src/gnm-so-filled.c (sof_sax_style) : new.
	(gnm_so_filled_prep_sax_parser) : new.
	(gnm_so_filled_class_init) : hook up the new function.
	* src/gnm-so-line.c (sol_sax_style) : new.
	(gnm_so_line_prep_sax_parser) : new.
	(gnm_so_line_class_init) : hook up the new function.

	* configure.in : bump goffice req to get the new GogStyle sax parser
	  organization.

	* src/xml-sax-read.c (xml_sax_version) : be more discerning.

2006-12-07  Jody Goldberg <jody@gnome.org>

	* src/xml-io-version.h : time to modernize a bit.  tack on some new
	  versions.

	* src/xml-sax-read.c : gnumeric_1_0_dtd Use GSF_XML_NO_CONTENT and
	  friends.
	(xml_sax_version) : new.
	(xml_sax_filter_condition) : The DOM filter has been swapping Value
	  and ValueType.  The SAX exported copied the code.  The importer
	  needs to use the incorrect layout to handle existing files.
	* src/xml-sax-write.c (xml_write_filter_expr) : warn about the the
	  swapping of Value and ValueType.
	* gnumeric.xsd : comment on the swapping.

2006-12-07  Christian Neumair  <chris@gnome-de.org>

	* src/widgets/gnumeric-expr-entry.c (cb_icon_clicked):
	Don't g_assert, always assume that
	gtk_container_class_list_child_properties returns a non-NULL value.

2006-12-05 Joseph Pingenot <gnumerichacker@digitasaru.net>

	* src/tools/analysis-{tools,histogram}.[ch]: split out all histogram
	stuff in preparation for larger work with histograms.  Nothing else
	should have changed at this point.

	* src/tools/Makefile.am: Added new files.

	* src/dialogs/dialog-analysis-tools.h: Added header include for
	analysis-histogram.h so that it compiles.

	* tools/check-files: complain if a filename line contains 
	leading/trailing whitespace, and ignore the whitespace.

2006-12-05  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-read.c (gnm_xml_file_open): Do as little as possible
	while in C locale.  Assign a default saver so the save button
	works right.

	* src/sheet-object-cell-comment.c (cell_comment_prep_sax_parser):
	Read the comment text(!) and author.
	(cell_comment_class_init): Hook up cell_comment_prep_sax_parser.
	(comment_view_set_bounds): Do not scale triangle size.  Flip
	triangle in rtl.

	* src/workbook-control-gui.c (wbcg_view_changed): Change back to
	using a workbook as data argument.  Keep the old view in a weak
	pointer.  Fixes #382643 (caused by the view disappearing and
	killing the signal handler with it).

2006-12-04  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2006-12-04  Jody Goldberg <jody@gnome.org>

	* Release 1.7.5

2006-12-04  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c (gnm_filter_combo_apply) : make public and init
	  target_sheet in the expr case too.
	(gnm_filter_set_condition) : revert the earlier change from apply ->
	  target_sheet.  We do not need that flexibility here.
	* src/widgets/gnm-filter-combo-foo-view.c (fcombo_fill_model) : Create
	  a temporary sheet and apply the filter to that so that we can list
	  only the elements filtered by other fields.

2006-12-02  Jody Goldberg <jody@gnome.org>

	* src/expr.c (gnm_expr_top_relocate) : don't init rinfo::from_inside
	  for INVALIDATE_SHEET case, it's unnecesasry and the inputs are
	  undefined.

	* src/gnumeric-canvas.h : Remove scaling from GNUMERIC_CANVAS_FACTOR_X
	  that was breaking text display in RTL.  We need a gtk patch for that
	  to work.

2006-12-02  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_dup_filters) : new.
	(sheet_dup) : called from here.
	* src/sheet-filter.c (gnm_filter_condition_dup) : new.
	(gnm_filter_dup) : new.
	(filter_field_apply) : take target_sheet to allow filtering a
	  different sheet using the src data.
	(gnm_filter_get_condition) : replace 'apply' boolean with
	  'target_sheet'.
	(gnm_filter_combo_foo_view_new) : move this internal and use
	  gnm_cell_combo_foo_view_new.
	(gnm_filter_add_field) : use offset to replace the effect of
	  SO_ANCHOR_PERCENTAGE_FROM_COLROW_END.

	* src/validation.c (gnm_validation_combo_foo_view_new) : move this
	  internal and use gnm_cell_combo_foo_view_new.

	* src/sheet-view.c (sv_update) : Use wb_view_selection_desc instead of
	  putting a subset of the logic here.

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : Add a hook to
	  popdown validate from list, or autofilter combos.

	* src/sheet-object.h : remove SO_ANCHOR_PERCENTAGE_FROM_COLROW_END.
	* src/sheet-object.c (sheet_object_draw_cairo) : ditto.
	* component/gnumeric.c (go_gnm_component_print) : ditto.
	* src/sheet-object-cell-comment.c (cell_comment_set_cell) : use offset
	  to replace the effect of SO_ANCHOR_PERCENTAGE_FROM_COLROW_END.
	* src/sheet-control-gui.c (calc_obj_place) : FROM_COLROW_END is gone.
	(cell_offset_calc_pixel) : ditto.

	* src/ranges.c (range_init_cellpos) : take only 1 cellpos and use for
	  both ends.  All callers changed.

2006-12-02  Jody Goldberg <jody@gnome.org>

	* gnumeric.xsd : Make schema validate by
	    - adding Attributes.
	    - Add Autofilters.
	    - Add Input Messages

	* src/xml-io.c (xml_init) : Make the sax importer the default.
	(xml_read_colrow_info) : update the max_outline_level.
	* src/xml-sax-read.c (xml_sax_colrow) : ditto. [#380015]
	(gnm_xml_file_open) : init State::filter
	(content_ns) : add schema namespace.
	(xml_sax_filter_end) : new.
	(xml_sax_filter_start) : new.
	(xml_sax_filter_condition) : new.
	(xml_sax_filter_operator) : new.
	(xml_sax_input_msg) : sync with logic in the DOM importer and do
	  not generate an input msg if both title and msg are missing.

2006-11-30  Morten Welinder  <terra@gnome.org>

	* src/clipboard.c (cellregion_get_content): Prevent critical.

2006-11-28  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (convert): Call goal seek if requestion (for
	testing purposes).

	* src/clipboard.c (cellregion_to_string): Fix critical.

2006-11-27  Morten Welinder  <terra@gnome.org>

	* Catch up with goffice renamings.

2006-11-27  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Bumped goffice dependency to reflect that goffice HEAD
	is needed as building against goffice 0.3.3 now fails.

2006-11-25  Morten Welinder  <terra@gnome.org>

	* src/dependent.c (gnm_dep_set_expr_undo_new,
	gnm_dep_unlink_undo_new): New functions.
	(dep_hash_destroy, invalidate_name, handle_referencing_names,
	handle_outgoing_reference, tweak_3ds): Drop destroy argument.  All
	callers changed.
	(dependents_invalidate_sheets): Make static.
	(dependents_revive_sheet): Use go_undo_undo.

	* src/sheet.h: Make ::revive a GOUndoGroup *.

	* src/expr-name.c (expr_name_set_expr_undo_new): New function.

2006-11-25  Jody Goldberg <jody@gnome.org>

	* src/clipboard.c (clipboard_paste_region) : don't warn when pasting
	  a cellregion with no cells which can easily happen on undo, where
	  the old content of a region was empty.  Problem originated in 2006-11-11
	  move from lists to a hash.
	(cellregion_cmd_size) : ditto.

2006-11-25  Jody Goldberg <jody@gnome.org>

	* src/sheet-filter.c (gnm_filter_combo_class_init) : adjust to
	  rename of gnm_filter_combo_foo_view_new.
	* src/validation.c (gnm_validation_combo_class_init) : adjust to
	  rename of gnm_validation_combo_foo_view_new.

2006-11-25  Jody Goldberg <jody@gnome.org>

	* src/value-sheet.c (value_area_foreach) : init ep in the cellrange
	  case, and region in both cases.

2006-11-25  Jody Goldberg <jody@gnome.org>

	* src/style-conditions.c (gnm_style_conditions_eval) : tidy up a bit.

2006-11-24  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (convert): Avoid updating the recect-files list.

2006-11-24  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : add validation-combo.h

2006-11-24  Jody Goldberg <jody@gnome.org>

	* src/mstyle.c (gnm_style_get_validation) : constify the result.  We
	  should not modify it while it's part of a style.

	* src/sheet-control-gui.c (cb_collect_objects_to_commit) : handle
	  no-view case.
	* src/gnumeric-pane.c (gnm_pane_display_obj_size_tip) : ditto.

	* src/sheet-object.c (sheet_object_clear_sheet) : Handle 
	  so::sheet == NULL (eg when data validation combo is cleared from
	  wbv::finalize after content_destroy clears the sheet list)
	  Drop the return flag, nothing was using.

	* src/validation.c (gnm_validation_combo_new) : new.
	(gnm_validation_combo_class_init) : new.
	(gnm_validation_combo_finalize) : new.
	(gnm_validation_combo_init) : new.
	(validation_ref) : allow the reffing of const objects.
	(validation_unref) : ditto, this should really be split into a const
	  and non-const version.  We can do that for all unref routines.

	* src/value.h : create new struct GnmValueIter.
	* src/value.c (gnm_value_get_type) : Make GnmValue a glib boxed type.
	* src/value-sheet.c (value_area_foreach) : rework to use GnmValueIter.
	  All callers changed.

	* src/workbook-view.h : s/::current_format/::current_style/
	  and make it const.  We have a ref to it, so it's not going away
	  _but_ we should never change it.
	  Add validation_combo.  For the sheet object corresponding to an
	  in cell data validation combo.

	* src/workbook-view.c (wb_view_style_feedback) : renamed from
	  wb_view_format_feedback all callers changed.  Add a creation
	  and removal of data validation in cell combo.
	(wb_view_finalize) : clear the validation combo if it exists.
	(workbook_view_new) : init the combo.

2006-11-24  Jody Goldberg <jody@gnome.org>

	* tools/xmlunzip : Add the 'macro enabled' formats from office12

2006-11-23  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-write.c (xml_write_styles): Sort style regions so
	hash order does not matter.
	(xml_write_named_expressions): Sort names to hash order does not
	matter.

	* src/expr-name.c (gnm_named_expr_collection_list): New function.

2006-11-22  Jon K Hellan  <hellan@acm.org>

	* src/gnumeric-gconf.c (gnm_gconf_set_gui_zoom): Fix typo that
	broke the default zoom preference. #378043.

2006-11-21  Morten Welinder  <terra@gnome.org>

	* src/value.c (value_parse_boolean): Add a few "+" to tell the
	checker that it is ok to mix -1 and TRUE/FALSE.

2006-11-20  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-gconf.c (gnm_conf_shutdown): Plug leaks.

2006-11-20  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2006-11-20  Jody Goldberg <jody@gnome.org>

	* Release 1.7.4

2006-11-20  Jody Goldberg <jody@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_setup_pixmaps) : move the splash out of here.
	* src/io-context-gtk.c (icg_show_gui) : and into here.

2006-11-20  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (ssconvert_options): Add new --recalc option.
	Add internal --export-range option.
	(convert): Recalc if requested.  Setup range if requested.
	Fix error handling.

	* src/stf-export.c (stf_export_sheet): Code to handle internal
	range specification.

2006-11-19  Jody Goldberg <jody@gnome.org>

	* src/func.c (gnm_func_load_if_stub) : make this inline.
	(function_call_with_exprs) : load stub _after_ we get the function def
	  Fixes crash on calling any vararg function.

2006-11-19  Morten Welinder  <terra@gnome.org>

	* configure.in: Post-release bump.

2006-11-19  Morten Welinder <terra@gnome.org>

	* Release 1.7.3

2006-11-19  Morten Welinder  <terra@gnome.org>

	* src/sheet-object.c (sheet_object_class_init): Objects class are
	not interactive by default.

	* src/sheet-object-widget.c (SOW_MAKE_TYPE): Widgets classes are
	interactive.

	* src/gnumeric-pane.c (cb_sheet_object_canvas_event): All mouse
	buttons select non-interactive objects.  Fixes #376866.

2006-11-18  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_def_get_arg_name): Avoid allocating like
	nuts.  Prepare for the day when format_get_arg_sep might return
	non-ASCII.

2006-11-18  Djihed Afifi <djihed@gmail.com> 

	* configure.in: Added Arabic Translation.

2006-11-17  Morten Welinder  <terra@gnome.org>

	* src/func.c (gnm_func_load_if_stub): New function.

2006-11-16  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_call_with_exprs): Drop the argc and argv
	arguments.  They now follow from the eval info.  All callers
	changed.

2006-11-16  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (sheet_cell_set_text): Use gnm_cell_get_format so
	current format gets handled properly even if it derives from the
	value.

	* src/workbook-edit.c (wbcg_edit_finish): Use gnm_cell_get_format
	here too.

	* src/number-match.c (format_match_datetime): Properly handle
	"2005/12" and "12/2005".  (Year got set to current year.)
	Add new presume_date argument and do not allow "1-10" and "1.10"
	unless that new argument is true.

2006-11-15  Jody Goldberg <jody@gnome.org>

	Fix check buttons.
	* src/gnumeric-pane.c (cb_sheet_object_widget_canvas_event) : do not
	  bring up an editor on double click for widgets.  Simple clicks are
	  too easy to confuse.  Use right click only.
	(cb_sheet_object_canvas_event) : Return FALSE on enter to allow
	  checkbox handlers to set things up.
	(cb_sheet_object_canvas_event) : Only change selection on right-button
	  press.

2006-11-12  Jody Goldberg <jody@gnome.org>

	* src/clipboard.c (cellregion_to_string) : support only exporting
	  visible content.

2006-11-11  Jody Goldberg <jody@gnome.org>

	* src/stf-parse.c (stf_parse_region) : adjust to signature change.
	* src/xml-io.c (xml_read_clipboard_cell) : ditto.
	* src/xml-sax-write.c (cb_xml_write_cell_region_cells) : adapt to move
	  from list to hash of cells.

	* src/clipboard.c (cb_paste_cell) : new. split from ...
	(clipboard_paste_region) : here.  For the move from a list of cells to
	  a hash table.
	(gnm_cell_copy_new) : insert the copy in here rather than forcing
	  callers to handle it.
	(cb_clipboard_prepend_cell) :
	(clipboard_copy_range) : store the col/row states too.  Not used yet.
	(cellregion_new) : col/row states and cells in a hash.
	(cellregion_unref) : free the col/row states if they exist.
	(cellregion_get_content) : new.
	(cb_invalidate_cellcopy) : split from ...
	(cellregion_invalidate_sheet) : here.
	(cellregion_to_string) : move here from gui-clipboard and use the new
	  hash based layout to avoid the intermediate matrix allocation.
	(gnm_cell_copy_free) : tidy up and name this.
	(gnm_cell_copy_new) : assign the copy to a region on creation.

	* src/colrow.c : Make ColRowState and ColRowRLEState public for use in
	  the clipboard.

2006-11-11  Jody Goldberg <jody@gnome.org>

	* src/application.c : Move the icons from here.
	* src/wbc-gtk.c (wbc_gtk_setup_icons) : to here.
	(wbc_gtk_setup_pixmaps) : here.
	(wbc_gtk_class_init) : and here.

2006-11-14  Morten Welinder  <terra@gnome.org>

	* src/sheet-control-gui.c (scg_wbcg): Rename from scg_get_wbcg.
	(scg_wbc, scg_sheet, scg_view): New functions.  Use a few hundred
	places to avoid casts.
	(scg_class_init): Install ->mode_edit handler(!)

2006-11-13  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_autosave_cancel): Make static.
	(wbcg_autosave_activate, wbcg_set_autosave_time,
	wbcg_set_property, wbcg_get_property): New functions.
	(wbcg_autosave_set): Remove.
	(wbcg_finalize): Cancel autosave timer.
	(workbook_control_gui_class_init): Install autosave-time and
	autosave-prompt properties.

	* src/workbook-control-gui-priv.h (WorkbookControlGUI): Remove
	redundant autosave member.  Change autosave_minutes to
	autosave_time and make it seconds-based.

	* src/workbook.c (workbook_dispose): Use
	wb_view_detach_from_workbook.
	(workbook_detach_view, workbook_attach_view): Don't set wbv->wb
	here.  Set in caller.

	* src/workbook-view.c (workbook_view_class_init): Install new
	property: auto-expr-text.
	(wb_view_get_property, wb_view_set_property,
	wb_view_auto_expr_text): Handle auto-expr-text.
	(wb_view_detach_from_workbook): New function.
	(wb_view_finalize): Use wb_view_detach_from_workbook.

	* src/workbook-control-priv.h (WorkbookControlClass): Remove
	auto_expr_value member.

	* src/workbook-control-gui.c (wbcg_auto_expr_text_changed): New
	function hooked up to WorkbookView::auto-expr-text.
	(wbcg_auto_expr_value): Removed.

2006-11-12  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (cb_auto_expr_changed): Control
	auto-expression via wbv properties.
	(cb_auto_expr_precision_toggled): Ditto.

	* src/workbook-view.h (WorkbookView): Replace auto_expr with more
	sane auto_expr_func member.

	* src/workbook-view.c (wb_view_auto_expr_recalc): Remove
	always-TRUE second argument.  All callers changed.  Adjust to
	WorkbookView changes.
	(wb_view_auto_expr): Remove.
	(wb_view_auto_expr_precision): Make static.
	(workbook_view_class_init): Install properties for
	auto-expressions.

2006-11-12  Jean Brefort  <jean.brefort@normalesup.org>

	* src/application.c: (gnm_app_history_add): return if max length is 0
	(avoids a critical).
	* src/gnm-graph-window.c: (gnm_graph_window_set_graph): set horizontal
	and vertical resolutions.

2006-11-11  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_format_feedback): Drop always-TRUE
	second argument.  All callers changed.

	* */*.[ch]: Grand rename for cell identifiers and a few more.

2006-11-11  Jody Goldberg <jody@gnome.org>

	* src/workbook-control-gui.c (cb_scroll_wheel) : renamed from
	  wbcg_scroll_wheel_support_cb and make static.

2006-11-11  Jody Goldberg <jody@gnome.org>

	* src/GNOME_Gnumeric-gtk.xml.in : Remove inc/dec indent from the menu.
	  They do not belong there.  Remove them from the accel list too, gtk
	  silently invalidates accels for Tab.  Handle them manually.
	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : here.  Use the
	  new functions from ...
	* src/workbook-cmd-format.c (workbook_cmd_inc_indent) : here.  That
	  are transfered from ...
	* src/wbcg-actions.c : here.

2006-11-10  Morten Welinder  <terra@gnome.org>

	* gnumeric.desktop.in: Set component to General.  Bug-buddy
	insists on that, even if I don't agree.  Fixes #348829.

	* src/style-conditions.c (gnm_style_conditions_eval): Fix
	pointer-int screwup.

2006-11-08  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c  : Add new accelerators.
	    <control><alt>Tab : inc indent
	    <control><alt><shift>Tab : dec indent.
	    <shift><alt>Right : group
	    <shift><alt>Left : ungroup

	* src/GNOME_Gnumeric-gtk.xml.in : Add explicit accelerator entries for
	  the inc/dec indent because they are not in the menu by default, so
	  their accels are not enabled.

	* src/gnumeric-canvas.c (gnm_canvas_key_mode_sheet) : don't eat
	  Alt-left/right.  We want those for accelerators.

2006-11-08  Jody Goldberg <jody@gnome.org>

	* src/gutils.c (gnm_push_C_locale) : new utility to set the C locale
	(gnm_pop_C_locale) : and restore it.  Useful for persistence to avoid
	  problems with decimal points.
	* src/xml-io.c (xml_cellregion_read) : Use it here.
	(xml_workbook_read) : and here.
	* src/xml-sax-read.c (gnm_xml_file_open) : ditto.
	* src/xml-sax-write.c (gnm_xml_file_save) : ditto.
	(gnm_cellregion_to_xml) : ditto.

	* src/sheet-object-graph.c (gnm_sog_write_object) : do not change the
	  locale here.
	* src/sheet-object.c (sheet_object_write_object) : that logic belongs
	  here.  Use the new push/pop C_locale routines.

2006-11-08  Eduardo Lima <eduardo.lima@indt.org.br>

	* configure.in: Make print support optional. #331948
	* plugins/excel/excel-xml-read.c: Ditto.
	* plugins/excel/ms-excel-read.c: Ditto.
	* plugins/openoffice/openoffice-write.c: Ditto.
	* src/Makefile.am: Ditto.
	* src/gnm-so-filled.c: Ditto.
	* src/gnm-so-line.c: Ditto.
	* src/gnm-so-polygon.c: Ditto.
	* src/gnumeric-gconf.c: Ditto.
	* src/gnumeric-gconf.h: Ditto.
	* src/pattern.c: Ditto.
	* src/pattern.h: Ditto.
	* src/print-info.c: Ditto.
	* src/print-info.h: Ditto.
	* src/sheet-object-cell-comment.c: Ditto.
	* src/sheet-object-graph.c: Ditto.
	* src/sheet-object-image.c: Ditto.
	* src/sheet-object-impl.h: Ditto.
	* src/sheet-object.c: Ditto.
	* src/sheet-object.h: Ditto.
	* src/style-border.c: Ditto.
	* src/style-border.h: Ditto.
	* src/style-font.h: Ditto.
	* src/wbc-gtk.c: Ditto.
	* src/wbcg-actions.c: Ditto.
	* src/workbook-control-gui.c: Ditto.
	* src/xml-io.c: Ditto.
	* src/xml-sax-read.c: Ditto.
	* src/xml-sax-write.c: Ditto.
	* src/dialogs/Makefile.am: Ditto.
	* src/dialogs/dialogs.h: Ditto.

2006-11-07  Jody Goldberg <jody@gnome.org>

	* src/application.c : Add a brush from the gimp for use in format
	  pasting.

2006-10-30  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (auto_sum) :  <Alt>= is the accelerator.

2006-11-05  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_paste_copy_impl): Paste objects on
	non-initial redos.  Paste the proper set of objects.  Fixes
	#308300.

2006-11-04  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_paste_copy_impl): Keep track of new objects
	created and undo as needed.  Fixes part of #308300.

2006-11-03  Morten Welinder  <terra@gnome.org>

	* */*.c: Avoid checked g_free and g_strdup.  They handle NULL just
	fine.  Fixes #369661.

2006-11-01  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (show_gui): Fix initial sizing. Fixes
	#368825.

2006-10-31  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (cb_editline_focus_in): Restore entry
	to normal state.  Fixes #367870.

2006-10-31  Jon K Hellan  <hellan@acm.org>

	* src/sheet-control-gui.c (scg_drag_data_received): Don't output
	warning if UTF8_STRING drag is received.

	* src/gnumeric-pane.c (cb_pane_drag_leave): Just return, no
	critical, when drag source widget is something other than GnmCanvas.

	* src/application.c (gnm_app_workbook_get_by_name,
	gnm_app_workbook_get_by_uri): Check for NULL URI. Fixes crash part
	of #367870.

2006-10-28  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (cb_entry_delete_text): Handle the no-scg
	case.
	(wbcg_edit_finish): Ditto.  Fixes #366570.

	Fixes for #366477:

	* src/workbook-view.c (wb_view_sheet_focus): Set
	current_sheet_view when we set current_sheet.

	* src/sheet-view.c (sv_sheet_visibility_changed): New function.
	(sv_real_dispose): Disconnect sv_sheet_visibility_changed.
	(sheet_view_new): Connect sv_sheet_visibility_changed.

	* src/workbook-view.c (wb_view_sheet_add): Fix order and use
	wb_view_sheet_focus.

2006-10-28  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (wbcg_show_save_dialog): Escape URI
	so that g_markup can do the right thing.
	(wbcg_close_control): Regenerate window list. Fixes #366335.

2006-10-24  Jody Goldberg <jody@gnome.org>

	* src/value.c (value_is_zero) : new.

2006-10-24  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (gnm_dialog_setup_destroy_handlers): New function
	for handling issues like 364291.

	* src/workbook-control-gui.c (wbcg_get_scg): Fix sheet removal
	problem.  Fixes #364865.

	* src/sheet-autofill.c (sheet_autofill_dir): Copy the style, don't
	just ref it, before sending it to sheet_style_set_pos.

2006-10-24  Jon K Hellan  <hellan@acm.org>

	* src/style-border.c (style_border_fetch): Return empty border for
	invalid border types. Fixes #364658.

2006-10-24  Jody Goldberg <jody@gnome.org>

	* src/expr.c (reloc_range) : Special case deleting cols/rows.
	  Trunate rather than invalidate  if only the bottom/right range 
	  is being removed.  Top/Left case is already handled by the inversion
	  avoidance.

	* src/sheet.c (sheet_delete_cols) : translate only columns when
	  invalidating otherwise the relocation code does not shorten ranges.
	(sheet_insert_rows) : ditto.

2006-10-24  Jody Goldberg <jody@gnome.org>

	* src/func.c (gnm_func_group_fetch_with_translation) : warning
	  suppression.

2006-10-24  Jody Goldberg <jody@gnome.org>

	* src/expr.c (relocate_cellref) : delete and take a different range
	  based approach.
	(cellref_shift) : delete.
	(invalidate_sheet_cellrange) : split out from the old
	  relocate_cellrange.
	(relocate_range) : new code to relocate a range (do not handle abs/rel
	  here).  If the entire range is enclosed then move it, otherwise
	  extend any of the sides that are enclosed but do not allow
	  inversion.  eg relocating the bottom above the top.
	(reloc_normalize_cellref) : new code to map from abs/rel cellref to
	  straight cellpos.  Take into account the 'check_rels' flag for use
	  with names that disables relocation of relative references (Not used
	  yet).
	(reloc_restore_cellref) : reverse the process in
	  reloc_normalize_cellref and do bounds checking.
	(relocate_cellrange) : rewrite, much simpler conceptually than the old
	  code.  Rather than handling abs/rel and in/out as part of the
	  process always do the conversions then generate a result if
	  something changed.  This code also handles full col/row refs better.
	(gnm_expr_relocate) : merge the ignore_rel flag into a new wrapper
	  'RelocInfoInternal'
	(gnm_expr_top_relocate) : check 'from_inside' here rather than for
	  every ref and use the new internal Reloc struct to pass the extra
	  information.

	* src/ranges.c (range_make_full) : new.

2006-10-24  Joseph Pingenot <trelane@digitasaru.net>

	* src/style-conditions.c (gnm_style_conditions_eval) :  Add in
	  additional string and error conditional operators.

2006-10-23  Jon K Hellan  <hellan@acm.org>

	* src/xml-sax-read.c (xml_sax_wb_view): Check that "SelectedTab"
	exists. Fixes #312010.

	* src/xml-io.c (xml_workbook_read): Ditto.

2006-10-22  Morten Welinder  <terra@gnome.org>

	* src/search.c (search_collect_cells_cb): Adapt to change in
	CellIterFunc type.  Fixes #364085.

2006-10-21  Morten Welinder  <terra@gnome.org>

	* src/workbook-control.c (wb_control_parse_and_jump): If the range
	does not have a sheet, use current.  Fixes #363977.

2006-10-20  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_get_scg): When we are focusing
	a new sheet it might not have a page yet.
	(wbcg_sheet_focus): Handle NULL sheet properly.

	* src/workbook.c (workbook_focus_other_sheet): Set focus even if
	that is NULL.

	* src/expr-name.c (cb_check_name): Survive a name without any
	expression.  That can happen in connection with sheet undo/redo.

2006-10-20  Jon K Hellan  <hellan@acm.org>

	* src/sheet-view.c: Add preconditions

2006-10-19  Jon K Hellan  <hellan@acm.org>

	* src/workbook-control-gui.c (cb_sheet_label_button_press): Only
	enable context menu when label is editable, which it is when we're
	not editing a cell. Fixes #363261.

2006-10-18  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_next_token, comp_term): Remove.
	(stf_parse_csv_cell): Make sane.  Fixes #359269.

2006-10-18  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (cellregion_to_string): Brown paper bag -
	would try to allocate negative memory. Fixes #362993.

2006-10-17  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_claim_clipboard): Really fix #308569.

2006-10-17  Jody Goldberg <jody@gnome.org>

	* configure.in : Post release bump

2006-10-17  Jody Goldberg <jody@gnome.org>

	* Release 1.7.2

2006-10-16  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (cb_workbook_debug_info): Use
	workbook_share_expressions.

	* src/workbook.c (workbook_share_expressions): New function.

	* src/workbook-view.c (wb_view_new_from_input): Share expressions
	after load.

2006-10-16  Jody Goldberg <jody@gnome.org>

	* src/expr.c (relocate_cellrange) : Check for inversion from the
	  destination position. (rinfo->pos.eval + offset).
	  Fixes 350222.

2006-10-16  Jody Goldberg <jody@gnome.org>

	* src/expr.c : Fixes #361074
	(bin_array_iter_a) : split out of the old bin_array_op, and handle the
	  more complex iteration cases of different shaped arguments.  See
	  samples/array.xls for details.
	(bin_array_iter_b) : split from bin_array_op and handle the simple
	  case of f(scalar,array).
	(gnm_expr_eval) : adjust to new binary array iterator functions.

2006-10-16  Jon K Hellan  <hellan@acm.org>

	* src/main-application.c (main): Increase stack limit.

2006-10-15  Jody Goldberg <jody@gnome.org>

	* src/preview-grid.c (pg_fetch_cell) : renamed from pg_construct_cell.
	  Now that we have a sheet to store things in the life cycle gets
	  simpler.
	(preview_grid_draw) : no need to destroy things so quickly now.
	(pg_destruct_cell) : delete.

2006-10-15  Jody Goldberg <jody@gnome.org>

	* src/func.c (function_call_with_exprs) : I don't have a concrete
	  example of where this would matter, but it seems like a better
	  choice.  Iterating for every array function seems over the top.

2006-10-15  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-write.c (xml_write_cell_and_position) : minor cosmetc
	  fix to export Row before Col to make the result more readable.

2006-10-15  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (cellregion_to_string): Limit to non-empty
	part of sheet.
	(x_store_clipboard_if_needed): Call whenever workbook with
	clipboard sheet is closed,

2006-10-14  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_sheet_delete): Actually clear clipboard
	references as the docs claim.  Fixes #323762.

	* src/sheet-object.c (sheet_object_invalidate_sheet): New
	function.

	* src/clipboard.c (cellregion_invalidate_sheet): Invalidate the
	sheet in sheet objects too.

2006-10-13  Jody Goldberg <jody@gnome.org>

	* po/POTFILES.in : translate the Hildon file (no actual text right now)
	* po-functions/POTFILES.skip : There is no function text in the hildon
	  file.

2006-10-13  Jody Goldberg <jody@gnome.org>

	* src/style-border.c (print_vline) : Respect RTL when rounding to
	  pixel bounds. [#317662]
	(style_borders_row_print) : and here.

2006-10-11  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-write.c (cb_write_cell, xml_write_cells): Only last
	change.  The explicit ordering was useful.

	* src/expr.c (gnm_expr_hash): Renamed from ets_hash and adapted to
	traverse the entire tree.
	(gnm_expr_top_hash): New function.
	(gnm_expr_sharer_new): Use gnm_expr_top_hash, not ets_hash.
	(gnm_expr_sharer_share): Re-implement sharing.
	(gnm_expr_top_equal): If we have different hash values,
	short-circuit as false.

2006-10-11  Valek Filippov  <frob@df.ru>

	* schemas/gnumeric-general.schemas.in: 	Extend comment about 'Transition Keys' with Jody's explanation.
	* schemas/gnumeric-dialogs.schemas.in:  Fixed typppo.

2006-10-10  Morten Welinder  <terra@gnome.org>

	* src/application.c (gnm_app_clipboard_invalidate_sheet): New
	function.
	* src/clipboard.c (cellregion_invalidate_sheet): New function.
	* src/sheet.c (sheet_destroy): Use
	gnm_app_clipboard_invalidate_sheet.  Fixes #323811 in a brutal
	way.
	(sheet_destroy): Make static.

2006-10-10  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_claim_clipboard): Don't declare text or
	html formats on clipboard for sheet objects. Fixes #308569.

	* src/workbook-control-gui.c (wbcg_finalize,
	wbcg_close_if_user_permits):  Move call of
	x_store_clipboard_if_needed from finalize to
	close_if_user_permits. This works around some lifecycle
	issues. Fixes #321714, #342580.

	* src/gui-clipboard.[ch] (x_store_clipboard_if_needed):
	Make it take a workbook, not a wbcg. Should now be explicitly
	called before workbook object is destroyed.

2006-10-09  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (cb_add_menus_toolbars): Fix hiding/unhiding of
	toolbars broken by 2006-08-09 commit.

	* src/clipboard.c (paste_cell): Transpose array formulas.
	[#349288].  Make sure we do not end up sharing corners in the
	non-transposed case.

	* src/expr.c (gnm_expr_top_transpose): New function.

2006-10-08  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_read_clipboard_cell): Make sure the value gets
	set to a non-NULL value.  Don't try to free a NULL value.

	* src/cell.c (cell_set_expr_and_value): Set CELL_HAS_NEW_EXPR just
	like cell_set_expr_internal.  Fixes #360672.

2006-10-08  Jon K Hellan  <hellan@acm.org>

	* src/gui-file.c (gui_file_open, gui_file_save_as): Explicitly
	show the file format box, because go_gtk_file_sel_dialog no longer
	calls gtk_wiget_show_all.

	* src/gui-clipboard.c (x_clipboard_get_cb): Ignore SAVE_TARGETS.

2006-10-06  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.c (x_store_clipboard_if_needed): Only store if
	we own selection.

2006-10-05  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (cb_max_cell_height): Optimize the non-string case.
	Fixes #359392.
	* src/mstyle.c (gnm_style_get_pango_height): New function.

2006-10-04  Morten Welinder  <terra@gnome.org>

	* src/preview-grid.c (pg_destruct_cell): Destroy cell properly.
	(pg_construct_cell): Construct it properly.
	(preview_grid_init): Create proper sheet object.

	* src/dependent.c (handle_outgoing_references): Handle sheet
	without workbook.

2006-10-04  Jean Brefort  <jean.brefort@normalesup.org>

	* src/gui-clipboard.c: (x_claim_clipboard): fixed one more detail.

2006-10-03  Jean Brefort  <jean.brefort@normalesup.org>

	* src/gui-clipboard.c: (x_claim_clipboard): check for imageable and
	exportable indepentently.

2006-10-03  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2006-10-02  Jody Goldberg <jody@gnome.org>

	* Release 1.7.1

2006-10-02  Jody Goldberg <jody@gnome.org>

	* src/func.c (function_call_with_exprs) : Iterate when we are in an
	  array, not when non-scalars are permitted.
	  Fix typo.
	(function_iterate_argument_values) : permit non-scalars for args that
	  are function calls.

2006-10-01  Jean Brefort  <jean.brefort@normalesup.org>

	* src/sheet-object-graph.c: (gnm_sog_get_object_target_list):
	do not add image targets from there.

2006-09-29  Jody Goldberg <jody@gnome.org>

	* component/gnumeric.c : add an include to suppress a warning.

2006-09-28  Morten Welinder  <terra@gnome.org>

	* src/clipboard.c, src/clipboard.h: undo partial list->hash
	change.

2006-09-24  Jean Brefort  <jean.brefort@normalesup.org>

	* src/sheet-object-graph.c: removed unused and deprecated header
	(gog-renderer-svg.h).	

2006-09-23  Jody Goldberg <jody@gnome.org>

	* configure.in : bump gsf req to 1.14.2 for some of xml fixes.

2006-09-17  Jody Goldberg <jody@gnome.org>

	* src/application.c (gnumeric_application_setup_icons) : Add DataSlice
	  icon.

2006-09-17  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_select_all) : do not move the edit
	  position.

2006-09-16  Jody Goldberg <jody@gnome.org>

	* configure.in : bump the libgda version dep.
	  We now use the fully GValue based api.

2006-09-15  Morten Welinder  <terra@gnome.org>

	* src/gnm-format.c (find_entry): Make sure floating point values,
	notably negative ones, get the right format.  #356140.

2006-09-10  Jean Brefort  <jean.brefort@normalesup.org>

	* component/gnumeric.c: (go_plugin_init): add a call to
	go_components_set_mime_suffix.

2006-09-08  Eduardo Lima <eduardo.lima@indt.org.br>

	* src/gui-file.c (gui_file_save_as): Added file type combo box to file
	chooser dialog for Maemo.
	(gui_file_open): ditto.

2006-09-02  Emmanuel Pacaud <emmanuel.pacaud@lapp.in2p3.fr>

	* src/sheet-control-gui.c (cb_select_all_btn_expose): small display
	fix.

2006-09-02  Emmanuel Pacaud <emmanuel.pacaud@lapp.in2p3.fr>

	Update of column/row header look and fixes for rtl mode.

	* src/gnumeric-canvas.c (gnm_canvas_find_col): use new
	gnm_canvas_x_w2c function.
	(gnm_canvas_compute_visible_region): use gnm_canvas_x_w2c instead of
	removed gnm_simple_canvas_x_w2c.
	(gnm_canvas_redraw_range): ditto.
	(gnm_canvas_window_to_coord): last pixel is allocation.width - 1.
	* src/gnumeric-canvas.h (gnm_foo_canvas_x_w2c): new.
	(gnm_canvas_x_w2c): new.
	* src/gnumeric-simple-canvas.c (gnm_simple_canvas_x_w2c): removed.
	* src/item-bar.c (ib_draw_cell): change bar item look to somehting
	less bulky.
	(item_bar_draw): ditto.
	* src/item-cursor.c (item_cursor_update): use of gnm_foo_canvas_x_w2c
	instead of gnm_simple_canvas_x_w2c.
	* src/item-edit.c (ie_layout): ditto.
	* src/sheet-control-gui.c (scg_redraw_headers): ditto.
	(scg_resize): fix for foo_canvas_set_scroll_region in rtl mode. When 
	setting a canvas scroll region to [x0 .. x1[ , pixel x1 is not displayed.
	That's why we set scroll region to [-FACTOR + 1 .. +1[ in rtl mode, 
	because we want x(ltr) = - x(rtl).
	(cb_select_all): removed.
	(cb_select_all_btn_expose): select all button is converted to a
	GtkDrawingArea, so we provide a custom rendering method here, in sync
	with item-bar.c.
	(cb_select_all_btn_event): new.
	(bar_set_left_col): use of calc_left_row_position.
	(gnm_canvas_set_top_row): ditto.
	(gnm_canvas_set_top_left): ditto.
	(resize_pane_pos): fix for rtl mode.
	(sheet_control_gui_new): select all button is converted to a
	GtkDrawingArea.
	(scg_scale_changed): update frozen pane handle position.

2006-08-23  Christian Neumair  <chris@gnome-de.org>

	* src/widgets/gnumeric-expr-entry.c: (cb_icon_clicked),
	(gee_set_property): Allow to toggle window size when clicking
	expression entry in dialogs.

2006-08-19  Jody Goldberg <jody@gnome.org>

	* src/gnm-format.c (find_entry) : re-fix 142474 do not use the last
	  element as a catch all.  If nothing matches use General.

	* src/wbcg-actions.c (actions) : Add EditSelectAllXL with accelerator
	  ctrl-a for backwards, and ms compat.
	* src/GNOME_Gnumeric-gtk.xml.in : add it to the accelerator list.

2006-08-11  Emmanuel Pacaud <emmanuel.pacaud@lapp.in2p3.fr>

	Fix for #342582.
	
	* src/gnumeric-pane.c (cb_pane_drag_motion): update cursor wrt
	control key state of source_widget window.
	(gnm_pane_object_start_resize): don't duplicate sheet object here.
	* src/sheet-control-gui.c (scg_drag_receive_same_process): duplicate
	sheet object when dropping with control key pressed.

2006-08-17  Emmanuel Pacaud <emmanuel.pacaud@lapp.in2p3.fr>

	* src/wbc-gtk.c (wbc_gtk_set_action_label): don't display "Nothing"
	when suffix == NULL, just prefix.

2006-08-09  Eduardo Lima  <eduardo.lima@indt.org.br>

	Port to Maemo/Hildon 2.0 (Nokia 770 OS2006).

	* configure.in: Clean up Maemo/Hildon configuration.

	* src/Makefile.am: Added $(HILDON_CFLAGS) and $(HILDON_LIBS) vars.

	* src/HILDON_Gnumeric-gtk.xml.in: Merged with GNOME_Gnumeric-gtk.xml.in.

	* src/widgets/gnumeric-expr-entry.c (gee_init): Set property "autocap"
	of the entry to FALSE if defined HILDON.

	* src/workbook-control-gui-priv.h: Using the new HildonProgram/Window
	API instead of the deprecated HildonApp/Appview.

	* src/workbook-control-gui.c: Clean up. Using the new
	HildonProgram/Window API instead of the deprecated HildonApp/Appview.

	* src/wbcg-actions.c: Clean up. Using the new HildonProgram/Window
	API instead of the deprecated HildonApp/Appview.

	(cb_edit_undo_last): New. Added in place of cb_edit_undo for action
	"UndoLast".
	(cb_edit_redo_last): New. Added in place of cb_edit_redo for action
	"RedoLast".

	* src/wbc-gtk.c: Clean up. Using the new HildonProgram/Window API
	instead of the deprecated HildonApp/Appview.

	* src/main-application.c: Changed gnumeric version in call to
	osso_initialize() if defined HILDON.

	* src/gui-file.c: Clean up.

	* src/item-grid.c: Clean up.

2006-08-04  Morten Welinder  <terra@gnome.org>

	* src/clipboard.c (paste_cell): Old cell_relocate linked the dep
	for us.  Thus we now need to ask cell_set_expr_and_value to do that.
	Note: now all callers to cell_set_expr_and_value has TRUE as last
	argument.

2006-08-03  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (sheet_cells): Actually respect "comments" argument.

	* src/commands.c (cmd_paste_copy_impl): Add () to clarify.

	* src/sheet.c (re_render_formulas): Use sheet_cell_foreach, not
	SHEET_FOREACH_DEPENDENT.
	(sheet_set_hide_zeros): Use sheet_cell_foreach, not
	sheet_foreach_cell_in_range.
	(cb_rerender_zeroes): Adapt to sheet_set_hide_zeros change.
	(sheet_cells): Use sheet_cell_foreach, not
	sheet_foreach_cell_in_range.

	* src/workbook-control-gui.c (cb_workbook_debug_info): Use
	sheet_cell_foreach, not sheet_foreach_cell_in_range.

	* src/xml-sax-write.c (xml_write_cells): Use sheet_cell_foreach,
	not sheet_foreach_cell_in_range.

	* src/dependent.c (dependent_eval): Make this static.  Move
	dependent_needs_recalc check to caller.  Change to void result.

	* src/validation.c (validation_eval): Use cell_eval, not
	dependent_eval.

2006-08-02  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/sheet.c (sheet_new_with_type): specify sheet for Print_Area
	  range

2006-08-01  Morten Welinder  <terra@gnome.org>

	* src/gui-clipboard.c (cellregion_to_string): Allocate only 1 byte
	per cell, not 20.  Allocate further 20 bytes per non-blank cell.
	Fixes #348922.

2006-07-31  Morten Welinder  <terra@gnome.org>

	* src/style.c (gnm_pango_context_get): Avoid leaking font maps in
	the no-screen case.

	* src/workbook-control-gui.c (wbcg_sheet_order_changed): Fix
	methodology and thus probably #349255.

2006-07-25  Jody Goldberg <jody@gnome.org>

	* src/cell.c (cell_relocate) : merge into clipboard.
	* src/ranges.c (range_parse) : renamed from parse_range and the
	  original unused range_parse was deleted.

	* src/sheet.c (sheet_range_trim) : renamed from range_trim.  It makes
	  more sense here.
	(sheet_range_has_heading) : renamed from range_has_header.

2006-07-19  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/commands.c (cmd_paste_copy_impl): don't forget comments
	(cmd_paste_copy): use undo_range_name rather than range_as_string 
	  to use sheet name according to preferences

2006-07-18  Morten Welinder  <terra@gnome.org>

	* src/application.c (gnm_app_workbook_get_by_name): Handle empty
	name.  Fixes #347916.

2006-07-17  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/commands.c (cmd_unmerge_cells_undo): make sure we are moving the
	  comment back into place #347536
	(cmd_unmerge_cells_redo): don't leave the comments behind #347536
	(cmd_merge_cells_undo): also put the comments back #347536

2006-07-16  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/sheet.c (sheet_get_comment): If the position is in a 
	  merged region we have to search for comments in the whole
	  region.
	
2006-07-11  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/commands.c (cmd_define_name): handle _ in names used in 
	  descriptor text

2006-07-06  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/GNOME_Gnumeric-gtk.xml.in: add print area commands to File
	  menu
	* src/commands.c (cmd_define_name): add optional descriptor argument
	* src/commands.h (cmd_define_name): ditto
	* src/sheet.c (sheet_get_nominal_printarea): new
	(-sheet_get_printarea): use sheet_get_nominal_printarea
	* src/sheet.h (sheet_get_nominal_printarea): new
	* src/wbcg-actions.c (cb_file_print_area_set): new
	(cb_file_print_area_show): new
	(cb_file_print_area_sclear): new
	* src/workbook-control.c (wb_control_parse_and_jump): add argument 
	  to call of cmd_define_name
	
2006-07-04  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/gnumeric-gconf.c (go_conf_set_double): use real_key when 
	  writing the value #346433

2006-07-04  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/expr-name.c (expr_name_perm_add)): accept expressions rather 
	  than just strings
	* src/expr-name.h (expr_name_perm_add): ditto
	* src/print.c (compute_pages): use new sheet_get_printarea
	(print_sheet): ditto
	* src/sheet.c (sheet_get_printarea): new
	(sheet_new_with_type): create "Print_Area" permanent name
	* src/sheet.h (sheet_get_printarea): new

2006-06-30  Jody Goldberg <jody@gnome.org>

	* src/position.c (parse_pos_init_dep) : init the col/row too for
	  cells.  Fixes relocation.

2006-06-30  Morten Welinder  <terra@gnome.org>

	* src/sheet-autofill.c (afm_compute): Fix hanlding of decresing
	month sequences.  Fixes #346028.

2006-06-28  Jody Goldberg <jody@gnome.org>

	* src/xml-io.c (xml_init) : down grade priority and rename the DOM
	  exporter.  We default to SAX now.
	(xml_read_colrow_info) : fix import.
	* src/gnm-plugin.c (gnm_plugin_loader_module_func_exec_action) : do
	  not crash if there is no handler.

2006-06-30  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/dependent.c (MICRO_HASH_hash): extinguish warning #346045

2006-06-29  Ivan, Wong Yat Cheung <ivanwong@gnome.org>

	* plugins/excel/ms-excel-read.c (excel_read_LABEL): use opcode instead
	  of esheet_ver to determine the offset and bit count of LABEl text
	  length.

2006-06-27  Jody Goldberg <jody@gnome.org>

	* src/colrow.c (colrow_foreach) : really fix it.

2006-06-26  Jody Goldberg <jody@gnome.org>

	* src/colrow.c (colrow_foreach) : Fix last nights breakage.
	* component/gnumeric.c (cell_render_cairo) : make this compile again.

2006-06-25  Jody Goldberg <jody@gnome.org>

	* gnumeric.xsd : update a bit.
	* ColRowInfo::pos : removed.
	* ColRowInfo::margin_a	: removed.
	* ColRowInfo::margin_b	: removed.
	* GnmCell::col_info	: removed.
	* GnmValueErr::src	: removed.

	* src/colrow.c (colrow_foreach) : Pass a new type 'GnmColRowIter' to
	  the handler to provide a position and an info ptr.  All callers
	  changed.

	* src/sheet.c
	(sheet_col_size_fit_pixels) : use the constant margins
	(sheet_row_size_fit_pixels) : ditto and and add +1 for
	  the grid line (why was this different from col_size_fit_pixels).
	* src/dialogs/dialog-row-height.c (dialog_row_height) : row margin is
	  constant now.
	* src/dialogs/dialog-col-width.c (dialog_col_width) : ditto.

	* src/cell-draw.c (cell_calc_layout) : no need for ri, the margins are
	  constant.
	(cell_draw) : row margin is now constant too.
	(cell_finish_layout) : document height better and make the row
	  margins constant.

	* src/cellspan.c (row_calc_spans) : Take the position as an argument
	  now that ColRowInfo::pos is gone.  All callers changed.

2006-06-25  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/sheet.c (sheet_set_name): update the Sheet_Title name
	(sheet_new_with_type): Create Sheet_Title permanent name
	* src/expr-name.h (GnmNamedExpr): add is_permanent and is_editable
	  fields
	(expr_name_perm_add): new
	* src/expr-name.c (expr_name_new): initialize new fields
	(expr_name_add): avoid conflicts when permanent names are (re)loaded 
	  from files.
	(expr_name_perm_add): new

2006-06-22  Andreas J. Guelzow <aguelzow@pyrshep.ca>

	* src/gnm-plugin.c (plugin_service_function_group_get_description):
	  Fix ngettext call #345027
	(plugin_service_ui_get_description): ditto

2006-06-20  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_options_guess): Explicitly try a
	comma.  And don't crash if we fail to guess a separator.  Fixes
	#345477.

2006-06-16  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* samples/chart-stripe-tests.gnumeric: new.

2006-06-11  Jody Goldberg <jody@gnome.org>

	* src/cell-draw.c (cell_calc_layout) : Take the width as an argument
	  rather than calculating it here.
	(cell_draw) : width must be specified now.  No more magic < 0 implies
	  cur col width.  Width convention changed to include margins.

	* src/search.c (search_collect_cells) :  adjust to sheet_cells
	  signature change.

	* src/expr.h (GnmExprRelocateInfo) : convert pos from an EvalPos to a
	  ParsePos.  One day the distinction will go away, but for now
	  relocations do not need to know which dependent is being evaluated.
	* src/dependent.c (dependents_relocate) : adjust to that change.
	* src/sheet-autofill.c (afc_set_cell_hint) : ditto.

	* src/colrow.h (GNM_COL_MARGIN) : define.  Margins are going away, why
	  waste space and time looking up values that were constant.

	* src/cell.h : remove GnmCell::col_info.
	(cell_is_linked) : delete.  it was only used internally this model is
	  targeted for removal when cells move into the quadtree.

	* src/gnumeric.h : Change CellIterFunc signature to take a GnmCellIter
	  in place of all the distinct arguments.
	* src/auto-format.c (cb_af_suggest) : Adjust to signature change.
	* src/clipboard.c (cb_clipboard_prepend_cell) : ditto.
	* src/colrow.c (cb_clear_variable_width_content) : ditto.
	* src/func.c (cb_iterate_cellrange) : ditto.
	* src/graph.c (cb_assign_val) : ditto.
	(cb_assign_matrix_val) : ditto.
	* src/print.c (cb_range_empty) : ditto.
	* src/ranges.c (cb_find_extents) : ditto.
	* src/sheet-filter.c (cb_collect_unique) : ditto.
	(cb_filter_expr) : ditto.
	(cb_filter_non_blanks) : ditto.
	(cb_filter_blanks) : ditto.
	(cb_filter_find_items) : ditto.
	(cb_hide_unwanted_items) : ditto.
	(cb_filter_find_percentage) : ditto.
	(cb_hide_unwanted_percentage) : ditto.
	* src/sheet-view.c (cb_fail_if_not_selected) : ditto.

2006-06-09  Jody Goldberg <jody@gnome.org>

	* src/sheet-view.h (SheetView) : Add ::first_col_tab
	  to track the first column a user used Tab to move out of.
	* src/sheet-view.c (sv_set_edit_pos) : reset ::first_tab_col to -1.
	* src/selection.c (sv_selection_walk_step) : When moving vertically in
	  a singleton (hitting Enter) check to see if the previous movements
	  where done with Tab, and jump back to that column.  For horizontal
	  movement (hitting Tab) store the col or restore the previous
	  ::first_tab_col. #88167

2006-05-31  Jody Goldberg <jody@gnome.org>

	* component/gnumeric.c (cell_render_cairo) : Just look up the
	  col_info/row_info directly for now.  It's less efficient than using
	  GnmCell::col_info, but that is going away and this renderer will be
	  rewritten to use GnmRenderedRegion when it is done.

2006-05-31  Jody Goldberg <jody@gnome.org>

	* src/parser.y (gnm_expr_parse_str) : fix docs.  Add new behavior.
	  if conv is NULL use the conv from @pp::sheet

	* src/parse-util.c (parse_text_value_or_expr) : Use the current
	  ExprConv associated with the ParsePosition's sheet, not
	  gnumeric_default (fixes R1C1).
	(gnm_expr_parse_str_simple) : ditto.
	* src/ranges.c (global_range_list_parse) : ditto.
	* src/value.c (value_new_cellrange_str) : ditto.
	* src/workbook-edit.c (wbcg_edit_finish) : ditto.
	* src/widgets/gnumeric-expr-entry.c (gnm_expr_entry_parse) : ditto.

2006-05-31  Morten Welinder  <terra@gnome.org>

	* src/cell.c (cell_dup): Remove.

2006-05-26  Jean Brefort  <jean.brefort@normalesup.org>

	* samples/chart-tests.gnumeric: added new stepped plots samples.

2006-05-25  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_create_edit_area): Add tooltip
	for the debug button so we don't get a critical.

	* src/str.c (gnm_string_dump): New function for debugging.

	* src/dependent.c: Use new "compact set" implementation for the
	micro hash.  Use alternative (and very efficient) storage methods
	for 1-element sets and for {2,3}-element sets.
	(micro_hash_insert): When resizing, make sure the hash table end
	up somewhat dense.  (Since we are using a pool allocator for
	cells, the entries are extremely well distributed in the hash
	table.)

2006-05-25  Jean Brefort  <jean.brefort@normalesup.org>

	* samples/chart-tests.gnumeric: added series lines samples for
	bars and columns.

2006-05-25  Jean Brefort  <jean.brefort@normalesup.org>

	* component/gnumeric.c: (go_gnm_component_set_data),
	(go_gnm_component_draw): use GOImage for the cairo <-> pixbuf conversion.
	* src/application.c: replaced gi18n.h by gi18n-lib.h.
	* src/clipboard.c: ditto.
	* src/cmd-edit.c: ditto.
	* src/command-context-stderr.c: ditto.
	* src/command-context.c: ditto.
	* src/commands.c: ditto.
	* src/consolidate.c: ditto.
	* src/expr-name.c: ditto.
	* src/expr.c: ditto.
	* src/file-autoft.c: ditto.
	* src/format-template.c: ditto.
	* src/func-builtin.c: ditto.
	* src/func.c: ditto.
	* src/gnm-format.c: ditto.
	* src/gnm-graph-window.c: ditto.
	* src/gnm-plugin.c: ditto.
	* src/gnm-so-filled.c: (gnm_so_filled_draw_cairo): fixed a memory leak and
	the gi18n change.
	* src/gnm-so-line.c: replaced gi18n.h by gi18n-lib.h.
	* src/gnm-so-polygon.c: (gnm_so_polygon_draw_cairo),
	(gnm_so_polygon_class_init): new draw cairo function (not implemented)
	and ditto.
	* src/gnumeric-canvas.c: replaced gi18n.h by gi18n-lib.h.
	* src/gnumeric-pane.c: ditto.
	* src/gui-clipboard.c: ditto.
	* src/gui-file.c: ditto.
	* src/gui-util.c: ditto.
	* src/gutils.c: ditto.
	* src/history.c: ditto.
	* src/hlink.c: ditto.
	* src/input-msg.c: ditto.
	* src/item-bar.c: ditto.
	* src/item-cursor.c: ditto.
	* src/item-edit.c: ditto.
	* src/libgnumeric.c: ditto.
	* src/mathfunc.c: ditto.
	* src/number-match.c: ditto.
	* src/parser.y: ditto.
	* src/pivottable.c: ditto.
	* src/print-info.c: ditto.
	* src/print.c: ditto.
	* src/ranges.c: ditto.
	* src/search.c: ditto.
	* src/selection.c: ditto.
	* src/session.c: ditto.
	* src/sheet-autofill.c: ditto.
	* src/sheet-control-gui.c: ditto.
	* src/sheet-filter.c: ditto.
	* src/sheet-merge.c: ditto.
	* src/sheet-object-graph.c: ditto.
	* src/sheet-object-image.c: ditto.
	* src/sheet-object-widget.c: ditto.
	* src/sheet-object.c: ditto.
	* src/sheet-style.c: ditto.
	* src/sheet-view.c: ditto.
	* src/sheet.c: ditto.
	* src/stf-export.c: ditto.
	* src/stf-parse.c: ditto.
	* src/stf.c: ditto.
	* src/style.c: ditto.
	* src/validation.c: ditto.
	* src/value-sheet.c: ditto.
	* src/value.c: ditto.
	* src/wbc-gtk.c: ditto and set translation domain for actions.
	* src/wbcg-actions.c: replaced gi18n.h by gi18n-lib.h.
	* src/widgets/gnm-dao.c: ditto.
	* src/widgets/gnumeric-expr-entry.c: ditto.
	* src/widgets/gnumeric-lazy-list.c: ditto.
	* src/widgets/widget-font-selector.c: ditto.
	* src/workbook-cmd-format.c: ditto.
	* src/workbook-control-gui.c: ditto.
	* src/workbook-control.c: ditto.
	* src/workbook-edit.c: ditto.
	* src/workbook-view.c: ditto.
	* src/workbook.c: ditto.
	* src/xml-io.c: ditto.
	* src/xml-sax-read.c: ditto.

2006-05-22  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (wbcg_edit_start): Handle scientific as
	other number formats.

2005-05-22  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gui-clipboard.c (image_write): set a resolution, which will be
	used when pasting graph from gnumeric in raster format.

2006-05-18  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (cb_share_a_cell): Reinstate code.

	* src/expr.c (gnm_expr_sharer_new): Renamed from
	expr_tree_sharer_new.  Class renamed from ExprTreeSharer to
	GnmExprSharer.
	(gnm_expr_sharer_destroy): Renamed from expr_tree_sharer_destroy.
	(gnm_expr_sharer_share): Renamed form expr_tree_sharer_share and
	changed to use GnmExprTop.

2006-05-15  Morten Welinder  <terra@gnome.org>

	* src/gnm-graph-window.c: Handle missing GTK_STOCK_FULLSCREEN and
	GTK_STOCK_LEAVE_FULLSCREEN.

2006-05-14  Jean Brefort  <jean.brefort@normalesup.org>

	* component/gnumeric.c: (cairo_to_pixbuf): fixed and renamed,
	(go_gnm_component_set_data): use current selection as displayed area,
	(cell_render): set colors in the correct (RGB) order,
	(go_gnm_component_draw): skip hidden rows and columns,
	(go_gnm_component_print): print sheet objects,
	(go_gnm_component_init): updated,
	(go_gnm_component_class_init): removed unused properties.
	* src/gnm-so-filled.c: (gnm_so_filled_draw_cairo): don't use cairo if
	GOFFICE_WITH_CAIRO is not defined.	
	* src/gnm-so-line.c: (gnm_so_line_print): use correct color,
	(gnm_so_line_draw_cairo): implemented,
	(gnm_so_line_class_init): add draw_cairo.
	* src/sheet-object-graph.c: (gnm_sog_draw_cairo): implemented,
	(gnm_sog_class_init): add draw_cairo.
	* src/sheet-object.c: (sheet_object_draw_cairo): don't use cairo if
	GOFFICE_WITH_CAIRO is not defined.	

2006-05-13  Jean Brefort  <jean.brefort@normalesup.org>

	* src/expr.c: (ets_hash): use G_POINTER_TO_UINT instead of a cast
	(fixes a warning for 64 bits processors).

2006-05-13  Jody Goldberg <jody@gnome.org>

	* component/gnumeric.c : patch some warnings and make some comments.

	* src/gnumeric-pane.c (display_object_menu) : Use the new
	  sheet_object_populate_menu and clarify that so and event can be
	  NULL.
	(cb_pane_popup_menu) : if objects are selected use
	  display_object_menu.

	* src/sheet-object.c (sheet_object_populate_menu) : new and public.
	(sheet_object_populate_menu_real) : renamed from sheet_object_populate_menu
	  and make smarter to be able to handle so == NULL.

	* src/gnumeric-canvas.c (gnm_canvas_class_init) : delete some unused
	  variables.

	* src/clipboard.c (clipboard_copy_obj) : tidy up a bit, and prepare to
	  clean out the odd GObject data usage.

	* src/sheet-control-gui.c (scg_object_coords_to_anchor) : set the
	  direction.

	* src/wbcg-actions.c (permanent_actions) : Make Save and Save-As
	  permanent so that the user can always save.

	* src/xml-sax-write.c (gnm_xml_file_save) : accept saving to unnamed
	  files.

2006-05-12  Jean Brefort  <jean.brefort@normalesup.org>

	* component/gnumeric.c: (go_gnm_component_print): implemented.

2006-05-12  Jean Brefort  <jean.brefort@normalesup.org>

	* Makefile.am: add component directory.
	* component/Gnumeric-embed.xml.in: add a goffice component.
	* component/Makefile.am: ditto.
	* component/gnumeric.c: ditto.
	* component/plugin.xml.in: ditto.
	* configure.in: add support for the component.
	* src/gnm-plugin.c: make GnmPluginLoaderModule public.
	* src/gnm-so-filled.c: (gnm_so_filled_draw_cairo),
	(gnm_so_filled_class_init): render using cairo.
	* src/sheet-object-impl.h: add a draw_cairo method.
	* src/sheet-object.c: (sheet_object_draw_cairo): implement the
	new functionality.
	* src/sheet-object.h: ditto.
	* src/wbc-gtk.c: (wbc_gtk_init): add support for customized ui.

2006-05-11  Christian Neumair  <chris@gnome-de.org>

	* src/Makefile.am:
	* src/gnm-graph-window.c:
	* src/gnm-graph-window.h:
	* src/sheet-object-graph.c:
	Add graph window for displaying graph in separate windows, add
	action to graph context menu.

2006-05-10  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Bumped goffice dependency to reflect that goffice HEAD
	is needed as building against goffice 0.3.0 now fails.

2006-05-09  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wbv_save_to_output) : new function broken out
	  of wbv_save_to_uri for convenience.  This API will change.

	* src/sheet.c
	(sheet_insert_cols) : make reloc_storage arg optionally NULL.
	(sheet_delete_cols) : ditto.
	(sheet_insert_rows) : ditto.
	(sheet_delete_rows) : ditto.

2006-05-08  Morten Welinder  <terra@gnome.org>

	* src/style.c (style_font_new_simple): Copy font description
	early.  We aren't supposed to touch the result of
	pango_context_get_font_description!
	(gnm_font_metrics_new, gnm_font_metrics_free): Moved to goffice.

	* src/style-font.h: Add GOFont and GOFontMetrics members.  Remove
	PangoFontDescription member.

2006-05-08  Jody Goldberg <jody@gnome.org>

	* configure.in : post release bump

2006-05-08  Jody Goldberg <jody@gnome.org>

	* Release 1.7.0

2006-05-07  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in: Ensure pkg-config is recent enough to support private
	libraries. 
	* libspreadsheet-1.7.pc.in: libart-2.0 is not being exposed by
	libspreadsheet's headers; mark it as private.

2006-05-06  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_autofill_redo): Fit columns.

2006-05-06  Jody Goldberg <jody@gnome.org>

	* libspreadsheet-1.7.pc.in : new.
	* configure.in : Add it.
	* src/Makefile.am : install headers.  When we move to subversion we
	  can move the path around a bit, with cvs too much surgery would be
	  required.

2006-05-05  Jody Goldberg <jody@gnome.org>

	* src/dependent.h : s/DependentClass/GnmDependentClass/ to be
	  consistent.

2006-05-04  Morten Welinder  <terra@gnome.org>

	* src/item-cursor.c (item_cursor_selection_event): Add help
	messages explaining what is going on.
	(cb_autofill_scroll): Fix hint for inverse autofill.

2006-05-03  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_autofill_redo): Improve selection.

	* src/sheet-autofill.c (sheet_autofill_hint): New function.
	(sheet_autofill_internal): Split out from sheet_autofill.
	(afm_teach_cell): Deduce dateconv here instead of as an init
	paramter.
	(afa_teach_cell): Deduce dateconv here.
	(afa_set_cell): Set format correctly.

	* src/item-cursor.c (cb_autofill_scroll): Display autofill hint.
	(item_cursor_selection_event): Store button state.
	(item_cursor_autofill_event): Use CONTROL state as-of when we
	started the drag, not when we ended it.

	* src/cell-draw.c (cell_finish_layout): Add parameter to allow
	inhibiting numerical overflow.  All callers changed.

2006-05-02  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (cb_max_cell_width, cb_max_cell_height): Call
	cell_finish_layout.  Fixes #67351.

	* src/cell-draw.c (cell_finish_layout): Split out...
	* src/print-cell.c (print_cell): ...here.

	* src/rendered-value.c (rendered_value_new): Wrap texts only.

	* src/main-application.c (main): Gracefully handle missing
	AttachConsole.  #332975.  Modeled after patch by Harun Vos.

	* src/workbook.c (workbook_dispose): Remove debug code that no
	longer does anything but cause criticals.

2006-04-30  Jody Goldberg <jody@gnome.org>

	* src/Makefile.am : remove unused code associated with bonobo.  People
	  can pull it from cvs archives if desired.
		: bonobo-io.c
		: bonobo-io.h
		: sheet-object-bonobo.c
		: sheet-object-bonobo.h
		: sheet-object-container.c
		: sheet-object-container.h
		: sheet-object-item.c
		: sheet-object-item.h

2006-05-01  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): Always call the display logic for
	the cells as that can change the layouts.  (And do it right while
	we're at it.)

	* src/rendered-value.c (rendered_value_new): Expand
	rendered_value_render and setup the layout fully before rendering.
	Fix latent allocation problem.  Fix border case of filling strings
	that have number formats.

2006-04-29  Morten Welinder  <terra@gnome.org>

	* src/wbcg-actions.c: Put a decent status bar message for full
	screen mode.

2006-04-30  Jody Goldberg <jody@gnome.org>

	* src/mstyle.c (gnm_style_is_complete) : implement.

	* src/sheet-style.c (sheet_style_get) : returns a const to make it
	  clear not to touch the result.
	* src/workbook-view.c (wb_view_format_feedback) : update.
	* src/workbook-edit.c (wbcg_edit_finish) : update.

	* src/cell.c (cell_dup) : renamed from cell_copy to be more consistent
	  about naming, and mark as deprecated.

2006-04-29  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_get_index_in_wb) : new for xlsx export.

	* src/selection.h (sv_selection_foreach) : renamed from
	  selection_foreach_range.  All callers changed.
	* src/selection.c (sv_selection_add_full) : renamed from
	  sv_selection_add_range to be clearer.
	(sv_selection_add_range) : new utility that takes a ... GnmRange.

	* src/sheet-view.h : SheetView::selections make this a GSList, no need
	  for a GList.  This makes the api more homogeneous.

	* src/cell.c (cell_get_style) : constify the result and rename from
	  cell_get_mstyle.

	* src/ranges.c (range_as_string) : renamed from range_name.  All
	  callers fixed.

	* src/style-conditions.c (gnm_style_conditions_eval) : tack on hooks
	  for some of the new condition types in office 12.

2006-04-27  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_clone_sheet): Remove.

	* src/wbcg-actions.c (cb_edit_duplicate_sheet): Remove.

	* src/workbook-control-gui.c (wbcg_clone_sheet): New function,
	based on cmd_reorganize_sheets.
	(sheet_action_clone_sheet): Just call wbcg_clone_sheet.

	* src/workbook-edit.c (wbcg_edit_start): Issue a warning if the
	cell has text format, but contains anything but a string.

	* src/wbc-gtk.c (wbc_gtk_init_zoom): Add stock_id.  Not a perfect
	match, but close enough.

2006-04-26  Morten Welinder  <terra@gnome.org>

	* src/style.c (gnm_font_metrics_new, gnm_font_metrics_free,
	gnm_font_metrics_unit): New font metrics setup.

	* src/sheet.c (sheet_col_get_distance_pixels): New function.

	* src/cell.c (cell_get_render_color, cell_get_entered_text,
	cell_rendered_height, cell_rendered_width, cell_rendered_offset):
	Moved from src/rendered-value.c.

	* src/gnm-format.c (gnm_format_layout, gnm_format_general): New
	functions.
	(format_value_gstring): Use gnm_format_general.

	* src/rendered-value.c (rendered_value_render): Calculate column
	widths in pixels and use gnm_format_layout to get accurate
	rendering.  Take layout instead of string.
	(rendered_value_new): Set attributes before the call to
	rendered_value_render.

	* src/hlink.c (gnm_hlink_cur_wb_activate): Prevent a critical.
	#339793.

2006-04-25  Morten Welinder  <terra@gnome.org>

	* src/mstyle.c (gnm_style_get_font): Don't ref the font.  All
	callers changed.

2006-04-24  Morten Welinder  <terra@gnome.org>

	* */*.c: Avoid lots of includes of <gnm-format.h>

2006-04-23  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_reorganize_sheets): Rename from
	cmd_reorganize_sheets2.  Take extra argument optionally specifying
	the front sheet before the action.
	(cmd_reorganize_sheets_undo, cmd_reorganize_sheets_redo): Raise
	relevant sheet.  Fixes #154705.

2006-04-21  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_options_guess): If we guessed a space
	separator that implies we want initial separators ignored.
	Further, space implies tab.
	(stf_parse_options_csv_set_trim_seps): New function.
	(stf_parse_csv_line): Ignore initial separators if asked to.
	Fixes #339297.

2006-04-20  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_options_guess): When we guess a space
	as separators, make two count as one.  Fixes #332997.

	* src/wbc-gtk.c (wbc_gtk_init_zoom, wbc_gtk_init_font_size,
	wbc_gtk_init_font_name): Add tooltip.  Together with goffice patch,
	this fixes #339122.

2006-04-19  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_paste_copy_impl, cmd_autofill_undo,
	cmd_copyrel_undo, cmd_text_to_columns_impl, cmd_paste_cut_redo,
	cmd_paste_cut_undo): Simplify using select_range.
	(cmd_set_text_undo, cmd_set_text_redo): Call select_range.
	(cmd_clear_undo): Simplify using select_selection.
	(cmd_clear_redo, cmd_format_redo, cmd_format_undo): Call
	select_selection.
	(select_range, select_selection): New functions.

2005-04-19  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gui-clipboard.c (image_write): sheet_object_write_image takes an
	extra parameter for export resolution.
	* src/sheet-control-gui.c (scg_drag_send_image): ditto.
	* src/sheet-object-image.c (gnm_soi_write_image): ditto.
	* src/sheet-object-impl.h: ditto.
	* src/sheet-object.c (sheet_object_write_image): ditto.
	* src/sheet-object-graph.c (gnm_sog_write_image): ditto.
	(sog_cb_save_as): ditto. Get resolution from gui_get_image_save_info.
	
2006-04-19  Morten Welinder  <terra@gnome.org>

	* src/sheet.c (sheet_apply_style): Don't re-fit heights here.
	Don't redraw twice.
	(sheet_apply_border): Don't redraw twice.
	(cb_max_cell_height): Drop cheap hack that didn't work on
	multi-line text.

	* src/commands.c (cmd_format_undo): Undo in reverse order of redo.
	(cmd_format_redo): Use colrow_autofit.

2006-04-19  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_set_text_redo): Autofit row heights for
	string constants.

	* src/sheet.c (sheet_col_size_fit_pixels): Add extra argument to
	control whether to ignore strings.  All callers changed.
	(sheet_row_size_fit_pixels): Similarly.

2006-04-18  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_set_text_redo): Autofit column based on
	cell's width.

	* src/sheet.c (sheet_col_size_fit_pixels): Take two extra
	arguments specifying the row interval to look at.  All callers
	changed.
	(sheet_row_size_fit_pixels): Similarly.

	* src/colrow.c (colrow_autofit): New primitive to autofit columns
	or rows based on the size of a range.
	(rows_height_update): This is now a special case of
	colrow_autofit.

2006-04-18  Morten Welinder  <terra@gnome.org>

	* src/workbook-view.c (wb_view_save_as, wb_view_save,
	wb_view_sendto): Hold a ref to the workbook while the save is in
	progress.  Makes #338847 go away, even if the underlying cause has
	not been fixed.

	* src/wbc-gtk.c (cb_regenerate_window_menu): Safely handle a
	control that no longer has a view (and thus a workbook).

	* src/workbook-control.c (wb_control_get_workbook): Handle NULL
	view.
	* src/workbook-control-gui.c (wbcg_view_changed): Simplify after
	above change.

2006-04-16  Jody Goldberg <jody@gnome.org>

	* gnumeric.desktop.in : Add mimetype for MS Office 12.
	* po/POTFILES.in : add xlsx-read.c

2006-04-16  Jon K Hellan  <hellan@acm.org>

	* src/stf-export.c: Include locale.h to make it build again.

2006-04-15  Morten Welinder  <terra@gnome.org>

	* src/workbook-control.c (workbook_control_class_init): Add a
	"view" property.

	* src/workbook-view.c (wb_view_attach_control,
	wb_view_detach_control): Use g_object_set instead of poking
	directly into wbc->wb_view.  That's cleaner and will fire the
	notify signals.

	* src/workbook-control-gui.c (wbcg_view_changed): Install and
	disconnect workbook signals here.  Watch changes to "view" (which
	implies changes to underlying workbook) and reconnect signals.
	(wbcg_create): Call wbcg_view_changed to update title and watch
	for changes.

	* src/stf-export.c (gnm_stf_export_class_init): New "locale"
	property.
	(stf_export): Switch locale during actual export.

2006-04-15  Jody Goldberg <jody@gnome.org>

	* plugins/fn-info/functions.c : Add HALIGN_DISTRIBUTED and resync a
	  few cases.
	* plugins/html/latex.c (latex2e_write_multicolumn_cell) : ditto.
	* plugins/html/roff.c (roff_file_save) : ditto.
	* plugins/plan-perfect/pln.c (pln_get_style) : ditto.
	* src/cellspan.c (cell_calc_span) : ditto.
	* src/rendered-value.c (rendered_value_new) : ditto.
	* src/dialogs/cell-format.glade : ditto.
	* src/dialogs/dialog-cell-format.c : ditto.
	* plugins/html/html.c (write_cell) : add HALIGN_DISTRIBUTED and fix
	  VALIGN_DISTRIBUTED.
	* src/cell-draw.c (cell_calc_layout) : ditto.
	* src/item-edit.c (get_top_left) : ditto.

2006-04-13  Morten Welinder  <terra@gnome.org>

	* src/gnm-style-impl.h (GnmStyle): Rename content_locked to
	contents_locked and content_hidden to contents_hidden.  All users
	changed.

	* src/clipboard.h (GnmCellRegion): Rename content to contents and
	not_as_content to not_as_contents.  All users changed.

	* src/mstyle.c (gnm_style_get_contents_locked,
	gnm_style_get_contents_hidden, gnm_style_set_contents_locked,
	gnm_style_set_contents_hidden): Renamed from _content_.
	All callers changed.

	* src/clipboard.c (cellregion_cmd_size): New function.

	* src/commands.c (cmd_sort_undo): Do this by pasting old contents.
	Fixes #161890.

	* src/sheet-autofill.c (sheet_autofill_dir): Add support for
	quarters.  Fixes #61650.
	(auto_filler_list): Number is fixed-width.

2006-04-12  Morten Welinder  <terra@gnome.org>

	* src/expr.c (bin_arith): Don't look closely if the result is an
	int because it no longer matters.

	* src/number-match.c (format_match_decimal_number): Fix FMR.
	(format_match_simple): Don't do the integer dance.  (And don't do
	it with two left feet either.)

2006-04-11  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match): When we currently have a date
	format, don't try to match a time.  This has the effect of not
	having "2005" interpreted as about 8 O'clock.
	(format_match_datetime): Handle 2005/5 and 5/2005 too.

2006-04-07  Morten Welinder  <terra@gnome.org>

	* src/test-harness.c (main): Don't use value_get_as_int.

	* src/workbook-edit.c (wbcg_edit_start): Standardize formats for
	time and date entry too.

	* src/rendered-value.c (rendered_value_render): Do not convert to
	unicode minus if the format is date.

	* src/expr-name.c (expr_name_set_expr): Queue deps for recalc.
	Fixes rest of #312610.

	* src/workbook-edit.c (wbcg_edit_start): Reformat numbers as
	general for editing so we don't hide decimals.  Kill extra spaces
	for fraction formats.  Improve cursor positioning for percentages.

	* src/commands.c (cmd_remove_name): New function.

2006-04-06  Jody Goldberg <jody@gnome.org>

	* src/sheet-control-gui.c (scg_image_create) : dragging in a new image
	  should not resize existing objects being edited, drag back to
	  sheet_mode before creation.

2006-04-06  Morten Welinder  <terra@gnome.org>

	* src/gui-util.c (gnumeric_keyed_dialog): Guess alternative button
	order.

2006-04-06  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=314866
	* src/sheet-control-gui.c (scg_drag_receive_same_process) : store the
	  current position as the original before we commit.
	* src/gnumeric-pane.c (cb_pane_drag_end) : restore the ctrl points to
	  the 'original' position in case the drag was canceled.  Hence the
	  magic in scg_drag_receive_same_process.
	  (cb_pane_drag_leave) : 

2006-04-05  Morten Welinder  <terra@gnome.org>

	* src/rendered-value.c (rendered_value_render): Resolve formats
	the same way as cell_get_format.

2006-04-05  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c : Use shift/ctrl space for select col/row/all
	  even though this is just for show.  The accels are handled
	  in gnumeric-canvas.
	* src/gnumeric-canvas.c (gnm_canvas_key_press) : re-organize to
	  clarify when to handle things.
	(gnm_canvas_colrow_key_press) : new.

2006-04-05  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_help_docs) : Use 'yelp help:gnumeric'
	* gnumeric.desktop.in (DocPath) : add an entry so that things show up
	  in yelp (at least for suse 10.1)

2006-04-01  Jody Goldberg <jody@gnome.org>

	http://bugzilla.gnome.org/show_bug.cgi?id=336212
	* src/func.c (function_iterate_argument_values) : This is ugly but it
	  seems to do the right thing.  We can not just assume that args to
	  vararg functions should be evaluated as non-scalars.  It is more
	  subtle.  Simple range_refs (direct or via a name) are non-scalar,
	  but general expressions that use a range (A1:A10=3) evaluate
	  depending on the top level mode, and honor implicit
	  intersecion/iteration.

	* src/position.h : Replace the cols/rows elemnts of GnmEvalPos with a
	  GnmExprArrayCorner pointer.  This allows us to differentiate normal
	  evaluation and singleton arrays.  As a side benefit it uses less
	  memory no 32bit architecture which is important as long as we still
	  use recusion for the recalc queue.

	* src/position.c (eval_pos_init) : adjust to GnmEvalPos change.
	(eval_pos_init_pos) : ditto.
	(eval_pos_init_dep) : ditto.
	(eval_pos_init_cell) : ditto.
	(eval_pos_init_sheet) : ditto.
	* src/expr.c (gnm_expr_eval) : ditto.
	* src/func-builtin.c (gnumeric_table_link) : ditto.
	(gnumeric_table) : ditto.
	* src/dependent.c (link_expr_dep) : ditto.
	* plugins/fn-lookup/functions.c (gnumeric_row) : ditto.
	(gnumeric_col) : ditto.

2006-04-01  Jody Goldberg <jody@gnome.org>

	* src/xml-sax-write.c : Add include to suppress warning.

2006-04-05  Morten Welinder  <terra@gnome.org>

	* src/search.c (gnm_search_replace_cell): Only force strings to
	remain as strings if asked to.
	(gnm_search_replace_class_init): New property
	replace-keep-strings.

	* src/commands.c (cmd_search_replace_do_cell): Fix error
	expression handling to go through expressions.
	(cmd_search_replace_do_cell): Plug leak in make-string case.

2006-04-04  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_cellregion_read): Switch to C locale while
	parsing.  Fixes #337215.

	* src/parser.y (array_exp): Handle explicit "+" sign.

2006-03-31  Morten Welinder  <terra@gnome.org>

	* */*.c: Get rid of VALUE_INTEGER.  It was a nice idea, but
	getting the semantics right meant doing everything twice, in code
	as well as at runtime.  Note, that the magic enum value (30) is
	still understood by value_new_from_string so we can still read old
	xml files.

2006-03-31  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (gcd): Remove.
	* src/sheet-view.c (sv_get_control): Remove.
	* src/stf-parse.c (stf_parse_options_remove_line_terminator): Remove.
	* src/value.c (value_new_error_RECALC, value_array_resize): Remove.

	* src/workbook-view.c (wb_view_sheet_remove): Remove.
	* src/ranges.c (range_adjacent, range_merge, range_is_infinite,
	gnm_sheet_range_dup): Remove.
	* src/sheet-control-gui.c (scg_toplevel): Remove.

	* src/print-info.c (hf_formats_base_num): Make static.
	* src/number-match.c (datetime_locale): Make static.

2006-03-30  Morten Welinder  <terra@gnome.org>

	* */*.c: Use VALUE_IS_STRING, VALUE_IS_ERROR, VALUE_IS_BOOLEAN,
	and VALUE_IS_EMPTY when appropriate.

	* */*.c: Reduce the use of VALUE_INTEGER.
	* parser.y: Fix parser crash for ={-#N/A}.

	* src/expr.c (negate_value): Simplify.
	(bin_arith): Simplify and handler overflow better.

	* src/cell.c (cell_is_zero): Simplify.

	* src/gui-util.c (entry_to_int): Accept floating point values as
	long as they hold integers of the right magnitude.

2006-03-29  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_top_get_array_corner,
	gnm_expr_top_is_array_elem): New functions.

2006-03-29  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* src/libgnumeric.c (gnm_common_init, gnm_shutdown),
	src/number-match-test.c (main): Dropped calls to format_match_init and
	format_match_finish.

2006-03-29  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_finish, format_match_init):
	Remove.

2006-03-28  Morten Welinder  <terra@gnome.org>

	* src/sheet-autofill.c (sheet_autofill_dir): Reimplement sanely.
	(autofill_shutdown): New function.

	* src/libgnumeric.c (gnm_shutdown): Hook up autofill_shutdown.

	* src/number-match.c (datetime_locale_setup): Use
	go_date_month_name.

	* src/sheet.c (cb_cell_is_array): Redo in terms of cell_is_array.
	(cb_sheet_cell_copy): Simplify using cell_is_array_corner.

2006-03-28  Eduardo Lima <eduardo.lima@indt.org.br>

	* src/gui-file.c (gui_wb_view_show) : Fixed compile error if defined
	USE_HILDON. Added some comments.
	* src/wbgc-actions.c (cb_file_new) : Fixed compile error if defined
	USE_HILDON. Added some comments. Code cleanup.

2006-03-27  Jody Goldberg <jody@gnome.org>

	* src/value-sheet.c (value_area_get_x_y) : document that this does a
	  cell_eval for range constants.

2006-03-27  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_top_new_array_corner,
	gnm_expr_top_new_array_elem): New function.
	(gnm_expr_new_array_corner, gnm_expr_new_array_elem): Make static.
	All callers changed to _top_ versions.

2006-03-24  Jody Goldberg <jody@gnome.org>

	* src/wbcg-actions.c (cb_auto_filter) : adding an autofilter dirties
	  the workbook.

	* src/gui-util.c
	* src/sheet-object-widget.c
	* src/workbook-control-gui.c
	* src/dialogs/dialog-autoformat.c
	* src/dialogs/dialog-stf-preview.c : use g_object_ref_sink if it is
	  available.

	* src/gnm-so-polygon.c (gnm_so_polygon_set_property) : minor safety
	  check.

2006-03-23  Morten Welinder  <terra@gnome.org>

	* src/gnm-datetime.c (datetime_value_to_g): Check validity of
	date.

2006-03-22  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_vector_get_value) : handle blanks without
	  an error.

2006-03-16  Jody Goldberg <jody@gnome.org>

	* Makefile.am : Drop the .server, .keys, and .mime files as obsolete.

2006-03-14  Jody Goldberg <jody@gnome.org>

	* src/sheet.c (sheet_dup) : dup the properties too.

2006-03-22  Morten Welinder  <terra@gnome.org>

	* src/validation.c (validation_eval): Clean this up.  Handle
	errors, strings and booleans better.

	* src/sheet-filter.c (filter_expr_eval): Fix last fix.

	* src/validation.c (cb_validate_custom): Use value_compare, not
	value_equal.  Fixes #114086 and makes string match caseless too.

	* src/workbook-control-gui.c (edit_area_button): Set tooltips
	here.
	(wbcg_create_edit_area): Make the line that contains the edit area
	a gtktoolbar so it themes like one.

2006-03-21  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (wb_rel_uri): New function to produce relative
	URIs for inter-workbook references.

2006-03-19  Morten Welinder  <terra@gnome.org>

	* src/value.c (value_diff): Merge integer and floating-point cases
	thus fixing an overflow.

2006-03-18  Jody Goldberg <jody@gnome.org>

	* src/graph.c (gnm_go_data_vector_get_value) : init valid to false
	  in case value_coerce_to_number fails and does not set it.

	* src/gnumeric-pane.c (cb_sheet_object_view_destroyed) : handle life
	  cycle change.

2006-03-18  Morten Welinder  <terra@gnome.org>

	* src/gnumeric-pane.c (cb_sheet_object_view_destroyed): Fix crash
	exposed by foocanvas fixes.  [#335052]

	* src/mathfunc.c (combin, permut): Changed parameter types to
	gnm_float.

	* src/parse-util.c (wbref_parse): Take reference wb in case a URI
	is relative.  All callers changed.

	* src/application.c (cb_workbook_uri): Renamed from
	cb_workbook_name.
	(gnm_app_workbook_get_by_uri): Renamed from
	gnm_app_workbook_get_by_name.
	(gnm_app_workbook_get_by_name): New function that tries URI,
	absolute filename, and relative URI.

2006-03-17  Morten Welinder  <terra@gnome.org>

	* src/application.c (gnm_app_workbook_get_by_index,
	gnm_app_workbook_get_by_name): s/close/closure/.  (The former is
	reserved by libc.)
	(cb_workbook_index): Actually set a result.

	* src/item-edit.c (item_edit_dispose): Rename from
	item_edit_finalize and hook up as such.  Otherwise it may not get
	run.
	* src/item-bar.c (item_bar_dispose): Ditto.

	* src/preview-grid.c (preview_grid_dispose): Rename from
	preview_grid_destroy and hook up as such.

2006-03-16  Morten Welinder  <terra@gnome.org>

	* src/style-border.h (STYLE_BORDER_LOCATION_TO_STYLE_ELEMENT): New
	translation macro that produces a value of the right type.

	* src/wbc-gtk.c (cb_border_activated): Use STYLE_BORDER_LEFT, not
	MSTYLE_BORDER_LEFT, for argument to style_border_get_orientation!
	Ditto for _RIGHT.

	* src/cell.c (cell_copy): Silence a "sparse" warning.

	* src/wbcg-actions.c (wbcg_set_selection_valign): Compare valign
	with the result of gnm_style_get_align_v, not
	gnm_style_get_align_h.

	* src/cell.h (cell_eval): Fix "sparse" warning and add "do { }
	while(0)" wrapper.

	* src/auto-format.c (do_af_suggest): Don't compare value types
	against GNM_EXPR_OP_ARRAY_CORNER and GNM_EXPR_OP_ARRAY_ELEM.

	* src/gnm-style-impl.h (GnmStyle): The v_align is not of type
	GnmHAlign. Really.

	* src/xml-sax-read.c (xml_sax_object_start): Use NULL, not FALSE.
	* src/xml-io.c (xml_read_sheet_object): Ditto.
	* src/expr.c (gnm_expr_top_is_err): Ditto.

2006-03-15  Morten Welinder  <terra@gnome.org>

	* src/collect.c (float_range_function2): When things are being
	stripped away, adjust the number of data pairs.  Fixes #334591.

2006-03-14  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_rewrite): Use gnm_expr_new_funcallv and
	gnm_expr_new_setv.
	(gnm_expr_new_funcallv, gnm_expr_new_setv): New functions.
	(gnm_expr_free): Renamed from gnm_expr_unref.  Always to deep
	free.  All callers changed.
	(gnm_expr_copy): Deep copy.

	* src/clipboard.c (paste_cell_with_operation): Build a regular
	expressions.  No hacks.

	* src/collect.c (collect_floats): When collecting info, walk over
	blanks too.

	* src/expr.c (gnm_expr_top_unwrap): Remove.  All callers changed.

	* src/preview-grid.c (preview_grid_destroy): Renamed from
	preview_grid_finalize and hooked up as destroy handler.  This
	breaks ref cycles and thus plugs leaks.

2006-03-13  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_sheet_read): Handle "protected" attribute.
	* src/xml-sax-read.c (xml_sax_sheet_start): Ditto.
	* src/xml-sax-write.c (xml_write_sheet): Ditto.
	Patch from Klokan Petr Pridal.  [#334257]

2006-03-11  Morten Welinder  <terra@gnome.org>

	* src/xml-sax-write.c (xml_write_cell_and_position): Wow.  Botched
	every single expression and every single value.

2006-03-10  Jody Goldberg <jody@gnome.org>

	* src/workbook-view.c (wb_view_sendto) : minor warning suppression.

2006-03-10  Morten Welinder  <terra@gnome.org>

	* src/expr.h (GnmExprTop): New type for top-level expressions.
	* src/clipboard.h (GnmCellCopy): Use a top-level expression here.
	Rename it to "texpr" to make sure we catch all users.  All users
	changed.
	* src/dependent.h (GnmDependent): Ditto.
	* src/expr-name.h (GnmNamedExpr): Ditto.
	* src/style-conditions.h (GnmStyleCond): Ditto.
	* src/validation.h (GnmValidation): Ditto.

	* src/expr.c (gnm_expr_top_new, gnm_expr_top_new_constant,
	gnm_expr_top_ref, gnm_expr_top_unref, gnm_expr_top_unwrap,
	gnm_expr_top_is_shared, gnm_expr_top_is_err,
	gnm_expr_top_is_rangeref, gnm_expr_top_get_constant,
	gnm_expr_top_contains_subtotal, gnm_expr_top_referenced_sheets,
	gnm_expr_top_first_funcall, gnm_expr_top_get_boundingbox,
	gnm_expr_top_rewrite, gnm_expr_top_get_ranges, gnm_expr_top_equal,
	gnm_expr_top_as_string, gnm_expr_top_as_gstring,
	gnm_expr_top_eval, gnm_expr_top_get_ranges): New functions.  Many
	non-top versions made static.
	(gnm_expr_copy): New function replacing gnm_expr_ref.  (Still
	simply refs, but not for long.)

	*/*.c: Massive changes adapting to the above.

	* src/rendered-value.c (rendered_value_recontext): Make sure
	wrap_text is only cleared when we clear the layout's width.
	Fixes #334144.

2006-03-09  Morten Welinder  <terra@gnome.org>

	* src/sheet-filter.c (filter_expr_eval): Take GnmCell instead of
	its value for target.  Use formatted value in !src case.
	(filter_expr_init): String EQ and NE should not coerce to number.
	(collect_unique_elements): Limit menu text length.  Change hash
	key to formatted value instead of value.  Store formatted value,
	not GnmValue, in model.
	All this fixes #333809.

2006-03-06  Morten Welinder  <terra@gnome.org>

	* src/collect.c (callback_function_collect): Rename COLLECT_DATES
	flags to COLLECT_COERCE_STRINGS and make it make all kinds of
	strings.  All callers changed.

	* configure.in (ALL_LINGUAS): Undo last change -- it breaks the
	build.  "id" can go back when there is a po-functions translation
	too.
	(CFLAGS): Drop -Wmissing-format-attribute.

2006-03-06  Ahmad Riza H Nst  <rizahnst@eriagempita.co.id>

	* po/id.po: Added Indonesian translation, done by Imam Musthaqim <imam@infoflow.co.id>
	* configure.in: Added "id" (Indonesian) to the ALL_LINGUAS line.
			
2006-03-03  Eduardo Lima  <eduardo.lima@indt.org.br>

	* src/dialogs/dialog-doc-metadata.c: Code reformulation.
	* src/dialogs/doc-meta-data.glade: Adjusted some properties.
	* src/dialogs/help.h: defined GNUMERIC_HELP_LINK_METADATA.

2006-03-02  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_focus): Update menu
	feedback here for the case where a pristine workbook is replaced.

2006-03-01  Morten Welinder  <terra@gnome.org>

	* src/print-cell.c (print_cell): Fix zoom issue #332932.

2006-02-27  Morten Welinder  <terra@gnome.org>

	* src/expr.c (do_gnm_expr_unref): Plug leaks.

2006-02-26  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_create): Attach to notify::uri
	and notify::dirty in order to control window title.

	* src/workbook-control.c (wb_control_update_title): Remove.

	* src/workbook-control-priv.h (WorkbookControl): Remove
	"set_title" member.

	* src/commands.c (GnmCommand): Add "workbook_modified_before_do"
	member.
	(command_undo): If !workbook_modified_before_do, mark the workbook
	not modified after undo.
	(command_push_undo, command_redo): Setup
	workbook_modified_before_do.

	* src/workbook-priv.h: Add "pristine" member.

	* src/sheet.h (Sheet): Remove "modified" and "pristine" members.

	* src/sheet.c (sheet_mark_dirty): Renamed from sheet_set_dirty.
	Always mark dirty, so kill last argument.  All callers changed.

	* src/workbook.c (workbook_get_property, workbook_set_property):
	New functions.
	(workbook_class_init): Install workbook_get_property and
	workbook_set_property.  Install new properties "uri" and "dirty".
	Remove FILENAME_CHANGED signal and fix callers to use notify::uri.
	(workbook_sheet_add): Drop dirty argument.  Adding a sheet always
	dirties the workbook.  All callers changed.
	(workbook_mark_not_modified): New function.
	(workbook_set_dirty, workbook_is_dirty): Maintain a simply
	"modified" flag.
	(workbook_is_pristine): Maintain a simple workbook-level
	"pristine" flag.
	(workbook_set_placeholder, workbook_is_placeholder): Remove.
	(workbook_new_with_sheets): After adding sheets, mark workbook not
	modified and pristine.
	(workbook_sheet_attach_at_pos): Mark workbook dirty.
	(workbook_sheet_delete): Except during workbook destruction, mark
	workbook dirty.

2006-02-24  Morten Welinder  <terra@gnome.org>

	* src/workbook-control-gui.c (wbcg_sheet_remove): Simplify.
	(wbcg_get_scg): Rename from wbcg_sheet_to_page_index and changed
	to return the scg only.  Make static.  All callers changed.

	* src/workbook.c (workbook_sheet_remove_controls): Renamed from
	workbook_sheet_hide_controls.
	(cb_sheet_visibility_change): Remove.  The workbook doesn't care
	about sheet visibility.

	* src/workbook-control-gui.c (wbcg_sheet_add): Set
	SHEET_CONTROL_GUI here.  Do everything here for invisible sheets
	too, but hide the table widget.  Attach signals for visibility
	[new] and sheet tabs here, not in wbcg_sheet_focus.
	(disconnect_sheet_signals): Take an extra argument to control
	whether to clear all signals or just those for the active sheet.
	All callers changed.
	(cb_sheet_label_button_press): Use the scg for data and simplify.
	(wbcg_sheet_remove_all): Disconnect signals for all sheets.  Use
	gtk_widget_destroy to get rid of the page.
	(wbcg_page_index_to_sheet): Remove.  Expand left-over bits to
	callers.
	(wbcg_sheet_to_page_index): Simplify now that sheets are 1-1 with
	tabs.

	* src/sheet-control-gui.c (sheet_control_gui_new): Don't set
	SHEET_CONTROL_KEY here.

	* src/workbook-control-gui.c (SHEET_CONTROL_KEY): Move to here.
	* src/sheet-control-gui.h (SHEET_CONTROL_KEY): From here.

2006-02-23  Morten Welinder  <terra@gnome.org>

	* src/workbook-edit.c (wbcg_edit_start): Go to the end of the
	text.  Fixes #319311.

	* src/workbook-control-gui.c (edit_area_button): Use tool buttons,
	not plain buttons.  Fixes #331916.

2006-02-22  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_new_set): Don't unref the args, just free
	the list.

2006-02-21  Morten Welinder  <terra@gnome.org>

	* src/func.h (GnmFuncNodes) Switch to argc/argv mode.  All, and I
	mean all, users changed.

	* src/collect.c (float_range_function, string_range_function):
	Switch to argc/argv mode.  All callers changed.
	* src/func.c (function_iterate_argument_values): Ditto.

2006-02-19  Morten Welinder  <terra@gnome.org>

	* src/expr.c (gnm_expr_new_funcall1, gnm_expr_new_funcall2,
	gnm_expr_new_funcall3): New functions.

	* src/parser.y (build_logical): Use gnm_expr_new_funcall2.
	(build_not): Use gnm_expr_new_funcall1.

2006-02-19  Morten Welinder  <terra@gnome.org>

	* src/expr-impl.h (GnmExprFunction, GnmExprSet): Replace
	expression list by argc/argv members.  All users fixed.

	* src/func.c (function_call_with_exprs): Renamed from
	function_call_with_list and changed to argc/argv input.  All
	callers changed.

	* src/auto-format.c (do_af_suggest_list): Changed to argc/argv
	input.  All callers changed.

	* src/expr.c (gnm_expr_list_equal, gnm_expr_list_eq): Remove.

	* src/mstyle.c (gnm_style_dump): Dump non-localized format.

2006-02-18  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (toolbar_context_menu): Add an entry to hide the
	toolbar.

	* src/gnumeric-gconf.c (gnm_gconf_get_toolbar_position,
	gnm_gconf_set_toolbar_position): New functions.

	* src/wbc-gtk.c (cb_add_menus_toolbars): Load initial toolbar
	positions from gconf.
	(set_toolbar_position): Store toolbar positions in gconf.

2006-02-17  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init): Initialize three toolbar zones.
	(cb_add_menus_toolbars): Attach context menus to the toolbars and
	their handlebox.
	(set_toolbar_position, cb_set_toolbar_position,
	toolbar_context_menu, cb_toolbar_button_press,
	cb_handlebox_button_press): New functions implementing the toolbar
	context menu.
	(create_undo_redo): Create actions for vertical mode too.
	(toolbar_context_menu): Present a different menu when detached.

2006-02-16  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init_font_name): Set a stock id to avoid
	critical on very narrow windows.
	(wbc_gtk_init_font_size): Ditto, but throw in a label also.

2006-02-15  Morten Welinder  <terra@gnome.org>

	* src/wbc-gtk.c (wbc_gtk_init): Update undo/redo labels here
	before checking for duplicate keys.  This avoid #324692.

	* src/ssconvert.c (main): Don't compare argv with 3.  Really.

	* src/workbook-edit.c (wbcg_edit_start): Don't compare gboolean
	and pointers.

2006-02-14  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_time): Handle hhmmss.sss,
	hhmmss, hhmm, mmss, and mmss.ss.  (All with no separators.)
	(handle_year): Map missing year to current year.
	(format_match_datetime): Handle yearless dates.  Handle
	20041224:121213.

2006-02-12  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_datetime): Loosen the separator
	requirements when alphabetic month is being used.  Fixes #56168.

2006-02-12  Morten Welinder  <terra@gnome.org>

	* src/number-match.c (format_match_simple): Don't bother parsing
	as int first.
	(format_match): Redo.  No longer uses canned formats.

2006-02-06  Morten Welinder  <terra@gnome.org>

	* src/mathfunc.c (random_binomial): Make trial argument a
	gnm_float for increased range.
	(random_negbinom, random_hypergeometric): Similarly.

2006-02-05  Morten Welinder  <terra@gnome.org>

	* src/ssconvert.c (main): Convert to GOption.
	* src/ssindex.c (main): Convert to GOption.

2006-02-04  Morten Welinder  <terra@gnome.org>

	* src/gutils.c (gutils_init): Solver messages have no business
	here.
	* src/solver.h (SOLVER_MAX_TIME_ERR): Define here.

	* src/main-application.c (gnumeric_arg_parse): Plug leak.

2006-02-03  Eduardo Lima  <eduardo.lima@indt.org.br>

	* src/main-application.c (gnumeric_arg_parse): Call gnome_vfs_init()
	if defined USE_HILDON.
	(main): Call osso_initialize() and osso_deinitialize()
	* src/wbcg-actions.c (actions): 
	Inserted macros for "ViewFullScreen", "ViewZoomIn" and "ViewZoomOut"
	accelerators. 
	* src/HILDON_Gnumeric-gtk.xml.in: Removed File->Print.
	Removed View->Zoom.
	Inserted View->Zoom In.
	Inserted View->Zoom Out.

2006-02-03  Morten Welinder  <terra@gnome.org>

	* src/main-application.c (gnumeric_arg_parse): Switch to GOption
	infrastructure.

2006-02-01  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (std_sheet_name_quote, std_name_parser): New
	functions.
	(gnm_expr_conventions_new): Hook these up.

	* src/parser.y (yylex): Use convs->name_parser.

	* src/parse-util.h (GnmExprConventions): Replace
	unquoted_ascii_name_chars member by sheet_name_quote and
	name_parser members.
	(gnm_expr_conv_is_unquoted_char): Remove.

2006-01-30  Morten Welinder  <terra@gnome.org>

	* src/parse-util.c (sheetref_parse): Underscore is a letter for
	this purpose.

2006-01-27  Andreas J. Guelzow <aguelzow@taliesin.ca>

	http://bugzilla.gnome.org/show_bug.cgi?id=327278
	* src/gnumeric-gconf-priv.h (GNM_CONF_SORT_DEFAULT_HAS_HEADER): new
	* src/gnumeric-gconf.c (gnm_gconf_set_sort_has_header): new
	(gnm_conf_init_extras): initialize prefs.sort_default_has_header
	* src/gnumeric-gconf.h (gnm_gconf_set_sort_has_header): new
	(GnmAppPrefs): add sort_default_has_header field
	* src/wbcg-actions.c (sort_by_rows): skip header if the preferences
	  indicate that
	* schemas/gnumeric-general.schemas.in: add sort/default/has-header
	  schema

2006-01-24  Morten Welinder  <terra@gnome.org>

	* src/item-cursor.c (item_cursor_draw): Revert previous change.
	It breaks my system by making the dragging-the-little-square
	operation blind.

2006-01-24  Morten Welinder  <terra@gnome.org>

	* src/gnm-datetime.c (datetime_value_to_seconds): Kill.

2006-01-23  Morten Welinder  <terra@gnome.org>

	* src/expr.c (expr_init): Create two pools: one for small and one
	for large nodes.

	* src/expr-impl.h (GnmExpr): Merge oper and ref_count fields into
	one oper_and_refcount field.  Define accessors GNM_EXPR_GET_OPER
	and GNM_EXPR_GET_REFCOUNT.  All users changed.

2006-01-22  Jody Goldberg <jody@gnome.org>

	* src/expr-impl.h : arrays cannot be larger than 2^32 even on 64 bit
	  architectures.

2006-01-21  Morten Welinder  <terra@gnome.org>

	* src/parse-util.h (struct _GnmExprConventions): Replace
	ignore_spaces by new intersection_char member.  All users fixed.

	* src/parser.y (yylex): Handle RANGE_INTERSECTION as symbolic
	token by translating space or whatever to that.

	* src/parse-util.c (gnm_expr_conventions_new): Default
	intersection char is space.

	* src/expr.c (do_expr_as_string): Append the right intersection
	operator.

2006-01-21  Morten Welinder  <terra@gnome.org>

	* gnumeric.desktop.in (Categories): Add Math, Science, GNOME, GTK.

2006-01-21  Jody Goldberg <jody@gnome.org>

	* src/auto-format.c (do_af_suggest) : handle new GNM_EXPR_OP_ARRAY
	  mechanisms.
	* src/clipboard.c (cb_clipboard_prepend_cell) : ditto.
	* src/cmd-edit.c (sv_select_cur_array) : ditto.
	* src/dependent.c (link_expr_dep) : ditto.
	(unlink_expr_dep) : ditto.
	* src/expr-name.c (expr_name_check_for_loop) : ditto.
	* src/expr.c (gnm_expr_new_array_corner) : new,
	(gnm_expr_new_array_elem) : new.
	(gnm_expr_new_array) : delete.
	(do_gnm_expr_unref) : handle new mechanism.
	(gnm_expr_eval) : ditto.
	(gnm_expr_equal) : ditto.
	(do_expr_as_string) : ditto.
	(gnm_expr_rewrite) : ditto.
	(gnm_expr_first_func) : ditto.
	(do_referenced_sheets) : ditto.
	(gnm_expr_containts_subtotal) : ditto.
	(gnm_expr_get_boundingbox) : ditto.
	(gnm_expr_is_rangeref) : ditto.
	(ets_hash) : ditto.
	(expr_tree_sharer_share) : ditto.
	(gnm_expr_is_array) : delete.
	(array_elem_get_corner) : new.

	* src/cell.c (cell_is_array) : ditto.
	(cell_array_bound) : new.
	(cell_is_array_corner) : new.
	(cell_is_nonsingleton_array) : renamed from cell_is_partial_array.
	(cell_has_comment) : delete.

	* src/sheet.c (sheet_get_comment) : renamed from cell_has_comment_pos

2006-01-21  Jody Goldberg <jody@gnome.org>

	* configure.in : adjust to new goffice versioning

2006-01-19  Ivan, Wong Yat Cheung  <ivanwong@gnome.org>

	* src/Makefile.am: Build as non-console Win32 application by default.

	* src/main-application.c (main): Attach to an existing console (only 
	if there is one)

	* src/item-cursor.c (item_cursor_draw): Use GDK_XOR which is more
	common than GDK_EQUIV for drawing item cursor. Fixes #314210.

2006-01-13  Morten Welinder  <terra@gnome.org>

	* src/stf-parse.c (stf_parse_general): Drop maxline argument.  All
	callers changed.

	* src/commands.c (cmd_text_to_columns): Plug leaks.

2006-01-06  Morten Welinder  <terra@gnome.org>

	* src/commands.c (cmd_search_replace_update_after_action): Add wbc
	argument and pass it on to update_after_action.  All callers
	changed.
	(cmd_search_replace_do): Add wbc argument and pass it on to
	cmd_search_replace_update_after_action.  All callers changed.

2006-01-02  Stepan Kasal  <kasal@ucw.cz>

	* schemas/gnumeric-dialogs.schemas.in (unfocused): Fix a typo
	  in the description.

2005-12-28  Jody Goldberg <jody@gnome.org>

	* src/workbook.c : Move to GsfDocMetaData

	* src/commands.c (cmd_change_meta_data*) : re-work for new metadata
	  structure.

	* src/Makefile.am : remove the defunct summary.[ch]

	* src/GNOME_Gnumeric-gtk.xml.in : enable the new dialog in place of
	  the old one.
	* src/wbcg-actions.c : ditto.

2005-12-22  Morten Welinder  <terra@gnome.org>

	* src/workbook.c (workbook_cells): Remove the variables orphaned by
	the previous Stepan's change.

2005-12-22  Stepan Kasal  <kasal@ucw.cz>

	* src/sheet-filter.c (cell_value_cmp): Fix "const" warning.

	* src/workbook.c (workbook_cells): Use WORKBOOK_FOREACH_SHEET, not
	workbook_sheets.

2005-12-21  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_call_with_list): Eliminate 'B'.  It was
	identical to 'E'.
	(function_def_get_arg_type_string): Ditto.

2005-12-13  Morten Welinder  <terra@gnome.org>

	* src/parser.y (build_set): Make this function unregister argument
	on success like all the other build_* functions.  Fix caller to
	not leak in error case.  Fixes #301127.

2005-12-13  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_read_scenarios): Plug leak.

	* src/xml-sax-write.c (xml_write_scenarios): Add missing
	gsf_xml_out_end_element corrupting files.

2005-12-12  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-object-graph.c (sog_gsf_gdk_pixbuf_save): removed.
	(gnm_sog_write_image): use gog_graph_export_image API.
	(sog_cb_save_as): use gog_graph_get_supported_image_formats API.
	Format is an enum now.
	* src/sheet-object-image.c (soi_get_image_fmt): removed. It's in
	goffice now. 
	(soi_free_image_fmt): removed.
	(gnm_soi_write_image): use go_image_get_formats_with_pixbuf_saver API.

2005-12-12  Morten Welinder  <terra@gnome.org>

	* src/xml-io.c (xml_node_get_value): Add protections against file
	corruption.  Fixes crash from #323888.

2005-12-11  Jon K Hellan  <hellan@acm.org>

	* src/gui-clipboard.[ch] (x_store_clipboard_if_needed): New
	function. Hand clipboard off to clipboard manager if this is the
	last remaining wbcg.

	* src/gui-clipboard.c (table_cellregion_write): Replace wbc
	parameter with a command context.
	(image_write, graph_write): Remove sheet parameter.
	(x_clipboard_get_cb): We're no longer passed a wbcg. Instead,
	create a temporary command context. Test output from
	gnm_cellregion_to_xml before using. Use workbook_date_conv from
	workbook of clipboard's origin_sheet.
	(x_clipboard_clear_cb): Simplify.
	(x_claim_clipboard): Register x_clipboard_clear_cb only for
	CLIPBOARD, not for PRIMARY. Call gtk_clipboard_set_can_store,
	indicating that we can hand clipboard off to clipboard manager
	when exiting.

	* src/workbook-control-gui.c (wbcg_finalize): Call
	x_store_clipboard_if_needed.

2005-12-09  Morten Welinder  <terra@gnome.org>

	* templates/english/loan.gnumeric: Replace BOLT.  (Boring Old Loan
	Template.)  Supplied by Philo Vivero.  #317201.

2005-12-08  Jody Goldberg <jody@gnome.org>

	* src/parse-util.c (gnm_expr_conventions_new) : assign a std set of
	  ascii characters that do not require quoting.
	(gnm_expr_conv_quote) : renamed from

2005-12-08  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_def_get_arg_type_string): Note, that 'B'
	accepts errors too.
	(function_call_with_list): Fix last fix.

	* src/parse-util.c (sheetref_parse): Handle sheet names starting
	with digits.

	* src/sheet.c (sheet_name_quote): Simplify and handle non-initial
	dot.

2005-11-30  Morten Welinder  <terra@gnome.org>

	* src/func.c (function_call_with_list): Fix handling of strings
	for 'b' argument types.  We only want TRUE/FALSE, not dates and
	numbers in strings.

	* src/commands.c (cmd_set_text): Plug leak.

	* src/value.c (value_new_from_string): Factor out boolean parsing
	into value_parse_boolean.
	(value_get_as_bool): Use value_parse_boolean.  This changes
	semantics so that only "TRUE" and "FALSE" (ignoring case) are valid
	values.

2005-12-01 Eduardo Lima <eduardo.lima@indt.org.br>

	* wbcg-actions.c (cb_view_zoom_in): Changed name to cb_view_zoom_out.
	(cb_view_zoom_out): Changed name to cb_view_zoom_in.

2005-11-30 Eduardo Lima <eduardo.lima@indt.org.br>

	* src/workbook-control-gui.c (wbcg_finalize:1665): Fixed compile
	error in Maemo Platform.

2005-11-28  Morten Welinder  <terra@gnome.org>

	* src/sheet-filter.c (cb_collect_unique): Map value to cells.
	(cb_hash_range): Renamed from cb_copy_hash_to_array.  Changed to
	collect values (i.e., cells) , not keys (i.e., values).
	(collect_unique_elements): Format values for display.  Fixes
	#322392.

2005-11-18  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/gnumeric-pane.c (cb_control_point_event): begin drag mode even
	for created object.

2005-11-18  Emmanuel Pacaud <emmanuel.pacaud@univ-poitiers.fr>

	* src/sheet-object-graph.c (gnm_sog_write_image): don't use pixbuf
	directly, but use helpers function from goffice/graph/gog-renderer.c,
	in order to ease testing of goffice cairo renderer.
	(sheet_object_graph_set_gog): ditto.

2005-11-15  Stepan Kasal  <kasal@ucw.cz>

	* README: Fix the goffice requirement.
	* src/application.c (gnm_app_workbook_list_add): Fix the comment.

2005-11-14  Jody Goldberg <jody@gnome.org>

	* configure.in : Post BRANCH bump
	  re-enable the disable_deprecated flags

2005-11-14  Jody Goldberg <jody@gnome.org>

	* Release 1.6.1
